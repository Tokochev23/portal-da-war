<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atribui√ß√£o Autom√°tica de Potenciais de Recursos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
    }
  </style>
</head>
<body class="min-h-screen p-8">
  <div class="max-w-6xl mx-auto">
    <div class="bg-slate-800/50 backdrop-blur border border-slate-600/50 rounded-2xl p-8 mb-8">
      <h1 class="text-3xl font-bold text-center mb-2">üåç Atribui√ß√£o de Potenciais de Recursos</h1>
      <p class="text-center text-slate-400">Baseado na realidade hist√≥rica de 1954</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Controles -->
      <div class="bg-slate-800/30 border border-slate-600/50 rounded-xl p-6">
        <h2 class="text-xl font-semibold mb-4 text-emerald-400">üöÄ Executar Atribui√ß√£o</h2>
        <div class="space-y-4">
          <button id="btn-execute-assignment" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-semibold px-6 py-4 rounded-lg transition-colors">
            Atribuir Potenciais Automaticamente
          </button>

          <button id="btn-show-preview" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-medium px-6 py-3 rounded-lg transition-colors">
            Visualizar Potenciais (Preview)
          </button>

          <div id="assignment-status" class="text-sm text-slate-400 p-3 rounded bg-slate-900/50">
            Aguardando execu√ß√£o...
          </div>
        </div>
      </div>

      <!-- Estat√≠sticas -->
      <div class="bg-slate-800/30 border border-slate-600/50 rounded-xl p-6">
        <h2 class="text-xl font-semibold mb-4 text-purple-400">üìä Estat√≠sticas</h2>
        <div id="statistics" class="space-y-3 text-sm">
          <div class="flex justify-between">
            <span class="text-slate-400">Pa√≠ses Mapeados:</span>
            <span class="text-slate-200 font-medium">50+</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-400">Recursos por Pa√≠s:</span>
            <span class="text-slate-200 font-medium">6 tipos</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-400">Escala de Potencial:</span>
            <span class="text-slate-200 font-medium">0-10</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-400">Base Hist√≥rica:</span>
            <span class="text-emerald-400 font-medium">1954</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Preview dos Potenciais -->
    <div id="preview-section" class="mt-8 bg-slate-900/50 border border-slate-600/50 rounded-xl p-6 hidden">
      <h3 class="text-lg font-semibold mb-4 text-blue-400">üîç Preview dos Potenciais por Pa√≠s</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-slate-600">
              <th class="text-left py-2 px-3 text-slate-300">Pa√≠s</th>
              <th class="text-center py-2 px-2 text-amber-400">üõ¢Ô∏è Petr√≥leo</th>
              <th class="text-center py-2 px-2 text-gray-400">‚ö´ Carv√£o</th>
              <th class="text-center py-2 px-2 text-orange-400">‚õèÔ∏è Metais</th>
              <th class="text-center py-2 px-2 text-green-400">üåæ Agricultura</th>
              <th class="text-center py-2 px-2 text-blue-400">üåä Hidrel√©trico</th>
              <th class="text-center py-2 px-2 text-purple-400">‚ò¢Ô∏è Ur√¢nio</th>
            </tr>
          </thead>
          <tbody id="preview-table-body">
            <!-- Ser√° preenchido dinamicamente -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Log detalhado -->
    <div class="mt-8 bg-slate-900/50 border border-slate-600/50 rounded-xl p-6">
      <h3 class="text-lg font-semibold mb-4">üìã Log de Execu√ß√£o</h3>
      <div id="execution-log" class="bg-slate-950/50 rounded-lg p-4 text-sm font-mono max-h-96 overflow-y-auto">
        <div class="text-slate-400">Sistema carregado. Pronto para atribui√ß√£o de potenciais...</div>
      </div>
    </div>
  </div>

  <script src="./js/services/firebase.js" type="module"></script>
  <script type="module">
    import { db, auth, getAllCountries } from './js/services/firebase.js';
    import { assignResourcePotentials, generateResourceReport } from './scripts/assign-resource-potentials.js';

    const log = document.getElementById('execution-log');
    const status = document.getElementById('assignment-status');
    const previewSection = document.getElementById('preview-section');
    const previewTable = document.getElementById('preview-table-body');

    function addLog(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const colors = {
        info: 'text-blue-400',
        success: 'text-emerald-400',
        error: 'text-red-400',
        warning: 'text-amber-400'
      };

      log.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
      log.scrollTop = log.scrollHeight;
    }

    function updateStatus(message, type = 'info') {
      const colors = {
        info: 'text-slate-400',
        success: 'text-emerald-400',
        error: 'text-red-400',
        warning: 'text-amber-400'
      };

      status.innerHTML = message;
      status.className = `text-sm ${colors[type]} p-3 rounded bg-slate-900/50`;
    }

    // Dados dos potenciais (mesmo do script principal)
    const RESOURCE_POTENTIALS = {
      // SUPERPOT√äNCIAS
      'Estados Unidos': { PotencialCombustivel: 9, PotencialCarvao: 10, PotencialMetais: 8, PotencialAgricola: 10, PotencialHidreletrico: 7, PotencialUranio: 7 },
      'URSS': { PotencialCombustivel: 7, PotencialCarvao: 9, PotencialMetais: 9, PotencialAgricola: 8, PotencialHidreletrico: 8, PotencialUranio: 8 },

      // POT√äNCIAS PETROL√çFERAS
      'Venezuela': { PotencialCombustivel: 10, PotencialCarvao: 2, PotencialMetais: 4, PotencialAgricola: 5, PotencialHidreletrico: 6, PotencialUranio: 1 },
      'Ar√°bia Saudita': { PotencialCombustivel: 9, PotencialCarvao: 0, PotencialMetais: 2, PotencialAgricola: 1, PotencialHidreletrico: 1, PotencialUranio: 0 },
      'Ir√£': { PotencialCombustivel: 8, PotencialCarvao: 3, PotencialMetais: 4, PotencialAgricola: 4, PotencialHidreletrico: 3, PotencialUranio: 2 },
      'Kuwait': { PotencialCombustivel: 8, PotencialCarvao: 0, PotencialMetais: 1, PotencialAgricola: 1, PotencialHidreletrico: 0, PotencialUranio: 0 },
      'Iraque': { PotencialCombustivel: 7, PotencialCarvao: 1, PotencialMetais: 3, PotencialAgricola: 4, PotencialHidreletrico: 2, PotencialUranio: 1 },

      // EUROPA
      'Reino Unido': { PotencialCombustivel: 4, PotencialCarvao: 8, PotencialMetais: 4, PotencialAgricola: 5, PotencialHidreletrico: 2, PotencialUranio: 3 },
      'Alemanha': { PotencialCombustivel: 2, PotencialCarvao: 7, PotencialMetais: 5, PotencialAgricola: 6, PotencialHidreletrico: 4, PotencialUranio: 4 },
      'Fran√ßa': { PotencialCombustivel: 2, PotencialCarvao: 4, PotencialMetais: 4, PotencialAgricola: 7, PotencialHidreletrico: 5, PotencialUranio: 5 },
      'It√°lia': { PotencialCombustivel: 1, PotencialCarvao: 2, PotencialMetais: 3, PotencialAgricola: 6, PotencialHidreletrico: 6, PotencialUranio: 2 },
      'Noruega': { PotencialCombustivel: 2, PotencialCarvao: 2, PotencialMetais: 5, PotencialAgricola: 3, PotencialHidreletrico: 9, PotencialUranio: 1 },
      'Su√©cia': { PotencialCombustivel: 1, PotencialCarvao: 2, PotencialMetais: 7, PotencialAgricola: 4, PotencialHidreletrico: 7, PotencialUranio: 3 },

      // AM√âRICAS
      'Brasil': { PotencialCombustivel: 3, PotencialCarvao: 4, PotencialMetais: 7, PotencialAgricola: 8, PotencialHidreletrico: 9, PotencialUranio: 4 },
      'Argentina': { PotencialCombustivel: 4, PotencialCarvao: 2, PotencialMetais: 5, PotencialAgricola: 9, PotencialHidreletrico: 5, PotencialUranio: 3 },
      'M√©xico': { PotencialCombustivel: 6, PotencialCarvao: 3, PotencialMetais: 6, PotencialAgricola: 6, PotencialHidreletrico: 4, PotencialUranio: 3 },
      'Canad√°': { PotencialCombustivel: 6, PotencialCarvao: 6, PotencialMetais: 8, PotencialAgricola: 7, PotencialHidreletrico: 10, PotencialUranio: 9 },

      // √ÅSIA
      'China': { PotencialCombustivel: 4, PotencialCarvao: 8, PotencialMetais: 7, PotencialAgricola: 7, PotencialHidreletrico: 7, PotencialUranio: 5 },
      'Jap√£o': { PotencialCombustivel: 1, PotencialCarvao: 3, PotencialMetais: 2, PotencialAgricola: 4, PotencialHidreletrico: 4, PotencialUranio: 1 },
      '√çndia': { PotencialCombustivel: 3, PotencialCarvao: 6, PotencialMetais: 6, PotencialAgricola: 7, PotencialHidreletrico: 6, PotencialUranio: 4 },

      // √ÅFRICA E OCEANIA
      '√Åfrica do Sul': { PotencialCombustivel: 2, PotencialCarvao: 7, PotencialMetais: 8, PotencialAgricola: 5, PotencialHidreletrico: 3, PotencialUranio: 8 },
      'Austr√°lia': { PotencialCombustivel: 3, PotencialCarvao: 7, PotencialMetais: 7, PotencialAgricola: 6, PotencialHidreletrico: 4, PotencialUranio: 6 },
      'Egito': { PotencialCombustivel: 3, PotencialCarvao: 1, PotencialMetais: 4, PotencialAgricola: 5, PotencialHidreletrico: 7, PotencialUranio: 2 }
    };

    // Executar atribui√ß√£o
    document.getElementById('btn-execute-assignment').addEventListener('click', async () => {
      const btn = document.getElementById('btn-execute-assignment');

      try {
        btn.disabled = true;
        btn.textContent = '‚è≥ Executando...';
        updateStatus('Iniciando atribui√ß√£o autom√°tica...', 'warning');
        addLog('üöÄ Iniciando processo de atribui√ß√£o autom√°tica de potenciais', 'info');

        // Executar a atribui√ß√£o real
        await assignResourcePotentials();

        updateStatus('Atribui√ß√£o conclu√≠da com sucesso! ‚úÖ', 'success');
        addLog('‚úÖ Potenciais atribu√≠dos com sucesso para todos os pa√≠ses', 'success');
        addLog(`üìä Total de ${Object.keys(RESOURCE_POTENTIALS).length} pa√≠ses com potenciais espec√≠ficos`, 'info');

        // Mostrar estat√≠sticas
        const resourceTypes = ['PotencialCombustivel', 'PotencialCarvao', 'PotencialMetais', 'PotencialAgricola', 'PotencialHidreletrico', 'PotencialUranio'];
        resourceTypes.forEach(resource => {
          const maxCountry = Object.entries(RESOURCE_POTENTIALS)
            .sort((a, b) => b[1][resource] - a[1][resource])[0];
          addLog(`üèÜ ${resource}: ${maxCountry[0]} (${maxCountry[1][resource]}/10)`, 'info');
        });

      } catch (error) {
        updateStatus('Erro na atribui√ß√£o ‚ùå', 'error');
        addLog(`‚ùå Erro: ${error.message}`, 'error');
        console.error(error);
      } finally {
        btn.disabled = false;
        btn.textContent = 'Atribuir Potenciais Automaticamente';
      }
    });

    // Mostrar preview
    document.getElementById('btn-show-preview').addEventListener('click', () => {
      addLog('üìã Gerando preview dos potenciais...', 'info');

      previewTable.innerHTML = '';

      // Ordenar pa√≠ses por relev√¢ncia (superpot√™ncias primeiro)
      const sortedCountries = Object.entries(RESOURCE_POTENTIALS)
        .sort((a, b) => {
          const totalA = Object.values(a[1]).reduce((sum, val) => sum + val, 0);
          const totalB = Object.values(b[1]).reduce((sum, val) => sum + val, 0);
          return totalB - totalA;
        });

      sortedCountries.forEach(([country, potentials]) => {
        const row = document.createElement('tr');
        row.className = 'border-b border-slate-700/50 hover:bg-slate-800/30';

        const getColorClass = (value) => {
          if (value >= 8) return 'text-emerald-400 font-semibold';
          if (value >= 6) return 'text-blue-400 font-medium';
          if (value >= 4) return 'text-slate-300';
          if (value >= 2) return 'text-amber-400';
          return 'text-red-400';
        };

        row.innerHTML = `
          <td class="py-2 px-3 font-medium text-slate-200">${country}</td>
          <td class="text-center py-2 px-2 ${getColorClass(potentials.PotencialCombustivel)}">${potentials.PotencialCombustivel}</td>
          <td class="text-center py-2 px-2 ${getColorClass(potentials.PotencialCarvao)}">${potentials.PotencialCarvao}</td>
          <td class="text-center py-2 px-2 ${getColorClass(potentials.PotencialMetais)}">${potentials.PotencialMetais}</td>
          <td class="text-center py-2 px-2 ${getColorClass(potentials.PotencialAgricola)}">${potentials.PotencialAgricola}</td>
          <td class="text-center py-2 px-2 ${getColorClass(potentials.PotencialHidreletrico)}">${potentials.PotencialHidreletrico}</td>
          <td class="text-center py-2 px-2 ${getColorClass(potentials.PotencialUranio)}">${potentials.PotencialUranio}</td>
        `;

        previewTable.appendChild(row);
      });

      previewSection.classList.remove('hidden');
      addLog(`‚úÖ Preview gerado para ${sortedCountries.length} pa√≠ses`, 'success');
    });

    // Autentica√ß√£o
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        addLog(`üë§ Usu√°rio autenticado: ${user.email}`, 'success');
        updateStatus('Sistema pronto para atribui√ß√£o de potenciais', 'success');
      } else {
        addLog('‚ö†Ô∏è Usu√°rio n√£o autenticado', 'warning');
        updateStatus('Fa√ßa login para executar a atribui√ß√£o', 'warning');
      }
    });

  </script>
</body>
</html>