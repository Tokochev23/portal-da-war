<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Sistema de Loading Otimizado</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-section {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            margin-top: 0;
            color: #06b6d4;
        }

        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 4px;
        }

        button:hover {
            background: #2563eb;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .log {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .metric {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #10b981;
        }

        .metric-label {
            font-size: 0.8em;
            color: #94a3b8;
            margin-top: 4px;
        }

        #test-content {
            min-height: 200px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Teste do Sistema de Loading Otimizado</h1>

        <div class="test-section">
            <h2>üìã Template Loading Tests</h2>
            <p>Teste o carregamento otimizado de templates com cache.</p>

            <div>
                <button onclick="testTemplateLoading()">Carregar Templates (Primeira vez)</button>
                <button onclick="testTemplateCaching()">Testar Cache (Segunda vez)</button>
                <button onclick="testBatchLoading()">Carregamento em Lote</button>
                <button onclick="clearTemplateCache()">Limpar Cache</button>
            </div>

            <div id="test-content"></div>
        </div>

        <div class="test-section">
            <h2>üìä Performance Metrics</h2>
            <div>
                <button onclick="updateMetrics()">Atualizar M√©tricas</button>
                <button onclick="showDetailedMetrics()">M√©tricas Detalhadas</button>
                <button onclick="resetMetrics()">Reset M√©tricas</button>
            </div>

            <div class="performance-metrics" id="metrics-display">
                <!-- Metrics will be populated here -->
            </div>
        </div>

        <div class="test-section">
            <h2>‚ö° Component Loading Tests</h2>
            <p>Teste o carregamento otimizado de componentes de aeronaves.</p>

            <div>
                <button onclick="testComponentLoading()">Carregar Componentes</button>
                <button onclick="testAirframeTab()">Testar Aba Fuselagens</button>
                <button onclick="testEnginesTab()">Testar Aba Motores</button>
                <button onclick="testWingsTab()">Testar Aba Asas</button>
            </div>
        </div>

        <div class="test-section">
            <h2>üìù Log do Sistema</h2>
            <div class="log" id="system-log">
                Aguardando testes...
            </div>
        </div>
    </div>

    <script type="module">
        import { optimizedTemplateLoader } from './js/components/OptimizedTemplateLoader.js';
        import { performanceMonitor } from './js/utils/PerformanceMonitor.js';

        // Global functions for testing
        window.testTemplateLoading = async function() {
            log('üîÑ Testando carregamento de templates...');

            try {
                const templates = [
                    'templates/aircraft-creator/airframes-tab.html',
                    'templates/aircraft-creator/engines-tab.html',
                    'templates/aircraft-creator/wings-tab.html'
                ];

                for (const template of templates) {
                    const startTime = performance.now();
                    await optimizedTemplateLoader.loadTemplate(template);
                    const loadTime = performance.now() - startTime;
                    log(`‚úÖ ${template} carregado em ${loadTime.toFixed(2)}ms`);
                }

                log('‚úÖ Todos os templates carregados com sucesso!');
                updateMetrics();

            } catch (error) {
                log(`‚ùå Erro no carregamento: ${error.message}`);
            }
        };

        window.testTemplateCaching = async function() {
            log('üìã Testando efici√™ncia do cache...');

            try {
                const template = 'templates/aircraft-creator/airframes-tab.html';

                const startTime = performance.now();
                await optimizedTemplateLoader.loadTemplate(template);
                const loadTime = performance.now() - startTime;

                log(`‚úÖ Template carregado do cache em ${loadTime.toFixed(2)}ms`);
                updateMetrics();

            } catch (error) {
                log(`‚ùå Erro no cache: ${error.message}`);
            }
        };

        window.testBatchLoading = async function() {
            log('üì¶ Testando carregamento em lote...');

            try {
                const templates = [
                    'templates/aircraft-creator/avionics-tab.html',
                    'templates/aircraft-creator/weapons-tab.html',
                    'templates/aircraft-creator/special-equipment-tab.html'
                ];

                const startTime = performance.now();

                const promises = templates.map(template =>
                    optimizedTemplateLoader.loadTemplate(template, { priority: 'normal' })
                );

                await Promise.all(promises);

                const totalTime = performance.now() - startTime;
                log(`‚úÖ ${templates.length} templates carregados em paralelo em ${totalTime.toFixed(2)}ms`);
                updateMetrics();

            } catch (error) {
                log(`‚ùå Erro no carregamento em lote: ${error.message}`);
            }
        };

        window.clearTemplateCache = function() {
            optimizedTemplateLoader.clearCaches();
            log('üßπ Cache de templates limpo');
            updateMetrics();
        };

        window.testComponentLoading = async function() {
            log('üîÑ Testando carregamento de componentes...');

            // Mock component loading for testing
            if (!window.loadAircraftComponents) {
                window.loadAircraftComponents = async function() {
                    return new Promise(resolve => {
                        setTimeout(() => {
                            window.AIRCRAFT_COMPONENTS = {
                                airframes: { test: { name: 'Test Airframe' } },
                                aircraft_engines: { test: { name: 'Test Engine' } },
                                wing_types: { test: { name: 'Test Wing' } }
                            };
                            resolve();
                        }, 100);
                    });
                };
            }

            try {
                const startTime = performance.now();
                await window.loadAircraftComponents();
                const loadTime = performance.now() - startTime;

                log(`‚úÖ Componentes carregados em ${loadTime.toFixed(2)}ms`);
                updateMetrics();

            } catch (error) {
                log(`‚ùå Erro no carregamento de componentes: ${error.message}`);
            }
        };

        window.testAirframeTab = async function() {
            log('‚úàÔ∏è Testando aba de fuselagens...');

            try {
                const startTime = performance.now();

                // Load template and simulate tab loading
                await optimizedTemplateLoader.loadAndInjectTemplate(
                    'test-content',
                    'templates/aircraft-creator/airframes-tab.html'
                );

                const loadTime = performance.now() - startTime;
                log(`‚úÖ Aba de fuselagens carregada em ${loadTime.toFixed(2)}ms`);
                updateMetrics();

            } catch (error) {
                log(`‚ùå Erro na aba de fuselagens: ${error.message}`);
            }
        };

        window.testEnginesTab = async function() {
            log('‚öôÔ∏è Testando aba de motores...');

            try {
                const startTime = performance.now();

                await optimizedTemplateLoader.loadAndInjectTemplate(
                    'test-content',
                    'templates/aircraft-creator/engines-tab.html'
                );

                const loadTime = performance.now() - startTime;
                log(`‚úÖ Aba de motores carregada em ${loadTime.toFixed(2)}ms`);
                updateMetrics();

            } catch (error) {
                log(`‚ùå Erro na aba de motores: ${error.message}`);
            }
        };

        window.testWingsTab = async function() {
            log('üõ©Ô∏è Testando aba de asas...');

            try {
                const startTime = performance.now();

                await optimizedTemplateLoader.loadAndInjectTemplate(
                    'test-content',
                    'templates/aircraft-creator/wings-tab.html'
                );

                const loadTime = performance.now() - startTime;
                log(`‚úÖ Aba de asas carregada em ${loadTime.toFixed(2)}ms`);
                updateMetrics();

            } catch (error) {
                log(`‚ùå Erro na aba de asas: ${error.message}`);
            }
        };

        window.updateMetrics = function() {
            const metrics = performanceMonitor.getPerformanceSummary();
            const loaderMetrics = optimizedTemplateLoader.getPerformanceMetrics();

            const metricsDisplay = document.getElementById('metrics-display');
            metricsDisplay.innerHTML = `
                <div class="metric">
                    <div class="metric-value">${metrics.totalLoads}</div>
                    <div class="metric-label">Total de Carregamentos</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${metrics.averageLoadTime}</div>
                    <div class="metric-label">Tempo M√©dio</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${metrics.cacheHitRate}</div>
                    <div class="metric-label">Taxa de Cache Hit</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${metrics.successRate}</div>
                    <div class="metric-label">Taxa de Sucesso</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${metrics.uptime}</div>
                    <div class="metric-label">Tempo Ativo</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${metrics.errors}</div>
                    <div class="metric-label">Erros</div>
                </div>
            `;
        };

        window.showDetailedMetrics = function() {
            performanceMonitor.logPerformanceSummary();
            optimizedTemplateLoader.logPerformanceMetrics();

            const recommendations = performanceMonitor.getRecommendations();
            if (recommendations.length > 0) {
                log('üí° Recomenda√ß√µes de performance:');
                recommendations.forEach(rec => {
                    log(`  ‚Ä¢ ${rec.message}`);
                });
            } else {
                log('‚úÖ Nenhuma recomenda√ß√£o de performance no momento');
            }
        };

        window.resetMetrics = function() {
            performanceMonitor.reset();
            optimizedTemplateLoader.clearCaches();
            log('üîÑ M√©tricas resetadas');
            updateMetrics();
        };

        function log(message) {
            const logElement = document.getElementById('system-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Initialize
        log('üöÄ Sistema de teste inicializado');
        updateMetrics();
    </script>
</body>
</html>