<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Sistema de Custos</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #0b1020; 
            color: #fff; 
        }
        .cost-container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #1a2235; 
            border-radius: 12px; 
        }
        .cost-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .cost-item {
            padding: 15px;
            background: #2a3441;
            border-radius: 8px;
            border: 1px solid #3a4451;
        }
        .cost-item h4 {
            color: #ffd166;
            margin: 0 0 8px 0;
        }
        .cost-breakdown {
            margin: 20px 0;
        }
        pre {
            background: #1a2235;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #3a4451;
        }
    </style>
</head>
<body>
    <div class="cost-container">
        <h1>üß™ Teste do Sistema de Custos</h1>
        
        <h2>Ve√≠culo de Teste</h2>
        <div id="vehicle-info"></div>
        
        <h2>Resumo de Custos</h2>
        <div class="cost-summary">
            <div class="cost-item">
                <h4>Custo por Unidade</h4>
                <div id="unit-cost">-</div>
            </div>
            <div class="cost-item">
                <h4>Manuten√ß√£o/Ano</h4>
                <div id="maintenance-cost">-</div>
            </div>
            <div class="cost-item">
                <h4>Opera√ß√£o/Ano</h4>
                <div id="operational-cost">-</div>
            </div>
            <div class="cost-item">
                <h4>Total 10 anos</h4>
                <div id="total-ownership">-</div>
            </div>
        </div>
        
        <h2>An√°lise Detalhada</h2>
        <div id="cost-analysis"></div>
        
        <h2>Debug - Dados RAW</h2>
        <pre id="debug-data">Carregando...</pre>
    </div>

    <!-- Load the cost system and components -->
    <script src="./js/utils/costSystem.js" type="module"></script>
    <script src="./js/data/components/chassis.js" type="module"></script>
    <script src="./js/data/components/engines.js" type="module"></script>
    <script src="./js/data/components/transmissions.js" type="module"></script>
    <script src="./js/data/components/suspensions.js" type="module"></script>
    <script src="./js/data/components/armor_materials.js" type="module"></script>
    <script src="./js/data/components/aa_guns.js" type="module"></script>
    <script src="./js/data/components/optics_systems.js" type="module"></script>
    <script src="./js/data/components/communication.js" type="module"></script>
    <script src="./js/data/components/special_equipment.js" type="module"></script>
    <script src="./js/data/components/fire_control.js" type="module"></script>
    
    <script type="module">
        import { chassis } from './js/data/components/chassis.js';
        import { engines } from './js/data/components/engines.js';
        import { transmissions } from './js/data/components/transmissions.js';
        import { suspensions } from './js/data/components/suspensions.js';
        import { armor_materials } from './js/data/components/armor_materials.js';
        import { aa_guns } from './js/data/components/aa_guns.js';
        import { optics_systems } from './js/data/components/optics_systems.js';
        import { communication } from './js/data/components/communication.js';
        import { special_equipment } from './js/data/components/special_equipment.js';
        import { fire_control } from './js/data/components/fire_control.js';
        
        // Setup global components
        window.VEHICLE_COMPONENTS = {
            chassis,
            engines,
            transmissions,
            suspensions,
            armor_materials,
            aa_guns,
            optics_systems,
            communication,
            special_equipment,
            fire_control
        };
        
        // Create comprehensive test vehicle
        const testVehicle = {
            name: "Test Vehicle Completo",
            chassis: "mbt_medium",
            engine: "diesel_v8_medium",
            transmission: "manual_4speed_combat",
            suspension: "torsion_bar",
            // Test both naming conventions
            armor_thickness: 120,
            armorThickness: 120,
            armor_material: "rolled_homogeneous_armor",
            armorMaterial: "rolled_homogeneous_armor",
            main_gun_caliber: 90,
            fcs: "mechanical_advanced",
            optics: "telescopic_sight",
            communication: "radio_basic",
            // Test special equipment with both conventions
            specialEquipment: ["spall_liner", "wet_ammunition_storage"],
            special_equipment: ["spall_liner", "wet_ammunition_storage"],
            // Test weapons with both conventions
            secondary_weapon: "mg_7_62mm",
            secondary_weapons: ["mg_7_62mm"],
            aa_gun: "cannon_20mm",
            aa_guns: ["cannon_20mm"],
            crewSize: 4,
            quantity: 1
        };
        
        // Display vehicle info
        document.getElementById('vehicle-info').innerHTML = `
            <ul style="columns: 2; column-gap: 30px;">
                <li><strong>Nome:</strong> ${testVehicle.name}</li>
                <li><strong>Chassi:</strong> ${chassis[testVehicle.chassis]?.name || testVehicle.chassis}</li>
                <li><strong>Motor:</strong> ${engines[testVehicle.engine]?.name || testVehicle.engine}</li>
                <li><strong>Transmiss√£o:</strong> ${transmissions[testVehicle.transmission]?.name || testVehicle.transmission}</li>
                <li><strong>Suspens√£o:</strong> ${suspensions[testVehicle.suspension]?.name || testVehicle.suspension}</li>
                <li><strong>Blindagem:</strong> ${testVehicle.armor_thickness}mm ${testVehicle.armor_material}</li>
                <li><strong>Canh√£o:</strong> ${testVehicle.main_gun_caliber}mm</li>
                <li><strong>Tripula√ß√£o:</strong> ${testVehicle.crewSize}</li>
            </ul>
        `;
        
        // Calculate costs
        setTimeout(() => {
            // First, let's test if secondary weapons component is loaded
            console.log('üîç Testing Secondary Weapons Component:');
            console.log('- Available:', !!window.VEHICLE_COMPONENTS?.secondary_weapons);
            console.log('- mg_7_62mm exists:', !!window.VEHICLE_COMPONENTS?.secondary_weapons?.mg_7_62mm);
            console.log('- mg_7_62mm data:', window.VEHICLE_COMPONENTS?.secondary_weapons?.mg_7_62mm);
            
            if (window.CostSystem) {
                const costs = window.CostSystem.calculateCosts(testVehicle);
                
                // Update summary
                document.getElementById('unit-cost').innerHTML = `<strong>$${(costs.production / 1000).toFixed(0)}K</strong>`;
                document.getElementById('maintenance-cost').innerHTML = `<strong>$${(costs.maintenance / 1000).toFixed(0)}K</strong>`;
                document.getElementById('operational-cost').innerHTML = `<strong>$${(costs.operational / 1000).toFixed(0)}K</strong>`;
                document.getElementById('total-ownership').innerHTML = `<strong>$${(costs.total_ownership / 1000).toFixed(0)}K</strong>`;
                
                // Display detailed analysis
                const analysisHtml = window.CostSystem.renderCostDisplay(testVehicle);
                document.getElementById('cost-analysis').innerHTML = analysisHtml;
                
                // Display debug data
                document.getElementById('debug-data').textContent = JSON.stringify(costs, null, 2);
                
                console.log('‚úÖ Teste de custos conclu√≠do:', costs);
            } else {
                document.getElementById('debug-data').textContent = '‚ùå CostSystem n√£o carregado';
                console.error('CostSystem n√£o encontrado');
            }
        }, 500);
    </script>
</body>
</html>