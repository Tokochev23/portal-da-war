<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Sistema PIB per Capita</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6">üß™ Teste do Sistema PIB per Capita</h1>
        
        <!-- Teste dos Utilit√°rios PIB -->
        <div class="bg-slate-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üìä Teste dos C√°lculos PIB</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-medium mb-3">Entrada:</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Popula√ß√£o (milh√µes)</label>
                            <input id="populacao" type="number" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="100" min="0">
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">PIB per Capita ($)</label>
                            <input id="pibPerCapita" type="number" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="25000" min="0">
                        </div>
                        <button id="calcular" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-medium py-2 px-4 rounded">
                            Calcular PIB Total
                        </button>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-medium mb-3">Resultado:</h3>
                    <div id="resultado" class="space-y-3">
                        <div class="p-3 bg-slate-700 rounded">
                            <div class="text-sm text-slate-400">PIB Total</div>
                            <div id="pibTotal" class="text-lg font-semibold">-</div>
                        </div>
                        <div class="p-3 bg-slate-700 rounded">
                            <div class="text-sm text-slate-400">PIB Formatado</div>
                            <div id="pibFormatado" class="text-lg font-semibold">-</div>
                        </div>
                        <div class="p-3 bg-slate-700 rounded">
                            <div class="text-sm text-slate-400">Or√ßamento (25% x 0.8 x 0.7 x 1.5)</div>
                            <div id="orcamento" class="text-lg font-semibold">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Teste de Consist√™ncia -->
        <div class="bg-slate-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üîç Teste de Consist√™ncia</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm text-slate-400 mb-1">PIB Total (atual)</label>
                    <input id="pibAtual" type="number" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="2500000000">
                </div>
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Popula√ß√£o</label>
                    <input id="popAtual" type="number" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="100000000">
                </div>
                <div>
                    <label class="block text-sm text-slate-400 mb-1">PIB per Capita (atual)</label>
                    <input id="pibPerCapitaAtual" type="number" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="24000">
                </div>
            </div>
            
            <button id="validar" class="bg-green-600 hover:bg-green-500 text-white font-medium py-2 px-4 rounded mb-4">
                Validar Consist√™ncia
            </button>
            
            <div id="validacaoResultado" class="p-4 bg-slate-700 rounded">
                <div class="text-sm text-slate-400">Resultado da valida√ß√£o aparecer√° aqui...</div>
            </div>
        </div>
        
        <!-- Teste do Simulador Econ√¥mico -->
        <div class="bg-slate-800 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">üí∞ Teste do Simulador Econ√¥mico</h2>
            
            <div class="mb-4">
                <p class="text-slate-300">O simulador econ√¥mico deve estar dispon√≠vel na interface do narrador.</p>
                <p class="text-sm text-slate-400 mt-2">Para testar:</p>
                <ol class="list-decimal list-inside text-sm text-slate-400 mt-2 space-y-1">
                    <li>Abra o narrador.html</li>
                    <li>V√° para a aba "Ferramentas"</li>
                    <li>Clique em "üí∞ Simulador Econ√¥mico"</li>
                    <li>Configure algumas a√ß√µes e verifique se o crescimento √© aplicado ao PIB per capita</li>
                </ol>
            </div>
            
            <div id="simuladorTeste" class="p-4 bg-slate-700 rounded">
                <div class="text-sm text-slate-400">Status do carregamento dos m√≥dulos:</div>
                <div id="modulosStatus" class="mt-2 space-y-1 text-sm"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { 
            calculatePIBTotal, 
            calculatePIBPerCapita, 
            validatePIBConsistency,
            fixPIBInconsistency,
            calculateBudgetFromPIB,
            formatCurrency,
            formatPIBPerCapita
        } from './js/utils/pibCalculations.js';

        // Elementos do DOM
        const populacaoInput = document.getElementById('populacao');
        const pibPerCapitaInput = document.getElementById('pibPerCapita');
        const calcularBtn = document.getElementById('calcular');
        const pibTotalDiv = document.getElementById('pibTotal');
        const pibFormatadoDiv = document.getElementById('pibFormatado');
        const orcamentoDiv = document.getElementById('orcamento');

        const pibAtualInput = document.getElementById('pibAtual');
        const popAtualInput = document.getElementById('popAtual');
        const pibPerCapitaAtualInput = document.getElementById('pibPerCapitaAtual');
        const validarBtn = document.getElementById('validar');
        const validacaoDiv = document.getElementById('validacaoResultado');

        const modulosStatusDiv = document.getElementById('modulosStatus');

        // Teste dos c√°lculos b√°sicos
        calcularBtn.addEventListener('click', () => {
            try {
                const populacao = parseFloat(populacaoInput.value) || 0;
                const pibPerCapita = parseFloat(pibPerCapitaInput.value) || 0;

                const pibTotal = calculatePIBTotal(populacao * 1000000, pibPerCapita); // Converter milh√µes para unidades
                const pibFormatado = formatCurrency(pibTotal);
                
                // Criar objeto pa√≠s fict√≠cio para teste do or√ßamento
                const paisTeste = {
                    Populacao: populacao * 1000000,
                    PIBPerCapita: pibPerCapita,
                    Burocracia: 80,
                    Estabilidade: 70
                };
                const orcamento = calculateBudgetFromPIB(paisTeste);

                pibTotalDiv.textContent = pibTotal.toLocaleString();
                pibFormatadoDiv.textContent = pibFormatado;
                orcamentoDiv.textContent = formatCurrency(orcamento);

                // Adicionar classe de sucesso
                document.getElementById('resultado').classList.add('border-l-4', 'border-green-500');
            } catch (error) {
                console.error('Erro no c√°lculo:', error);
                pibTotalDiv.textContent = 'Erro: ' + error.message;
                document.getElementById('resultado').classList.add('border-l-4', 'border-red-500');
            }
        });

        // Teste de valida√ß√£o de consist√™ncia
        validarBtn.addEventListener('click', () => {
            try {
                const paisTeste = {
                    PIB: parseFloat(pibAtualInput.value) || 0,
                    Populacao: parseFloat(popAtualInput.value) || 0,
                    PIBPerCapita: parseFloat(pibPerCapitaAtualInput.value) || 0
                };

                const validacao = validatePIBConsistency(paisTeste);
                
                let resultHtml = '';
                if (validacao.isConsistent) {
                    resultHtml = `
                        <div class="flex items-center gap-2 text-green-400">
                            <span>‚úÖ</span>
                            <span class="font-medium">Dados consistentes!</span>
                        </div>
                        <div class="mt-2 text-sm text-slate-300">
                            Fonte preferida: ${validacao.preferredSource === 'pib_total' ? 'PIB Total' : 'PIB per Capita'}
                        </div>
                    `;
                } else {
                    resultHtml = `
                        <div class="flex items-center gap-2 text-red-400">
                            <span>‚ùå</span>
                            <span class="font-medium">Inconsist√™ncia detectada!</span>
                        </div>
                        <div class="mt-2 text-sm text-slate-300">
                            <div><strong>Problema:</strong> ${validacao.message}</div>
                            <div class="mt-2">
                                <strong>PIB atual:</strong> ${paisTeste.PIB.toLocaleString()}<br>
                                <strong>PIB per capita atual:</strong> ${formatPIBPerCapita(paisTeste.PIBPerCapita)}<br>
                                <strong>PIB calculado do per capita:</strong> ${formatCurrency(validacao.calculatedFromPerCapita || 0)}<br>
                                <strong>PIB per capita calculado do PIB:</strong> ${formatPIBPerCapita(validacao.calculatedFromTotal || 0)}
                            </div>
                        </div>
                        <div class="mt-3">
                            <button id="corrigir" class="bg-yellow-600 hover:bg-yellow-500 text-white text-sm py-1 px-3 rounded">
                                Corrigir usando PIB total como refer√™ncia
                            </button>
                        </div>
                    `;
                }
                
                validacaoDiv.innerHTML = resultHtml;
                
                // Adicionar listener para corre√ß√£o
                const corrigirBtn = document.getElementById('corrigir');
                if (corrigirBtn) {
                    corrigirBtn.addEventListener('click', () => {
                        const paisCorrigido = fixPIBInconsistency(paisTeste, 'pib_total');
                        pibPerCapitaAtualInput.value = paisCorrigido.PIBPerCapita.toFixed(2);
                        validarBtn.click(); // Re-executar valida√ß√£o
                    });
                }

            } catch (error) {
                console.error('Erro na valida√ß√£o:', error);
                validacaoDiv.innerHTML = `
                    <div class="text-red-400">
                        <span>üí•</span>
                        <span>Erro: ${error.message}</span>
                    </div>
                `;
            }
        });

        // Verificar status dos m√≥dulos
        function verificarModulos() {
            const modulos = [
                'calculatePIBTotal',
                'calculatePIBPerCapita', 
                'validatePIBConsistency',
                'fixPIBInconsistency',
                'calculateBudgetFromPIB',
                'formatCurrency',
                'formatPIBPerCapita'
            ];

            let statusHtml = '';
            modulos.forEach(modulo => {
                const disponivel = typeof window[modulo] === 'function' || eval(`typeof ${modulo}`) === 'function';
                statusHtml += `
                    <div class="flex items-center gap-2">
                        <span class="${disponivel ? 'text-green-400' : 'text-red-400'}">
                            ${disponivel ? '‚úÖ' : '‚ùå'}
                        </span>
                        <span class="text-slate-300">${modulo}</span>
                    </div>
                `;
            });

            modulosStatusDiv.innerHTML = statusHtml;
        }

        // Executar verifica√ß√£o inicial
        verificarModulos();
        
        // Executar c√°lculo inicial
        calcularBtn.click();
        
        console.log('üß™ Teste do sistema PIB per capita carregado!');
        console.log('üìù Verifique os c√°lculos na interface e abra o narrador.html para testar o simulador econ√¥mico.');
    </script>
</body>
</html>