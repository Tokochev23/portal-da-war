<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üèóÔ∏è Criador de Ve√≠culos Blindados Avan√ßado ‚Ä¢ WAR Era 1954</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22%3E%3Crect width=%2216%22 height=%2216%22 rx=%223%22 fill=%22%23ffb400%22/%3E%3Ctext x=%228%22 y=%2211%22 font-size=%2210%22 text-anchor=%22middle%22 fill=%22%230b1020%22%3EW%3C/text%3E%3C/svg%3E" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: {
              DEFAULT: "#0b1020",
              soft: "#10172a",
              ring: "#1e293b"
            },
            brand: {
              50:"#fff7e6",100:"#ffefcc",200:"#ffe099",300:"#ffd166",400:"#ffc233",
              500:"#ffb400",600:"#e09f00",700:"#b37d00",800:"#805900",900:"#4d3600"
            }
          }
        }
      }
    }
  // Equipamentos: renderer completo (substitui placeholder)
  function loadEquipmentTab() {
    const tabContent = document.getElementById('tab-content');
    const equipmentData = window.VEHICLE_COMPONENTS?.special_equipment || {};
    const currentSpecialEquipment = window.currentVehicle?.specialEquipment || [];

    let html = '';
    html += '<div class="flex items-center justify-between mb-4">';
    html += '  <h3 class="text-lg font-semibold text-slate-100">Equipamentos Especiais</h3>';
    html += '  <div class="text-sm text-slate-400">Selecionados: <span id="equipment-selected-count" class="text-slate-200">' + currentSpecialEquipment.length + '</span></div>';
    html += '</div>';

    const categories = {
      survivability: { name: 'Sobreviv√™ncia', items: [] },
      detection: { name: 'Observa√ß√£o & Detec√ß√£o', items: [] },
      mobility: { name: 'Mobilidade & Engenharia', items: [] },
      camouflage: { name: 'Camuflagem & Oculta√ß√£o', items: [] },
      ew: { name: 'Guerra Eletr√¥nica', items: [] },
      comfort: { name: 'Conforto da Tripula√ß√£o', items: [] },
      maintenance: { name: 'Manuten√ß√£o & Log√≠stica', items: [] },
      other: { name: 'Outros', items: [] }
    };

    Object.entries(equipmentData).forEach(([id, eq]) => {
      let cat = 'other';
      if (eq.crew_survival_bonus || eq.explosion_resistance || eq.fire_suppression_bonus) cat = 'survivability';
      else if (eq.visibility_bonus || eq.blind_spot_reduction || eq.night_combat_bonus || eq.detection_range) cat = 'detection';
      else if (eq.range_bonus || eq.water_crossing_depth || eq.mine_clearance_capability || eq.earthwork_capability) cat = 'mobility';
      else if (eq.concealment_bonus || eq.smoke_deployment_range || eq.continuous_smoke) cat = 'camouflage';
      else if (eq.enemy_communication_disruption || eq.radar_warning) cat = 'ew';
      else if (eq.crew_endurance_bonus || eq.cold_weather_performance || eq.crew_comfort_bonus) cat = 'comfort';
      else if (eq.field_repair_capability || eq.preventive_maintenance_bonus || eq.reliability_bonus || eq.maintenance_time_reduction) cat = 'maintenance';
      const n = (eq.name || '').toLowerCase();
      if (cat === 'other') {
        if (n.includes('spall') || n.includes('armazenamento') || n.includes('supress')) cat = 'survivability';
        else if (n.includes('c√∫pula') || n.includes('perisc') || n.includes('holofote')) cat = 'detection';
        else if (n.includes('vadeamento') || n.includes('rolo') || n.includes('dozer') || n.includes('tanques')) cat = 'mobility';
        else if (n.includes('camuflag') || n.includes('fuma')) cat = 'camouflage';
        else if (n.includes('jammer') || n.includes('radar')) cat = 'ew';
        else if (n.includes('ventila') || n.includes('aquec') || n.includes('assento')) cat = 'comfort';
        else if (n.includes('reparo') || n.includes('pe√ßas') || n.includes('diagn')) cat = 'maintenance';
      }
      categories[cat].items.push([id, eq]);
    });

    html += '<div class="space-y-6">';
    Object.entries(categories).forEach(([key, cat]) => {
      if (cat.items.length === 0) return;
      html += '<div class="mb-2">';
      html += '  <h4 class="text-md font-medium text-slate-200 mb-3">' + cat.name + '</h4>';
      html += '  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">';
      cat.items.forEach(([id, eq]) => {
        const isSelected = currentSpecialEquipment.includes(id);
        html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-lg p-3 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="toggleSpecialEquipment(\'' + id + '\')">';
        html += '  <div class="flex items-start justify-between mb-1">';
        html += '    <h5 class="font-medium text-sm ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '\">' + (eq.name || id) + '</h5>';
        html += '    <span class="text-xs bg-slate-600/50 text-slate-300 px-1 py-0.5 rounded">' + (eq.weight || 0) + 'kg</span>';
        html += '  </div>';
        html += '  <div class="text-xs text-slate-400">';
        html += '    <div><span class="text-slate-500">Custo:</span> <span class="text-slate-300">$' + (eq.cost || 0).toLocaleString() + '</span></div>';
        if (eq.tech_requirement) {
          const lvl = eq.tech_requirement.level || 0;
          html += '    <div class="mt-1"><span class="text-slate-500">Requisito:</span> <span class="text-slate-300">' + (eq.tech_requirement.year || '‚Äî') + ' ¬∑ ' + lvl + '%</span></div>';
        }
        if (eq.experimental) {
          html += '    <div class="text-purple-400 mt-1">Experimental</div>';
        }
        html += '  </div>';
        if (isSelected) {
          html += '  <div class="absolute top-1 right-1"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
        }
        html += '</div>';
      });
      html += '  </div>';
      html += '</div>';
    });
    html += '</div>';

    tabContent.innerHTML = html;
  }
  </script>

  <!-- Inter Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Stardos+Stencil:wght@700&display=swap" rel="stylesheet">
  
  <!-- Chart.js for performance graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body { font-family: Inter, system-ui, sans-serif; background: #0b1020; color: #e2e8f0; }
    .gradient-bg { background: linear-gradient(135deg, #0b1020 0%, #1e293b 100%); }
    .glass { background: rgba(16, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
    .component-card { transition: all 0.2s ease; }
    .component-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); }
    .component-card.selected { border-color: #ffb400; background: rgba(255, 180, 0, 0.1); }
    .component-card.incompatible { 
      opacity: 0.4; 
      border-color: #ef4444; 
      background: rgba(239, 68, 68, 0.1);
      cursor: not-allowed;
    }
    .component-card.incompatible:hover {
      opacity: 0.6;
      transform: none;
      scale: 1;
    }
    .stats-radar { max-width: 300px; max-height: 300px; }
    .loading-shimmer { animation: shimmer 2s ease-in-out infinite alternate; background: linear-gradient(90deg, #334155, #475569, #334155); height: 1rem; border-radius: 0.5rem; }
    @keyframes shimmer { 0% { opacity: 0.5; } 100% { opacity: 1; } }
    .warning-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    .cost-bar { background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444); }
    
    /* Custom slider styles */
    .slider-thumb::-webkit-slider-thumb {
      appearance: none;
      height: 20px;
      width: 20px;
      background: linear-gradient(135deg, #ffb400, #ff8c00);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(255, 180, 0, 0.3);
      transition: all 0.2s ease;
    }
    
    .slider-thumb::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(255, 180, 0, 0.4);
    }
    
    .slider-thumb::-moz-range-thumb {
      height: 20px;
      width: 20px;
      background: linear-gradient(135deg, #ffb400, #ff8c00);
      border-radius: 50%;
      cursor: pointer;
      border: none;
      box-shadow: 0 4px 8px rgba(255, 180, 0, 0.3);
    }
    
    /* Armor slider styles */
    .armor-slider {
      background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
    }
    
    .armor-slider::-webkit-slider-thumb {
      appearance: none;
      height: 24px;
      width: 24px;
      background: linear-gradient(135deg, #1f2937, #374151);
      border: 2px solid #ffb400;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 0 0 2px rgba(255, 180, 0, 0.2);
      transition: all 0.2s ease;
    }
    
    .armor-slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4), 0 0 0 3px rgba(255, 180, 0, 0.3);
      border-color: #ff8c00;
    }
    
    .armor-slider::-moz-range-thumb {
      height: 24px;
      width: 24px;
      background: linear-gradient(135deg, #1f2937, #374151);
      border: 2px solid #ffb400;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>

<body class="gradient-bg min-h-screen">
  <!-- HEADER -->
  <header class="sticky top-0 z-50 border-b border-slate-800/50 bg-bg/80 backdrop-blur-xl">
    <div class="mx-auto flex h-16 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8">
      <div class="flex items-center gap-4">
        <a href="index.html" class="flex items-center gap-3 text-slate-100 hover:text-white transition-colors">
          <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-brand-500 text-sm font-bold text-bg">üèóÔ∏è</div>
          <div class="hidden sm:block">
            <div class="text-sm font-semibold">WAR ‚Ä¢ Era 1954</div>
            <div class="text-xs text-slate-400">Criador de Ve√≠culos Avan√ßado</div>
          </div>
        </a>
      </div>

      <nav class="flex items-center gap-6 text-sm">
        <div id="country-display" class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-800/50">
          <span class="text-xs text-slate-400">Pa√≠s:</span>
          <span id="current-country" class="font-medium text-slate-200">‚Äî</span>
        </div>
        <a href="dashboard.html" class="hover:text-white/90 transition">‚Üê Voltar ao Painel</a>
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- PROJECT INFO SECTION -->
    <section class="mb-8">
      <div class="glass rounded-2xl p-6">
        <div class="flex flex-col lg:flex-row gap-6">
          <div class="flex-1">
            <h1 class="text-3xl font-bold text-slate-100 mb-2">üöó Criador de Ve√≠culos Blindados</h1>
            <p class="text-slate-400 mb-6">Design completo com f√≠sica realista, limita√ß√µes tecnol√≥gicas e custos de produ√ß√£o detalhados</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Nome do Projeto</label>
                <input 
                  type="text" 
                  id="vehicle-name" 
                  class="w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-slate-100 placeholder-slate-400 focus:outline-none focus:border-brand-500 transition-colors"
                  placeholder="Ex: M-62 Carcar√° MBT"
                  oninput="updateVehicleCalculations()"
                />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Quantidade</label>
                <input 
                  type="number" 
                  id="vehicle-quantity" 
                  class="w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-slate-100 focus:outline-none focus:border-brand-500 transition-colors"
                  value="1"
                  min="1"
                  max="1000"
                  oninput="updateVehicleCalculations()"
                />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Prioridade de Produ√ß√£o</label>
                <select id="production-priority" class="w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-slate-100 focus:outline-none focus:border-brand-500 transition-colors">
                  <option value="normal">Normal (12-24 meses)</option>
                  <option value="high">Alta (+25% custo, -30% tempo)</option>
                  <option value="rush">Emerg√™ncia (+50% custo, -50% tempo)</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- REAL-TIME STATS PREVIEW -->
          <div class="lg:w-80">
            <div class="bg-slate-900/50 rounded-xl p-4">
              <h3 class="text-lg font-semibold text-slate-100 mb-4">üìä Estat√≠sticas em Tempo Real</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-slate-400">Peso Total:</span>
                  <span id="live-weight" class="font-mono text-slate-200">‚Äî</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-slate-400">Custo Unit√°rio:</span>
                  <span id="live-cost" class="font-mono text-slate-200">‚Äî</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-slate-400">Confiabilidade:</span>
                  <span id="live-reliability" class="font-mono text-slate-200">‚Äî</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-slate-400">Vel. M√°xima:</span>
                  <span id="live-speed" class="font-mono text-slate-200">‚Äî</span>
                </div>
              </div>
              
              <!-- Chassis Compatibility Info -->
              <div class="mt-4 p-3 bg-slate-800/50 rounded-lg">
                <div class="text-sm font-medium text-slate-300 mb-2">üîß Limita√ß√µes do Chassi</div>
                <div id="chassis-compatibility-info" class="text-xs text-amber-400 leading-relaxed">
                  Selecione um chassi para ver limita√ß√µes espec√≠ficas
                </div>
              </div>
              
              <!-- Performance Radar Chart -->
              <div class="mt-4">
                <canvas id="performance-radar" class="stats-radar"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- COMPONENT SELECTION TABS -->
    <section class="mb-8">
      <div class="glass rounded-2xl">
        <!-- Tab Navigation -->
        <div class="flex border-b border-slate-700 overflow-x-auto">
          <button class="tab-button px-6 py-4 font-medium transition-colors border-b-2 border-transparent hover:border-brand-400 hover:text-brand-300" data-tab="chassis">
            üèóÔ∏è Chassi
          </button>
          <button class="tab-button px-6 py-4 font-medium transition-colors border-b-2 border-transparent hover:border-brand-400 hover:text-brand-300" data-tab="engine">
            ‚öôÔ∏è Motor
          </button>
          <button class="tab-button px-6 py-4 font-medium transition-colors border-b-2 border-transparent hover:border-brand-400 hover:text-brand-300" data-tab="transmission">
            üîß Transmiss√£o
          </button>
          <button class="tab-button px-6 py-4 font-medium transition-colors border-b-2 border-transparent hover:border-brand-400 hover:text-brand-300" data-tab="suspension">
            ‚öôÔ∏è Suspens√£o
          </button>
          <button class="tab-button px-6 py-4 font-medium transition-colors border-b-2 border-transparent hover:border-brand-400 hover:text-brand-300" data-tab="crew">
            üë• Tripula√ß√£o
          </button>
          <button class="tab-button px-6 py-4 font-medium transition-colors border-b-2 border-transparent hover:border-brand-400 hover:text-brand-300" data-tab="armor">
            üõ°Ô∏è Blindagem
          </button>
          <button class="tab-button px-6 py-4 font-medium transition-colors border-b-2 border-transparent hover:border-brand-400 hover:text-brand-300" data-tab="weapons">
            üí• Armamento
          </button>
          <button class="tab-button px-6 py-4 font-medium transition-colors border-b-2 border-transparent hover:border-brand-400 hover:text-brand-300" data-tab="systems">
            üì° Sistemas
          </button>
          <button class="tab-button px-6 py-4 font-medium transition-colors border-b-2 border-transparent hover:border-brand-400 hover:text-brand-300" data-tab="equipment">
            üî¨ Equipamentos
          </button>
        </div>
        
        <!-- Tab Content Panels -->
        <div id="tab-content" class="p-6">
          <!-- Dynamic content will be loaded here -->
        </div>
      </div>
    </section>

    <!-- WARNINGS & ALERTS -->
    <section id="warnings-section" class="mb-8" style="display: none;">
      <div class="space-y-3">
        <!-- Dynamic warnings will appear here -->
      </div>
    </section>

    <!-- DETAILED ANALYSIS SECTION -->
    <section class="mb-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- PERFORMANCE ANALYSIS -->
        <div class="glass rounded-2xl p-6">
          <h3 class="text-xl font-semibold text-slate-100 mb-4">üìà An√°lise de Performance</h3>
          <div id="performance-analysis">
            <div class="loading-shimmer w-full"></div>
            <div class="loading-shimmer w-3/4 mt-2"></div>
            <div class="loading-shimmer w-1/2 mt-2"></div>
          </div>
        </div>

        <!-- COST BREAKDOWN -->
        <div class="glass rounded-2xl p-6">
          <h3 class="text-xl font-semibold text-slate-100 mb-4">üí∞ An√°lise de Custos</h3>
          <div id="cost-breakdown">
            <div class="loading-shimmer w-full"></div>
            <div class="loading-shimmer w-2/3 mt-2"></div>
            <div class="loading-shimmer w-3/4 mt-2"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ACTION BUTTONS -->
    <section class="text-center">
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button 
          id="calculate-btn"
          class="px-8 py-3 bg-brand-500 hover:bg-brand-600 text-bg font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          onclick="performFullAnalysis()"
        >
          üßÆ Calcular Performance Completa
        </button>
        
        <button 
          id="save-prototype-btn"
          class="px-8 py-3 bg-slate-700 hover:bg-slate-600 text-slate-100 font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          onclick="savePrototype()"
        >
          üíæ Salvar Prot√≥tipo
        </button>
        
        <button 
          id="submit-approval-btn"
          class="px-8 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          onclick="submitForApproval()"
        >
          üìã Enviar para Aprova√ß√£o
        </button>
      </div>
    </section>

  </main>

  <!-- COMPONENT COMPATIBILITY TOOLTIP -->
  <div id="compatibility-tooltip" class="fixed z-50 pointer-events-none opacity-0 transition-opacity duration-200 bg-slate-900 border border-slate-700 rounded-lg p-3 shadow-xl max-w-sm">
    <div id="tooltip-content" class="text-sm text-slate-200"></div>
  </div>

  <!-- LOADING OVERLAY -->
  <div id="loading-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center" style="display: none;">
    <div class="glass rounded-2xl p-8 text-center">
      <div class="animate-spin w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full mx-auto mb-4"></div>
      <p class="text-slate-200">Carregando componentes...</p>
    </div>
  </div>

  <!-- Firebase & Scripts -->
  <script src="./js/services/firebase.js" type="module"></script>
  <script src="js/vehicleCreator.js" type="module"></script>
  
  <script>
    // Advanced UI Controller
    let currentTab = 'chassis';
    let performanceChart = null;

    // Initialize when page loads
    window.addEventListener('load', async () => {
      console.log('üöó Initializing Advanced Vehicle Creator UI...');
      await new Promise(resolve => setTimeout(resolve, 100)); 
      
      initializeInterface();
      setupTabNavigation();
      setupPerformanceChart();
      loadComponentTabs();
    });

    function initializeInterface() {
      const country = localStorage.getItem('loggedCountry') || 'Desconhecido';
      document.getElementById('current-country').textContent = country;
      setActiveTab('chassis');
    }

    function setupTabNavigation() {
      const tabButtons = document.querySelectorAll('.tab-button');
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const tabId = button.dataset.tab;
          setActiveTab(tabId);
          loadTabContent(tabId);
        });
      });
    }

    function setActiveTab(tabId) {
      currentTab = tabId;
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-brand-500', 'text-brand-300');
        btn.classList.add('border-transparent', 'text-slate-400');
      });
      const activeBtn = document.querySelector('[data-tab="' + tabId + '"]');
      if(activeBtn) {
        activeBtn.classList.add('border-brand-500', 'text-brand-300');
        activeBtn.classList.remove('border-transparent', 'text-slate-400');
      }
    }

    function loadTabContent(tabId) {
      const tabContent = document.getElementById('tab-content');
      tabContent.innerHTML = '<div class="text-center py-8"><div class="animate-spin w-6 h-6 border-2 border-brand-500 border-t-transparent rounded-full mx-auto"></div></div>';
      
      setTimeout(() => {
        switch(tabId) {
          case 'chassis': loadChassisTab(); break;
          case 'engine': loadEngineTab(); break;
          case 'transmission': loadTransmissionTab(); break;
          case 'suspension': loadSuspensionTab(); break;
          case 'crew': loadCrewTab(); break;
          case 'armor': loadArmorTab(); break;
          case 'weapons': loadWeaponsTab(); break;
          case 'systems': loadSystemsTab(); break;
          case 'equipment': loadEquipmentTab(); break;
        }
      }, 200);
    }

    function loadComponentTabs() {
      loadTabContent(currentTab);
    }

    function setupPerformanceChart() {
      const ctx = document.getElementById('performance-radar').getContext('2d');
      performanceChart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: ['Velocidade', 'Blindagem', 'Pot√™ncia', 'Confiabilidade', 'Economia', 'Manutenibilidade'],
          datasets: [{
            label: 'Performance',
            data: [0, 0, 0, 0, 0, 0],
            backgroundColor: 'rgba(255, 180, 0, 0.2)',
            borderColor: 'rgba(255, 180, 0, 0.8)',
            pointBackgroundColor: 'rgba(255, 180, 0, 1)',
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: { r: { min: 0, max: 100, ticks: { display: false }, grid: { color: 'rgba(255, 255, 255, 0.1)' }, pointLabels: { color: 'rgba(255, 255, 255, 0.7)', font: { size: 11 } } } },
          plugins: { legend: { display: false } }
        }
      });
    }

    // FUN√á√ïES DE RENDERIZA√á√ÉO DE ABAS - SINTAXE CORRIGIDA
    function loadChassisTab() {
        if (!window.VEHICLE_COMPONENTS || !window.VEHICLE_COMPONENTS.chassis) {
            document.getElementById('tab-content').innerHTML = '<div class="text-center text-slate-400">Carregando componentes...</div>';
            return;
        }
        
        const chassisComponents = window.VEHICLE_COMPONENTS.chassis;
        const tabContent = document.getElementById('tab-content');
        let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
        
        Object.entries(chassisComponents).forEach(([id, chassis]) => {
            const compatibility = window.checkComponentCompatibility ? window.checkComponentCompatibility('chassis', id) : { compatible: true };
            const compatClass = compatibility.compatible ? '' : 'incompatible';
            const isSelected = window.currentVehicle && window.currentVehicle.chassis === id;
            const costLevel = chassis.base_cost > 120000 ? 'high' : chassis.base_cost > 80000 ? 'medium' : 'low';
            const techLevel = chassis.tech_requirement && chassis.tech_requirement.level > 70 ? 'advanced' : chassis.tech_requirement && chassis.tech_requirement.level > 50 ? 'standard' : 'basic';
            const reliabilityLevel = chassis.reliability > 0.85 ? 'excellent' : chassis.reliability > 0.7 ? 'good' : 'fair';
            
            html += '<div class="component-card ' + compatClass + (isSelected ? ' selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : ' bg-slate-800/40 border-slate-700/50') + ' rounded-xl p-4 cursor-pointer hover:border-brand-500/60 hover:bg-slate-800/60 hover:shadow-lg hover:shadow-brand-500/10 transition-all duration-200" onclick="selectChassis(\'' + id + '\')" data-tooltip="' + (compatibility.reason || 'Compat√≠vel') + '">';
            html += '<div class="flex items-start justify-between mb-3">';
            html += '<h4 class="font-semibold ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + ' text-base">' + chassis.name + '</h4>';
            
            if (chassis.tech_requirement && chassis.tech_requirement.level) {
                html += '<span class="text-xs px-2 py-1 rounded font-medium ';
                html += techLevel === 'advanced' ? 'bg-purple-500/20 text-purple-300 border border-purple-500/30' :
                       techLevel === 'standard' ? 'bg-blue-500/20 text-blue-300 border border-blue-500/30' :
                       'bg-slate-600/50 text-slate-400';
                html += '">' + chassis.tech_requirement.level + '% tech</span>';
            }
            
            html += '</div>';
            html += '<div class="grid grid-cols-2 gap-2 text-xs text-slate-400">';
            html += '<div class="space-y-1">';
            html += '<div><span class="text-slate-500">Peso:</span> <span class="' + (isSelected ? 'text-brand-200' : 'text-slate-300') + ' font-medium">' + (chassis.base_weight/1000).toFixed(1) + 't</span></div>';
            html += '<div><span class="text-slate-500">Vel M√°x:</span> <span class="' + (isSelected ? 'text-brand-200' : 'text-slate-300') + ' font-medium">' + chassis.base_speed + 'km/h</span></div>';
            html += '</div>';
            html += '<div class="space-y-1">';
            html += '<div><span class="text-slate-500">Custo:</span> <span class="' + (isSelected ? 'text-brand-200' : 'text-slate-300') + ' font-medium ' + (costLevel === 'high' ? 'text-red-400' : costLevel === 'medium' ? 'text-amber-400' : 'text-emerald-400') + '">$' + (chassis.base_cost/1000).toFixed(0) + 'K</span></div>';
            
            if (chassis.max_armor_thickness) {
                html += '<div><span class="text-slate-500">Blindagem:</span> <span class="' + (isSelected ? 'text-brand-200' : 'text-slate-300') + ' font-medium">' + chassis.max_armor_thickness + 'mm</span></div>';
            }
            
            html += '</div>';
            html += '</div>';
            
            if (chassis.reliability) {
                html += '<div class="mt-3 pt-2 border-t ' + (isSelected ? 'border-brand-700/50' : 'border-slate-700/50') + '">';
                html += '<div class="flex justify-between items-center text-xs">';
                html += '<span class="text-slate-500">Confiabilidade</span>';
                html += '<div class="flex items-center gap-2">';
                html += '<div class="w-16 h-1.5 bg-slate-700 rounded-full overflow-hidden">';
                html += '<div class="h-full rounded-full ' + (reliabilityLevel === 'excellent' ? 'bg-gradient-to-r from-emerald-500 to-emerald-400' : reliabilityLevel === 'good' ? 'bg-gradient-to-r from-blue-500 to-blue-400' : 'bg-gradient-to-r from-amber-500 to-amber-400') + '" style="width: ' + (chassis.reliability * 100) + '%"></div>';
                html += '</div>';
                html += '<span class="' + (isSelected ? 'text-brand-200' : 'text-slate-300') + ' font-medium ' + (reliabilityLevel === 'excellent' ? 'text-emerald-400' : reliabilityLevel === 'good' ? 'text-blue-400' : 'text-amber-400') + '">' + Math.round(chassis.reliability * 100) + '%</span>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            if (!compatibility.compatible) {
                html += '<div class="absolute top-2 left-2"><div class="w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold">!</div></div>';
                html += '<div class="mt-2 p-2 bg-red-900/30 border border-red-500/30 rounded text-xs text-red-300">' + compatibility.reason + '</div>';
            }
            html += '</div>';
        });
        
        tabContent.innerHTML = html + '</div>';
    }

    function loadEngineTab() {
        if (!window.VEHICLE_COMPONENTS || !window.VEHICLE_COMPONENTS.engines) {
            document.getElementById('tab-content').innerHTML = '<div class="text-center text-slate-400">Carregando componentes...</div>';
            return;
        }
        
        const engines = window.filterCompatibleComponents ? window.filterCompatibleComponents('engines') : window.VEHICLE_COMPONENTS.engines;
        const tabContent = document.getElementById('tab-content');
        let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
        
        Object.entries(engines).forEach(function([id, engine]) {
            const compatibility = window.checkComponentCompatibility ? window.checkComponentCompatibility('engines', id) : { compatible: true };
            const compatClass = compatibility.compatible ? '' : 'incompatible';
            const isSelected = window.currentVehicle && window.currentVehicle.engine === id;
            const powerLevel = engine.power > 800 ? 'high' : engine.power > 500 ? 'medium' : 'low';
            const costLevel = engine.cost > 25000 ? 'high' : engine.cost > 15000 ? 'medium' : 'low';
            const techLevel = (engine.tech_requirement && engine.tech_requirement.level || 50) > 70 ? 'advanced' : (engine.tech_requirement && engine.tech_requirement.level || 50) > 50 ? 'standard' : 'basic';
            const reliabilityLevel = engine.reliability > 0.85 ? 'excellent' : engine.reliability > 0.7 ? 'good' : 'fair';
            const fuelLevel = engine.consumption > 2.0 ? 'high' : engine.consumption > 1.5 ? 'medium' : 'low';
            
            let cardClass = 'component-card ' + compatClass;
            if (isSelected) {
                cardClass += ' selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg';
            } else if (compatibility.compatible) {
                cardClass += ' bg-slate-800/40 border-slate-700/50';
            } else {
                cardClass += ' bg-red-900/20 border-red-500/50';
            }
            
            const tooltipText = compatibility.reason || 'Compat√≠vel';
            const techText = (engine.tech_requirement && engine.tech_requirement.level || 50) + '% tech';
            
            html += '<div class="' + cardClass + ' rounded-xl p-4 cursor-pointer hover:border-brand-500/60 hover:bg-slate-800/60 hover:shadow-lg hover:shadow-brand-500/10 transition-all duration-200" onclick="selectEngine(\'' + id + '\')" data-tooltip="' + tooltipText + '">';
            html += '<div class="flex items-start justify-between mb-3">';
            html += '<h4 class="font-semibold text-slate-100 text-base">' + engine.name + '</h4>';
            html += '<span class="text-xs px-2 py-1 rounded font-medium">' + techText + '</span>';
            html += '</div>';
            html += '<div class="grid grid-cols-2 gap-2 text-xs text-slate-400">';
            html += '<div class="space-y-1">';
            html += '<div><span class="text-slate-500">Pot√™ncia:</span> <span class="text-slate-300 font-medium">' + engine.power + 'hp</span></div>';
            html += '<div><span class="text-slate-500">Peso:</span> <span class="text-slate-300 font-medium">' + engine.weight + 'kg</span></div>';
            html += '</div>';
            html += '<div class="space-y-1">';
            html += '<div><span class="text-slate-500">Custo:</span> <span class="text-slate-300 font-medium">$' + (engine.cost/1000).toFixed(0) + 'K</span></div>';
            html += '<div><span class="text-slate-500">Consumo:</span> <span class="text-slate-300 font-medium">' + engine.consumption + 'L/h</span></div>';
            html += '</div>';
            html += '</div>';
            html += '<div class="mt-3 pt-2 border-t border-slate-700/50">';
            html += '<div class="flex justify-between items-center text-xs">';
            html += '<span class="text-slate-500">Confiabilidade</span>';
            html += '<div class="flex items-center gap-2">';
            html += '<div class="w-16 h-1.5 bg-slate-700 rounded-full overflow-hidden">';
            html += '<div class="h-full rounded-full bg-gradient-to-r from-emerald-500 to-emerald-400" style="width: ' + (engine.reliability * 100) + '%"></div>';
            html += '</div>';
            html += '<span class="font-medium">' + Math.round(engine.reliability * 100) + '%</span>';
            html += '</div>';
            html += '</div>';
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            if (!compatibility.compatible) {
                html += '<div class="absolute top-2 left-2"><div class="w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold">!</div></div>';
                html += '<div class="mt-2 p-2 bg-red-900/30 border border-red-500/30 rounded text-xs text-red-300">' + compatibility.reason + '</div>';
            }
            html += '</div>';
        });
        
        tabContent.innerHTML = html + '</div>';
    }

    function loadTransmissionTab() {
        if (!window.VEHICLE_COMPONENTS || !window.VEHICLE_COMPONENTS.transmissions) {
            document.getElementById('tab-content').innerHTML = '<div class="text-center text-slate-400">Carregando componentes...</div>';
            return;
        }
        
        const transmissions = window.filterCompatibleComponents ? window.filterCompatibleComponents('transmissions') : window.VEHICLE_COMPONENTS.transmissions;
        const tabContent = document.getElementById('tab-content');
        let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
        
        Object.entries(transmissions).forEach(function([id, transmission]) {
            const compatibility = window.checkComponentCompatibility ? window.checkComponentCompatibility('transmissions', id) : { compatible: true };
            const compatClass = compatibility.compatible ? '' : 'incompatible';
            const isSelected = window.currentVehicle && window.currentVehicle.transmission === id;
            
            let cardClass = 'component-card ' + compatClass;
            if (isSelected) {
                cardClass += ' selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg';
            } else {
                cardClass += ' bg-slate-800/40 border-slate-700/50';
            }
            
            const tooltipText = compatibility.reason || 'Compat√≠vel';
            
            html += '<div class="' + cardClass + ' rounded-xl p-4 cursor-pointer hover:border-brand-500/60 hover:bg-slate-800/60 hover:shadow-lg hover:shadow-brand-500/10 transition-all duration-200" onclick="selectTransmission(\'' + id + '\')" data-tooltip="' + tooltipText + '">';
            html += '<div class="flex items-start justify-between mb-3">';
            html += '<h4 class="font-semibold text-slate-100 text-base">' + transmission.name + '</h4>';
            html += '</div>';
            html += '<div class="grid grid-cols-2 gap-2 text-xs text-slate-400">';
            html += '<div class="space-y-1">';
            html += '<div><span class="text-slate-500">Tipo:</span> <span class="text-slate-300 font-medium">' + transmission.type + '</span></div>';
            html += '<div><span class="text-slate-500">Peso:</span> <span class="text-slate-300 font-medium">' + transmission.weight + 'kg</span></div>';
            html += '</div>';
            html += '<div class="space-y-1">';
            html += '<div><span class="text-slate-500">Custo:</span> <span class="text-slate-300 font-medium">$' + (transmission.cost/1000).toFixed(0) + 'K</span></div>';
            html += '<div><span class="text-slate-500">Efici√™ncia:</span> <span class="text-slate-300 font-medium">' + Math.round(transmission.efficiency * 100) + '%</span></div>';
            html += '</div>';
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            if (!compatibility.compatible) {
                html += '<div class="absolute top-2 left-2"><div class="w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold">!</div></div>';
                html += '<div class="mt-2 p-2 bg-red-900/30 border border-red-500/30 rounded text-xs text-red-300">' + compatibility.reason + '</div>';
            }
            html += '</div>';
        });
        
        tabContent.innerHTML = html + '</div>';
    }

    function loadSuspensionTab() {
        if (!window.VEHICLE_COMPONENTS || !window.VEHICLE_COMPONENTS.suspensions) {
            document.getElementById('tab-content').innerHTML = '<div class="text-center text-slate-400">Carregando componentes...</div>';
            return;
        }
        
        const suspensions = window.filterCompatibleComponents ? window.filterCompatibleComponents('suspensions') : window.VEHICLE_COMPONENTS.suspensions;
        const tabContent = document.getElementById('tab-content');
        let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
        
        Object.entries(suspensions).forEach(([id, suspension]) => {
            const compatibility = window.checkComponentCompatibility ? window.checkComponentCompatibility('suspensions', id) : { compatible: true };
            const compatClass = compatibility.compatible ? '' : 'incompatible';
            const isSelected = window.currentVehicle && window.currentVehicle.suspension === id;
            
            html += '<div class="component-card ' + compatClass + (isSelected ? ' selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : ' bg-slate-800/40 border-slate-700/50') + ' rounded-xl p-4 cursor-pointer hover:border-brand-500/60 hover:bg-slate-800/60 hover:shadow-lg hover:shadow-brand-500/10 transition-all duration-200" onclick="selectSuspension(\'' + id + '\')" data-tooltip="' + (compatibility.reason || 'Compat√≠vel') + '">';
            html += '<div class="flex items-start justify-between mb-3">';
            html += '<h4 class="font-semibold ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + ' text-base">' + suspension.name + '</h4>';
            html += '</div>';
            html += '<div class="grid grid-cols-2 gap-2 text-xs text-slate-400">';
            html += '<div class="space-y-1">';
            html += '<div><span class="text-slate-500">Tipo:</span> <span class="' + (isSelected ? 'text-brand-200' : 'text-slate-300') + ' font-medium">' + suspension.type + '</span></div>';
            html += '<div><span class="text-slate-500">Peso:</span> <span class="' + (isSelected ? 'text-brand-200' : 'text-slate-300') + ' font-medium">' + suspension.weight + 'kg</span></div>';
            html += '</div>';
            html += '<div class="space-y-1">';
            html += '<div><span class="text-slate-500">Custo:</span> <span class="' + (isSelected ? 'text-brand-200' : 'text-slate-300') + ' font-medium">$' + (suspension.cost/1000).toFixed(0) + 'K</span></div>';
            html += '<div><span class="text-slate-500">Conforto:</span> <span class="' + (isSelected ? 'text-brand-200' : 'text-slate-300') + ' font-medium">' + Math.round(suspension.comfort * 100) + '%</span></div>';
            html += '</div>';
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            if (!compatibility.compatible) {
                html += '<div class="absolute top-2 left-2"><div class="w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold">!</div></div>';
                html += '<div class="mt-2 p-2 bg-red-900/30 border border-red-500/30 rounded text-xs text-red-300">' + compatibility.reason + '</div>';
            }
            html += '</div>';
        });
        
        tabContent.innerHTML = html + '</div>';
    }

    function loadCrewTab() {
        const tabContent = document.getElementById('tab-content');
        const currentCrewSize = window.currentVehicle && window.currentVehicle.crewSize || 3;
        const currentTrainingLevel = window.currentVehicle && window.currentVehicle.trainingLevel || 'standard';
        
        const crewRoles = {
            2: ['Motorista', 'Gunner/Comandante'],
            3: ['Motorista', 'Gunner', 'Comandante'],
            4: ['Motorista', 'Gunner', 'Comandante', 'Carregador'],
            5: ['Motorista', 'Gunner', 'Comandante', 'Carregador', 'Operador de R√°dio']
        };
        
        const trainingLevels = {
            rookie: { name: 'Recruta', costMultiplier: 0.7, reliabilityBonus: -0.15, description: 'Treinamento b√°sico, custo baixo mas menos eficiente' },
            standard: { name: 'Padr√£o', costMultiplier: 1.0, reliabilityBonus: 0, description: 'Treinamento militar padr√£o, equilibrado' },
            veteran: { name: 'Veterano', costMultiplier: 1.5, reliabilityBonus: 0.1, description: 'Experi√™ncia em combate, mais confi√°vel' },
            elite: { name: 'Elite', costMultiplier: 2.2, reliabilityBonus: 0.2, description: 'Treinamento especializado, m√°xima efici√™ncia' }
        };
        
        let html = '<div class="space-y-6">';
        
        // Crew Size Selection
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üë• Tamanho da Tripula√ß√£o</h3>';
        html += '<div class="space-y-4">';
        html += '<div class="flex items-center justify-between">';
        html += '<span class="text-slate-300">N√∫mero de Tripulantes:</span>';
        html += '<span class="text-2xl font-bold text-brand-400" id="crew-size-display">' + currentCrewSize + '</span>';
        html += '</div>';
        html += '<div class="relative">';
        html += '<input type="range" id="crew-size-slider" min="2" max="5" value="' + currentCrewSize + '" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb" oninput="updateCrewSize(this.value)" />';
        html += '<div class="flex justify-between text-xs text-slate-400 mt-1">';
        html += '<span>2</span><span>3</span><span>4</span><span>5</span>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';

        // Crew Roles
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üéØ Fun√ß√µes da Tripula√ß√£o</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3" id="crew-roles">';
        
        if (crewRoles[currentCrewSize]) {
            crewRoles[currentCrewSize].forEach((role, index) => {
                html += '<div class="flex items-center gap-3 bg-slate-700/30 rounded-lg p-3">';
                html += '<div class="w-8 h-8 bg-brand-500/20 rounded-full flex items-center justify-center text-brand-300 text-sm font-semibold">' + (index + 1) + '</div>';
                html += '<span class="text-slate-200 font-medium">' + role + '</span>';
                html += '</div>';
            });
        }
        
        html += '</div>';
        html += '</div>';

        // Training Level Selection
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üéì N√≠vel de Treinamento</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="training-levels">';
        
        Object.entries(trainingLevels).forEach(([key, level]) => {
            const isCurrentLevel = currentTrainingLevel === key;
            html += '<div class="training-level-card ' + (isCurrentLevel ? 'selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-xl p-4 cursor-pointer hover:border-brand-500/60 hover:bg-slate-700/50 transition-all duration-200" onclick="selectTrainingLevel(\'' + key + '\')" data-level="' + key + '">';
            html += '<div class="flex items-start justify-between mb-2">';
            html += '<h4 class="font-semibold ' + (isCurrentLevel ? 'text-brand-100' : 'text-slate-100') + '">' + level.name + '</h4>';
            html += '<div class="flex items-center gap-2">';
            
            if (level.reliabilityBonus > 0) {
                html += '<span class="text-xs bg-emerald-500/20 text-emerald-300 px-2 py-1 rounded">+' + Math.round(level.reliabilityBonus * 100) + '%</span>';
            } else if (level.reliabilityBonus < 0) {
                html += '<span class="text-xs bg-red-500/20 text-red-300 px-2 py-1 rounded">' + Math.round(level.reliabilityBonus * 100) + '%</span>';
            } else {
                html += '<span class="text-xs bg-slate-600/50 text-slate-400 px-2 py-1 rounded">Padr√£o</span>';
            }
            
            html += '</div>';
            html += '</div>';
            html += '<p class="text-xs text-slate-400 mb-3">' + level.description + '</p>';
            html += '<div class="flex justify-between items-center text-xs">';
            html += '<span class="text-slate-500">Multiplicador de Custo:</span>';
            html += '<span class="' + (isCurrentLevel ? 'text-brand-200' : 'text-slate-300') + ' font-medium ' + (level.costMultiplier > 1.5 ? 'text-red-400' : level.costMultiplier > 1.0 ? 'text-amber-400' : 'text-emerald-400') + '">x' + level.costMultiplier + '</span>';
            html += '</div>';
            
            if (isCurrentLevel) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';

        // Crew Summary
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üìä Resumo da Tripula√ß√£o</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="crew-summary">';
        html += '<div class="text-center">';
        html += '<div class="text-2xl font-bold text-brand-400" id="summary-crew-size">' + currentCrewSize + '</div>';
        html += '<div class="text-sm text-slate-400">Tripulantes</div>';
        html += '</div>';
        html += '<div class="text-center">';
        html += '<div class="text-2xl font-bold text-slate-300" id="summary-training">' + trainingLevels[currentTrainingLevel].name + '</div>';
        html += '<div class="text-sm text-slate-400">Treinamento</div>';
        html += '</div>';
        html += '<div class="text-center">';
        html += '<div class="text-2xl font-bold ' + (trainingLevels[currentTrainingLevel].costMultiplier > 1.5 ? 'text-red-400' : trainingLevels[currentTrainingLevel].costMultiplier > 1.0 ? 'text-amber-400' : 'text-emerald-400') + '" id="summary-cost-multiplier">x' + trainingLevels[currentTrainingLevel].costMultiplier + '</div>';
        html += '<div class="text-sm text-slate-400">Custo Base</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        
        html += '</div>';
        
        tabContent.innerHTML = html;
    }

    function loadArmorTab() {
        const tabContent = document.getElementById('tab-content');
        const chassis = window.currentVehicle && window.currentVehicle.chassis ? (window.VEHICLE_COMPONENTS && window.VEHICLE_COMPONENTS.chassis ? window.VEHICLE_COMPONENTS.chassis[window.currentVehicle.chassis] : null) : null;
        const armorMaterials = window.VEHICLE_COMPONENTS && window.VEHICLE_COMPONENTS.armor_materials || {};
        const armorAngles = window.VEHICLE_COMPONENTS && window.VEHICLE_COMPONENTS.armor_angles || {};
        const additionalArmor = window.VEHICLE_COMPONENTS && window.VEHICLE_COMPONENTS.additional_armor || {};
        
        const maxThickness = chassis && chassis.max_armor_thickness || 300;
        const currentThickness = window.currentVehicle && window.currentVehicle.armorThickness || 80;
        const currentMaterial = window.currentVehicle && window.currentVehicle.armorMaterial || 'rolled_homogeneous_armor';
        const currentAngle = window.currentVehicle && window.currentVehicle.armorAngle || 'vertical_90';
        const currentAdditional = window.currentVehicle && window.currentVehicle.additionalArmor || [];

        let html = '<div class="space-y-6">';
        
        // Chassis Armor Limits Warning
        if (!chassis) {
            html += '<div class="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4">';
            html += '<div class="flex items-center gap-3">';
            html += '<div class="text-amber-400">‚ö†Ô∏è</div>';
            html += '<p class="text-amber-300 text-sm">Selecione um chassi primeiro para ver os limites de blindagem espec√≠ficos.</p>';
            html += '</div>';
            html += '</div>';
        } else {
            html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-4">';
            html += '<div class="flex items-center justify-between">';
            html += '<div class="flex items-center gap-3">';
            html += '<div class="text-slate-300">üõ°Ô∏è</div>';
            html += '<span class="text-slate-300 font-medium">' + chassis.name + '</span>';
            html += '</div>';
            html += '<div class="text-right">';
            html += '<div class="text-sm text-slate-400">Blindagem M√°xima</div>';
            html += '<div class="text-lg font-bold text-brand-400">' + maxThickness + 'mm</div>';
            html += '</div>';
            html += '</div>';
            html += '</div>';
        }

        // Armor Thickness Selection
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üîß Espessura da Blindagem</h3>';
        html += '<div class="space-y-4">';
        html += '<div class="flex items-center justify-between">';
        html += '<span class="text-slate-300">Espessura:</span>';
        html += '<div class="flex items-center gap-2">';
        html += '<span class="text-3xl font-bold text-brand-400" id="armor-thickness-display">' + currentThickness + '</span>';
        html += '<span class="text-slate-400">mm</span>';
        html += '</div>';
        html += '</div>';
        html += '<div class="relative">';
        html += '<input type="range" id="armor-thickness-slider" min="0" max="' + maxThickness + '" step="5" value="' + currentThickness + '" class="w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer armor-slider" oninput="updateArmorThickness(this.value)" ' + (!chassis ? 'disabled' : '') + ' />';
        html += '</div>';
        html += '</div>';
        html += '</div>';

        // Armor Material Selection
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">‚öóÔ∏è Material da Blindagem</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
        
        Object.entries(armorMaterials).forEach(([id, material]) => {
            const isSelected = currentMaterial === id;
            html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-xl p-4 cursor-pointer hover:border-brand-500/60 hover:bg-slate-700/50 transition-all duration-200" onclick="updateArmorMaterial(\'' + id + '\')">';
            html += '<div class="flex items-start justify-between mb-2">';
            html += '<h4 class="font-semibold ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + material.name + '</h4>';
            html += '<span class="text-xs ';
            html += material.effectiveness_factor >= 1.2 ? 'bg-emerald-500/20 text-emerald-300' :
                   material.effectiveness_factor >= 1.0 ? 'bg-blue-500/20 text-blue-300' :
                   'bg-amber-500/20 text-amber-300';
            html += ' px-2 py-1 rounded">' + Math.round(material.effectiveness_factor * 100) + '%</span>';
            html += '</div>';
            html += '<div class="text-xs text-slate-400 space-y-1">';
            html += '<div><span class="text-slate-500">Efetividade:</span> <span class="text-slate-300">x' + material.effectiveness_factor + '</span></div>';
            html += '<div><span class="text-slate-500">Peso:</span> <span class="text-slate-300">x' + material.weight_factor + '</span></div>';
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';

        // Armor Angle Selection
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üìê √Çngulo da Blindagem</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
        
        Object.entries(armorAngles).forEach(([id, angle]) => {
            const isSelected = currentAngle === id;
            html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : 'bg-slate-800/40 border-slate-700/50') + ' border rounded-xl p-4 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="selectArmorAngle(\'' + id + '\')">';
            html += '<div class="flex items-start justify-between mb-2">';
            html += '<h4 class="font-semibold text-sm ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + angle.name + '</h4>';
            html += '<span class="text-xs ';
            html += angle.effectiveness_multiplier >= 1.8 ? 'bg-emerald-500/20 text-emerald-300' :
                   angle.effectiveness_multiplier >= 1.5 ? 'bg-blue-500/20 text-blue-300' :
                   angle.effectiveness_multiplier >= 1.2 ? 'bg-yellow-500/20 text-yellow-300' :
                   'bg-slate-500/20 text-slate-300';
            html += ' px-2 py-1 rounded">x' + angle.effectiveness_multiplier + '</span>';
            html += '</div>';
            html += '<div class="text-xs text-slate-400 space-y-1">';
            html += '<div class="text-slate-500">' + angle.description + '</div>';
            
            if (angle.crew_capacity_penalty > 0) {
                html += '<div class="text-red-400">‚ö†Ô∏è Tripula√ß√£o -' + angle.crew_capacity_penalty + '</div>';
            }
            if (angle.gun_depression_penalty > 0) {
                html += '<div class="text-amber-400">‚ö†Ô∏è Depress√£o -' + angle.gun_depression_penalty + '¬∞</div>';
            }
            
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';

        // Additional Armor Selection  
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üõ°Ô∏è Blindagem Adicional</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">';
        
        // Group additional armor by type
        const armorByType = {};
        Object.entries(additionalArmor).forEach(([id, armor]) => {
            const type = armor.type || 'misc';
            if (!armorByType[type]) armorByType[type] = [];
            armorByType[type].push([id, armor]);
        });
        
        Object.entries(armorByType).forEach(([type, armors]) => {
            armors.forEach(([id, armor]) => {
                const isSelected = currentAdditional.includes(id);
                html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-lg p-3 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="toggleAdditionalArmor(\'' + id + '\')">';
                html += '<div class="flex items-start justify-between mb-1">';
                html += '<h5 class="font-medium text-sm ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + armor.name + '</h5>';
                html += '<span class="text-xs bg-slate-600/50 text-slate-300 px-1 py-0.5 rounded">+' + armor.protection_bonus + '</span>';
                html += '</div>';
                html += '<div class="text-xs text-slate-400">' + armor.description + '</div>';
                
                if (isSelected) {
                    html += '<div class="absolute top-1 right-1"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
                }
                
                html += '</div>';
            });
        });
        
        html += '</div>';
        html += '</div>';

        // Armor Efficiency Summary
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üìä Efici√™ncia da Blindagem</h3>';
        html += '<div id="armor-efficiency-summary" class="grid grid-cols-1 md:grid-cols-4 gap-4">';
        html += '<div class="text-center">';
        html += '<div class="text-2xl font-bold text-brand-400" id="effective-thickness">Calculando...</div>';
        html += '<div class="text-sm text-slate-400">mm Efetivos</div>';
        html += '</div>';
        html += '<div class="text-center">';
        html += '<div class="text-lg font-bold text-slate-300">Classe</div>';
        html += '<div class="text-sm text-slate-400">Prote√ß√£o</div>';
        html += '</div>';
        html += '<div class="text-center">';
        html += '<div class="text-lg font-bold text-slate-300">Peso</div>';
        html += '<div class="text-sm text-slate-400">Estimado</div>';
        html += '</div>';
        html += '<div class="text-center">';
        html += '<div class="text-lg font-bold text-slate-300">Custo</div>';
        html += '<div class="text-sm text-slate-400">Estimado</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        
        html += '</div>';
        
        tabContent.innerHTML = html;
        
        // Trigger initial calculation
        updateArmorEfficiency();
    }

    function loadWeaponsTab() {
        const tabContent = document.getElementById('tab-content');
        const chassis = window.currentVehicle && window.currentVehicle.chassis ? (window.VEHICLE_COMPONENTS && window.VEHICLE_COMPONENTS.chassis ? window.VEHICLE_COMPONENTS.chassis[window.currentVehicle.chassis] : null) : null;
        
        // Detectar tipo de chassi
        let chassisType = 'standard';
        if (chassis) {
            const chassisName = chassis.name.toLowerCase();
            if (chassisName.includes('spaa') || chassisName.includes('anti') || chassisName.includes('aa')) {
                chassisType = 'spaa';
            } else if (chassisName.includes('sph') || chassisName.includes('artillery') || chassisName.includes('howitzer')) {
                chassisType = 'sph';
            }
        }

        let html = '<div class="space-y-6">';
        
        // Warning se n√£o houver chassi
        if (!chassis) {
            html += '<div class="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4">';
            html += '<div class="flex items-center gap-3">';
            html += '<div class="text-amber-400">‚ö†Ô∏è</div>';
            html += '<p class="text-amber-300 text-sm">Selecione um chassi primeiro para ver as op√ß√µes de armamento.</p>';
            html += '</div>';
            html += '</div>';
            html += '</div>';
            tabContent.innerHTML = html;
            return;
        }

        // Header com info do chassi
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-4">';
        html += '<div class="flex items-center justify-between">';
        html += '<div class="flex items-center gap-3">';
        html += '<div class="text-slate-300">üéØ</div>';
        html += '<span class="text-slate-300 font-medium">' + chassis.name + '</span>';
        html += '</div>';
        html += '<div class="text-right">';
        html += '<div class="text-sm text-slate-400">' + 
                (chassisType === 'spaa' ? 'Ve√≠culo Antia√©reo' : 
                 chassisType === 'sph' ? 'Artilharia Autopropulsada' : 
                 'Tanque de Combate') + '</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';

        if (chassisType === 'spaa') {
            html += loadSPAAWeaponsInterface();
        } else if (chassisType === 'sph') {
            html += loadSPHWeaponsInterface();
        } else {
            html += loadStandardWeaponsInterface();
        }

        html += '</div>';
        tabContent.innerHTML = html;
    }

    function loadSPAAWeaponsInterface() {
        const aaGuns = window.VEHICLE_COMPONENTS?.aa_guns || {};
        const currentGun = window.currentVehicle?.aaGun || 'cannon_20mm';
        const currentMount = window.currentVehicle?.aaMount || 'twin';
        const currentFireControl = window.currentVehicle?.aaFireControl || 'optical_sight';

        let html = '';

        // Sele√ß√£o de Canh√£o AA
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üéØ Canh√£o Antia√©reo</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
        
        Object.entries(aaGuns).forEach(([id, gun]) => {
            const isSelected = currentGun === id;
            html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-xl p-4 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="selectAAGun(\'' + id + '\')">';
            html += '<div class="flex items-start justify-between mb-2">';
            html += '<h4 class="font-semibold ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + gun.name + '</h4>';
            html += '<span class="text-xs bg-slate-600/50 text-slate-300 px-2 py-1 rounded">' + gun.caliber + 'mm</span>';
            html += '</div>';
            html += '<div class="text-xs text-slate-400 space-y-1">';
            html += '<div><span class="text-slate-500">Cad√™ncia:</span> <span class="text-slate-300">' + gun.rate_of_fire + ' tpm</span></div>';
            html += '<div><span class="text-slate-500">Alcance:</span> <span class="text-slate-300">' + gun.effective_range + 'm</span></div>';
            html += '<div><span class="text-slate-500">Efic√°cia AA:</span> <span class="text-slate-300">' + Math.round(gun.aa_effectiveness * 100) + '%</span></div>';
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';

        // Configura√ß√£o de Montagem
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üîß Configura√ß√£o de Montagem</h3>';
        
        const selectedGun = aaGuns[currentGun];
        if (selectedGun) {
            html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">';
            
            selectedGun.mount_options.forEach(mountType => {
                const isSelected = currentMount === mountType;
                const mountConfig = window.VEHICLE_COMPONENTS?.aa_mount_configs?.[mountType];
                if (mountConfig) {
                    html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-lg p-3 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="selectAAMount(\'' + mountType + '\')">';
                    html += '<div class="text-center">';
                    html += '<div class="text-lg font-bold ' + (isSelected ? 'text-brand-200' : 'text-slate-200') + '">' + mountConfig.gun_count + 'x</div>';
                    html += '<div class="text-sm text-slate-400">' + mountConfig.name + '</div>';
                    html += '</div>';
                    
                    if (isSelected) {
                        html += '<div class="absolute top-1 right-1"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
                    }
                    
                    html += '</div>';
                }
            });
            
            html += '</div>';
        }
        
        html += '</div>';

        // Sistema de Controle de Fogo
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üì° Sistema de Controle</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
        
        const fireControlSystems = window.VEHICLE_COMPONENTS?.aa_fire_control || {};
        Object.entries(fireControlSystems).forEach(([id, system]) => {
            const isSelected = currentFireControl === id;
            html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-xl p-4 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="selectAAFireControl(\'' + id + '\')">';
            html += '<div class="flex items-start justify-between mb-2">';
            html += '<h4 class="font-semibold ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + system.name + '</h4>';
            html += '<span class="text-xs bg-' + (system.type === 'radar' ? 'blue' : system.type === 'electronic' ? 'purple' : 'slate') + '-500/20 text-' + (system.type === 'radar' ? 'blue' : system.type === 'electronic' ? 'purple' : 'slate') + '-300 px-2 py-1 rounded">' + system.type + '</span>';
            html += '</div>';
            html += '<div class="text-xs text-slate-400 space-y-1">';
            html += '<div>' + system.description + '</div>';
            html += '<div><span class="text-slate-500">Precis√£o:</span> <span class="text-slate-300">+' + Math.round(system.accuracy_bonus * 100) + '%</span></div>';
            if (system.night_capable) {
                html += '<div class="text-green-400">‚úì Combate noturno</div>';
            }
            if (system.detection_range) {
                html += '<div><span class="text-slate-500">Alcance radar:</span> <span class="text-slate-300">' + system.detection_range + 'm</span></div>';
            }
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';

        return html;
    }

    function loadSPHWeaponsInterface() {
        // Carregar dados de artilharia (quando implementado)
        const artilleryGuns = {}; // window.VEHICLE_COMPONENTS?.artillery_guns || {};
        const currentGun = window.currentVehicle?.artilleryGun || 'howitzer_122mm';
        const currentMount = window.currentVehicle?.artilleryMount || 'open_mount';
        const currentFireControl = window.currentVehicle?.artilleryFireControl || 'basic_sights';

        let html = '';

        // Por enquanto, interface b√°sica
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üéØ Sistema de Artilharia</h3>';
        html += '<div class="space-y-4">';
        
        // Seletor de calibre de artilharia
        html += '<div class="space-y-4">';
        html += '<div class="flex items-center justify-between">';
        html += '<span class="text-slate-300">Calibre da Artilharia:</span>';
        html += '</div>';
        
        const artilleryCalibers = [105, 122, 130, 150, 152, 155, 170, 203];
        html += '<div class="grid grid-cols-4 md:grid-cols-8 gap-2">';
        artilleryCalibers.forEach(caliber => {
            const currentCaliber = window.currentVehicle?.artilleryCaliber || 122;
            const isSelected = currentCaliber === caliber;
            html += '<button class="artillery-caliber-btn ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400 text-brand-200' : 'bg-slate-700/30 border-slate-600/50 text-slate-300') + ' border rounded-lg p-2 text-sm font-medium hover:border-brand-500/60 transition-all duration-200" onclick="selectArtilleryCaliber(' + caliber + ')" data-caliber="' + caliber + '">';
            html += caliber + 'mm';
            html += '</button>';
        });
        html += '</div>';
        html += '</div>';
        
        html += '<div class="text-sm text-slate-400">';
        html += '<p>Interface de artilharia ser√° expandida com mais op√ß√µes em breve.</p>';
        html += '</div>';
        
        html += '</div>';
        html += '</div>';

        return html;
    }

    function loadStandardWeaponsInterface() {
        const chassis = window.VEHICLE_COMPONENTS?.chassis?.[window.currentVehicle?.chassis];
        let maxCaliber = 180;
        let minCaliber = 37;
        
        if (chassis) {
            const chassisName = chassis.name.toLowerCase();
            if (chassisName.includes('pesado') || chassisName.includes('heavy')) {
                maxCaliber = 130;
                minCaliber = 75;
            } else if (chassisName.includes('m√©dio') || chassisName.includes('medium')) {
                maxCaliber = 125;
                minCaliber = 75;
            } else if (chassisName.includes('leve') || chassisName.includes('light')) {
                maxCaliber = 105;
                minCaliber = 75;
            }
        }
        
        const currentMainGunCaliber = window.currentVehicle?.mainGunCaliber || 75;
        const currentSecondaryWeapon = window.currentVehicle?.secondaryWeapon || 'mg_7_62mm';

        let html = '';

        // Canh√£o Principal com design original
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üí• Canh√£o Principal</h3>';
        html += '<div class="space-y-4">';
        html += '<div class="flex items-center justify-between">';
        html += '<span class="text-slate-300">Calibre:</span>';
        html += '<div class="flex items-center gap-2">';
        html += '<span class="text-3xl font-bold text-brand-400" id="main-gun-caliber-display">' + currentMainGunCaliber + '</span>';
        html += '<span class="text-slate-400">mm</span>';
        html += '</div>';
        html += '</div>';
        html += '<div class="relative">';
        html += '<input type="range" id="main-gun-caliber-slider" min="' + minCaliber + '" max="' + maxCaliber + '" step="5" value="' + currentMainGunCaliber + '" class="w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer armor-slider" oninput="updateMainGunCaliber(this.value)" />';
        html += '<div class="flex justify-between text-xs text-slate-400 mt-2">';
        html += '<span>' + minCaliber + 'mm</span>';
        
        // Categoria baseada no calibre atual
        let gunCategory = '';
        let categoryColor = '';
        if (currentMainGunCaliber <= 75) {
            gunCategory = 'Leve';
            categoryColor = 'text-emerald-400';
        } else if (currentMainGunCaliber <= 105) {
            gunCategory = 'M√©dia';
            categoryColor = 'text-amber-400';
        } else if (currentMainGunCaliber <= 125) {
            gunCategory = 'Pesada';
            categoryColor = 'text-red-400';
        } else {
            gunCategory = 'Artilharia';
            categoryColor = 'text-purple-400';
        }
        
        html += '<span class="' + categoryColor + ' font-medium">' + gunCategory + '</span>';
        html += '<span>' + maxCaliber + 'mm</span>';
        html += '</div>';
        html += '</div>';
        
        // Indicadores de categoria
        html += '<div class="grid grid-cols-4 gap-2 text-xs">';
        html += '<div class="text-center p-2 rounded ' + (currentMainGunCaliber <= 75 ? 'bg-emerald-500/20 text-emerald-300' : 'bg-slate-700/30 text-slate-500') + '">';
        html += '<div class="font-medium">‚â§75mm</div><div>Leve</div>';
        html += '</div>';
        html += '<div class="text-center p-2 rounded ' + (currentMainGunCaliber > 75 && currentMainGunCaliber <= 105 ? 'bg-amber-500/20 text-amber-300' : 'bg-slate-700/30 text-slate-500') + '">';
        html += '<div class="font-medium">76-105mm</div><div>M√©dia</div>';
        html += '</div>';
        html += '<div class="text-center p-2 rounded ' + (currentMainGunCaliber > 105 && currentMainGunCaliber <= 125 ? 'bg-red-500/20 text-red-300' : 'bg-slate-700/30 text-slate-500') + '">';
        html += '<div class="font-medium">106-125mm</div><div>Pesada</div>';
        html += '</div>';
        html += '<div class="text-center p-2 rounded ' + (currentMainGunCaliber > 125 ? 'bg-purple-500/20 text-purple-300' : 'bg-slate-700/30 text-slate-500') + '">';
        html += '<div class="font-medium">126mm+</div><div>Artilharia</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';

        // Armamentos Secund√°rios
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üî´ Armamento Secund√°rio</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
        
        const secondaryWeapons = window.VEHICLE_COMPONENTS?.secondary_weapons || {};
        Object.entries(secondaryWeapons).forEach(([id, weapon]) => {
            const isSelected = currentSecondaryWeapon === id;
            html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-xl p-4 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="selectSecondaryWeapon(\'' + id + '\')">';
            html += '<div class="flex items-start justify-between mb-2">';
            html += '<h4 class="font-semibold text-sm ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + weapon.name + '</h4>';
            html += '<span class="text-xs bg-slate-600/50 text-slate-300 px-2 py-1 rounded">' + weapon.caliber + 'mm</span>';
            html += '</div>';
            html += '<div class="text-xs text-slate-400 space-y-1">';
            html += '<div><span class="text-slate-500">Cad√™ncia:</span> <span class="text-slate-300">' + weapon.rate_of_fire + ' tpm</span></div>';
            html += '<div><span class="text-slate-500">Alcance:</span> <span class="text-slate-300">' + weapon.effective_range + 'm</span></div>';
            if (weapon.aa_capable) {
                html += '<div class="text-green-400">‚úì Capacidade AA</div>';
            }
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';

        // Resumo de Armamento
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üìä Resumo do Armamento</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-3 gap-4">';
        html += '<div class="text-center">';
        html += '<div class="text-2xl font-bold text-brand-400" id="summary-main-gun-caliber">' + currentMainGunCaliber + 'mm</div>';
        html += '<div class="text-sm text-slate-400">Canh√£o Principal</div>';
        html += '</div>';
        html += '<div class="text-center">';
        html += '<div class="text-2xl font-bold text-slate-300" id="summary-secondary-weapon">' + (secondaryWeapons[currentSecondaryWeapon]?.name || 'N/A') + '</div>';
        html += '<div class="text-sm text-slate-400">Secund√°rio</div>';
        html += '</div>';
        html += '<div class="text-center">';
        const mainGunCost = Math.round(Math.pow(currentMainGunCaliber / 25, 2) * 10000);
        html += '<div class="text-2xl font-bold ' + (mainGunCost > 50000 ? 'text-red-400' : mainGunCost > 25000 ? 'text-amber-400' : 'text-emerald-400') + '" id="summary-weapon-cost">$' + mainGunCost.toLocaleString() + '</div>';
        html += '<div class="text-sm text-slate-400">Custo Est.</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';

        return html;
    }

    // Fun√ß√µes para SPAA
    function selectAAGun(gunId) {
        if (window.currentVehicle) {
            window.currentVehicle.aaGun = gunId;
            loadWeaponsTab(); // Recarregar para atualizar op√ß√µes de montagem
            updateVehicleCalculations();
            console.log('Canh√£o AA selecionado:', gunId);
        }
    }

    function selectAAMount(mountType) {
        if (window.currentVehicle) {
            window.currentVehicle.aaMount = mountType;
            updateVehicleCalculations();
            console.log('Montagem AA selecionada:', mountType);
        }
    }

    function selectAAFireControl(systemId) {
        if (window.currentVehicle) {
            window.currentVehicle.aaFireControl = systemId;
            updateVehicleCalculations();
            console.log('Sistema de controle AA selecionado:', systemId);
        }
    }

    function selectArtilleryCaliber(caliber) {
        if (window.currentVehicle) {
            window.currentVehicle.artilleryCaliber = caliber;
            updateVehicleCalculations();
            console.log('Calibre de artilharia selecionado:', caliber);
        }
    }

    function selectSecondaryWeapon(weaponId) {
        if (window.currentVehicle) {
            window.currentVehicle.secondaryWeapon = weaponId;
            
            // Atualizar visual - remover sele√ß√£o de todos
            document.querySelectorAll('[onclick^="selectSecondaryWeapon"]').forEach(card => {
                card.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                card.classList.add('bg-slate-700/30', 'border-slate-600/50');
                
                // Remover indicador selecionado
                const indicator = card.querySelector('.animate-pulse');
                if (indicator) {
                    indicator.parentElement.remove();
                }
            });
            
            // Marcar novo selecionado
            const selectedCard = document.querySelector('[onclick="selectSecondaryWeapon(\'' + weaponId + '\')"]');
            if (selectedCard) {
                selectedCard.classList.add('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                selectedCard.classList.remove('bg-slate-700/30', 'border-slate-600/50');
                
                // Adicionar indicador
                const indicator = document.createElement('div');
                indicator.className = 'absolute top-2 right-2';
                indicator.innerHTML = '<div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>';
                selectedCard.appendChild(indicator);
            }
            
            // Atualizar resumo
            const secondaryWeapons = window.VEHICLE_COMPONENTS?.secondary_weapons || {};
            const summaryElement = document.getElementById('summary-secondary-weapon');
            if (summaryElement && secondaryWeapons[weaponId]) {
                summaryElement.textContent = secondaryWeapons[weaponId].name;
            }
            
            updateVehicleCalculations();
            console.log('Armamento secund√°rio selecionado:', weaponId);
        }
    }

    function loadSystemsTab() {
        const tabContent = document.getElementById('tab-content');
        const opticsData = window.VEHICLE_COMPONENTS?.optics_systems || {};
        const communicationData = window.VEHICLE_COMPONENTS?.communication || {};
        const fireControlData = window.VEHICLE_COMPONENTS?.fire_control || {};
        const specialEquipmentData = window.VEHICLE_COMPONENTS?.special_equipment || {};
        
        const currentOptics = window.currentVehicle?.opticsSystem || 'basic_periscope';
        const currentComm = window.currentVehicle?.communicationSystem || 'signal_flags';
        const currentFireControl = window.currentVehicle?.fireControlSystem || 'basic_optical';
        const currentSpecialEquipment = window.currentVehicle?.specialEquipment || [];

        let html = '<div class="space-y-6">';
        
        // Sistemas √ìpticos
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üëÅÔ∏è Sistemas √ìpticos</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
        
        Object.entries(opticsData).forEach(([id, optic]) => {
            const isSelected = currentOptics === id;
            html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-xl p-4 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="selectOpticsSystem(\'' + id + '\')">';
            html += '<div class="flex items-start justify-between mb-2">';
            html += '<h4 class="font-semibold text-sm ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + optic.name + '</h4>';
            html += '<span class="text-xs bg-slate-600/50 text-slate-300 px-2 py-1 rounded">' + optic.magnification + '</span>';
            html += '</div>';
            html += '<div class="text-xs text-slate-400 space-y-1">';
            html += '<div><span class="text-slate-500">Precis√£o:</span> <span class="text-slate-300">+' + Math.round(optic.accuracy_bonus * 100) + '%</span></div>';
            html += '<div><span class="text-slate-500">Campo:</span> <span class="text-slate-300">' + optic.field_of_view + '¬∞</span></div>';
            if (optic.night_vision) {
                html += '<div class="text-green-400">‚úì Vis√£o Noturna</div>';
            }
            if (optic.experimental) {
                html += '<div class="text-purple-400">‚öóÔ∏è Experimental</div>';
            }
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';

        // Sistemas de Comunica√ß√£o
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üì° Comunica√ß√£o</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">';
        
        Object.entries(communicationData).forEach(([id, comm]) => {
            const isSelected = currentComm === id;
            html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-xl p-4 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="selectCommunicationSystem(\'' + id + '\')">';
            html += '<div class="flex items-start justify-between mb-2">';
            html += '<h4 class="font-semibold text-sm ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + comm.name + '</h4>';
            html += '<span class="text-xs bg-slate-600/50 text-slate-300 px-2 py-1 rounded">' + comm.range + 'km</span>';
            html += '</div>';
            html += '<div class="text-xs text-slate-400 space-y-1">';
            html += '<div><span class="text-slate-500">Confiabilidade:</span> <span class="text-slate-300">' + Math.round(comm.reliability * 100) + '%</span></div>';
            if (comm.encryption_capable) {
                html += '<div class="text-green-400">üîí Criptografia</div>';
            }
            if (comm.command_bonus) {
                html += '<div class="text-blue-400">‚≠ê Comando +' + comm.command_bonus + '</div>';
            }
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';

        // Controle de Fogo
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üéØ Controle de Fogo</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">';
        
        Object.entries(fireControlData).forEach(([id, fcs]) => {
            const isSelected = currentFireControl === id;
            html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-xl p-4 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="selectFireControlSystem(\'' + id + '\')">';
            html += '<div class="flex items-start justify-between mb-2">';
            html += '<h4 class="font-semibold text-sm ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + fcs.name + '</h4>';
            if (fcs.experimental) {
                html += '<span class="text-xs bg-purple-500/20 text-purple-300 px-2 py-1 rounded">EXP</span>';
            }
            html += '</div>';
            html += '<div class="text-xs text-slate-400 space-y-1">';
            html += '<div><span class="text-slate-500">Precis√£o:</span> <span class="text-slate-300">+' + Math.round(fcs.accuracy_bonus * 100) + '%</span></div>';
            html += '<div><span class="text-slate-500">Alcance:</span> <span class="text-slate-300">+' + Math.round(fcs.range_bonus * 100) + '%</span></div>';
            if (fcs.first_hit_probability) {
                html += '<div class="text-green-400">üéØ Primeiro Tiro: ' + Math.round(fcs.first_hit_probability * 100) + '%</div>';
            }
            html += '</div>';
            
            if (isSelected) {
                html += '<div class="absolute top-2 right-2"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
            }
            
            html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';

        // Equipamentos Especiais
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">‚öôÔ∏è Equipamentos Especiais</h3>';
        
        // Agrupar por categoria
        const equipmentByCategory = {
            survival: { name: 'üõ°Ô∏è Sobreviv√™ncia', items: [] },
            mobility: { name: 'üöó Mobilidade', items: [] },
            detection: { name: 'üëÄ Detec√ß√£o', items: [] },
            camouflage: { name: 'ü´• Camuflagem', items: [] },
            comfort: { name: 'üòä Conforto', items: [] },
            maintenance: { name: 'üîß Manuten√ß√£o', items: [] }
        };
        
        Object.entries(specialEquipmentData).forEach(([id, equipment]) => {
            let category = 'survival';
            if (equipment.name.includes('Tanque') || equipment.name.includes('Vadeamento') || equipment.name.includes('Rolo') || equipment.name.includes('L√¢mina')) {
                category = 'mobility';
            } else if (equipment.name.includes('C√∫pula') || equipment.name.includes('Perisc√≥pio') || equipment.name.includes('Holofote')) {
                category = 'detection';
            } else if (equipment.name.includes('Camuflagem') || equipment.name.includes('Fuma√ßa') || equipment.name.includes('fum√≠geno')) {
                category = 'camouflage';
            } else if (equipment.name.includes('Ventila√ß√£o') || equipment.name.includes('Aquecedor') || equipment.name.includes('Assento')) {
                category = 'comfort';
            } else if (equipment.name.includes('Reparos') || equipment.name.includes('Pe√ßas') || equipment.name.includes('Diagn√≥stico')) {
                category = 'maintenance';
            }
            equipmentByCategory[category].items.push([id, equipment]);
        });
        
        Object.entries(equipmentByCategory).forEach(([catId, category]) => {
            if (category.items.length > 0) {
                html += '<div class="mb-6">';
                html += '<h4 class="text-md font-medium text-slate-200 mb-3">' + category.name + '</h4>';
                html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">';
                
                category.items.forEach(([id, equipment]) => {
                    const isSelected = currentSpecialEquipment.includes(id);
                    html += '<div class="relative ' + (isSelected ? 'selected bg-brand-900/30 border-brand-400' : 'bg-slate-700/30 border-slate-600/50') + ' border rounded-lg p-3 cursor-pointer hover:border-brand-500/60 transition-all duration-200" onclick="toggleSpecialEquipment(\'' + id + '\')">';
                    html += '<div class="flex items-start justify-between mb-1">';
                    html += '<h5 class="font-medium text-sm ' + (isSelected ? 'text-brand-100' : 'text-slate-100') + '">' + equipment.name + '</h5>';
                    html += '<span class="text-xs bg-slate-600/50 text-slate-300 px-1 py-0.5 rounded">' + equipment.weight + 'kg</span>';
                    html += '</div>';
                    html += '<div class="text-xs text-slate-400">';
                    html += '<div><span class="text-slate-500">Custo:</span> <span class="text-slate-300">$' + equipment.cost.toLocaleString() + '</span></div>';
                    if (equipment.experimental) {
                        html += '<div class="text-purple-400 mt-1">‚öóÔ∏è Experimental</div>';
                    }
                    html += '</div>';
                    
                    if (isSelected) {
                        html += '<div class="absolute top-1 right-1"><div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div></div>';
                    }
                    
                    html += '</div>';
                });
                
                html += '</div>';
                html += '</div>';
            }
        });
        
        html += '</div>';
        
        // Resumo dos Sistemas
        html += '<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';
        html += '<h3 class="text-lg font-semibold text-slate-100 mb-4">üìä Resumo dos Sistemas</h3>';
        html += '<div class="grid grid-cols-1 md:grid-cols-4 gap-4">';
        html += '<div class="text-center">';
        html += '<div class="text-lg font-bold text-brand-400" id="systems-optics">' + (opticsData[currentOptics]?.name || 'Nenhum') + '</div>';
        html += '<div class="text-sm text-slate-400">√ìptica</div>';
        html += '</div>';
        html += '<div class="text-center">';
        html += '<div class="text-lg font-bold text-slate-300" id="systems-communication">' + (communicationData[currentComm]?.name || 'Nenhum') + '</div>';
        html += '<div class="text-sm text-slate-400">Comunica√ß√£o</div>';
        html += '</div>';
        html += '<div class="text-center">';
        html += '<div class="text-lg font-bold text-slate-300" id="systems-fcs">' + (fireControlData[currentFireControl]?.name || 'Nenhum') + '</div>';
        html += '<div class="text-sm text-slate-400">Controle de Fogo</div>';
        html += '</div>';
        html += '<div class="text-center">';
        html += '<div class="text-lg font-bold text-slate-300" id="systems-special-count">' + currentSpecialEquipment.length + '</div>';
        html += '<div class="text-sm text-slate-400">Equipamentos Especiais</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        
        html += '</div>';
        
        tabContent.innerHTML = html;
    }

    // Fun√ß√µes dos Sistemas
    function selectOpticsSystem(systemId) {
        if (window.currentVehicle) {
            window.currentVehicle.opticsSystem = systemId;
            
            // Atualizar visual
            document.querySelectorAll('[onclick^="selectOpticsSystem"]').forEach(card => {
                card.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                card.classList.add('bg-slate-700/30', 'border-slate-600/50');
                const indicator = card.querySelector('.animate-pulse');
                if (indicator) indicator.parentElement.remove();
            });
            
            const selectedCard = document.querySelector('[onclick="selectOpticsSystem(\'' + systemId + '\')"]');
            if (selectedCard) {
                selectedCard.classList.add('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                selectedCard.classList.remove('bg-slate-700/30', 'border-slate-600/50');
                
                const indicator = document.createElement('div');
                indicator.className = 'absolute top-2 right-2';
                indicator.innerHTML = '<div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>';
                selectedCard.appendChild(indicator);
            }
            
            // Atualizar resumo
            const opticsData = window.VEHICLE_COMPONENTS?.optics_systems || {};
            const summaryElement = document.getElementById('systems-optics');
            if (summaryElement && opticsData[systemId]) {
                summaryElement.textContent = opticsData[systemId].name;
            }
            
            updateVehicleCalculations();
            console.log('Sistema √≥ptico selecionado:', systemId);
        }
    }

    function selectCommunicationSystem(systemId) {
        if (window.currentVehicle) {
            window.currentVehicle.communicationSystem = systemId;
            
            // Atualizar visual
            document.querySelectorAll('[onclick^="selectCommunicationSystem"]').forEach(card => {
                card.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                card.classList.add('bg-slate-700/30', 'border-slate-600/50');
                const indicator = card.querySelector('.animate-pulse');
                if (indicator) indicator.parentElement.remove();
            });
            
            const selectedCard = document.querySelector('[onclick="selectCommunicationSystem(\'' + systemId + '\')"]');
            if (selectedCard) {
                selectedCard.classList.add('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                selectedCard.classList.remove('bg-slate-700/30', 'border-slate-600/50');
                
                const indicator = document.createElement('div');
                indicator.className = 'absolute top-2 right-2';
                indicator.innerHTML = '<div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>';
                selectedCard.appendChild(indicator);
            }
            
            // Atualizar resumo
            const commData = window.VEHICLE_COMPONENTS?.communication || {};
            const summaryElement = document.getElementById('systems-communication');
            if (summaryElement && commData[systemId]) {
                summaryElement.textContent = commData[systemId].name;
            }
            
            updateVehicleCalculations();
            console.log('Sistema de comunica√ß√£o selecionado:', systemId);
        }
    }

    function selectFireControlSystem(systemId) {
        if (window.currentVehicle) {
            window.currentVehicle.fireControlSystem = systemId;
            
            // Atualizar visual
            document.querySelectorAll('[onclick^="selectFireControlSystem"]').forEach(card => {
                card.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                card.classList.add('bg-slate-700/30', 'border-slate-600/50');
                const indicator = card.querySelector('.animate-pulse');
                if (indicator) indicator.parentElement.remove();
            });
            
            const selectedCard = document.querySelector('[onclick="selectFireControlSystem(\'' + systemId + '\')"]');
            if (selectedCard) {
                selectedCard.classList.add('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                selectedCard.classList.remove('bg-slate-700/30', 'border-slate-600/50');
                
                const indicator = document.createElement('div');
                indicator.className = 'absolute top-2 right-2';
                indicator.innerHTML = '<div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>';
                selectedCard.appendChild(indicator);
            }
            
            // Atualizar resumo
            const fcsData = window.VEHICLE_COMPONENTS?.fire_control || {};
            const summaryElement = document.getElementById('systems-fcs');
            if (summaryElement && fcsData[systemId]) {
                summaryElement.textContent = fcsData[systemId].name;
            }
            
            updateVehicleCalculations();
            console.log('Sistema de controle de fogo selecionado:', systemId);
        }
    }

    function toggleSpecialEquipment(equipmentId) {
        if (window.currentVehicle) {
            if (!window.currentVehicle.specialEquipment) {
                window.currentVehicle.specialEquipment = [];
            }
            
            const index = window.currentVehicle.specialEquipment.indexOf(equipmentId);
            
            if (index > -1) {
                window.currentVehicle.specialEquipment.splice(index, 1);
            } else {
                window.currentVehicle.specialEquipment.push(equipmentId);
            }
            // Mirror to legacy array used in calculations
            try {
                window.currentVehicle.special_equipment = Array.from(window.currentVehicle.specialEquipment);
            } catch (e) {
                window.currentVehicle.special_equipment = window.currentVehicle.specialEquipment.slice();
            }
            
            // Atualizar visual
            const card = document.querySelector('[onclick="toggleSpecialEquipment(\'' + equipmentId + '\')"]');
            if (card) {
                const isSelected = window.currentVehicle.specialEquipment.includes(equipmentId);
                
                if (isSelected) {
                    card.classList.add('selected', 'bg-brand-900/30', 'border-brand-400');
                    card.classList.remove('bg-slate-700/30', 'border-slate-600/50');
                    
                    const indicator = document.createElement('div');
                    indicator.className = 'absolute top-1 right-1';
                    indicator.innerHTML = '<div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>';
                    card.appendChild(indicator);
                } else {
                    card.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400');
                    card.classList.add('bg-slate-700/30', 'border-slate-600/50');
                    
                    const indicator = card.querySelector('.animate-pulse');
                    if (indicator) {
                        indicator.parentElement.remove();
                    }
                }
            }
            
            // Atualizar contador no resumo
            const countElement = document.getElementById('systems-special-count');
            if (countElement) {
                countElement.textContent = window.currentVehicle.specialEquipment.length;
            }
            const equipCountEl = document.getElementById('equipment-selected-count');
            if (equipCountEl) {
                equipCountEl.textContent = window.currentVehicle.specialEquipment.length;
            }
            
            updateVehicleCalculations();
            console.log('Equipamento especial alterado:', equipmentId, window.currentVehicle.specialEquipment);
        }
    }

    function loadEquipmentTab_old() {
        const tabContent = document.getElementById('tab-content');
        tabContent.innerHTML = '<div class="text-center py-8"><p class="text-slate-400">Equipamentos adicionais ser√£o implementados em breve...</p></div>';
    }

    // Fun√ß√µes de sele√ß√£o de componentes - SINTAXE CORRIGIDA
    function selectChassis(chassisId) {
        if (window.currentVehicle) {
            window.currentVehicle.chassis = chassisId;
            document.querySelectorAll('#tab-content .component-card').forEach(card => card.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            setTimeout(() => {
                if(window.updateChassisLimits) window.updateChassisLimits();
                updateVehicleCalculations();
                loadTabContent(currentTab);
            }, 50);
        }
    }

    function selectEngine(engineId) {
        if (window.currentVehicle) {
            const compatibility = window.checkComponentCompatibility ? window.checkComponentCompatibility('engines', engineId) : { compatible: true };
            if (!compatibility.compatible) {
                alert('‚ùå ' + compatibility.reason);
                return;
            }
            
            window.currentVehicle.engine = engineId;
            setTimeout(() => {
                updateVehicleCalculations();
                loadTabContent(currentTab);
            }, 50);
        }
    }

    function selectTransmission(transmissionId) {
        if (window.currentVehicle) {
            const compatibility = window.checkComponentCompatibility ? window.checkComponentCompatibility('transmissions', transmissionId) : { compatible: true };
            if (!compatibility.compatible) {
                alert('‚ùå ' + compatibility.reason);
                return;
            }
            
            window.currentVehicle.transmission = transmissionId;
            setTimeout(() => {
                updateVehicleCalculations();
                loadTabContent(currentTab);
            }, 50);
        }
    }

    function selectSuspension(suspensionId) {
        if (window.currentVehicle) {
            const compatibility = window.checkComponentCompatibility ? window.checkComponentCompatibility('suspensions', suspensionId) : { compatible: true };
            if (!compatibility.compatible) {
                alert('‚ùå ' + compatibility.reason);
                return;
            }
            
            window.currentVehicle.suspension = suspensionId;
            setTimeout(() => {
                updateVehicleCalculations();
                loadTabContent(currentTab);
            }, 50);
        }
    }

    function updateCrewSize(size) {
        const crewSize = parseInt(size);
        if (window.currentVehicle) {
            window.currentVehicle.crewSize = crewSize;
        }
        
        document.getElementById('crew-size-display').textContent = crewSize;
        document.getElementById('summary-crew-size').textContent = crewSize;
        
        const crewRoles = {
            2: ['Motorista', 'Gunner/Comandante'],
            3: ['Motorista', 'Gunner', 'Comandante'],
            4: ['Motorista', 'Gunner', 'Comandante', 'Carregador'],
            5: ['Motorista', 'Gunner', 'Comandante', 'Carregador', 'Operador de R√°dio']
        };
        
        const rolesContainer = document.getElementById('crew-roles');
        if (rolesContainer && crewRoles[crewSize]) {
            let rolesHTML = '';
            crewRoles[crewSize].forEach((role, index) => {
                rolesHTML += '<div class="flex items-center gap-3 bg-slate-700/30 rounded-lg p-3">';
                rolesHTML += '<div class="w-8 h-8 bg-brand-500/20 rounded-full flex items-center justify-center text-brand-300 text-sm font-semibold">' + (index + 1) + '</div>';
                rolesHTML += '<span class="text-slate-200 font-medium">' + role + '</span>';
                rolesHTML += '</div>';
            });
            rolesContainer.innerHTML = rolesHTML;
        }
        
        updateVehicleCalculations();
    }

    function selectTrainingLevel(level) {
        if (window.currentVehicle) {
            window.currentVehicle.trainingLevel = level;
        }
        
        const trainingLevels = {
            rookie: { name: 'Recruta', costMultiplier: 0.7, reliabilityBonus: -0.15 },
            standard: { name: 'Padr√£o', costMultiplier: 1.0, reliabilityBonus: 0 },
            veteran: { name: 'Veterano', costMultiplier: 1.5, reliabilityBonus: 0.1 },
            elite: { name: 'Elite', costMultiplier: 2.2, reliabilityBonus: 0.2 }
        };
        
        document.querySelectorAll('.training-level-card').forEach(card => {
            card.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
            card.classList.add('bg-slate-700/30', 'border-slate-600/50');
        });
        
        const selectedCard = document.querySelector('[data-level="' + level + '"]');
        if (selectedCard) {
            selectedCard.classList.remove('bg-slate-700/30', 'border-slate-600/50');
            selectedCard.classList.add('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
        }
        
        document.getElementById('summary-training').textContent = trainingLevels[level].name;
        const costElement = document.getElementById('summary-cost-multiplier');
        costElement.textContent = 'x' + trainingLevels[level].costMultiplier;
        
        costElement.className = 'text-2xl font-bold ' + (
            trainingLevels[level].costMultiplier > 1.5 ? 'text-red-400' :
            trainingLevels[level].costMultiplier > 1.0 ? 'text-amber-400' : 'text-emerald-400'
        );
        
        updateVehicleCalculations();
    }

    function updateArmorThickness(thickness) {
        const armorThickness = parseInt(thickness);
        if (window.currentVehicle) {
            window.currentVehicle.armorThickness = armorThickness;
        }
        
        document.getElementById('armor-thickness-display').textContent = armorThickness;
        document.getElementById('summary-thickness').textContent = armorThickness + 'mm';
        
        const getArmorLevel = (thickness) => {
            if (thickness >= 200) return { level: 'heavy', color: 'text-red-400', name: 'Pesada' };
            if (thickness >= 100) return { level: 'medium', color: 'text-amber-400', name: 'M√©dia' };
            if (thickness >= 30) return { level: 'light', color: 'text-emerald-400', name: 'Leve' };
            return { level: 'minimal', color: 'text-slate-400', name: 'M√≠nima' };
        };
        
        const armorLevel = getArmorLevel(armorThickness);
        const levelIndicator = document.querySelector('.flex.justify-between .font-medium');
        if (levelIndicator) {
            levelIndicator.className = armorLevel.color + ' font-medium';
            levelIndicator.textContent = armorLevel.name;
        }
        
        document.querySelectorAll('.grid.grid-cols-4 > div').forEach((div, index) => {
            const isActive = (index === 0 && armorThickness < 30) ||
                           (index === 1 && armorThickness >= 30 && armorThickness < 100) ||
                           (index === 2 && armorThickness >= 100 && armorThickness < 200) ||
                           (index === 3 && armorThickness >= 200);
            
            div.className = 'text-center p-2 rounded ' + (isActive ? 
                (index === 0 ? 'bg-slate-600/50 text-slate-300' :
                 index === 1 ? 'bg-emerald-500/20 text-emerald-300' :
                 index === 2 ? 'bg-amber-500/20 text-amber-300' :
                 'bg-red-500/20 text-red-300') : 
                'bg-slate-700/30 text-slate-500');
        });
        
        updateArmorEfficiency();
        updateVehicleCalculations();
    }

    function selectArmorMaterial(materialId) {
        if (window.currentVehicle) {
            window.currentVehicle.armorMaterial = materialId;
        }
        
        const armorMaterials = window.VEHICLE_COMPONENTS && window.VEHICLE_COMPONENTS.armor_materials || {};
        const material = armorMaterials[materialId];
        
        document.querySelectorAll('.armor-material-card').forEach(card => {
            card.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
            card.classList.add('bg-slate-700/30', 'border-slate-600/50');
        });
        
        const selectedCard = document.querySelector('[data-material="' + materialId + '"]');
        if (selectedCard) {
            selectedCard.classList.remove('bg-slate-700/30', 'border-slate-600/50');
            selectedCard.classList.add('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
        }
        
        if (material) {
            document.getElementById('summary-material').textContent = material.name;
        }
        
        updateArmorEfficiency();
        updateVehicleCalculations();
    }

    function updateArmorCalculations() {
        const currentThickness = window.currentVehicle && window.currentVehicle.armorThickness || 0;
        const currentMaterial = window.currentVehicle && window.currentVehicle.armorMaterial || 'rolled_homogeneous_armor';
        const armorMaterials = window.VEHICLE_COMPONENTS && window.VEHICLE_COMPONENTS.armor_materials || {};
        const selectedMaterial = armorMaterials[currentMaterial];
        
        if (selectedMaterial) {
            const estimatedWeight = Math.round(currentThickness * selectedMaterial.weight_factor * 15);
            const estimatedCost = Math.round(currentThickness * selectedMaterial.cost_factor * 150);
            
            const weightElement = document.getElementById('summary-weight');
            if (weightElement) {
                weightElement.textContent = estimatedWeight + 'kg';
            }
            
            const costElement = document.getElementById('summary-cost');
            if (costElement) {
                costElement.textContent = '$' + estimatedCost.toLocaleString();
                costElement.className = 'text-2xl font-bold ' + (
                    estimatedCost > 50000 ? 'text-red-400' :
                    estimatedCost > 20000 ? 'text-amber-400' : 'text-emerald-400'
                );
            }
        }
    }

    function updateMainGunCaliber(caliber) {
        const mainGunCaliber = parseInt(caliber);
        if (window.currentVehicle) {
            window.currentVehicle.mainGunCaliber = mainGunCaliber;
        }
        
        document.getElementById('main-gun-caliber-display').textContent = mainGunCaliber;
        const summaryCaliberElement = document.getElementById('summary-main-gun-caliber');
        if (summaryCaliberElement) {
            summaryCaliberElement.textContent = mainGunCaliber + 'mm';
        }
        
        // Update category indicator
        let gunCategory = '';
        let categoryColor = '';
        if (mainGunCaliber <= 75) {
            gunCategory = 'Leve';
            categoryColor = 'text-emerald-400';
        } else if (mainGunCaliber <= 105) {
            gunCategory = 'M√©dia';
            categoryColor = 'text-amber-400';
        } else if (mainGunCaliber <= 125) {
            gunCategory = 'Pesada';
            categoryColor = 'text-red-400';
        } else {
            gunCategory = 'Artilharia';
            categoryColor = 'text-purple-400';
        }
        
        // Update category indicator in slider area
        const categoryElements = document.querySelectorAll('.flex.justify-between .font-medium');
        categoryElements.forEach(element => {
            if (element.textContent.includes('Leve') || element.textContent.includes('M√©dia') || 
                element.textContent.includes('Pesada') || element.textContent.includes('Artilharia')) {
                element.className = categoryColor + ' font-medium';
                element.textContent = gunCategory;
            }
        });
        
        // Update category indicators
        document.querySelectorAll('.grid.grid-cols-4 > div').forEach((div, index) => {
            const isActive = (index === 0 && mainGunCaliber <= 75) ||
                           (index === 1 && mainGunCaliber > 75 && mainGunCaliber <= 105) ||
                           (index === 2 && mainGunCaliber > 105 && mainGunCaliber <= 125) ||
                           (index === 3 && mainGunCaliber > 125);
            
            div.className = 'text-center p-2 rounded ' + (isActive ? 
                (index === 0 ? 'bg-emerald-500/20 text-emerald-300' :
                 index === 1 ? 'bg-amber-500/20 text-amber-300' :
                 index === 2 ? 'bg-red-500/20 text-red-300' :
                 'bg-purple-500/20 text-purple-300') : 
                'bg-slate-700/30 text-slate-500');
        });
        
        // Update summary (safely check if elements exist)
        const cost = Math.round(Math.pow(mainGunCaliber / 25, 2) * 10000);
        
        const costElement = document.getElementById('summary-weapon-cost');
        if (costElement) {
            costElement.textContent = '$' + cost.toLocaleString();
            costElement.className = 'text-2xl font-bold ' + (
                cost > 50000 ? 'text-red-400' :
                cost > 25000 ? 'text-amber-400' : 'text-emerald-400'
            );
        }
        
        updateVehicleCalculations();
    }

    function selectAACaliber(caliber) {
        if (window.currentVehicle) {
            window.currentVehicle.aaGunCaliber = caliber;
        }
        
        // Update display
        document.getElementById('aa-caliber-display').textContent = caliber;
        document.getElementById('summary-aa-caliber').textContent = caliber + 'mm';
        
        // Update button states
        document.querySelectorAll('.aa-caliber-btn').forEach(btn => {
            btn.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400', 'text-brand-200');
            btn.classList.add('bg-slate-700/30', 'border-slate-600/50', 'text-slate-300');
        });
        
        const selectedBtn = document.querySelector('[data-caliber="' + caliber + '"]');
        if (selectedBtn) {
            selectedBtn.classList.remove('bg-slate-700/30', 'border-slate-600/50', 'text-slate-300');
            selectedBtn.classList.add('selected', 'bg-brand-900/30', 'border-brand-400', 'text-brand-200');
        }
        
        updateAACalculations();
        updateVehicleCalculations();
    }

    function updateAAQuantity(quantity) {
        const aaQuantity = parseInt(quantity);
        if (window.currentVehicle) {
            window.currentVehicle.aaGunQuantity = aaQuantity;
        }
        
        document.getElementById('aa-quantity-display').textContent = aaQuantity;
        document.getElementById('summary-aa-quantity').textContent = aaQuantity;
        
        updateAACalculations();
        updateVehicleCalculations();
    }

    function updateAACalculations() {
        const currentAAGunCaliber = window.currentVehicle && window.currentVehicle.aaGunCaliber || 20;
        const currentAAGunQuantity = window.currentVehicle && window.currentVehicle.aaGunQuantity || 1;
        
        const totalWeight = Math.round(currentAAGunQuantity * currentAAGunCaliber * 15);
        const totalCost = currentAAGunQuantity * currentAAGunCaliber * 500;
        
        const weightElement = document.getElementById('summary-aa-total-weight');
        if (weightElement) {
            weightElement.textContent = totalWeight + 'kg';
        }
        
        const costElement = document.getElementById('summary-aa-cost');
        if (costElement) {
            costElement.textContent = '$' + totalCost.toLocaleString();
            costElement.className = 'text-2xl font-bold ' + (
                totalCost > 25000 ? 'text-red-400' :
                totalCost > 15000 ? 'text-amber-400' : 'text-emerald-400'
            );
        }
    }

    function updateVehicleCalculations() {
        if (!window.calculateVehiclePhysics || !window.calculateVehicleCosts) return;
        
        const physics = window.calculateVehiclePhysics();
        const costs = window.calculateVehicleCosts();
        
        // Update live stats
        if (physics && !physics.error) {
            document.getElementById('live-weight').textContent = physics.totalWeight + ' kg';
            document.getElementById('live-reliability').textContent = physics.reliability + '%';
            if (physics.topSpeed && physics.topSpeed.road) {
                document.getElementById('live-speed').textContent = physics.topSpeed.road + ' km/h';
            }
        }
        
        if (costs && !costs.error) {
            document.getElementById('live-cost').textContent = '$' + costs.unitCost.toLocaleString();
        }
    }

    // Enhanced Armor Functions
    function updateArmorMaterial(materialId) {
        if (window.currentVehicle) {
            window.currentVehicle.armorMaterial = materialId;
            updateArmorEfficiency();
            updateVehicleCalculations();
            
            console.log('Material de blindagem atualizado:', materialId);
        }
    }

    function selectArmorAngle(angleId) {
        if (window.currentVehicle) {
            window.currentVehicle.armorAngle = angleId;
            
            // Atualizar visual
            document.querySelectorAll('[onclick^="selectArmorAngle"]').forEach(card => {
                card.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                card.classList.add('bg-slate-800/40', 'border-slate-700/50');
                
                const indicator = card.querySelector('.animate-pulse');
                if (indicator) {
                    indicator.parentElement.remove();
                }
            });
            
            const selectedCard = document.querySelector('[onclick="selectArmorAngle(\'' + angleId + '\')"]');
            if (selectedCard) {
                selectedCard.classList.add('selected', 'bg-brand-900/30', 'border-brand-400', 'shadow-brand-500/20', 'shadow-lg');
                selectedCard.classList.remove('bg-slate-800/40', 'border-slate-700/50');
                
                const indicator = document.createElement('div');
                indicator.className = 'absolute top-2 right-2';
                indicator.innerHTML = '<div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>';
                selectedCard.appendChild(indicator);
            }
            
            updateArmorEfficiency();
            updateVehicleCalculations();
            
            console.log('√Çngulo de blindagem selecionado:', angleId);
        }
    }

    function toggleAdditionalArmor(armorId) {
        if (window.currentVehicle) {
            if (!window.currentVehicle.additionalArmor) {
                window.currentVehicle.additionalArmor = [];
            }
            
            const index = window.currentVehicle.additionalArmor.indexOf(armorId);
            
            if (index > -1) {
                window.currentVehicle.additionalArmor.splice(index, 1);
            } else {
                window.currentVehicle.additionalArmor.push(armorId);
            }
            
            // Atualizar visual
            const card = document.querySelector('[onclick="toggleAdditionalArmor(\'' + armorId + '\')"]');
            if (card) {
                const isSelected = window.currentVehicle.additionalArmor.includes(armorId);
                
                if (isSelected) {
                    card.classList.add('selected', 'bg-brand-900/30', 'border-brand-400');
                    card.classList.remove('bg-slate-700/30', 'border-slate-600/50');
                    
                    const indicator = document.createElement('div');
                    indicator.className = 'absolute top-1 right-1';
                    indicator.innerHTML = '<div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>';
                    card.appendChild(indicator);
                } else {
                    card.classList.remove('selected', 'bg-brand-900/30', 'border-brand-400');
                    card.classList.add('bg-slate-700/30', 'border-slate-600/50');
                    
                    const indicator = card.querySelector('.animate-pulse');
                    if (indicator) {
                        indicator.parentElement.remove();
                    }
                }
            }
            
            updateArmorEfficiency();
            updateVehicleCalculations();
            
            console.log('Blindagem adicional alterada:', armorId, window.currentVehicle.additionalArmor);
        }
    }

    function updateArmorEfficiency() {
        if (!window.currentVehicle || !window.VEHICLE_COMPONENTS) return;
        
        const summaryContainer = document.getElementById('armor-efficiency-summary');
        if (!summaryContainer) return;
        
        const thickness = window.currentVehicle.armorThickness || 80;
        const materialId = window.currentVehicle.armorMaterial || 'rolled_homogeneous_armor';
        const angleId = window.currentVehicle.armorAngle || 'vertical_90';
        const additionalIds = window.currentVehicle.additionalArmor || [];
        
        const materials = window.VEHICLE_COMPONENTS.armor_materials;
        const angles = window.VEHICLE_COMPONENTS.armor_angles;
        const additionalArmors = window.VEHICLE_COMPONENTS.additional_armor;
        
        // Calculate armor efficiency
        const material = materials[materialId];
        const angle = angles[angleId];
        const additional = additionalIds.map(id => additionalArmors[id]).filter(Boolean);
        
        let effectiveness = thickness;
        
        // Apply material effectiveness
        if (material && material.effectiveness_factor) {
            effectiveness *= material.effectiveness_factor;
        }
        
        // Apply angle multiplier
        if (angle && angle.effectiveness_multiplier) {
            effectiveness *= angle.effectiveness_multiplier;
        }
        
        // Add additional armor bonuses
        additional.forEach(armor => {
            if (armor && armor.protection_bonus) {
                effectiveness += armor.protection_bonus * (armor.effectiveness_vs && armor.effectiveness_vs.ap || 1.0);
            }
        });
        
        const effectiveThickness = Math.round(effectiveness);
        
        // Update display
        const effectiveDisplay = document.getElementById('effective-thickness');
        if (effectiveDisplay) {
            let colorClass;
            if (effectiveThickness >= 200) colorClass = 'text-green-400';
            else if (effectiveThickness >= 150) colorClass = 'text-blue-400';
            else if (effectiveThickness >= 100) colorClass = 'text-yellow-400';
            else if (effectiveThickness >= 50) colorClass = 'text-orange-400';
            else colorClass = 'text-red-400';
            
            effectiveDisplay.className = 'text-2xl font-bold ' + colorClass;
            effectiveDisplay.textContent = effectiveThickness + 'mm';
        }
        
        // Update armor preview in main summary
        const armorPreview = document.getElementById('armor-preview');
        if (armorPreview) {
            let colorClass;
            if (effectiveThickness >= 200) colorClass = 'text-green-400';
            else if (effectiveThickness >= 150) colorClass = 'text-blue-400';
            else if (effectiveThickness >= 100) colorClass = 'text-yellow-400';
            else if (effectiveThickness >= 50) colorClass = 'text-orange-400';
            else colorClass = 'text-red-400';
            
            armorPreview.innerHTML = '<span class="' + colorClass + '">' + effectiveThickness + 'mm efetivos</span>';
        }
    }

    // Placeholder functions for buttons
    function performFullAnalysis() {
        if (!window.calculateVehiclePhysics || !window.calculateVehicleCosts) {
            alert('Sistema de c√°lculos n√£o carregado ainda. Aguarde...');
            return;
        }
        
        const physics = window.calculateVehiclePhysics();
        const costs = window.calculateVehicleCosts();
        
        let analysis = 'An√°lise Completa do Ve√≠culo:\\n\\n';
        
        if (physics && !physics.error) {
            analysis += 'üìä PERFORMANCE:\\n';
            analysis += '‚Ä¢ Peso Total: ' + physics.totalWeight + ' kg\\n';
            analysis += '‚Ä¢ Confiabilidade: ' + physics.reliability + '%\\n';
            analysis += '‚Ä¢ Pot√™ncia/Peso: ' + physics.powerToWeight + ' hp/t\\n';
            if (physics.topSpeed) {
                analysis += '‚Ä¢ Vel. Estrada: ' + physics.topSpeed.road + ' km/h\\n';
            }
            analysis += '\\n';
        }
        
        if (costs && !costs.error) {
            analysis += 'üí∞ CUSTOS:\\n';
            analysis += '‚Ä¢ Custo Unit√°rio: $' + costs.unitCost.toLocaleString() + '\\n';
            analysis += '‚Ä¢ Custo Total: $' + costs.totalCost.toLocaleString() + '\\n';
            analysis += '‚Ä¢ Manuten√ß√£o/Hora: $' + costs.maintenanceCostPerHour + '\\n';
            analysis += '\\n';
        }
        
        alert(analysis);
    }

    function savePrototype() {
        const vehicleData = {
            name: document.getElementById('vehicle-name').value || 'Prot√≥tipo Sem Nome',
            vehicle: window.currentVehicle,
            timestamp: new Date().toISOString()
        };
        
        console.log('Prot√≥tipo salvo:', vehicleData);
        alert('Prot√≥tipo salvo com sucesso! Verifique o console para detalhes.');
    }

    function submitForApproval() {
        if (!window.currentVehicle || !window.currentVehicle.chassis || !window.currentVehicle.engine) {
            alert('‚ùå Selecione pelo menos um chassi e um motor antes de enviar para aprova√ß√£o.');
            return;
        }
        
        alert('üéâ Projeto enviado para aprova√ß√£o! O comando analisar√° o design em breve.');
    }
  </script>
</body>
</html>
