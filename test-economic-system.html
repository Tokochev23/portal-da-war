<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Sistema Econ√¥mico War 1954</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
    <div class="container mx-auto py-8 px-4">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-slate-100 mb-2">üß™ Teste do Sistema Econ√¥mico</h1>
                <p class="text-slate-400">Teste das funcionalidades do simulador econ√¥mico</p>
            </div>

            <div class="grid gap-6">
                <!-- Card de Teste de C√°lculos -->
                <div class="bg-slate-800 border border-slate-600 rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-slate-200 mb-4">üßÆ Teste de C√°lculos</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">PIB do Pa√≠s</label>
                            <input type="number" id="test-pib" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="100000000000" placeholder="PIB em d√≥lares">
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">Tecnologia</label>
                            <input type="number" id="test-technology" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="60" min="0" max="100" placeholder="0-100">
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">Urbaniza√ß√£o</label>
                            <input type="number" id="test-urbanization" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="70" min="0" max="100" placeholder="0-100">
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">Estabilidade</label>
                            <input type="number" id="test-stability" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="80" min="0" max="100" placeholder="0-100">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">Tipo de A√ß√£o</label>
                            <select id="test-action-type" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2">
                                <option value="infrastructure">üèóÔ∏è Infraestrutura</option>
                                <option value="research">üî¨ P&D</option>
                                <option value="industry">üè≠ Ind√∫stria</option>
                                <option value="social">üè• Social</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">Investimento (Mi)</label>
                            <input type="number" id="test-investment" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="1000" placeholder="Milh√µes">
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">Dado D12</label>
                            <input type="number" id="test-dice" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="8" min="1" max="12">
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">Buff (%)</label>
                            <input type="number" id="test-buff" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2" value="0" min="-3" max="3" step="0.5">
                        </div>
                    </div>

                    <div class="flex gap-4 mb-4">
                        <button id="test-calculate" class="px-6 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg font-semibold transition-colors">
                            üßÆ Calcular Crescimento
                        </button>
                        <button id="test-inflation" class="px-6 py-2 bg-red-600 hover:bg-red-500 rounded-lg font-semibold transition-colors">
                            üî• Testar Infla√ß√£o
                        </button>
                    </div>

                    <div id="test-results" class="bg-slate-700/50 rounded-lg p-4 hidden">
                        <!-- Resultados aparecer√£o aqui -->
                    </div>
                </div>

                <!-- Card de Teste do Sistema Completo -->
                <div class="bg-slate-800 border border-slate-600 rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-slate-200 mb-4">üöÄ Abrir Simulador</h2>
                    <p class="text-slate-400 mb-4">
                        Teste o sistema econ√¥mico completo abrindo o simulador.
                        Certifique-se de estar logado como narrador.
                    </p>
                    
                    <button id="open-simulator" class="px-6 py-2 bg-emerald-600 hover:bg-emerald-500 rounded-lg font-semibold transition-colors">
                        üí∞ Abrir Simulador Econ√¥mico
                    </button>
                </div>

                <!-- Log de Testes -->
                <div class="bg-slate-800 border border-slate-600 rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-slate-200 mb-4">üìù Log de Testes</h2>
                    <div id="test-log" class="bg-slate-900/50 rounded-lg p-4 min-h-32 font-mono text-sm text-slate-300 overflow-y-auto max-h-64">
                        Sistema pronto para testes...
                    </div>
                    <button id="clear-log" class="mt-2 px-4 py-1 bg-slate-600 hover:bg-slate-500 rounded text-sm transition-colors">
                        üóëÔ∏è Limpar Log
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import EconomicCalculations from './js/systems/economicCalculations.js';
        import { initEconomicSimulator } from './js/systems/economicSimulator.js';

        // Fun√ß√£o para adicionar log
        function addLog(message, type = 'info') {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-slate-300',
                success: 'text-emerald-400',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            
            logElement.innerHTML += `<div class="${colors[type] || colors.info}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Fun√ß√£o para obter dados de teste
        function getTestData() {
            return {
                country: {
                    PIB: document.getElementById('test-pib').value,
                    Tecnologia: document.getElementById('test-technology').value,
                    Urbanizacao: document.getElementById('test-urbanization').value,
                    Estabilidade: document.getElementById('test-stability').value
                },
                action: {
                    type: document.getElementById('test-action-type').value,
                    value: document.getElementById('test-investment').value,
                    dice: parseInt(document.getElementById('test-dice').value),
                    buff: parseFloat(document.getElementById('test-buff').value)
                }
            };
        }

        // Teste de c√°lculo de crescimento
        document.getElementById('test-calculate').addEventListener('click', () => {
            try {
                addLog('Iniciando teste de c√°lculo de crescimento...');
                
                const { country, action } = getTestData();
                
                addLog(`Pa√≠s: PIB=${country.PIB}, Tech=${country.Tecnologia}, Urb=${country.Urbanizacao}, Est=${country.Estabilidade}`);
                addLog(`A√ß√£o: ${action.type}, $${action.value}M, D12=${action.dice}, Buff=${action.buff}%`);
                
                const result = EconomicCalculations.calculateBaseGrowth(action, country);
                
                const resultsDiv = document.getElementById('test-results');
                resultsDiv.innerHTML = `
                    <h3 class="font-semibold text-slate-200 mb-3">üìä Resultados do C√°lculo</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><span class="text-slate-400">Crescimento Base:</span> <span class="text-slate-200">${(result.baseGrowth * 100).toFixed(3)}%</span></div>
                        <div><span class="text-slate-400">Mod. Pa√≠s:</span> <span class="text-slate-200">${result.countryModifier.toFixed(3)}x</span></div>
                        <div><span class="text-slate-400">Mod. Estabilidade:</span> <span class="text-slate-200">${result.stabilityModifier.toFixed(3)}x</span></div>
                        <div><span class="text-slate-400">Mult. Tipo:</span> <span class="text-slate-200">${result.typeMultiplier.toFixed(3)}x</span></div>
                        <div><span class="text-slate-400">Mod. Buff:</span> <span class="text-slate-200">${result.buffModifier.toFixed(3)}x</span></div>
                        <div><span class="text-slate-400">Crescimento Final:</span> <span class="text-emerald-400 font-semibold">${(result.preInflationGrowth * 100).toFixed(3)}%</span></div>
                    </div>
                    <div class="mt-3 p-3 bg-slate-800 rounded">
                        <div class="text-slate-400 text-xs">PIB Ganho (estimado):</div>
                        <div class="text-emerald-400 font-semibold text-lg">$${((result.preInflationGrowth * result.value) * 1000000).toLocaleString()}</div>
                    </div>
                `;
                resultsDiv.classList.remove('hidden');
                
                addLog(`‚úÖ C√°lculo conclu√≠do: ${(result.preInflationGrowth * 100).toFixed(3)}% de crescimento`, 'success');
                
            } catch (error) {
                addLog(`‚ùå Erro no c√°lculo: ${error.message}`, 'error');
                console.error('Erro no teste:', error);
            }
        });

        // Teste de infla√ß√£o
        document.getElementById('test-inflation').addEventListener('click', () => {
            try {
                addLog('Testando c√°lculo de infla√ß√£o...');
                
                const { country, action } = getTestData();
                const actions = [action]; // Simular uma a√ß√£o
                
                const inflation = EconomicCalculations.calculateInflation(actions, country);
                
                addLog(`üî• Infla√ß√£o calculada: ${(inflation * 100).toFixed(2)}%`, 'warning');
                
                // Atualizar resultados
                const resultsDiv = document.getElementById('test-results');
                if (!resultsDiv.classList.contains('hidden')) {
                    resultsDiv.innerHTML += `
                        <div class="mt-4 p-3 bg-red-900/20 border border-red-500/30 rounded">
                            <div class="text-red-400 font-semibold">Infla√ß√£o: ${(inflation * 100).toFixed(2)}%</div>
                            <div class="text-sm text-slate-300 mt-1">
                                Crescimento ap√≥s infla√ß√£o: ${(parseFloat(document.querySelector('.text-emerald-400.font-semibold.text-lg').textContent.replace(/[^\d.-]/g, '')) * (1 - inflation)).toLocaleString()}
                            </div>
                        </div>
                    `;
                }
                
            } catch (error) {
                addLog(`‚ùå Erro no c√°lculo de infla√ß√£o: ${error.message}`, 'error');
                console.error('Erro no teste de infla√ß√£o:', error);
            }
        });

        // Abrir simulador
        document.getElementById('open-simulator').addEventListener('click', async () => {
            try {
                addLog('Inicializando simulador econ√¥mico...');
                
                const simulator = await initEconomicSimulator();
                addLog('‚úÖ Simulador inicializado com sucesso', 'success');
                
                // Tentar abrir o modal
                simulator.showModal();
                addLog('üì± Modal do simulador aberto', 'success');
                
            } catch (error) {
                addLog(`‚ùå Erro ao abrir simulador: ${error.message}`, 'error');
                console.error('Erro ao abrir simulador:', error);
            }
        });

        // Limpar log
        document.getElementById('clear-log').addEventListener('click', () => {
            document.getElementById('test-log').innerHTML = 'Log limpo...';
        });

        // Inicializa√ß√£o
        addLog('üß™ Sistema de testes carregado', 'success');
        addLog('Configure os par√¢metros e execute os testes');
    </script>
</body>
</html>