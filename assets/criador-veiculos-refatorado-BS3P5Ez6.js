import{_ as R}from"./firebase-DhoRyF0N.js";/* empty css                                 */import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js";class ve{constructor(){this.cache=new Map,this.loadingQueue=new Set,this.retryAttempts=3,this.retryDelay=1e3}async loadTemplate(e,t=!0){if(t&&this.cache.has(e))return this.cache.get(e);if(this.loadingQueue.has(e))return this.waitForTemplate(e);this.loadingQueue.add(e);try{const a=await(await this.fetchWithRetry(e)).text();return this.cache.set(e,a),this.loadingQueue.delete(e),a}catch(i){throw this.loadingQueue.delete(e),console.error(`Failed to load template: ${e}`,i),new Error(`Template loading failed: ${e}`)}}async fetchWithRetry(e,t=0){try{const i=await fetch(e);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return i}catch(i){if(t<this.retryAttempts-1)return await this.delay(this.retryDelay*(t+1)),this.fetchWithRetry(e,t+1);throw i}}async waitForTemplate(e){for(;this.loadingQueue.has(e);)await this.delay(50);return this.cache.get(e)}delay(e){return new Promise(t=>setTimeout(t,e))}preloadTemplates(e){return Promise.allSettled(e.map(t=>this.loadTemplate(t)))}clearCache(){this.cache.clear(),this.loadingQueue.clear()}getCacheSize(){return this.cache.size}}window.templateLoader=new ve;class xe{constructor(e){this.loader=e,this.injectionQueue=[],this.isProcessing=!1}async injectTemplate(e,t,i={}){return new Promise((a,s)=>{this.injectionQueue.push({containerId:e,templatePath:t,data:i,resolve:a,reject:s}),this.isProcessing||this.processQueue()})}async processQueue(){if(this.injectionQueue.length===0){this.isProcessing=!1;return}this.isProcessing=!0;const e=this.injectionQueue.shift();try{const t=await this.loader.loadTemplate(e.templatePath),i=this.processTemplate(t,e.data),a=document.getElementById(e.containerId);if(!a)throw new Error(`Container not found: ${e.containerId}`);a.innerHTML=i,e.resolve(i)}catch(t){console.error("Template injection failed:",t),e.reject(t)}setTimeout(()=>this.processQueue(),10)}processTemplate(e,t){let i=e;for(const[a,s]of Object.entries(t)){const n=new RegExp(`{{\\s*${a}\\s*}}`,"g");i=i.replace(n,String(s))}return i}async injectMultipleTemplates(e){const t=e.map(i=>this.injectTemplate(i.containerId,i.templatePath,i.data));return Promise.allSettled(t)}}window.templateInjector=new xe(window.templateLoader);window.loadTemplate=async function(o,e,t={}){try{await window.templateInjector.injectTemplate(o,e,t)}catch(i){console.error(`Failed to load template into ${o}:`,i);const a=document.getElementById(o);a&&(a.innerHTML=`
                <div class="text-center py-8 text-red-400">
                    <div class="text-2xl mb-2">‚ö†Ô∏è</div>
                    <p>Erro ao carregar componente</p>
                    <p class="text-sm text-slate-500 mt-2">${i.message}</p>
                </div>
            `)}};class Ce{constructor(){this.criticalTemplates=["templates/aircraft-creator/airframes-tab.html","templates/aircraft-creator/engines-tab.html"],this.secondaryTemplates=["templates/aircraft-creator/weapons-tab.html","templates/aircraft-creator/wings-tab.html","templates/aircraft-creator/avionics-tab.html"],this.tertiaryTemplates=["templates/aircraft-creator/component-tabs.html"]}async loadCritical(){console.log("üöÄ Loading critical templates...");const e=await window.templateLoader.preloadTemplates(this.criticalTemplates),t=e.filter(i=>i.status==="rejected");return t.length>0&&console.warn("Some critical templates failed to load:",t),e}async loadSecondary(){return console.log("üì¶ Loading secondary templates..."),window.templateLoader.preloadTemplates(this.secondaryTemplates)}async loadTertiary(){return console.log("üîß Loading tertiary templates..."),window.templateLoader.preloadTemplates(this.tertiaryTemplates)}async loadAll(){try{await this.loadCritical(),setTimeout(()=>this.loadSecondary(),100),setTimeout(()=>this.loadTertiary(),500),console.log("‚úÖ Progressive loading initiated")}catch(e){console.error("‚ùå Progressive loading failed:",e)}}}window.progressiveLoader=new Ce;console.log("üìù Template Loader carregado!");class G{constructor(){this.tabContent=null}getTabContent(){return this.tabContent||(this.tabContent=document.getElementById("tab-content")),this.tabContent}showLoadingState(e="Carregando componentes..."){const t=this.getTabContent();t&&(t.innerHTML=`<div class="text-center text-slate-400 p-8">${e}</div>`)}showEmptyState(e){const t=this.getTabContent();t&&(t.innerHTML=`<div class="text-center text-slate-500 p-8">${e}</div>`)}loadChassisTab(){const e=window.VEHICLE_COMPONENTS.chassis||{};let t='<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';Object.entries(e).forEach(([i,a])=>{t+=this.renderChassisCard(i,a)}),t+="</div>",this.getTabContent().innerHTML=t}loadEngineTab(){const e=window.filterCompatibleComponents("engines");if(Object.keys(e).length===0){this.showEmptyState("Nenhum motor compat√≠vel para o chassi selecionado.");return}let t='<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';Object.entries(e).forEach(([i,a])=>{t+=this.renderEngineCardV2(i,a)}),t+="</div>",this.getTabContent().innerHTML=t}renderEngineCardV2(e,t){const i=window.currentVehicle?.engine===e,a=window.getResolvedComponent("engines",e);if(!a)return"";const s=t?.category||a.category||"",n=Math.round(a.power||0),r=Math.round(a.weight||0),c=a.cost?Math.round(a.cost/1e3):0,l=a.energy_output??t?.energy_output??0,d=Math.min(100,Math.max(0,Math.round((a.reliability||0)*100))),u=s==="heavy"?"bg-red-600":s==="medium"?"bg-blue-600":"bg-emerald-600";return`
        <button class="component-card relative w-full text-left rounded-2xl p-4 shadow-lg transition ${i?"selected border-brand-400 ring-1 ring-brand-400/50":""} bg-gradient-to-br from-slate-800 to-slate-900 hover:scale-[1.01] hover:shadow-xl" onclick="selectEngine('${e}')">
          <div class="flex justify-between items-center mb-2">
            <h4 class="text-base font-semibold text-slate-100">${a.name}</h4>
            <span class="px-2 py-0.5 text-xs rounded-lg text-white ${u}">${s||"‚Äî"}</span>
          </div>
          <div class="grid grid-cols-2 gap-2 text-xs">
            <div class="flex items-center gap-1"><span>‚öôÔ∏è</span> <b>${n}hp</b></div>
            <div class="flex items-center gap-1"><span>‚öñÔ∏è</span> <b>${r}kg</b></div>
            <div class="flex items-center gap-1 text-yellow-400"><span>üí∞</span> $${c}K</div>
            <div class="flex items-center gap-1 text-green-400"><span>‚ö°</span> ${l}kW</div>
          </div>
          <div class="mt-3">
            <span class="text-xs text-slate-400">Confiabilidade</span>
            <div class="w-full bg-slate-700 rounded-full h-2 mt-1">
              <div class="bg-green-500 h-2 rounded-full" style="width: ${d}%"></div>
            </div>
            <p class="text-xs text-right text-slate-300">${d}%</p>
          </div>
          ${i?'<div class="absolute top-2 right-2 w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>':""}
        </button>`}loadTransmissionTab(){const e=window.filterCompatibleComponents("transmissions");if(Object.keys(e).length===0){this.showEmptyState("Nenhuma transmiss√£o compat√≠vel para o chassi selecionado.");return}let t='<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';Object.entries(e).forEach(([i,a])=>{t+=this.renderTransmissionCard(i,a)}),t+="</div>",this.getTabContent().innerHTML=t}loadSuspensionTab(){const e=window.filterCompatibleComponents("suspensions");if(Object.keys(e).length===0){this.showEmptyState("Nenhuma suspens√£o compat√≠vel para o chassi selecionado.");return}let t='<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';Object.entries(e).forEach(([i,a])=>{t+=this.renderSuspensionCard(i,a)}),t+="</div>",this.getTabContent().innerHTML=t}loadCrewTab(){const e=window.currentVehicle?.crewSize||3,t=window.currentVehicle?.trainingLevel||"standard";if(this.getTabContent().innerHTML=this.renderCrewInterface(e,t),window.updateCrewRolesDisplay)try{window.updateCrewRolesDisplay(e)}catch{}}loadArmorTab(){const e=window.currentVehicle||{},t=window.VEHICLE_COMPONENTS.armor_materials,i=window.VEHICLE_COMPONENTS.additional_armor,a=window.VEHICLE_COMPONENTS.armor_angles,s=e.armorThickness||80,n=e.armorMaterial||"rolled_homogeneous_armor",r=e.armorAngle||"vertical_90",c=e.additionalArmor||[];if(this.getTabContent().innerHTML=this.renderArmorInterfaceV2(s,n,r,c,t,i,a),window.updateArmorEfficiency)try{window.updateArmorEfficiency()}catch{}}loadWeaponsTab(){if(this.getTabContent().innerHTML=this.renderWeaponsInterface(),window.updateGunPreview)try{window.updateGunPreview()}catch{}}loadSystemsTab(){this.getTabContent().innerHTML=this.renderSystemsInterface()}loadEquipmentTab(){this.getTabContent().innerHTML=this.renderEquipmentInterface()}renderChassisCard(e,t){const i=window.currentVehicle?.chassis===e,a=t.base_cost>12e4?"high":t.base_cost>8e4?"medium":"low",s=t.tech_requirement?.level>70?"advanced":t.tech_requirement?.level>50?"standard":"basic",n=t.reliability>.85?"excellent":t.reliability>.7?"good":"fair";return`<div class="component-card relative p-4 rounded-xl cursor-pointer ${i?"selected bg-brand-900/30 border-brand-400 shadow-brand-500/20 shadow-lg":"bg-slate-800/40 border-slate-700/50"} hover:border-brand-500/60 transition-all duration-200" onclick="selectChassis('${e}')">
            <div class="flex items-start justify-between mb-3">
                <h4 class="font-semibold text-base ${i?"text-brand-100":"text-slate-100"}">${t.name}</h4>
                ${t.tech_requirement?.level?`<span class="text-xs px-2 py-1 rounded font-medium ${s==="advanced"?"bg-purple-500/20 text-purple-300":s==="standard"?"bg-blue-500/20 text-blue-300":"bg-slate-600/50 text-slate-400"}">${t.tech_requirement.level}% tech</span>`:""}
            </div>
            <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-slate-400">
                <div><span class="text-slate-500">Peso:</span> <span class="font-medium text-slate-300">${(t.base_weight/1e3).toFixed(1)}t</span></div>
                <div><span class="text-slate-500">Vel M√°x:</span> <span class="font-medium text-slate-300">${t.base_speed} km/h</span></div>
                <div><span class="text-slate-500">Custo:</span> <span class="font-medium ${a==="high"?"text-red-400":a==="medium"?"text-amber-400":"text-emerald-400"}">$${(t.base_cost/1e3).toFixed(0)}K</span></div>
                <div><span class="text-slate-500">Blind. M√°x:</span> <span class="font-medium text-slate-300">${t.max_armor_thickness}mm</span></div>
            </div>
            ${t.reliability?`<div class="mt-3 pt-2 border-t ${i?"border-brand-700/50":"border-slate-700/50"}">
                <div class="flex justify-between items-center text-xs">
                    <span class="text-slate-500">Confiabilidade</span>
                    <div class="flex items-center gap-2">
                        <div class="w-16 h-1.5 bg-slate-700 rounded-full overflow-hidden">
                            <div class="h-full rounded-full ${n==="excellent"?"bg-emerald-500":n==="good"?"bg-blue-500":"bg-amber-500"}" style="width: ${t.reliability*100}%"></div>
                        </div>
                        <span class="font-medium ${n==="excellent"?"text-emerald-400":n==="good"?"text-blue-400":"text-amber-400"}">${Math.round(t.reliability*100)}%</span>
                    </div>
                </div>
            </div>`:""}
            ${i?'<div class="absolute top-2 right-2 w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>':""}
        </div>`}renderEngineCard(e,t){const i=window.currentVehicle?.engine===e,a=window.getResolvedComponent("engines",e);return a?`<div class="component-card relative p-4 rounded-xl cursor-pointer ${i?"selected bg-brand-900/30 border-brand-400":"bg-slate-800/40 border-slate-700/50"} hover:border-brand-500/60 transition-all duration-200" onclick="selectEngine('${e}')">
            <h4 class="font-semibold text-base ${i?"text-brand-100":"text-slate-100"}">${a.name}</h4>
            <div class="grid grid-cols-2 gap-x-4 gap-y-1 mt-2 text-xs text-slate-400">
                <span>Pot√™ncia: <span class="font-medium text-slate-300">${a.power}hp</span></span>
                <span>Peso: <span class="font-medium text-slate-300">${a.weight}kg</span></span>
                <span>Custo: <span class="font-medium text-slate-300">$${(a.cost/1e3).toFixed(0)}K</span></span>
                <span>Consumo: <span class="font-medium text-slate-300">${a.consumption} L/h</span></span>
            </div>
            ${i?'<div class="absolute top-2 right-2 w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>':""}
        </div>`:""}renderTransmissionCard(e,t){const i=window.currentVehicle?.transmission===e,a=this.getTransmissionTypeInfo(t.type),s=Math.round(t.efficiency*100),n=t.gears==="infinite"?"‚àû":t.gears==="variable"?"Var":t.gears,r=Math.round(t.cost/1e3),c=Math.round(t.weight);return`
        <div class="component-card relative overflow-hidden rounded-2xl cursor-pointer transition-all duration-300 hover:scale-[1.02] ${i?"selected bg-gradient-to-br from-brand-900/40 to-brand-800/30 border-2 border-brand-400 shadow-lg shadow-brand-500/20":"bg-gradient-to-br from-slate-800/60 to-slate-900/40 border border-slate-700/50 hover:border-slate-600/60"}" onclick="selectTransmission('${e}')">
            <!-- Header with type badge -->
            <div class="flex items-start justify-between p-4 pb-3">
                <div class="flex-1">
                    <h4 class="font-bold text-lg ${i?"text-brand-100":"text-slate-100"} mb-1">${t.name}</h4>
                    <div class="flex items-center gap-2">
                        <span class="px-3 py-1.5 rounded-full text-sm font-semibold ${a.badgeClass}">
                            ${a.icon} ${a.name}
                        </span>
                    </div>
                </div>
                ${i?'<div class="w-3 h-3 bg-brand-400 rounded-full animate-pulse"></div>':""}
            </div>
            
            <!-- Main stats row -->
            <div class="px-4 pb-3">
                <div class="flex items-center justify-between mb-3">
                    <div class="text-center">
                        <div class="text-2xl font-bold ${i?"text-brand-200":"text-slate-200"}">${n}</div>
                        <div class="text-xs text-slate-400">Marchas</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl font-bold text-slate-300">${c}kg</div>
                        <div class="text-xs text-slate-400">Peso</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl font-bold text-green-400">$${r}K</div>
                        <div class="text-xs text-slate-400">Custo</div>
                    </div>
                </div>
            </div>
            
            <!-- Efficiency bar and percentage -->
            <div class="px-4 pb-4">
                <div class="flex items-center justify-between text-sm mb-2">
                    <span class="text-slate-400">Efici√™ncia</span>
                    <span class="font-bold ${s>=80?"text-green-400":s>=70?"text-yellow-400":"text-orange-400"}">${s}%</span>
                </div>
                <div class="w-full bg-slate-700/60 rounded-full h-3 overflow-hidden">
                    <div class="h-full rounded-full transition-all duration-500 ${s>=80?"bg-gradient-to-r from-green-600 to-green-400":s>=70?"bg-gradient-to-r from-yellow-600 to-yellow-400":"bg-gradient-to-r from-orange-600 to-orange-400"}" style="width: ${s}%"></div>
                </div>
            </div>
            
            <!-- Special features badges (if any) -->
            ${this.renderTransmissionSpecialFeatures(t)}
            
            ${i?'<div class="absolute inset-0 border-2 border-brand-400/30 rounded-2xl pointer-events-none"></div>':""}
        </div>`}getTransmissionTypeInfo(e){return{manual:{name:"Manual",icon:"üîß",badgeClass:"bg-gradient-to-r from-slate-600 to-slate-500 text-white border border-slate-400/30"},semi_auto:{name:"Semi-Auto",icon:"‚öôÔ∏è",badgeClass:"bg-gradient-to-r from-blue-600 to-blue-500 text-white border border-blue-400/30"},automatic:{name:"Autom√°tica",icon:"ü§ñ",badgeClass:"bg-gradient-to-r from-green-600 to-green-500 text-white border border-green-400/30"},planetary:{name:"Planet√°rio",icon:"üåç",badgeClass:"bg-gradient-to-r from-purple-600 to-purple-500 text-white border border-purple-400/30"},cvt:{name:"CVT",icon:"‚ôæÔ∏è",badgeClass:"bg-gradient-to-r from-orange-600 to-orange-500 text-white border border-orange-400/30"},electric:{name:"El√©trica",icon:"‚ö°",badgeClass:"bg-gradient-to-r from-cyan-600 to-cyan-500 text-white border border-cyan-400/30"},hydrostatic:{name:"Hidrost√°tica",icon:"üíß",badgeClass:"bg-gradient-to-r from-indigo-600 to-indigo-500 text-white border border-indigo-400/30"}}[e]||{name:e,icon:"‚ùì",badgeClass:"bg-gradient-to-r from-slate-600 to-slate-500 text-white border border-slate-400/30"}}renderTransmissionSpecialFeatures(e){const t=[];return e.torque_converter&&t.push({icon:"üîÑ",text:"Conversor de Torque",class:"bg-blue-600/20 text-blue-300 border border-blue-500/30"}),e.hydraulic_assist&&t.push({icon:"üí®",text:"Assist√™ncia Hidr√°ulica",class:"bg-indigo-600/20 text-indigo-300 border border-indigo-500/30"}),e.continuously_variable&&t.push({icon:"‚ôæÔ∏è",text:"Varia√ß√£o Cont√≠nua",class:"bg-orange-600/20 text-orange-300 border border-orange-500/30"}),e.instant_torque&&t.push({icon:"‚ö°",text:"Torque Instant√¢neo",class:"bg-yellow-600/20 text-yellow-300 border border-yellow-500/30"}),e.silent_operation&&t.push({icon:"ü§´",text:"Opera√ß√£o Silenciosa",class:"bg-gray-600/20 text-gray-300 border border-gray-500/30"}),e.pivot_turn&&t.push({icon:"üîÑ",text:"Giro no Local",class:"bg-purple-600/20 text-purple-300 border border-purple-500/30"}),e.smooth_operation&&t.push({icon:"üåä",text:"Opera√ß√£o Suave",class:"bg-teal-600/20 text-teal-300 border border-teal-500/30"}),e.prototype_only&&t.push({icon:"üß™",text:"Prot√≥tipo",class:"bg-red-600/20 text-red-300 border border-red-500/30"}),t.length===0?"":`
        <div class="px-4 pb-3 border-t border-slate-700/40">
            <div class="flex flex-wrap gap-1.5 mt-3">
                ${t.map(i=>`
                    <span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-md ${i.class}">
                        <span class="text-xs">${i.icon}</span>
                        ${i.text}
                    </span>
                `).join("")}
            </div>
        </div>`}renderSuspensionCard(e,t){const i=window.currentVehicle?.suspension===e,a=Math.round(t.comfort_factor*100),s=Math.round(t.cost/1e3),n=Math.round(t.weight),r=this.getSuspensionTechLevel(t),c=this.getSuspensionSpecialFeatures(t);return`
        <div class="component-card relative overflow-hidden rounded-2xl cursor-pointer transition-all duration-300 hover:scale-[1.02] ${i?"selected bg-gradient-to-br from-brand-900/40 to-brand-800/30 border-2 border-brand-400 shadow-lg shadow-brand-500/20":"bg-gradient-to-br from-slate-800/60 to-slate-900/40 border border-slate-700/50 hover:border-slate-600/60"}" onclick="selectSuspension('${e}')">
            <!-- Header with tech level badge -->
            <div class="flex items-start justify-between p-4 pb-3">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xs text-slate-500 uppercase tracking-wide">SUSPENS√ÉO</span>
                        <span class="px-2 py-1 text-xs font-semibold rounded-md ${r.badgeClass}">
                            ${r.name}
                        </span>
                    </div>
                    <h4 class="font-bold text-lg ${i?"text-brand-100":"text-slate-100"} mb-1">
                        ${t.name}
                        ${t.experimental?' <span class="text-orange-400">(Experimental)</span>':""}
                    </h4>
                </div>
                ${i?'<div class="w-3 h-3 bg-brand-400 rounded-full animate-pulse"></div>':""}
            </div>
            
            <!-- Comfort bar - destaque principal -->
            <div class="px-4 pb-3">
                <div class="flex items-center justify-between text-sm mb-2">
                    <div class="flex items-center gap-2">
                        <span class="text-slate-400">üõãÔ∏è Conforto</span>
                    </div>
                    <span class="font-bold text-2xl ${a>=90?"text-green-400":a>=80?"text-blue-400":a>=70?"text-yellow-400":"text-orange-400"}">${a}%</span>
                </div>
                <div class="w-full bg-slate-700/60 rounded-full h-4 overflow-hidden">
                    <div class="h-full rounded-full transition-all duration-500 ${a>=90?"bg-gradient-to-r from-green-600 to-green-400":a>=80?"bg-gradient-to-r from-blue-600 to-blue-400":a>=70?"bg-gradient-to-r from-yellow-600 to-yellow-400":"bg-gradient-to-r from-orange-600 to-orange-400"}" style="width: ${a}%"></div>
                </div>
            </div>
            
            <!-- Stats row -->
            <div class="px-4 pb-3">
                <div class="flex items-center justify-between">
                    <div class="text-center">
                        <div class="flex items-center gap-1 text-slate-400 text-xs mb-1">
                            <span>‚öñÔ∏è</span>
                            <span>Peso</span>
                        </div>
                        <div class="text-lg font-bold text-slate-300">${n}kg</div>
                    </div>
                    <div class="text-center">
                        <div class="flex items-center gap-1 text-slate-400 text-xs mb-1">
                            <span>üí∞</span>
                            <span>Custo</span>
                        </div>
                        <div class="text-lg font-bold text-green-400">$${s}K</div>
                    </div>
                    <div class="text-center">
                        <div class="flex items-center gap-1 text-slate-400 text-xs mb-1">
                            <span>üèîÔ∏è</span>
                            <span>Terreno</span>
                        </div>
                        <div class="text-lg font-bold text-slate-300">${Math.round(t.terrain_performance*100)}%</div>
                    </div>
                </div>
            </div>
            
            <!-- Special features badges -->
            ${c.length>0?`
            <div class="px-4 pb-3 border-t border-slate-700/40">
                <div class="flex flex-wrap gap-1.5 mt-3">
                    ${c.map(l=>`
                        <span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-md ${l.class}">
                            <span class="text-xs">${l.icon}</span>
                            ${l.text}
                        </span>
                    `).join("")}
                </div>
            </div>`:""}
            
            ${i?'<div class="absolute inset-0 border-2 border-brand-400/30 rounded-2xl pointer-events-none"></div>':""}
        </div>`}getSuspensionTechLevel(e){const t=e.tech_requirement?.level||0;return t>=75?{name:"Avan√ßada",badgeClass:"bg-gradient-to-r from-purple-600 to-purple-500 text-white border border-purple-400/30"}:t>=50?{name:"Moderna",badgeClass:"bg-gradient-to-r from-blue-600 to-blue-500 text-white border border-blue-400/30"}:t>=30?{name:"Padr√£o",badgeClass:"bg-gradient-to-r from-green-600 to-green-500 text-white border border-green-400/30"}:{name:"B√°sica",badgeClass:"bg-gradient-to-r from-slate-600 to-slate-500 text-white border border-slate-400/30"}}getSuspensionSpecialFeatures(e){const t=[];return e.variable_height&&t.push({icon:"üìè",text:"Altura Ajust√°vel",class:"bg-blue-600/20 text-blue-300 border border-blue-500/30"}),e.automatic_adjustment&&t.push({icon:"ü§ñ",text:"Ajuste Autom√°tico",class:"bg-green-600/20 text-green-300 border border-green-500/30"}),e.high_speed_stability&&t.push({icon:"üèéÔ∏è",text:"Estabilidade Velocidade",class:"bg-orange-600/20 text-orange-300 border border-orange-500/30"}),e.internal_space_savings&&t.push({icon:"üì¶",text:"Economia de Espa√ßo",class:"bg-purple-600/20 text-purple-300 border border-purple-500/30"}),e.track_contact_bonus&&t.push({icon:"üõ§Ô∏è",text:"Melhor Contato",class:"bg-teal-600/20 text-teal-300 border border-teal-500/30"}),e.maintenance_difficulty&&t.push({icon:"‚ö†Ô∏è",text:"Manuten√ß√£o Dif√≠cil",class:"bg-red-600/20 text-red-300 border border-red-500/30"}),e.experimental&&t.push({icon:"üß™",text:"Experimental",class:"bg-yellow-600/20 text-yellow-300 border border-yellow-500/30"}),e.stabilization_bonus&&t.push({icon:"‚öñÔ∏è",text:"Estabiliza√ß√£o Extra",class:"bg-indigo-600/20 text-indigo-300 border border-indigo-500/30"}),t}renderCrewInterface(e,t){const i={rookie:{name:"Recruta",desc:"Custo baixo, menos eficiente"},standard:{name:"Padr√£o",desc:"Treinamento equilibrado"},veteran:{name:"Veterano",desc:"Experiente e mais confi√°vel"},elite:{name:"Elite",desc:"M√°xima efici√™ncia em combate"}};let a='<div class="space-y-6">';return a+='<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">',a+='<h3 class="text-lg font-semibold text-slate-100 mb-4">üë• Tamanho da Tripula√ß√£o</h3>',a+=`<div class="flex items-center justify-between"><span class="text-slate-300">N√∫mero de Tripulantes:</span><span class="text-2xl font-bold text-brand-400" id="crew-size-display">${e}</span></div>`,a+=`<div class="relative"><input type="range" id="crew-size-slider" min="2" max="5" value="${e}" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb" oninput="updateCrewSize(this.value)" /></div>`,a+="</div>",a+='<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">',a+='<h3 class="text-lg font-semibold text-slate-100 mb-4">üéñÔ∏è N√≠vel de Treinamento</h3>',a+='<div class="grid grid-cols-1 md:grid-cols-2 gap-4">',Object.entries(i).forEach(([s,n])=>{const r=t===s;a+=`<div class="component-card relative p-4 rounded-xl cursor-pointer ${r?"selected bg-brand-900/30 border-brand-400":"bg-slate-700/30 border-slate-700/50"}" onclick="selectTrainingLevel('${s}')">
                <h4 class="font-semibold ${r?"text-brand-100":"text-slate-100"}">${n.name}</h4>
                <p class="text-xs ${r?"text-brand-200":"text-slate-400"}">${n.desc}</p>
                ${r?'<div class="absolute top-2 right-2 w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>':""}
            </div>`}),a+="</div></div></div>",a}renderArmorInterface(e,t,i,a,s,n,r){let c='<div class="space-y-6">';return c+='<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">',c+='<h3 class="text-lg font-semibold text-slate-100 mb-4">üõ°Ô∏è Blindagem Base</h3>',c+='<div class="grid grid-cols-1 md:grid-cols-2 gap-6">',c+=`<div><label class="block text-sm font-medium text-slate-300 mb-2">Material</label><select id="armor-material-select" class="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg" onchange="updateArmorMaterial(this.value)">${Object.entries(s).map(([l,d])=>`<option value="${l}" ${l===t?"selected":""}>${d.name}</option>`).join("")}</select></div>`,c+=`<div><label class="block text-sm font-medium text-slate-300 mb-2">Espessura</label><div class="flex items-center"><input type="range" id="armor-thickness-slider" min="20" max="300" value="${e}" class="w-full" oninput="updateArmorThickness(this.value)"><span class="ml-4 w-16 text-right font-bold text-brand-400">${e}mm</span></div></div>`,c+="</div></div>",c+='<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">',c+='<h3 class="text-lg font-semibold text-slate-100 mb-4">üìê √Çngulo da Blindagem</h3>',c+='<div class="grid grid-cols-2 md:grid-cols-4 gap-4">',Object.entries(r).forEach(([l,d])=>{const u=l===i;c+=`<div class="component-card text-center p-3 rounded-xl cursor-pointer ${u?"selected bg-brand-900/30 border-brand-400":"bg-slate-800/40 border-slate-700/50"}" onclick="selectArmorAngle('${l}')">
                <div class="font-semibold ${u?"text-brand-100":"text-slate-100"}">${d.name}</div>
                <div class="text-xs text-slate-400">${d.effectiveness_multiplier}x</div>
            </div>`}),c+="</div></div>",c+='<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">',c+='<h3 class="text-lg font-semibold text-slate-100 mb-4">üîß Blindagens Adicionais</h3>',c+='<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">',Object.entries(n).forEach(([l,d])=>{const u=a.includes(l);c+=`<div class="component-card relative p-3 rounded-xl cursor-pointer ${u?"selected bg-brand-900/30 border-brand-400":"bg-slate-800/40 border-slate-700/50"}" onclick="toggleAdditionalArmor('${l}')">
                <h5 class="font-medium text-sm ${u?"text-brand-100":"text-slate-100"}">${d.name}</h5>
                <div class="text-xs text-slate-400">+${d.protection_bonus}mm, ${d.weight}kg</div>
                ${u?'<div class="absolute top-1 right-1 w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>':""}
            </div>`}),c+="</div></div></div>",c}renderWeaponsInterface(){let e='<div class="space-y-6">';return e+=this.renderMainGunSection(),e+=this.renderSecondaryWeaponsSection(),e+=this.renderAntiAircraftSection(),e+=this.renderWeaponsResume(),e+="</div>",e}renderMainGunSection(){const e=window.currentVehicle?.chassis?window.VEHICLE_COMPONENTS?.chassis?.[window.currentVehicle.chassis]:null,t=e?.min_main_gun_caliber??20,i=e?.max_main_gun_caliber??180;let a=window.currentVehicle?.main_gun_caliber||Math.max(37,t);a<t&&(a=t),a>i&&(a=i),window.currentVehicle.main_gun_caliber=a;const s=window.currentVehicle?.main_gun_length_ratio||40,n=this.calculateGunPenetration(a,s),r=this.calculateGunCost(a,s);let c='<div class="bg-slate-800/60 border border-slate-700/50 rounded-2xl overflow-hidden">';c+='<div class="bg-gradient-to-r from-orange-600/20 to-red-600/20 border-b border-slate-700/50 p-4">',c+='<div class="flex items-center gap-3">',c+='<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center">',c+='<span class="text-white text-xl">üéØ</span>',c+="</div>",c+='<h3 class="text-2xl font-bold text-slate-100">Canh√£o Principal</h3>',c+=`<div id="main-gun-header-caliber" class="ml-auto text-3xl font-bold text-orange-400">${a} mm</div>`,c+="</div>",c+="</div>",c+='<div class="p-6">',c+='<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">',c+="<div>",c+='<div class="flex items-center justify-between mb-3">',c+='<label class="text-sm font-medium text-slate-300">Comprimento do Cano</label>',c+='<div class="flex gap-2">',["L/30","L/40","L/50","L/60","L/70"].forEach(u=>{const p=parseInt(u.substring(2));c+=`<button onclick="updateMainGunLength(${p})" class="px-3 py-1 text-xs rounded-md font-medium transition-colors ${s===p?"bg-brand-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}">${u}</button>`}),c+="</div>",c+="</div>",c+='<div class="relative">',c+=`<input type="range" id="main-gun-caliber-slider" min="${t}" max="${i}" value="${a}" class="w-full h-3 bg-slate-700/60 rounded-full appearance-none cursor-pointer slider-thumb" oninput="updateMainGunCaliber(this.value)" />`,c+='<div class="flex justify-between text-xs text-slate-400 mt-2">',c+=`<span>${t}mm</span><span>${i}mm</span>`,c+="</div>",c+="</div>",c+="</div>",c+="<div>",c+='<label class="text-sm font-medium text-slate-300 mb-3 block">Tipo de Muni√ß√£o</label>',c+='<div class="flex gap-2 flex-wrap">';const l=[{id:"AP",name:"AP",desc:"Perfurante"},{id:"HE",name:"HE",desc:"Alto Explosivo"},{id:"APCR",name:"APCR",desc:"N√∫cleo R√≠gido"},{id:"HEAT",name:"HEAT",desc:"Carga Oca"},{id:"APDS",name:"APDS",desc:"Sabot Descart√°vel"}],d=window.currentVehicle?.main_gun_ammo||"AP";return l.forEach(u=>{const p=d===u.id;c+=`<button onclick="updateMainGunAmmo('${u.id}')" class="px-4 py-2 text-sm rounded-lg font-medium transition-colors ${p?"bg-brand-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}">${u.name}</button>`}),c+="</div>",c+="</div>",c+="</div>",c+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30">',c+='<div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">',c+="<div>",c+='<div class="text-xs text-slate-400 mb-1">Penetra√ß√£o estimada</div>',c+=`<div class="text-xl font-bold text-slate-200" id="main-gun-penetration">${n} mm</div>`,c+="</div>",c+="<div>",c+='<div class="text-xs text-slate-400 mb-1">Custo do canh√£o</div>',c+=`<div class="text-xl font-bold text-slate-200" id="main-gun-cost">$${r}K</div>`,c+="</div>",c+="</div>",c+="</div>",c+="</div>",c+="</div>",c}renderSecondaryWeaponsSection(){const e=window.filterCompatibleComponents("secondary_weapons")||{};let t='<div class="bg-slate-800/60 border border-slate-700/50 rounded-2xl overflow-hidden">';return t+='<div class="bg-gradient-to-r from-blue-600/20 to-cyan-600/20 border-b border-slate-700/50 p-4">',t+='<div class="flex items-center gap-3">',t+='<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center">',t+='<span class="text-white text-xl">üî´</span>',t+="</div>",t+='<h3 class="text-2xl font-bold text-slate-100">Armamento Secund√°rio</h3>',t+="</div>",t+="</div>",t+='<div class="p-6">',t+='<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">',Object.entries(e).forEach(([i,a])=>{const s=window.currentVehicle?.secondary_weapons?.includes(i),n=Math.round(a.cost/1e3);t+=`
            <div class="component-card relative overflow-hidden rounded-xl cursor-pointer transition-all duration-300 hover:scale-[1.02] ${s?"selected bg-gradient-to-br from-brand-900/40 to-brand-800/30 border-2 border-brand-400 shadow-lg shadow-brand-500/20":"bg-gradient-to-br from-slate-800/60 to-slate-900/40 border border-slate-700/50 hover:border-slate-600/60"}" onclick="toggleSecondaryWeapon('${i}')">
                <div class="p-4">
                    <div class="flex items-start justify-between mb-3">
                        <h5 class="font-bold text-sm ${s?"text-brand-100":"text-slate-100"}">${a.name}</h5>
                        ${s?'<div class="w-3 h-3 bg-brand-400 rounded-full animate-pulse"></div>':""}
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 text-xs mb-3">
                        <div class="text-center">
                            <div class="text-blue-400 font-medium">${a.caliber}mm</div>
                            <div class="text-slate-400">Calibre</div>
                        </div>
                        <div class="text-center">
                            <div class="text-slate-300 font-medium">${a.rate_of_fire} tpm</div>
                            <div class="text-slate-400">Taxa de tiro</div>
                        </div>
                        <div class="text-center">
                            <div class="text-green-400 font-medium">$${n}K</div>
                            <div class="text-slate-400">Custo</div>
                        </div>
                    </div>
                </div>
            </div>`}),t+="</div>",t+='<div class="mt-4 text-xs text-slate-400">',t+="Dica: clique para adicionar/remover. M√∫ltiplas fixas comum ao DPS e ao custo.",t+="</div>",t+="</div>",t+="</div>",t}renderAntiAircraftSection(){const e=window.currentVehicle||{},i=(e?.chassis?window.VEHICLE_COMPONENTS?.chassis?.[e.chassis]:null)?.category==="Anti-Aircraft";let a='<div class="bg-slate-800/60 border border-slate-700/50 rounded-2xl overflow-hidden">';if(a+='<div class="bg-gradient-to-r from-red-600/20 to-pink-600/20 border-b border-slate-700/50 p-4">',a+='<div class="flex items-center gap-3">',a+='<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-pink-500 flex items-center justify-center">',a+='<span class="text-white text-xl">üõ°Ô∏è</span>',a+="</div>",a+='<h3 class="text-2xl font-bold text-slate-100">Defesa Antia√©rea</h3>',a+="</div>",a+="</div>",a+='<div class="p-6">',!i)a+='<div class="text-center text-slate-400 py-8">',a+='<div class="text-4xl mb-2">‚ö†Ô∏è</div>',a+='<div class="font-medium text-slate-300 mb-2">Apenas para chassis SPAA</div>',a+='<div class="text-sm">Armamentos antia√©reos s√≥ est√£o dispon√≠veis para chassis<br/>especializados em defesa antia√©rea (SPAA)</div>',a+="</div>";else{const s=window.filterCompatibleComponents("aa_guns")||{};Object.keys(s).length===0?(a+='<div class="text-center text-slate-400 py-8">',a+='<div class="text-4xl mb-2">üö´</div>',a+="<div>Nenhum armamento antia√©reo compat√≠vel com este chassi SPAA</div>",a+="</div>"):(a+='<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">',Object.entries(s).forEach(([n,r])=>{const c=window.currentVehicle?.aa_guns?.includes(n),l=Math.round(r.cost/1e3);a+=`
                <div class="component-card relative overflow-hidden rounded-xl cursor-pointer transition-all duration-300 hover:scale-[1.02] ${c?"selected bg-gradient-to-br from-brand-900/40 to-brand-800/30 border-2 border-brand-400 shadow-lg shadow-brand-500/20":"bg-gradient-to-br from-slate-800/60 to-slate-900/40 border border-slate-700/50 hover:border-slate-600/60"}" onclick="toggleAAGun('${n}')">
                    <div class="p-4">
                        <div class="flex items-start justify-between mb-3">
                            <h5 class="font-bold text-sm ${c?"text-brand-100":"text-slate-100"}">${r.name}</h5>
                            ${c?'<div class="w-3 h-3 bg-brand-400 rounded-full animate-pulse"></div>':""}
                        </div>
                        
                        <div class="grid grid-cols-3 gap-2 text-xs mb-3">
                            <div class="text-center">
                                <div class="text-red-400 font-medium">${r.caliber}mm</div>
                                <div class="text-slate-400">Calibre</div>
                            </div>
                            <div class="text-center">
                                <div class="text-slate-300 font-medium">${r.rate_of_fire} tpm</div>
                                <div class="text-slate-400">Taxa de tiro</div>
                            </div>
                            <div class="text-center">
                                <div class="text-green-400 font-medium">$${l}K</div>
                                <div class="text-slate-400">Custo</div>
                            </div>
                        </div>
                    </div>
                </div>`}),a+="</div>",a+='<div class="mt-4 text-xs text-slate-400">',a+="Sele√ß√£o m√∫ltipla permitida.",a+="</div>")}return a+="</div>",a+="</div>",a}renderWeaponsResume(){const e=window.currentVehicle||{},t=e.main_gun_caliber||0,i=e.main_gun_length_ratio||40,a=this.calculateGunPenetration(t,i),s=(e.secondary_weapons||[]).length,n=(e.aa_guns||[]).length,r=this.calculateGunCost(t,i),c=this.calculateSecondaryCost(e.secondary_weapons||[]),l=this.calculateAACost(e.aa_guns||[]),d=r+c+l;let u='<div class="bg-slate-800/60 border border-slate-700/50 rounded-2xl overflow-hidden">';return u+='<div class="bg-gradient-to-r from-green-600/20 to-emerald-600/20 border-b border-slate-700/50 p-4">',u+='<div class="flex items-center gap-3">',u+='<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center">',u+='<span class="text-white text-xl">üìã</span>',u+="</div>",u+='<h3 class="text-2xl font-bold text-slate-100">Resumo</h3>',u+="</div>",u+="</div>",u+='<div class="p-6">',u+='<div class="grid grid-cols-2 md:grid-cols-4 gap-4">',u+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30 text-center">',u+='<div class="text-xs text-slate-400 mb-1">Calibre principal</div>',u+=`<div id="summary-main-gun-caliber" class="text-2xl font-bold text-slate-200">${t} mm</div>`,u+="</div>",u+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30 text-center">',u+='<div class="text-xs text-slate-400 mb-1">Penetra√ß√£o</div>',u+=`<div id="summary-penetration" class="text-2xl font-bold text-slate-200">${a} mm</div>`,u+="</div>",u+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30 text-center">',u+='<div class="text-xs text-slate-400 mb-1">DPS Secund√°rio</div>',u+=`<div id="summary-secondary-dps" class="text-2xl font-bold text-slate-200">${s}.0</div>`,u+="</div>",u+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30 text-center">',u+='<div class="text-xs text-slate-400 mb-1">DPS AA</div>',u+=`<div id="summary-aa-dps" class="text-2xl font-bold text-slate-200">${n}.0</div>`,u+="</div>",u+="</div>",u+='<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">',u+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30 text-center">',u+='<div class="text-xs text-slate-400 mb-1">Custo Canh√£o</div>',u+=`<div class="text-xl font-bold text-slate-200">$${r}K</div>`,u+="</div>",u+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30 text-center">',u+='<div class="text-xs text-slate-400 mb-1">Custo Secund√°rio</div>',u+=`<div class="text-xl font-bold text-slate-200">$${c}K</div>`,u+="</div>",u+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30 text-center">',u+='<div class="text-xs text-slate-400 mb-1">Custo AA</div>',u+=`<div class="text-xl font-bold text-slate-200">$${l}K</div>`,u+="</div>",u+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30 text-center">',u+='<div class="text-xs text-slate-400 mb-1">CUSTO TOTAL</div>',u+=`<div class="text-xl font-bold text-slate-200">$${d}K</div>`,u+="</div>",u+="</div>",u+="</div>",u+="</div>",u}calculateGunPenetration(e,t){const i=window.currentVehicle?.ammo_view||"AP",a=e*(t||40)/25,n=Math.round(a*({AP:1,APCR:1.4,APDS:1.8,HEAT:1.6,HE:.15}[i]||1));return console.log("TabLoader penetration calc:",e,"mm L/"+t,i,"=",n,"mm"),n}calculateGunCost(e,t){const i=Math.pow(e/10,2)*2,a=1+(t-30)*.02;return Math.round(i*a)}calculateSecondaryCost(e){if(!e||e.length===0)return 0;let t=0;return e.forEach(i=>{const a=window.VEHICLE_COMPONENTS?.secondary_weapons?.[i];a?.cost&&(t+=a.cost)}),Math.round(t/1e3)}calculateAACost(e){if(!e||e.length===0)return 0;let t=0;return e.forEach(i=>{const a=window.VEHICLE_COMPONENTS?.aa_guns?.[i];a?.cost&&(t+=a.cost)}),Math.round(t/1e3)}renderSystemsInterface(){let e='<div class="space-y-6">';return e+=this.renderSystemCategory("fire_control","üéØ Sistema de Controle de Fogo",this.renderSystemCard),e+=this.renderSystemCategory("optics_systems","üëÅÔ∏è Sistemas √ìpticos",this.renderSystemCard),e+=this.renderSystemCategory("communication","üì° Sistemas de Comunica√ß√£o",this.renderSystemCard),e+="</div>",e}renderSystemCategory(e,t,i){let a='<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';a+=`<h3 class="text-lg font-semibold text-slate-100 mb-4">${t}</h3>`;const s=window.filterCompatibleComponents(e)||{};return Object.keys(s).length>0?(a+='<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">',Object.entries(s).forEach(([n,r])=>{a+=i.call(this,n,r,e)}),a+="</div>"):a+='<p class="text-slate-500 text-sm">Nenhum sistema compat√≠vel dispon√≠vel.</p>',a+="</div>",a}renderSystemCard(e,t,i){const a=i==="fire_control"?"fcs":i==="optics_systems"?"optics":"communication",s=window.currentVehicle?.[a]===e,c=`${{fire_control:"selectFireControl",optics_systems:"selectOptics",communication:"selectCommunication"}[i]||"selectCommunication"}('${e}')`;return`<div class="component-card relative p-3 rounded-xl cursor-pointer ${s?"selected bg-brand-900/30 border-brand-400":"bg-slate-800/40 border-slate-700/50"}" onclick="${c}">
            <h5 class="font-medium text-sm ${s?"text-brand-100":"text-slate-100"}">${t.name}</h5>
            <div class="text-xs text-slate-400">Custo: $${(t.cost/1e3).toFixed(0)}K</div>
            ${s?'<div class="absolute top-1 right-1 w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>':""}
        </div>`}renderEquipmentInterface(){const e=window.VEHICLE_COMPONENTS?.special_equipment||{},t=window.currentVehicle?.special_equipment||[];let i='<div class="space-y-6">';return i+='<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">',i+='<h3 class="text-lg font-semibold text-slate-100 mb-4">Equipamentos Especiais</h3>',i+='<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">',Object.entries(e).forEach(([a,s])=>{const n=t.includes(a);i+=`<div class="component-card relative p-3 rounded-xl cursor-pointer ${n?"selected bg-brand-900/30 border-brand-400":"bg-slate-800/40 border-slate-700/50"}" onclick="toggleSpecialEquipment('${a}')">
                <h5 class="font-medium text-sm ${n?"text-brand-100":"text-slate-100"}">${s.name}</h5>
                <div class="text-xs text-slate-400">${s.weight}kg, $${(s.cost/1e3).toFixed(0)}K</div>
                ${n?'<div class="absolute top-1 right-1 w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>':""}
            </div>`}),i+="</div></div></div>",i}}window.tabLoaders=new G;G.prototype.calculateArmorEfficiency=function(o,e,t,i,a,s,n){try{const r=a?.[e],c=s?.[t],l=(i||[]).map(_=>n?.[_]).filter(Boolean);let d=Number(o)||0;r?.effectiveness_factor&&(d*=r.effectiveness_factor),c?.effectiveness_multiplier&&(d*=c.effectiveness_multiplier),l.forEach(_=>{if(_?.protection_bonus){const b=_.effectiveness_vs&&_.effectiveness_vs.ap||1;d+=_.protection_bonus*b}});const u=Math.round(d);let p="Inadequada",f="text-red-400";u>=300?(p="Excepcional",f="text-purple-400"):u>=200?(p="Excelente",f="text-green-400"):u>=150?(p="Boa",f="text-blue-400"):u>=100?(p="Adequada",f="text-yellow-400"):u>=50&&(p="Fraca",f="text-orange-400");const g=c?.crew_capacity_penalty||0,y=c?.gun_depression_penalty||0;return`
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-sm text-slate-300">Efetividade</div>
                    <div class="text-lg font-semibold ${f}">${u}mm (${p})</div>
                </div>
                <div class="text-xs text-slate-400 text-right">
                    ${g?`- Tripula√ß√£o: -${g}`:""}
                    ${y?`<br/>- Depress√£o canh√£o: -${y}¬∞`:""}
                </div>
            </div>
        `}catch(r){return console.error("Erro ao calcular efici√™ncia de blindagem:",r),'<div class="text-slate-400">N√£o foi poss√≠vel calcular a efici√™ncia</div>'}};G.prototype.renderArmorInterfaceV2=function(o,e,t,i,a,s,n){const r=!!(window.currentVehicle&&window.currentVehicle.chassis),l=(r?window.getResolvedComponent?window.getResolvedComponent("chassis",window.currentVehicle.chassis):window.VEHICLE_COMPONENTS?.chassis?.[window.currentVehicle.chassis]:null)?.max_armor_thickness||300,d=20,u=Math.min(Math.max(o,d),l);let p='<div class="space-y-6">';return r||(p+='<div class="border border-yellow-500/30 bg-yellow-500/10 text-yellow-300 text-sm rounded-lg px-4 py-3">Selecione um chassi primeiro para ver os limites de blindagem espec√≠ficos.</div>'),p+='<div class="bg-slate-800/60 border border-slate-700/50 rounded-2xl p-6">',p+='<div class="flex items-center gap-3 mb-6">',p+='<div class="w-8 h-8 rounded-lg bg-blue-600/20 flex items-center justify-center">',p+='<span class="text-blue-400">üõ°Ô∏è</span>',p+="</div>",p+='<h3 class="text-xl font-bold text-slate-100">Espessura da Blindagem</h3>',p+=`<div id="armor-thickness-display" class="ml-auto text-3xl font-bold text-amber-400">${u} mm</div>`,p+="</div>",p+='<div class="relative">',p+=`<input type="range" id="armor-thickness-slider" min="${d}" max="${l}" value="${u}" class="armor-slider w-full h-3 bg-slate-700/60 rounded-full appearance-none cursor-pointer" oninput="updateArmorThickness(this.value)" />`,p+='<div class="flex justify-between text-xs text-slate-400 mt-2">',p+=`<span>${d}</span>`,p+=`<span>${l}</span>`,p+="</div>",p+="</div>",p+="</div>",p+='<div class="bg-slate-800/60 border border-slate-700/50 rounded-2xl p-6">',p+='<div class="flex items-center gap-3 mb-6">',p+='<div class="w-8 h-8 rounded-lg bg-orange-600/20 flex items-center justify-center">',p+='<span class="text-orange-400">üß™</span>',p+="</div>",p+='<h3 class="text-xl font-bold text-slate-100">Material da Blindagem</h3>',p+="</div>",p+='<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">',Object.entries(a).forEach(([f,g])=>{const y=f===e,_=Math.round((g.effectiveness_factor||1)*100),b=g.cost_factor||1;p+=`
        <div class="component-card relative overflow-hidden rounded-xl cursor-pointer transition-all duration-300 ${y?"selected bg-gradient-to-br from-brand-900/40 to-brand-800/30 border-2 border-brand-400 shadow-lg shadow-brand-500/20":"bg-gradient-to-br from-slate-800/60 to-slate-900/40 border border-slate-700/50 hover:border-slate-600/60"}" onclick="updateArmorMaterial('${f}')">
            <div class="p-4">
                <div class="flex items-start justify-between mb-3">
                    <div>
                        <h4 class="font-bold text-base ${y?"text-brand-100":"text-slate-100"}">${g.name}</h4>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="px-2 py-1 text-xs font-semibold rounded-md bg-blue-600/20 text-blue-300 border border-blue-500/30">
                                ${_}%
                            </span>
                        </div>
                    </div>
                    ${y?'<div class="w-3 h-3 bg-brand-400 rounded-full animate-pulse"></div>':""}
                </div>
                <div class="grid grid-cols-3 gap-2 text-xs text-slate-400">
                    <div class="text-center">
                        <div class="text-slate-300 font-medium">x${g.effectiveness_factor||1}</div>
                        <div>Efetividade</div>
                    </div>
                    <div class="text-center">
                        <div class="text-slate-300 font-medium">x${g.weight_factor||1}</div>
                        <div>Peso</div>
                    </div>
                    <div class="text-center">
                        <div class="font-medium ${b>2?"text-red-400":b>1.5?"text-yellow-400":"text-green-400"}">x${b}</div>
                        <div>Custo</div>
                    </div>
                </div>
            </div>
        </div>`}),p+="</div></div>",p+='<div class="bg-slate-800/60 border border-slate-700/50 rounded-2xl p-6">',p+='<div class="flex items-center gap-3 mb-6">',p+='<div class="w-8 h-8 rounded-lg bg-purple-600/20 flex items-center justify-center">',p+='<span class="text-purple-400">üìê</span>',p+="</div>",p+='<h3 class="text-xl font-bold text-slate-100">√Çngulo da Blindagem</h3>',p+="</div>",p+='<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">',Object.entries(n).forEach(([f,g])=>{const y=f===t,b=`x${(g.effectiveness_multiplier||1).toFixed(2)}`,v=[];g.gun_depression_penalty&&v.push(`Depress√£o -${g.gun_depression_penalty}¬∞`),g.crew_capacity_penalty&&v.push(`Tripula√ß√£o -${g.crew_capacity_penalty}`),p+=`
        <div class="component-card relative overflow-hidden rounded-xl cursor-pointer transition-all duration-300 ${y?"selected bg-gradient-to-br from-brand-900/40 to-brand-800/30 border-2 border-brand-400 shadow-lg shadow-brand-500/20":"bg-gradient-to-br from-slate-800/60 to-slate-900/40 border border-slate-700/50 hover:border-slate-600/60"}" onclick="selectArmorAngle('${f}')">
            <div class="p-4">
                <div class="flex items-start justify-between mb-3">
                    <div class="flex-1">
                        <h4 class="font-bold text-base ${y?"text-brand-100":"text-slate-100"}">${g.name}</h4>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="px-2 py-1 text-xs font-semibold rounded-md bg-green-600/20 text-green-300 border border-green-500/30">
                                ${b}
                            </span>
                        </div>
                        ${g.description?`<p class="text-xs text-slate-400 mt-2">${g.description}</p>`:""}
                    </div>
                    ${y?'<div class="w-3 h-3 bg-brand-400 rounded-full animate-pulse"></div>':""}
                </div>
                ${v.length>0?`
                <div class="border-t border-slate-700/40 pt-2 mt-2">
                    <div class="flex flex-wrap gap-1">
                        ${v.map(T=>`<span class="px-2 py-1 text-xs rounded-md bg-amber-600/20 text-amber-300">‚ö†Ô∏è ${T}</span>`).join("")}
                    </div>
                </div>`:""}
            </div>
        </div>`}),p+="</div></div>",p+='<div class="bg-slate-800/60 border border-slate-700/50 rounded-2xl p-6">',p+='<div class="flex items-center gap-3 mb-6">',p+='<div class="w-8 h-8 rounded-lg bg-green-600/20 flex items-center justify-center">',p+='<span class="text-green-400">üîß</span>',p+="</div>",p+='<h3 class="text-xl font-bold text-slate-100">Blindagens Adicionais</h3>',p+="</div>",p+='<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">',Object.entries(s).forEach(([f,g])=>{const y=(i||[]).includes(f),_=g.cost||0,b=_>=1e3?`$${Math.round(_/1e3)}K`:`$${_}`;p+=`
        <div class="component-card relative overflow-hidden rounded-xl cursor-pointer transition-all duration-300 ${y?"selected bg-gradient-to-br from-brand-900/40 to-brand-800/30 border-2 border-brand-400 shadow-lg shadow-brand-500/20":"bg-gradient-to-br from-slate-800/60 to-slate-900/40 border border-slate-700/50 hover:border-slate-600/60"}" onclick="toggleAdditionalArmor('${f}')">
            <div class="p-4">
                <div class="flex items-start justify-between mb-3">
                    <h5 class="font-bold text-sm ${y?"text-brand-100":"text-slate-100"}">${g.name}</h5>
                    ${y?'<div class="w-2 h-2 bg-brand-400 rounded-full animate-pulse"></div>':""}
                </div>
                <div class="grid grid-cols-3 gap-2 text-xs">
                    <div class="text-center">
                        <div class="text-blue-400 font-medium">+${g.protection_bonus}mm</div>
                        <div class="text-slate-400">Prote√ß√£o</div>
                    </div>
                    <div class="text-center">
                        <div class="text-slate-300 font-medium">${g.weight}kg</div>
                        <div class="text-slate-400">Peso</div>
                    </div>
                    <div class="text-center">
                        <div class="text-green-400 font-medium">${b}</div>
                        <div class="text-slate-400">Custo</div>
                    </div>
                </div>
            </div>
        </div>`}),p+="</div></div>",p+='<div class="bg-slate-800/60 border border-slate-700/50 rounded-2xl p-6">',p+='<div class="flex items-center gap-3 mb-6">',p+='<div class="w-8 h-8 rounded-lg bg-cyan-600/20 flex items-center justify-center">',p+='<span class="text-cyan-400">üìä</span>',p+="</div>",p+='<h3 class="text-xl font-bold text-slate-100">Resumo</h3>',p+="</div>",p+='<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">',p+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30">',p+='<div class="text-xs text-slate-400 mb-1">Espessura base</div>',p+=`<div class="text-2xl font-bold text-slate-200" id="summary-base-thickness">${u} mm</div>`,p+="</div>",p+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30">',p+='<div class="text-xs text-slate-400 mb-1">Efetividade total</div>',p+='<div class="text-2xl font-bold text-slate-200" id="summary-effectiveness">x1.00</div>',p+="</div>",p+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30">',p+='<div class="text-xs text-slate-400 mb-1">Espessura efetiva</div>',p+=`<div class="text-2xl font-bold text-slate-200" id="summary-effective-thickness">${u} mm</div>`,p+="</div>",p+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30">',p+='<div class="text-xs text-slate-400 mb-1">Material</div>',p+='<div class="text-sm font-bold text-slate-200" id="summary-material">RHA</div>',p+="</div>",p+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30">',p+='<div class="text-xs text-slate-400 mb-1">√Çngulo</div>',p+='<div class="text-sm font-bold text-slate-200" id="summary-angle">Vertical (90¬∞)</div>',p+="</div>",p+='<div class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/30">',p+='<div class="text-xs text-slate-400 mb-1">Peso relativo</div>',p+='<div class="text-sm font-bold text-slate-200" id="summary-weight">x1.00</div>',p+="</div>",p+="</div>",p+="</div>",p+="</div>",setTimeout(()=>{window.updateArmorEfficiency&&window.updateArmorEfficiency()},100),p};class Ee{static calculateEnergyProduction(e){if(!e?.engine||!window.VEHICLE_COMPONENTS?.engines)return 0;const t=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):null,i=window.VEHICLE_COMPONENTS.engines[e.engine],a=t&&typeof t.energy_output=="number"?t.energy_output:i&&i.base&&typeof i.base.energy_output=="number"?i.base.energy_output:0;return Number.isFinite(a)?a:0}static calculateEnergyConsumption(e){const t=!e?.chassis,i=!e?.engine,a=!e?.fcs&&!e?.optics&&!e?.communication&&!e?.transmission&&!e?.suspension&&!(e?.specialEquipment&&e.specialEquipment.length)&&!(e?.special_equipment&&e.special_equipment.length)&&!(e?.additional_armor&&e.additional_armor.length);if(t&&i&&a)return 0;let s=0;if(s+=2,e?.fcs&&window.VEHICLE_COMPONENTS?.fire_control){const r=window.VEHICLE_COMPONENTS.fire_control[e.fcs];s+=r?.energy_consumption||0}if(e?.optics&&window.VEHICLE_COMPONENTS?.optics_systems){const r=window.VEHICLE_COMPONENTS.optics_systems[e.optics];s+=r?.energy_consumption||0}if(e?.communication&&window.VEHICLE_COMPONENTS?.communication){const r=window.VEHICLE_COMPONENTS.communication[e.communication];s+=r?.energy_consumption||0}if(e?.transmission&&window.VEHICLE_COMPONENTS?.transmissions){const r=window.VEHICLE_COMPONENTS.transmissions[e.transmission];s+=r?.energy_consumption||0}if(e?.suspension&&window.VEHICLE_COMPONENTS?.suspensions){const r=window.VEHICLE_COMPONENTS.suspensions[e.suspension];s+=r?.energy_consumption||0}e?.aa_guns&&window.VEHICLE_COMPONENTS?.aa_guns&&window.VEHICLE_COMPONENTS?.aa_fire_control&&e.aa_guns.forEach(r=>{const c=window.VEHICLE_COMPONENTS.aa_guns[r];if(c?.fire_control){const l=window.VEHICLE_COMPONENTS.aa_fire_control[c.fire_control];s+=l?.energy_consumption||0}}),e?.additional_armor&&window.VEHICLE_COMPONENTS?.additional_armor&&e.additional_armor.forEach(r=>{const c=window.VEHICLE_COMPONENTS.additional_armor[r];s+=c?.energy_consumption||0});const n=e?.specialEquipment||e?.special_equipment||[];return Array.isArray(n)&&window.VEHICLE_COMPONENTS?.special_equipment&&n.forEach(r=>{const c=window.VEHICLE_COMPONENTS.special_equipment[r];s+=c?.energy_consumption||0}),s}static calculateEnergyBalance(e){const t=this.calculateEnergyProduction(e),i=this.calculateEnergyConsumption(e);return{production:t,consumption:i,balance:t-i,efficiency:t>0?i/t*100:0,isValid:t>=i}}static validateEnergyBalance(e){const t=this.calculateEnergyBalance(e);return t.isValid?t.efficiency>90?{valid:!0,warning:!0,message:`‚ö†Ô∏è Alto consumo de energia (${t.efficiency.toFixed(1)}%)`,efficiency:t.efficiency}:{valid:!0,message:`‚úÖ Energia balanceada (${t.efficiency.toFixed(1)}% utiliza√ß√£o)`,efficiency:t.efficiency}:{valid:!1,message:`‚ö° Consumo de energia excede a produ√ß√£o! (${t.consumption}kW > ${t.production}kW)`,shortfall:Math.abs(t.balance)}}static getEnergyRecommendations(e){const t=this.calculateEnergyBalance(e),i=[];return t.isValid?t.efficiency>90&&i.push({type:"warning",message:"Considere motor mais potente para margem de seguran√ßa",priority:"medium"}):i.push({type:"error",message:`Necess√°rio motor com pelo menos ${t.consumption}kW de sa√≠da`,priority:"high"}),t.consumption>20&&i.push({type:"info",message:"Alto consumo pode afetar autonomia e confiabilidade",priority:"low"}),i}static renderEnergyDisplay(e){const t=this.calculateEnergyBalance(e),i=this.validateEnergyBalance(e);let a='<div class="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6">';a+='<h3 class="text-lg font-semibold text-slate-100 mb-4">‚ö° Sistema de Energia</h3>',a+='<div class="space-y-4">',a+="<div>",a+='<div class="flex items-center justify-between text-sm mb-2">',a+='<span class="text-slate-300">Produ√ß√£o (Motor)</span>',a+=`<span class="text-emerald-400 font-bold">${t.production} kW</span>`,a+="</div>",a+='<div class="w-full bg-slate-700 rounded-full h-2">';const s=Math.min(t.production/50*100,100);a+=`<div class="bg-emerald-500 h-2 rounded-full transition-all duration-300" style="width: ${s}%"></div>`,a+="</div>",a+="</div>",a+="<div>",a+='<div class="flex items-center justify-between text-sm mb-2">',a+='<span class="text-slate-300">Consumo (Sistemas)</span>';const n=t.isValid?"text-blue-400":"text-red-400";a+=`<span class="${n} font-bold">${t.consumption} kW</span>`,a+="</div>",a+='<div class="w-full bg-slate-700 rounded-full h-2">';const r=Math.min(t.consumption/50*100,100),c=t.isValid?"bg-blue-500":"bg-red-500";a+=`<div class="${c} h-2 rounded-full transition-all duration-300" style="width: ${r}%"></div>`,a+="</div>",a+="</div>",a+='<div class="flex items-center justify-between p-3 rounded-lg '+(t.isValid?"bg-emerald-900/30 border border-emerald-500/30":"bg-red-900/30 border border-red-500/30")+'">',a+='<span class="text-slate-200 font-medium">Balan√ßo Energ√©tico</span>';const l=t.balance>=0?"text-emerald-400":"text-red-400",d=t.balance>=0?"+":"";a+=`<span class="${l} font-bold">${d}${t.balance} kW</span>`,a+="</div>";const u=i.valid?i.warning?"text-amber-400":"text-emerald-400":"text-red-400";return a+=`<div class="${u} text-sm text-center mt-2">${i.message}</div>`,a+="</div></div>",a}}window.EnergySystem=Ee;class Se{static calculatePerformanceMetrics(e){if(!e||!window.VEHICLE_COMPONENTS)return this.getDefaultMetrics();if(!e.chassis&&!e.engine&&!e.transmission&&!e.suspension&&!e.main_gun_caliber&&(!e.secondary_weapons||e.secondary_weapons.length===0)&&!e.fcs&&!e.optics&&!e.communication)return this.getDefaultMetrics();const i=this.getChassisInfo(e),a=this.calculateMobility(e,i),s=this.calculateFirepower(e,i),n=this.calculateProtection(e,i),r=this.calculateSurvivability(e,i),c=this.calculateReconnaissance(e,i),l=this.calculateMaintenance(e,i),d=this.getChassisSpecificWeights(i),u=Math.round(s*d.firepower+n*d.protection+a*d.mobility+r*d.survivability+c*d.reconnaissance);return{mobility:a,firepower:s,protection:n,survivability:r,reconnaissance:c,maintenance:l,combat_effectiveness:u,details:this.getPerformanceDetails(e,i)}}static getChassisInfo(e){return!e?.chassis||!window.VEHICLE_COMPONENTS?.chassis?{category:"Unknown",weight_class:"medium"}:window.VEHICLE_COMPONENTS.chassis[e.chassis]||{category:"Unknown",weight_class:"medium"}}static getChassisSpecificWeights(e){switch(e.category){case"Main Battle Tank":case"Super Heavy Tank":return{firepower:.35,protection:.3,mobility:.15,survivability:.15,reconnaissance:.05};case"Light Tracked":return{mobility:.35,reconnaissance:.25,survivability:.15,firepower:.15,protection:.1};case"Wheeled":return{mobility:.4,reconnaissance:.3,maintenance:.15,survivability:.1,protection:.05};case"Anti-Aircraft":return{firepower:.45,mobility:.25,reconnaissance:.15,survivability:.1,protection:.05};case"Self-Propelled Artillery":return{firepower:.5,protection:.2,survivability:.15,mobility:.1,reconnaissance:.05};case"Amphibious":return{mobility:.3,survivability:.25,reconnaissance:.2,firepower:.15,protection:.1};case"Airmobile":return{mobility:.4,reconnaissance:.25,survivability:.2,maintenance:.1,protection:.05};default:return{firepower:.25,protection:.25,mobility:.25,survivability:.15,reconnaissance:.1}}}static calculateMobility(e,t=null){const i=t||this.getChassisInfo(e);let a=40;switch(i.category){case"Wheeled":a=60;break;case"Light Tracked":a=50;break;case"Airmobile":a=55;break;case"Anti-Aircraft":a=45;break;case"Main Battle Tank":a=35;break;case"Super Heavy Tank":case"Self-Propelled Artillery":a=25;break;case"Amphibious":a=35;break}let s=a;if(e?.engine&&window.VEHICLE_COMPONENTS?.engines){const n=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(n?.power){let c=n.power/(this.calculateTotalWeight(e)/1e3)*2;i.weight_class==="light"?c*=1.2:i.weight_class==="super_heavy"&&(c*=.7),s+=Math.min(35,c)}}if(e?.transmission&&window.VEHICLE_COMPONENTS?.transmissions){const n=window.VEHICLE_COMPONENTS.transmissions[e.transmission];if(n){let r=0;n.type==="automatic"?r=10:n.type==="semi_auto"?r=7:n.gears>=5?r=5:n.gears>=4&&(r=3),i.category==="Wheeled"&&n.type==="automatic"&&(r+=5),n.efficiency&&(r+=(n.efficiency-.7)*20),s+=r}}if(e?.suspension&&window.VEHICLE_COMPONENTS?.suspensions){const n=window.VEHICLE_COMPONENTS.suspensions[e.suspension];if(n){let r=(n.terrain_performance||.8)*10;i.category==="Anti-Aircraft"&&n.stabilization_bonus?r+=n.stabilization_bonus*30:n.stabilization_bonus&&(r+=n.stabilization_bonus*20),s+=r}}if(i.terrain_mult){const n=(i.terrain_mult.road+i.terrain_mult.offroad+(i.terrain_mult.mud||.7)+(i.terrain_mult.snow||.7))/4;s+=(n-.8)*25}return e?.specialEquipment&&window.VEHICLE_COMPONENTS?.special_equipment&&e.specialEquipment.forEach(n=>{const r=window.VEHICLE_COMPONENTS.special_equipment[n];r&&(r.speed_reduction&&(s-=r.speed_reduction*35),r.ground_pressure_increase&&(s-=r.ground_pressure_increase*20),r.water_crossing_depth&&r.water_crossing_depth>1&&(s+=Math.min(10,r.water_crossing_depth*2)),r.obstacle_clearing&&(s+=5),r.mine_clearance_capability&&(s+=3))}),(isNaN(s)||!isFinite(s))&&(s=a),Math.min(100,Math.max(0,Math.round(s)))}static calculateFirepower(e,t=null){const i=t||this.getChassisInfo(e);let a=20;switch(i.category){case"Self-Propelled Artillery":a=10;break;case"Anti-Aircraft":a=15;break;case"Main Battle Tank":case"Super Heavy Tank":a=25;break;case"Light Tracked":a=15;break;case"Wheeled":a=10;break;case"Amphibious":a=18;break;case"Airmobile":a=12;break}let s=a;if(e?.main_gun&&window.VEHICLE_COMPONENTS?.main_guns){const n=window.VEHICLE_COMPONENTS.main_guns[e.main_gun];if(n){const r=n.caliber;let c=r/3;n.penetration_1000m&&(c+=n.penetration_1000m/20),n.accuracy&&(c+=(n.accuracy-.7)*30),n.rate_of_fire&&(c+=Math.min(10,n.rate_of_fire)),i.category==="Self-Propelled Artillery"&&r>=130?c*=1.5:i.category==="Wheeled"&&r>90?c*=.6:i.category==="Light Tracked"&&r>75?c*=.8:i.category==="Anti-Aircraft"&&r>0&&(c*=.3),s+=Math.min(50,c)}}else if(e?.main_gun_caliber){const n=e.main_gun_caliber;let r=n/3;i.category==="Self-Propelled Artillery"&&n>=130?r*=1.5:i.category==="Wheeled"&&n>90?r*=.6:i.category==="Light Tracked"&&n>75?r*=.8:i.category==="Anti-Aircraft"&&n>0&&(r*=.3),s+=Math.min(40,r)}if(e?.secondary_weapons&&window.VEHICLE_COMPONENTS?.secondary_weapons){let n=0;e.secondary_weapons.forEach(r=>{const c=window.VEHICLE_COMPONENTS.secondary_weapons[r];c&&(n+=c.rate_of_fire/100)}),i.weight_class==="light"&&(n*=1.3),s+=Math.min(15,n)}if(e?.aa_guns&&window.VEHICLE_COMPONENTS?.aa_guns){let n=0;e.aa_guns.forEach(r=>{const c=window.VEHICLE_COMPONENTS.aa_guns[r];c&&(n+=c.aa_effectiveness*10)}),i.category==="Anti-Aircraft"?(n*=3,s+=Math.min(50,n)):s+=Math.min(10,n)}if(e?.fcs&&window.VEHICLE_COMPONENTS?.fire_control){const n=window.VEHICLE_COMPONENTS.fire_control[e.fcs];if(n){let r=(n.accuracy_bonus||0)*30;n.night_capable&&(r+=3),n.automatic_tracking&&(r+=5),(i.category==="Anti-Aircraft"||i.category==="Main Battle Tank")&&(r*=1.2),s+=r}}return e?.specialEquipment&&window.VEHICLE_COMPONENTS?.special_equipment&&e.specialEquipment.forEach(n=>{const r=window.VEHICLE_COMPONENTS.special_equipment[n];r&&(r.accuracy_bonus_long_missions&&(s+=r.accuracy_bonus_long_missions*25),r.command_efficiency&&(s+=r.command_efficiency*15),r.night_combat_bonus&&(s+=r.night_combat_bonus*20),r.smoke_deployment_range&&(s+=Math.min(8,r.smoke_deployment_range/10)),r.continuous_smoke&&(s+=5),r.engine_performance_reduction&&(s-=r.engine_performance_reduction*15),r.gives_away_position&&(s-=5))}),(isNaN(s)||!isFinite(s))&&(s=a),Math.min(100,Math.max(0,Math.round(s)))}static calculateProtection(e,t=null){const i=t||this.getChassisInfo(e);let a=30;switch(i.category){case"Super Heavy Tank":a=50;break;case"Main Battle Tank":a=40;break;case"Self-Propelled Artillery":a=25;break;case"Anti-Aircraft":a=20;break;case"Light Tracked":a=15;break;case"Wheeled":a=10;break;case"Amphibious":a=20;break;case"Airmobile":a=12;break}let s=a;if(e?.armor_thickness||e?.armorThickness){const n=e.armor_thickness?.frontal??e.armorThickness??50,r=e.armor_thickness?.side||n*.6,c=e.armor_thickness?.rear||n*.4,l=(n+r+c)/3;let d=l/3;i.category==="Super Heavy Tank"?d*=1.2:i.category==="Wheeled"&&l>25?d*=.7:i.category==="Airmobile"&&l>30&&(d*=.6),s+=Math.min(50,d)}if(e?.additional_armor&&window.VEHICLE_COMPONENTS?.additional_armor){let n=0;e.additional_armor.forEach(r=>{const c=window.VEHICLE_COMPONENTS.additional_armor[r];c&&(n+=c.protection_bonus/5)}),i.weight_class==="super_heavy"||i.weight_class==="heavy"?n*=1.2:i.weight_class==="light"&&(n*=.8),s+=Math.min(20,n)}return e?.specialEquipment&&window.VEHICLE_COMPONENTS?.special_equipment&&e.specialEquipment.forEach(n=>{const r=window.VEHICLE_COMPONENTS.special_equipment[n];r&&(r.frontal_protection_bonus&&(s+=r.frontal_protection_bonus*30),r.armor_thickness&&typeof r.armor_thickness=="number"&&(s+=r.armor_thickness/5),r.armor_reduction_sides&&(s-=r.armor_reduction_sides*25),r.armor_integrity_reduction&&(s-=r.armor_integrity_reduction*20),r.fire_vulnerability&&(s-=r.fire_vulnerability*15))}),(isNaN(s)||!isFinite(s))&&(s=a),Math.min(100,Math.max(0,Math.round(s)))}static calculateSurvivability(e,t=null){const i=t||this.getChassisInfo(e);let a=40;switch(i.category){case"Main Battle Tank":case"Super Heavy Tank":a=50;break;case"Self-Propelled Artillery":a=35;break;case"Anti-Aircraft":a=30;break;case"Light Tracked":a=35;break;case"Wheeled":a=25;break;case"Amphibious":a=30;break;case"Airmobile":a=32;break}let s=a;const n=e?.crewSize||i?.crew_capacity?.optimal||3;let r=Math.min(15,n*3);if(i.category==="Self-Propelled Artillery"&&n>4?r*=.8:i.category==="Anti-Aircraft"?r*=.7:i.category==="Main Battle Tank"&&(r*=1.2),s+=r,e?.specialEquipment&&window.VEHICLE_COMPONENTS?.special_equipment){let c=0;e.specialEquipment.forEach(l=>{const d=window.VEHICLE_COMPONENTS.special_equipment[l];d&&(d.crew_survival_bonus&&(c+=d.crew_survival_bonus*25),d.fire_suppression_bonus&&(c+=d.fire_suppression_bonus*15),d.escape_time_reduction&&(c+=d.escape_time_reduction*20),d.explosion_resistance&&(c+=d.explosion_resistance*20),d.internal_damage_reduction&&(c+=d.internal_damage_reduction*25),d.crew_endurance_bonus&&(c+=d.crew_endurance_bonus*15),d.crew_comfort_bonus&&(c+=d.crew_comfort_bonus*10),d.crew_fatigue_reduction&&(c+=d.crew_fatigue_reduction*12),d.cold_weather_performance&&(c+=d.cold_weather_performance*8),d.nbc_protection_bonus&&(c+=d.nbc_protection_bonus*12))}),(i.category==="Main Battle Tank"||i.category==="Super Heavy Tank")&&(c*=1.1),s+=Math.min(35,c)}if(e?.engine&&window.VEHICLE_COMPONENTS?.engines){const c=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(c?.reliability){let l=(c.reliability-.7)*66;(i.category==="Wheeled"||i.category==="Amphibious")&&(l*=1.3),s+=Math.min(20,l)}}return i.reliability&&(s+=(i.reliability-.75)*40),(isNaN(s)||!isFinite(s))&&(s=a),Math.min(100,Math.max(0,Math.round(s)))}static calculateReconnaissance(e,t=null){const i=t||this.getChassisInfo(e);let a=30;switch(i.category){case"Light Tracked":a=45;break;case"Wheeled":a=50;break;case"Airmobile":a=40;break;case"Anti-Aircraft":a=35;break;case"Amphibious":a=35;break;case"Main Battle Tank":a=25;break;case"Super Heavy Tank":a=15;break;case"Self-Propelled Artillery":a=20;break}let s=a;if(e?.optics&&window.VEHICLE_COMPONENTS?.optics_systems){const r=window.VEHICLE_COMPONENTS.optics_systems[e.optics];if(r){let l=(typeof r.magnification=="number"&&!isNaN(r.magnification)?r.magnification:1)*8;if(i.category==="Light Tracked"||i.category==="Wheeled"?l*=1.3:i.category==="Self-Propelled Artillery"&&(l*=1.2),r.night_vision){let d=15;(i.category==="Light Tracked"||i.category==="Wheeled")&&(d*=1.5),l+=d}r.thermal_imaging&&(l+=20),r.range_finding&&(l+=10),s+=Math.min(35,l)}}if(e?.communication&&window.VEHICLE_COMPONENTS?.communication){const r=window.VEHICLE_COMPONENTS.communication[e.communication];if(r&&typeof r.range=="number"&&!isNaN(r.range)){let c=Math.min(20,r.range*.8);r.encryption_capable&&(c+=5),i.category==="Light Tracked"||i.category==="Wheeled"?c*=1.4:i.category==="Anti-Aircraft"&&(c*=1.2),s+=c}}let n=0;if(e?.engine&&window.VEHICLE_COMPONENTS?.engines){const r=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(r?.power){const c=r.power/(this.calculateTotalWeight(e)/1e3);n=Math.min(15,c/20*15),i.weight_class==="light"&&(n*=1.3)}}return s+=n,e?.specialEquipment&&window.VEHICLE_COMPONENTS?.special_equipment&&e.specialEquipment.forEach(r=>{const c=window.VEHICLE_COMPONENTS.special_equipment[r];c&&(c.visibility_bonus&&(s+=c.visibility_bonus*30),c.blind_spot_reduction&&(s+=c.blind_spot_reduction*25),c.night_combat_bonus&&(s+=c.night_combat_bonus*25),c.detection_range&&c.detection_range>1e3&&(s+=Math.min(15,c.detection_range/1e3)),c.concealment_bonus&&(s+=c.concealment_bonus*20),c.air_detection_reduction&&(s+=c.air_detection_reduction*15),c.radar_warning&&(s+=10),c.enemy_communication_disruption&&(s+=c.enemy_communication_disruption*12),c.gives_away_position&&(s-=8),c.vulnerability_increase&&(s-=c.vulnerability_increase*15))}),i.weight_class==="light"||i.category==="Wheeled"?s+=5:i.weight_class==="super_heavy"&&(s-=5),(isNaN(s)||!isFinite(s))&&(s=a),Math.min(100,Math.max(0,Math.round(s)))}static calculateMaintenance(e,t=null){const i=t||this.getChassisInfo(e);let a=50;switch(i.category){case"Wheeled":a=70;break;case"Light Tracked":a=60;break;case"Airmobile":a=65;break;case"Main Battle Tank":a=40;break;case"Anti-Aircraft":a=45;break;case"Amphibious":a=35;break;case"Self-Propelled Artillery":a=30;break;case"Super Heavy Tank":a=15;break}let s=a;const n=this.calculateTotalWeight(e);let r=0;if(i.weight_class==="light"?n>25e3?r=-10:n<15e3&&(r=15):i.weight_class==="medium"?n>45e3?r=-20:n>35e3?r=-10:n<25e3&&(r=8):i.weight_class==="heavy"?n>6e4?r=-25:n>5e4?r=-15:n<4e4&&(r=5):i.weight_class==="super_heavy"&&(n>8e4?r=-35:n>7e4&&(r=-25)),s+=r,e?.engine&&window.VEHICLE_COMPONENTS?.engines){const l=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(l?.consumption){let d=0;l.consumption>2.5?d=-25:l.consumption>2?d=-20:l.consumption>1.5?d=-10:l.consumption<1?d=8:l.consumption<.8&&(d=12),(i.category==="Wheeled"||i.weight_class==="light")&&d>0&&(d*=1.5),s+=d}}let c=0;if(i.maintenance_complexity&&(c+=i.maintenance_complexity*15),e?.transmission&&window.VEHICLE_COMPONENTS?.transmissions){const l=window.VEHICLE_COMPONENTS.transmissions[e.transmission];l?.maintenance_complexity&&(c+=l.maintenance_complexity*10)}return i.category==="Amphibious"&&(c+=10),i.category==="Experimental"&&(c+=15),s-=c,e?.specialEquipment&&window.VEHICLE_COMPONENTS?.special_equipment&&e.specialEquipment.forEach(l=>{const d=window.VEHICLE_COMPONENTS.special_equipment[l];d&&(d.field_repair_capability&&(s+=d.field_repair_capability*40),d.reliability_bonus&&(s+=d.reliability_bonus*50),d.maintenance_time_reduction&&(s+=d.maintenance_time_reduction*35),d.preventive_maintenance_bonus&&(s+=d.preventive_maintenance_bonus*30),d.maintenance_interval_extension&&(s+=d.maintenance_interval_extension*25),d.maintenance_complexity&&(s-=d.maintenance_complexity*15),d.installation_complexity&&(s-=d.installation_complexity*10))}),i.terrain_mult?.road>1.1&&(s+=(i.terrain_mult.road-1)*20),(isNaN(s)||!isFinite(s))&&(s=a),Math.min(100,Math.max(0,Math.round(s)))}static calculateTotalWeight(e){let t=3e3;if(e?.chassis&&window.VEHICLE_COMPONENTS?.chassis){const s=window.VEHICLE_COMPONENTS.chassis[e.chassis];s&&(t=s.base_weight||t)}["engine","transmission","suspension"].forEach(s=>{if(e?.[s]&&window.VEHICLE_COMPONENTS?.[s+"s"]){let n;s==="engine"?n=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine]:n=window.VEHICLE_COMPONENTS[s+"s"][e[s]],n?.weight&&(t+=n.weight)}}),t+=this.calculateArmorWeight(e),t+=this.calculateWeaponWeight(e),e?.additional_armor&&window.VEHICLE_COMPONENTS?.additional_armor&&e.additional_armor.forEach(s=>{const n=window.VEHICLE_COMPONENTS.additional_armor[s];n?.weight&&(t+=n.weight)});const a=e?.specialEquipment||e?.special_equipment||[];return Array.isArray(a)&&window.VEHICLE_COMPONENTS?.special_equipment&&a.forEach(s=>{const n=window.VEHICLE_COMPONENTS.special_equipment[s];n?.weight&&(t+=n.weight,n.internal_space_reduction)}),t+=this.calculateAmmoWeight(e),t+=this.calculateFuelWeight(e),t}static calculateArmorWeight(e){let t=0;if(!(e?.armor_thickness||e?.armorThickness))return t;let i=1;if(e?.armor_material&&window.VEHICLE_COMPONENTS?.armor_materials){const s=window.VEHICLE_COMPONENTS.armor_materials[e.armor_material];s?.weight_factor&&(i=s.weight_factor)}const a=window.VEHICLE_COMPONENTS?.chassis?.[e?.chassis];if(a){let s=1;a.weight_class==="light"?s=35:a.weight_class==="medium"?s=50:a.weight_class==="heavy"?s=65:a.weight_class==="super_heavy"&&(s=90);const n=7.85,r=e.armor_thickness?.frontal??e.armorThickness??50,c=e.armor_thickness?.side||r*.6,l=e.armor_thickness?.rear||r*.4,d=(r+c+l)/3;t=s*d*n*i}return Math.round(t)}static calculateWeaponWeight(e){let t=0;if(e?.main_gun&&window.VEHICLE_COMPONENTS?.main_guns){const i=window.VEHICLE_COMPONENTS.main_guns[e.main_gun];i?.weight&&(t+=i.weight)}else if(e?.main_gun_caliber){const i=e.main_gun_caliber;i<=37?t+=200:i<=57?t+=800:i<=75?t+=1500:i<=88?t+=2200:i<=105?t+=3e3:i<=122?t+=4500:i<=152?t+=6500:t+=8e3}return e?.secondary_weapons&&window.VEHICLE_COMPONENTS?.secondary_weapons&&e.secondary_weapons.forEach(i=>{const a=window.VEHICLE_COMPONENTS.secondary_weapons[i];a?.weight?t+=a.weight:t+=150}),e?.aa_guns&&window.VEHICLE_COMPONENTS?.aa_guns&&e.aa_guns.forEach(i=>{const a=window.VEHICLE_COMPONENTS.aa_guns[i];a?.weight?t+=a.weight:t+=400}),t}static calculateAmmoWeight(e){let t=0;if(e?.main_gun&&window.VEHICLE_COMPONENTS?.main_guns){const i=window.VEHICLE_COMPONENTS.main_guns[e.main_gun];if(i?.ammunition_weight){const a=e?.ammoCapacity||40;t+=a*i.ammunition_weight}else if(i?.caliber){const a=i.caliber,s=40;a<=37?t+=s*2:a<=57?t+=s*4:a<=75?t+=s*8:a<=88?t+=s*12:a<=105?t+=s*18:a<=122?t+=s*25:a<=152?t+=s*45:t+=s*60}}else if(e?.main_gun_caliber){const i=e.main_gun_caliber,a=40;i<=37?t+=a*2:i<=57?t+=a*4:i<=75?t+=a*8:i<=88?t+=a*12:i<=105?t+=a*18:i<=122?t+=a*25:i<=152?t+=a*45:t+=a*60}return e?.secondary_weapons&&(t+=e.secondary_weapons.length*200),e?.specialEquipment&&window.VEHICLE_COMPONENTS?.special_equipment&&e.specialEquipment.forEach(i=>{const a=window.VEHICLE_COMPONENTS.special_equipment[i];a?.ammo_capacity_reduction&&(t*=1-a.ammo_capacity_reduction)}),t}static calculateFuelWeight(e){let t=400;if(e?.engine&&window.VEHICLE_COMPONENTS?.engines){const i=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];i?.power&&(t=Math.max(300,i.power*.6))}return Math.round(t*.85)}static getPerformanceDetails(e,t=null){const i=t||this.getChassisInfo(e);return{weight:this.calculateTotalWeight(e),power_to_weight:e?.engine?((typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine)?.power:window.VEHICLE_COMPONENTS?.engines[e.engine]?.base?.power||window.VEHICLE_COMPONENTS?.engines[e.engine]?.power)||0)/Math.max(1,this.calculateTotalWeight(e)/1e3):0,max_speed:this.calculateMaxSpeed(e,i),range:this.calculateRange(e,i),crew_size:e?.crewSize||i?.crew_capacity?.optimal||2,chassis_type:i.category||"Unknown",role_optimization:this.getRoleOptimization(i)}}static getRoleOptimization(e){switch(e.category){case"Main Battle Tank":return"Combate balanceado";case"Super Heavy Tank":return"M√°xima prote√ß√£o";case"Light Tracked":return"Mobilidade e reconhecimento";case"Wheeled":return"Mobilidade estrat√©gica";case"Anti-Aircraft":return"Defesa antia√©rea";case"Self-Propelled Artillery":return"Suporte de fogo";case"Amphibious":return"Opera√ß√µes anf√≠bias";case"Airmobile":return"Desdobramento r√°pido";default:return"Uso geral"}}static calculateMaxSpeed(e,t=null){const i=t||this.getChassisInfo(e);let a=i?.base_speed||45;if(e?.engine&&e?.transmission&&window.VEHICLE_COMPONENTS?.engines&&window.VEHICLE_COMPONENTS?.transmissions){const s=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine],n=window.VEHICLE_COMPONENTS.transmissions[e.transmission];if(s&&n){const r=(s?.power||0)/(this.calculateTotalWeight(e)/1e3);let c=Math.min(80,25+r*1.5);i.category==="Wheeled"?c*=1.2:i.category==="Super Heavy Tank"?c*=.7:i.category==="Light Tracked"&&(c*=1.1),a=Math.max(i?.base_speed||45,c),n.max_speed_road&&(a=Math.min(a,n.max_speed_road)),i.terrain_mult?.road&&(a*=i.terrain_mult.road)}}return Math.round(a)}static calculateRange(e,t=null){const i=t||this.getChassisInfo(e);let a=200,s=400;switch(i.weight_class){case"light":s=300;break;case"medium":s=500;break;case"heavy":s=700;break;case"super_heavy":s=1e3;break}if(i.category==="Wheeled"?s*=.8:i.category==="Self-Propelled Artillery"&&(s*=1.2),e?.engine&&window.VEHICLE_COMPONENTS?.engines){const n=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(n?.consumption){let r=n.consumption;i.fuel_consumption_base&&(r*=i.fuel_consumption_base);let c=1;e?.specialEquipment&&window.VEHICLE_COMPONENTS?.special_equipment&&e.specialEquipment.forEach(l=>{const d=window.VEHICLE_COMPONENTS.special_equipment[l];d&&(d.range_bonus&&(c+=d.range_bonus),d.fuel_consumption_increase&&(r*=1+d.fuel_consumption_increase))}),a=Math.round(s/r*c)}}return a}static getDefaultMetrics(){return{mobility:0,firepower:0,protection:0,survivability:0,reconnaissance:0,logistics:0,combat_effectiveness:0,details:{weight:0,power_to_weight:0,max_speed:0,range:0,crew_size:0}}}static renderPerformanceDisplay(e){const t=this.calculatePerformanceMetrics(e),i=this.getChassisInfo(e);let a='<h3 class="text-xl font-semibold text-slate-100 mb-4">üìà An√°lise de Performance</h3>';a+='<div class="mb-3 p-2 rounded bg-slate-800/30 border border-slate-700/30">',a+='<div class="flex items-center justify-between text-sm">',a+='<span class="text-slate-400">Tipo de Chassi:</span>',a+=`<span class="text-slate-200 font-medium">${i.name||"Desconhecido"}</span>`,a+="</div>",a+='<div class="flex items-center justify-between text-sm mt-1">',a+='<span class="text-slate-400">Otimizado para:</span>',a+=`<span class="text-slate-300">${t.details.role_optimization}</span>`,a+="</div>",a+="</div>";const s=t.combat_effectiveness>=80?"text-green-400":t.combat_effectiveness>=60?"text-yellow-400":"text-red-400";return a+='<div class="mb-4 p-3 rounded-lg bg-slate-800/50 border border-slate-700/50">',a+='<div class="flex items-center justify-between">',a+='<span class="text-slate-200 font-medium">Efic√°cia de Combate Geral</span>',a+=`<span class="${s} font-bold text-xl">${t.combat_effectiveness}/100</span>`,a+="</div>",a+='<div class="w-full bg-slate-700 rounded-full h-2 mt-2">',a+=`<div class="h-2 rounded-full bg-gradient-to-r from-emerald-500 to-emerald-400" style="width: ${t.combat_effectiveness}%"></div>`,a+="</div>",a+="</div>",a+='<div class="space-y-3">',this.getChassisSpecificCategories(i).forEach(r=>{const c=t[r.key],l=c>=75?"text-green-400":c>=50?"text-yellow-400":"text-red-400",d=c>=75?"from-green-500 to-green-400":c>=50?"from-yellow-500 to-yellow-400":"from-red-500 to-red-400";a+='<div class="flex items-center justify-between text-sm">',a+=`<span class="text-slate-300">${r.icon} ${r.name}</span>`,a+='<div class="flex items-center gap-2 flex-1 ml-3">',a+='<div class="flex-1 bg-slate-700 rounded-full h-1.5">',a+=`<div class="h-1.5 rounded-full bg-gradient-to-r ${d}" style="width: ${c}%"></div>`,a+="</div>",a+=`<span class="${l} font-medium w-8 text-right">${c}</span>`,a+="</div>",a+="</div>"}),a+="</div>",a+='<div class="mt-4 pt-3 border-t border-slate-700/50">',a+='<h4 class="text-slate-200 font-medium mb-2">Detalhes T√©cnicos</h4>',a+='<div class="grid grid-cols-2 gap-2 text-xs text-slate-400">',a+=`<div><span class="text-slate-500">Peso:</span> <span class="text-slate-300">${(t.details.weight/1e3).toFixed(1)}t</span></div>`,a+=`<div><span class="text-slate-500">Vel. M√°x:</span> <span class="text-slate-300">${t.details.max_speed}km/h</span></div>`,a+=`<div><span class="text-slate-500">Pot√™ncia/Peso:</span> <span class="text-slate-300">${t.details.power_to_weight.toFixed(1)}hp/t</span></div>`,a+=`<div><span class="text-slate-500">Alcance:</span> <span class="text-slate-300">${t.details.range}km</span></div>`,a+="</div>",a+="</div>",a}static getChassisSpecificCategories(e){const t=[{key:"mobility",name:"Mobilidade",icon:"üöõ"},{key:"firepower",name:"Poder de Fogo",icon:"üí•"},{key:"protection",name:"Prote√ß√£o",icon:"üõ°Ô∏è"},{key:"survivability",name:"Sobreviv√™ncia",icon:"‚ù§Ô∏è"},{key:"reconnaissance",name:"Reconhecimento",icon:"üëÅÔ∏è"},{key:"maintenance",name:"Manuten√ß√£o",icon:"üîß"}];switch(e.category){case"Wheeled":t[0].icon="üöó",t[5].icon="üîß";break;case"Anti-Aircraft":t[1].icon="üéØ",t[4].icon="üì°";break;case"Self-Propelled Artillery":t[1].icon="üí£";break;case"Amphibious":t[0].icon="üõü";break;case"Airmobile":t[0].icon="‚úàÔ∏è",t[5].icon="üõ†Ô∏è";break}return t}}window.PerformanceSystem=Se;class Me{static calculateCosts(e){console.log("üìä CostSystem: Starting cost calculation");let t=5e4,i=5e3,a=15e3;try{if(e&&window.VEHICLE_COMPONENTS){if(!e.chassis&&!e.engine&&!e.transmission&&!e.suspension&&!e.fcs&&!e.optics&&!e.communication&&(!e.special_equipment||e.special_equipment.length===0)&&(!e.specialEquipment||e.specialEquipment.length===0)&&(!e.secondary_weapons||e.secondary_weapons.length===0))return this.getDefaultCosts();const r=this.calculateProductionCost(e),c=this.calculateMaintenanceCost(e,r),l=this.calculateOperationalCost(e);!isNaN(r)&&r>0&&(t=r),!isNaN(c)&&c>0&&(i=c),!isNaN(l)&&l>0&&(a=l)}}catch(n){console.error("üö® Error in cost calculation, using defaults:",n)}const s=t+i*10+a*10;return console.log("üí∞ Final CostSystem Results:",{production:t,maintenance:i,operational:a,total_ownership:s}),{production:t,maintenance:i,operational:a,total_ownership:s,breakdown:this.getCostBreakdown(e,t),efficiency_metrics:this.calculateCostEfficiency(e,t)}}static calculateProductionCost(e){let t=0,i={};if(e?.chassis&&window.VEHICLE_COMPONENTS?.chassis){const n=window.VEHICLE_COMPONENTS.chassis[e.chassis];if(n){const r=n.base_cost||0;t+=r,i.chassis=r,console.log(`üèóÔ∏è Chassis cost: $${r.toLocaleString()}`)}}else console.log("‚ö†Ô∏è No chassis selected");if(e?.engine&&window.VEHICLE_COMPONENTS?.engines){const n=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(n?.power){let r=n.power*45;const c=window.VEHICLE_COMPONENTS.engines[e.engine],l=n.fuel_type||c?.fuel_type,d=typeof n.experimental<"u"?n.experimental:!!c?.experimental,u=typeof n.supercharged<"u"?n.supercharged:!!c?.supercharged;l==="diesel"&&(r*=1.3),d&&(r*=2.5),u&&(r*=1.4),t+=Math.round(r)}}if(e?.transmission&&window.VEHICLE_COMPONENTS?.transmissions){const n=window.VEHICLE_COMPONENTS.transmissions[e.transmission];if(n){let r=n.cost||5e3;n.type==="automatic"?r*=1.5:n.type==="semi_auto"?r*=1.3:n.type==="planetary"?r*=2:(n.type==="cvt"||n.type==="electric")&&(r*=3),t+=Math.round(r)}}if(e?.suspension&&window.VEHICLE_COMPONENTS?.suspensions){const n=window.VEHICLE_COMPONENTS.suspensions[e.suspension];if(n){let r=n.cost||2500;n.hydropneumatic&&(r*=2.5),n.adaptive_experimental&&(r*=4),n.variable_height&&(r*=1.8),t+=Math.round(r)}}t+=this.calculateArmorCost(e),t+=this.calculateWeaponsCost(e),t+=this.calculateSystemsCost(e);const a=this.calculateCrewCost(e);t+=a,i.crew=a;const s=e?.specialEquipment||e?.special_equipment||[];if(console.log("üõ†Ô∏è Special Equipment Check:",{specialEquipmentFound:s,length:s.length,componentsAvailable:!!window.VEHICLE_COMPONENTS?.special_equipment}),s.length>0&&window.VEHICLE_COMPONENTS?.special_equipment){let n=0;s.forEach(r=>{const c=window.VEHICLE_COMPONENTS.special_equipment[r];c?.cost?(n+=c.cost,console.log(`‚öôÔ∏è Special Equipment: ${c.name} - $${c.cost.toLocaleString()}`)):console.log(`‚ùå Special Equipment not found or no cost: ${r}`)}),t+=n,i.specialEquipment=n}else s.length===0&&console.log("‚ÑπÔ∏è No special equipment selected");return e?.additional_armor&&window.VEHICLE_COMPONENTS?.additional_armor&&e.additional_armor.forEach(n=>{const r=window.VEHICLE_COMPONENTS.additional_armor[n];r?.cost&&(t+=r.cost)}),console.log("üìã Production Cost Breakdown:",i),console.log(`üí∞ Total Production Cost: $${t.toLocaleString()}`),Math.round(t)}static calculateArmorCost(e){const t=e?.armor_thickness||e?.armorThickness||0,i=e?.armor_material||e?.armorMaterial;if(!t)return 0;let a=0;window.PerformanceSystem&&window.PerformanceSystem.calculateArmorWeight?a=window.PerformanceSystem.calculateArmorWeight(e):a=this.calculateArmorWeight(e);let s=a*8;if(i&&window.VEHICLE_COMPONENTS?.armor_materials){const n=window.VEHICLE_COMPONENTS.armor_materials[i];n?.cost_factor&&(s*=n.cost_factor)}return Math.round(s)}static calculateWeaponsCost(e){let t=0;if(!e?.chassis)return 0;const i=e?.main_gun_caliber||0;if(console.log("üéØ Main Gun Check:",{caliber:i,main_gun_caliber:e?.main_gun_caliber}),i&&i>0&&!isNaN(i)){const n=i*180,r=i*120,c=n+r;t+=c,console.log(`üéØ Main gun: ${i}mm - Gun: $${n.toLocaleString()}, Mount: $${r.toLocaleString()}, Total: $${c.toLocaleString()}`)}else i===0?console.log("‚ÑπÔ∏è No main gun selected"):console.log("‚ö†Ô∏è Invalid main gun caliber:",i);let a=[];if(e?.secondary_weapons&&Array.isArray(e.secondary_weapons)&&e.secondary_weapons.length>0)a=e.secondary_weapons;else if(e?.secondary_weapon&&e.secondary_weapon!==null&&e.secondary_weapon!=="")a=[e.secondary_weapon];else if(e?.secondaryWeapon&&e.secondaryWeapon!==null&&e.secondaryWeapon!=="")a=[e.secondaryWeapon];else{for(const[n,r]of Object.entries(e||{}))if(n.toLowerCase().includes("secondary")&&r){if(Array.isArray(r)&&r.length>0){a=r,console.log(`üîç Found secondary weapons in property: ${n}`,r);break}else if(typeof r=="string"&&r.trim()!==""){a=[r],console.log(`üîç Found secondary weapon in property: ${n}`,r);break}}a.length===0&&document.querySelectorAll('.component-card.selected, [class*="selected"], .bg-brand-900, .border-brand-400').forEach(r=>{const c=r.getAttribute("onclick");if(c&&c.includes("selectSecondaryWeapon")){const l=c.match(/selectSecondaryWeapon\(['"]([^'"]+)['"]\)/);l&&l[1]&&(a.push(l[1]),console.log(`üîç Found selected weapon from UI: ${l[1]}`))}})}console.log("üî´ FULL Secondary Weapons Debug:",{vehicle_keys:Object.keys(e||{}),secondary_weapon:e?.secondary_weapon,secondary_weapons:e?.secondary_weapons,secondaryWeapon:e?.secondaryWeapon,secondaryWeapons_final:a,components_available:!!window.VEHICLE_COMPONENTS?.secondary_weapons,all_secondary_weapons_ids:Object.keys(window.VEHICLE_COMPONENTS?.secondary_weapons||{}).slice(0,5)}),a.length>0&&window.VEHICLE_COMPONENTS?.secondary_weapons&&a.forEach(n=>{if(n&&n!==null&&n!==void 0&&n!==""){const r=window.VEHICLE_COMPONENTS.secondary_weapons[n];if(console.log(`üîç Looking up weapon: "${n}"`,r),r&&r.cost&&typeof r.cost=="number"&&!isNaN(r.cost)&&r.cost>0)t+=r.cost,console.log(`‚úÖ Secondary weapon: ${r.name} - $${r.cost.toLocaleString()}`);else{let c=!1;for(const[l,d]of Object.entries(window.VEHICLE_COMPONENTS.secondary_weapons))if(d.name&&d.name.toLowerCase().includes("7.62")&&d.cost&&!isNaN(d.cost)){t+=d.cost,console.log(`üîç Found by name match: ${d.name} (${l}) - $${d.cost.toLocaleString()}`),c=!0;break}c||(t+=1800,console.log(`üî´ Secondary weapon (fallback): ${n} - $${1800 .toLocaleString()}`),console.log("‚ùå Weapon data issue:",{weaponId:n,weapon:r,cost:r?.cost}))}}else console.log("‚ö†Ô∏è Invalid secondary weapon ID:",n)});const s=e?.aa_guns||(e?.aa_gun?[e.aa_gun]:[]);return console.log("üéØ AA Guns Check:",{aaGuns:s,length:s.length,aa_gun:e?.aa_gun,aa_guns:e?.aa_guns}),s.length>0&&window.VEHICLE_COMPONENTS?.aa_guns&&s.forEach(n=>{if(n&&n!==null&&n!==void 0){const r=window.VEHICLE_COMPONENTS.aa_guns[n];if(r?.cost&&!isNaN(r.cost))t+=r.cost,console.log(`üéØ AA gun: ${r.name} - $${r.cost.toLocaleString()}`);else{const c=r?.caliber&&!isNaN(r.caliber)?r.caliber*200:4e3;t+=c,console.log(`üéØ AA gun (fallback cost): ${n} - $${c.toLocaleString()}`)}}else console.log("‚ö†Ô∏è Invalid AA gun ID:",n)}),Math.round(t)}static calculateSystemsCost(e){let t=0;if(e?.fcs&&window.VEHICLE_COMPONENTS?.fire_control){const i=window.VEHICLE_COMPONENTS.fire_control[e.fcs];if(console.log("üéØ Fire Control Check:",{fcs_id:e.fcs,fcs_data:i}),i){let a=i.cost||5e3;i.type==="radar"?a*=3:i.type==="electronic"?a*=5:i.type==="mechanical"&&(a*=1.8),isNaN(a)?(console.log("‚ùå FCS cost is NaN:",a),t+=5e3):(t+=a,console.log(`üéØ Fire Control: ${i.name} - $${a.toLocaleString()}`))}}if(e?.optics&&window.VEHICLE_COMPONENTS?.optics_systems){const i=window.VEHICLE_COMPONENTS.optics_systems[e.optics];console.log("üëÅÔ∏è Optics Check:",{optics_id:e.optics,optics_data:i}),i?.cost&&!isNaN(i.cost)?(t+=i.cost,console.log(`üëÅÔ∏è Optics: ${i.name} - $${i.cost.toLocaleString()}`)):(t+=1e3,console.log(`üëÅÔ∏è Optics (default): ${e.optics} - $${1e3.toLocaleString()}`))}if(e?.communication&&window.VEHICLE_COMPONENTS?.communication){const i=window.VEHICLE_COMPONENTS.communication[e.communication];console.log("üì° Communication Check:",{comm_id:e.communication,comm_data:i}),i?.cost&&!isNaN(i.cost)?(t+=i.cost,console.log(`üì° Communication: ${i.name} - $${i.cost.toLocaleString()}`)):(t+=2e3,console.log(`üì° Communication (default): ${e.communication} - $${2e3.toLocaleString()}`))}return Math.round(t)}static calculateCrewCost(e){let t=0;const i=e?.crewSize||3,a=e?.trainingLevel||"standard";console.log("üë• Crew Cost Check:",{crewSize:i,trainingLevel:a}),t+=i*800;const n={rookie:1200,standard:2500,veteran:5e3,elite:8500},r=n[a]||n.standard;return t+=i*r,console.log(`üë• Crew cost: ${i} crew @ ${a} = $${t.toLocaleString()}`),t}static calculateMaintenanceCost(e,t){let i=0;if(e?.chassis&&window.VEHICLE_COMPONENTS?.chassis){const l=window.VEHICLE_COMPONENTS.chassis[e.chassis];if(l){let d=l.maintenance_complexity||.15;l.weight_class==="light"?d*=1:l.weight_class==="medium"?d*=1.2:l.weight_class==="heavy"?d*=1.6:l.weight_class==="super_heavy"&&(d*=2.2),i+=(l.base_cost||0)*d}}if(e?.engine&&window.VEHICLE_COMPONENTS?.engines){const l=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(l){let d=l.maintenance_hours||2,u=25;(l.fuel_type||window.VEHICLE_COMPONENTS.engines[e.engine]?.fuel_type)==="diesel"?u=20:(l.fuel_type||window.VEHICLE_COMPONENTS.engines[e.engine]?.fuel_type)==="kerosene"?u=45:(l.fuel_type||window.VEHICLE_COMPONENTS.engines[e.engine]?.fuel_type)==="gasoline"&&(u=22),(l.experimental||window.VEHICLE_COMPONENTS.engines[e.engine]?.experimental)&&(u*=3.5),(l.supercharged||window.VEHICLE_COMPONENTS.engines[e.engine]?.supercharged)&&(u*=1.8),l.reliability&&(u*=1.5-l.reliability*.5),i+=d*u*12}}if(e?.transmission&&window.VEHICLE_COMPONENTS?.transmissions){const l=window.VEHICLE_COMPONENTS.transmissions[e.transmission];if(l){let d=(l.cost||5e3)*(l.maintenance_complexity||.2);l.type==="manual"?d*=1:l.type==="semi_auto"?d*=1.4:l.type==="automatic"?d*=2.1:l.type==="planetary"?d*=2.8:l.type==="cvt"?d*=3.5:l.type==="electric"&&(d*=1.8),i+=d}}if(e?.suspension&&window.VEHICLE_COMPONENTS?.suspensions){const l=window.VEHICLE_COMPONENTS.suspensions[e.suspension];if(l){let d=(l.cost||2500)*.25;l.hydropneumatic&&(d*=2.2),l.adaptive_experimental&&(d*=4.5),l.variable_height&&(d*=1.9),i+=d}}if(e?.chassis&&e?.main_gun_caliber){const l=e.main_gun_caliber*15;i+=l}const a=e?.secondary_weapons||e?.secondary_weapon?[e.secondary_weapon]:[];a.length>0&&window.VEHICLE_COMPONENTS?.secondary_weapons&&a.forEach(l=>{const d=window.VEHICLE_COMPONENTS.secondary_weapons[l];d&&(i+=(d.cost||1500)*.3)});const s=e?.aa_guns||e?.aa_gun?[e.aa_gun]:[];if(s.length>0&&window.VEHICLE_COMPONENTS?.aa_guns&&s.forEach(l=>{if(l){const d=window.VEHICLE_COMPONENTS.aa_guns[l];if(d){const u=(d.cost||d.caliber*200)*.35;i+=u}}}),e?.fcs&&window.VEHICLE_COMPONENTS?.fire_control){const l=window.VEHICLE_COMPONENTS.fire_control[e.fcs];if(l){let d=(l.cost||5e3)*.4;l.type==="mechanical"?d*=.8:l.type==="radar"?d*=2.5:l.type==="electronic"&&(d*=4.2),i+=d}}if(e?.optics&&window.VEHICLE_COMPONENTS?.optics_systems){const l=window.VEHICLE_COMPONENTS.optics_systems[e.optics];l&&(i+=(l.cost||1e3)*.25)}if(e?.communication&&window.VEHICLE_COMPONENTS?.communication){const l=window.VEHICLE_COMPONENTS.communication[e.communication];l&&(i+=(l.cost||2e3)*.3)}const n=e?.specialEquipment||e?.special_equipment||[];n.length>0&&window.VEHICLE_COMPONENTS?.special_equipment&&n.forEach(l=>{const d=window.VEHICLE_COMPONENTS.special_equipment[l];if(d){let u=(d.cost||3e3)*.35;d.energy_consumption>2&&(u*=1.5),d.installation_complexity>.7&&(u*=1.3),i+=u}});const r=e?.armor_thickness||e?.armorThickness||0,c=e?.armor_material||e?.armorMaterial;if(r&&c){let d=this.calculateArmorWeight(e)*.5;if(c&&window.VEHICLE_COMPONENTS?.armor_materials){const u=window.VEHICLE_COMPONENTS.armor_materials[c];u&&(u.cost_factor>1.5&&(d*=1.4),u.experimental&&(d*=2.8))}i+=d}return Math.round(i)}static calculateArmorWeight(e){const t=e?.armor_thickness||e?.armorThickness||0;if(!t)return 0;const i=window.VEHICLE_COMPONENTS?.chassis?.[e?.chassis];if(!i)return 0;const a=i.weight_class==="light"?25:i.weight_class==="medium"?35:i.weight_class==="heavy"?50:65;return t*.001*a*7850}static calculateOperationalCost(e){let t=0;if(e?.engine&&window.VEHICLE_COMPONENTS?.engines){const i=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(i?.consumption){const a=i.consumption*1e3*1.06;t+=a}}if(e?.chassis){const a=(e?.crewSize||0)*12e3;t+=a}if(e?.chassis&&e?.main_gun_caliber){const i=e.main_gun_caliber*50;t+=i}return Math.round(t)}static calculateTotalOwnershipCost(e,t,i){return Math.round(e+t*10+i*10)}static getCostBreakdown(e,t){const i=isNaN(t)?5e4:t;return{chassis:Math.floor(i*.25),armor:Math.floor(i*.2),engine_drivetrain:Math.floor(i*.25),weapons:Math.floor(i*.15),systems:Math.floor(i*.1),crew:Math.floor(i*.05),special_equipment:0,other:0}}static calculateSpecialEquipmentCost(e){let t=0;const i=e?.specialEquipment||e?.special_equipment||[];return i.length>0&&window.VEHICLE_COMPONENTS?.special_equipment&&i.forEach(a=>{const s=window.VEHICLE_COMPONENTS.special_equipment[a];s?.cost&&!isNaN(s.cost)&&(t+=s.cost)}),t}static calculateEngineCost(e){if(!e?.engine||!window.VEHICLE_COMPONENTS?.engines)return 0;const t=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(!t)return 0;let i=t.power*45;if((t.fuel_type||window.VEHICLE_COMPONENTS.engines[e.engine]?.fuel_type)==="diesel"&&(i*=1.3),(t.experimental||window.VEHICLE_COMPONENTS.engines[e.engine]?.experimental)&&(i*=2.5),e?.transmission&&window.VEHICLE_COMPONENTS?.transmissions){const a=window.VEHICLE_COMPONENTS.transmissions[e.transmission];a&&(i+=a.cost||5e3)}if(e?.suspension&&window.VEHICLE_COMPONENTS?.suspensions){const a=window.VEHICLE_COMPONENTS.suspensions[e.suspension];a&&(i+=a.cost||2500)}return Math.round(i)}static calculateCostEfficiency(e,t){const i=window.PerformanceSystem?window.PerformanceSystem.calculateTotalWeight(e):3e4,a=window.PerformanceSystem?window.PerformanceSystem.calculatePerformanceMetrics(e):{combat_effectiveness:50};return{cost_per_ton:Math.round(t/(i/1e3)),cost_per_performance_point:Math.round(t/Math.max(1,a.combat_effectiveness)),bang_for_buck:Math.round(a.combat_effectiveness*1e3/t)}}static getDefaultCosts(){return{production:0,maintenance:0,operational:0,total_ownership:0,breakdown:{chassis:0,armor:0,engine_drivetrain:0,weapons:0,systems:0,other:0},efficiency_metrics:{cost_per_ton:0,cost_per_performance_point:0,bang_for_buck:0}}}static renderCostDisplay(e){const t=window.currentVehicle||e||{};console.log("üîç ULTIMATE DEBUG:",{passedVehicle:e,windowCurrentVehicle:window.currentVehicle,actualVehicle:t,allKeys:Object.keys(t||{})});const i=Object.keys(t).length>Object.keys(e||{}).length?t:e;console.log("üéØ Using vehicle:",i);const a=this.calculateCosts(i),s=e?.quantity||1;let n='<h3 class="text-xl font-semibold text-slate-100 mb-4">üí∞ An√°lise de Custos</h3>';n+='<div class="grid grid-cols-2 gap-4 mb-6">',n+='<div class="p-4 rounded-lg bg-green-900/20 border border-green-500/30">',n+='<div class="text-green-300 text-sm font-medium">Custo por Unidade</div>';const r=isNaN(a.production)?0:a.production;n+=`<div class="text-green-100 text-xl font-bold">$${(r/1e3).toFixed(0)}K</div>`,n+="</div>",n+='<div class="p-4 rounded-lg bg-yellow-900/20 border border-yellow-500/30">',n+='<div class="text-yellow-300 text-sm font-medium">Manuten√ß√£o por Unidade/Ano</div>';const c=isNaN(a.maintenance)?0:a.maintenance;n+=`<div class="text-yellow-100 text-xl font-bold">$${(c/1e3).toFixed(0)}K</div>`,n+="</div>",n+="</div>",s>1&&(n+='<div class="p-4 rounded-lg bg-blue-900/20 border border-blue-500/30 mb-4">',n+='<div class="flex items-center justify-between">',n+=`<span class="text-blue-300 font-medium">Custo Total do Projeto (${s} unidades)</span>`,n+=`<span class="text-blue-100 font-bold text-lg">$${(a.production*s/1e6).toFixed(1)}M</span>`,n+="</div>",n+="</div>"),n+='<div class="mb-6">',n+='<h4 class="text-slate-200 font-medium mb-3">üìä Breakdown de Custos (por unidade)</h4>',n+='<div class="space-y-2">',Object.entries(a.breakdown).sort((S,x)=>x[1]-S[1]).forEach(([S,x])=>{if(x&&x>0&&!isNaN(x)){const C=a.production>0?(x/a.production*100).toFixed(1):"0.0",Z=(x/1e3).toFixed(0);n+='<div class="flex items-center justify-between p-2 rounded bg-slate-800/30">',n+=`<span class="text-slate-200">${this.formatComponentName(S)}</span>`,n+='<div class="flex items-center gap-3">',n+=`<span class="text-slate-400 text-sm">${C}%</span>`,n+=`<span class="text-slate-100 font-semibold">$${Z}K</span>`,n+="</div>",n+="</div>",n+='<div class="h-1 bg-slate-700 rounded-full overflow-hidden ml-2 mb-2">',n+=`<div class="h-full bg-brand-500 transition-all duration-300" style="width: ${C}%"></div>`,n+="</div>"}}),n+="</div>",n+="</div>",n+='<div class="mb-6">',n+='<h4 class="text-slate-200 font-medium mb-3">üîß Detalhes de Manuten√ß√£o (por unidade/ano)</h4>',n+=this.renderMaintenanceBreakdown(e,a.maintenance),n+="</div>",n+='<div class="grid grid-cols-3 gap-3 mb-6">',n+='<div class="p-3 rounded bg-slate-800/40">',n+='<div class="text-xs text-slate-400">Combust√≠vel/Ano</div>';const d=isNaN(a.operational)?0:a.operational*.4;n+=`<div class="text-orange-400 font-semibold">$${(d/1e3).toFixed(0)}K</div>`,n+="</div>",n+='<div class="p-3 rounded bg-slate-800/40">',n+='<div class="text-xs text-slate-400">Tripula√ß√£o/Ano</div>';const u=isNaN(a.operational)?0:a.operational*.6;n+=`<div class="text-blue-400 font-semibold">$${(u/1e3).toFixed(0)}K</div>`,n+="</div>",n+='<div class="p-3 rounded bg-slate-800/40">',n+='<div class="text-xs text-slate-400">Total Opera√ß√£o</div>';const p=isNaN(a.operational)?0:a.operational;n+=`<div class="text-purple-400 font-semibold">$${(p/1e3).toFixed(0)}K</div>`,n+="</div>",n+="</div>",n+='<div class="p-4 rounded-lg bg-red-900/20 border border-red-500/30 mb-6">',n+='<div class="flex items-center justify-between mb-2">',n+='<span class="text-red-300 font-medium">Custo Total de Propriedade (10 anos por unidade)</span>';const f=isNaN(a.total_ownership)?0:a.total_ownership;n+=`<span class="text-red-100 font-bold text-lg">$${(f/1e3).toFixed(0)}K</span>`,n+="</div>",n+='<div class="text-xs text-red-300/70">';const g=isNaN(a.production)?0:a.production,y=isNaN(a.maintenance)?0:a.maintenance,_=isNaN(a.operational)?0:a.operational;n+=`Inclui: Compra ($${(g/1e3).toFixed(0)}K) + Manuten√ß√£o 10 anos ($${(y*10/1e3).toFixed(0)}K) + Opera√ß√£o 10 anos ($${(_*10/1e3).toFixed(0)}K)`,n+="</div>",n+="</div>",n+='<div class="pt-4 border-t border-slate-700/50">',n+='<h4 class="text-slate-200 font-medium mb-3">üìà M√©tricas de Efici√™ncia</h4>',n+='<div class="grid grid-cols-1 gap-3">',n+='<div class="flex justify-between items-center p-2 rounded bg-slate-800/30">',n+='<span class="text-slate-400">Custo por Tonelada</span>';const b=isNaN(a.efficiency_metrics.cost_per_ton)?0:a.efficiency_metrics.cost_per_ton;n+=`<span class="text-slate-100 font-semibold">$${b.toLocaleString()}</span>`,n+="</div>",n+='<div class="flex justify-between items-center p-2 rounded bg-slate-800/30">',n+='<span class="text-slate-400">Custo-benef√≠cio</span>';const v=isNaN(a.efficiency_metrics.bang_for_buck)?0:a.efficiency_metrics.bang_for_buck;n+=`<span class="text-slate-100 font-semibold">${v} pts/$1K</span>`,n+="</div>",n+='<div class="flex justify-between items-center p-2 rounded bg-slate-800/30">',n+='<span class="text-slate-400">Custo/Performance</span>';const T=isNaN(a.efficiency_metrics.cost_per_performance_point)?0:a.efficiency_metrics.cost_per_performance_point;return n+=`<span class="text-slate-100 font-semibold">$${T.toLocaleString()}</span>`,n+="</div>",n+="</div>",n+="</div>",n}static renderMaintenanceBreakdown(e,t){let i='<div class="space-y-2 text-sm">';const a=isNaN(t)||t<=0?1:t;if(e?.engine&&window.VEHICLE_COMPONENTS?.engines){const s=typeof window.getResolvedComponent=="function"?window.getResolvedComponent("engines",e.engine):window.VEHICLE_COMPONENTS.engines[e.engine]?.base||window.VEHICLE_COMPONENTS.engines[e.engine];if(s){const n=(s.maintenance_hours||2)*this.getEngineMaintenanceCostPerHour(s)*12,r=isNaN(n)?0:n,c=(r/a*100).toFixed(1);i+='<div class="flex justify-between text-slate-400">',i+=`<span>üîß Motor (${s.fuel_type})</span>`,i+=`<span>$${(r/1e3).toFixed(1)}K (${c}%)</span>`,i+="</div>"}}if(e?.transmission&&window.VEHICLE_COMPONENTS?.transmissions){const s=window.VEHICLE_COMPONENTS.transmissions[e.transmission];if(s){let n=(s.cost||5e3)*(s.maintenance_complexity||.2);s.type==="automatic"?n*=2.1:s.type==="manual"&&(n*=1);const r=isNaN(n)?0:n,c=(r/a*100).toFixed(1);i+='<div class="flex justify-between text-slate-400">',i+=`<span>‚öôÔ∏è Transmiss√£o (${s.type})</span>`,i+=`<span>$${(r/1e3).toFixed(1)}K (${c}%)</span>`,i+="</div>"}}if(e?.chassis&&e?.main_gun_caliber&&!isNaN(e.main_gun_caliber)){const s=e.main_gun_caliber*15,n=isNaN(s)?0:s,r=(n/a*100).toFixed(1);i+='<div class="flex justify-between text-slate-400">',i+=`<span>üî´ Canh√£o Principal (${e.main_gun_caliber}mm)</span>`,i+=`<span>$${(n/1e3).toFixed(1)}K (${r}%)</span>`,i+="</div>"}if(e?.fcs&&window.VEHICLE_COMPONENTS?.fire_control){const s=window.VEHICLE_COMPONENTS.fire_control[e.fcs];if(s){let n=(s.cost||5e3)*.4;s.type==="electronic"?n*=4.2:s.type==="radar"&&(n*=2.5);const r=isNaN(n)?0:n,c=(r/a*100).toFixed(1);i+='<div class="flex justify-between text-slate-400">',i+=`<span>üéØ Fire Control (${s.type})</span>`,i+=`<span>$${(r/1e3).toFixed(1)}K (${c}%)</span>`,i+="</div>"}}return i+="</div>",i}static getEngineMaintenanceCostPerHour(e){let t=25;return e.fuel_type==="diesel"?t=20:e.fuel_type==="kerosene"?t=45:e.fuel_type==="gasoline"&&(t=22),e.experimental&&(t*=3.5),e.supercharged&&(t*=1.8),e.reliability&&(t*=1.5-e.reliability*.5),t}static formatComponentName(e){return{chassis:"Chassi",armor:"Blindagem",engine_drivetrain:"Motor/Tra√ß√£o",weapons:"Armamentos",systems:"Sistemas",crew:"Tripula√ß√£o",special_equipment:"Equip. Especiais",other:"Outros"}[e]||e}static syncVehicleWithUI(e){if(!e)return;console.log("üîÑ Syncing vehicle with UI selections...");const t=document.querySelectorAll('[onclick*="selectSecondaryWeapon"].selected, [onclick*="selectSecondaryWeapon"][class*="brand-"], [onclick*="selectSecondaryWeapon"][class*="selected"]');if(t.length>0){const a=[];t.forEach(s=>{const n=s.getAttribute("onclick");if(n){const r=n.match(/selectSecondaryWeapon\(['"]([^'"]+)['"]\)/);r&&r[1]&&(a.push(r[1]),console.log(`üîÑ UI Sync: Found selected secondary weapon: ${r[1]}`))}}),a.length>0&&(!e.secondary_weapons||e.secondary_weapons.length===0)&&(e.secondary_weapons=a,console.log("üîÑ UI Sync: Updated vehicle.secondary_weapons:",a))}document.querySelectorAll('[onclick*="select"][class*="brand-"], [onclick*="select"][class*="selected"]').forEach(a=>{const s=a.getAttribute("onclick");if(s){if(s.includes("selectFireControl")){const n=s.match(/selectFireControl\(['"]([^'"]+)['"]\)/);n&&n[1]&&!e.fcs&&(e.fcs=n[1],console.log(`üîÑ UI Sync: Found fire control: ${n[1]}`))}else if(s.includes("selectOptics")){const n=s.match(/selectOptics\(['"]([^'"]+)['"]\)/);n&&n[1]&&!e.optics&&(e.optics=n[1],console.log(`üîÑ UI Sync: Found optics: ${n[1]}`))}else if(s.includes("selectCommunication")){const n=s.match(/selectCommunication\(['"]([^'"]+)['"]\)/);n&&n[1]&&!e.communication&&(e.communication=n[1],console.log(`üîÑ UI Sync: Found communication: ${n[1]}`))}}})}}window.CostSystem=Me;const O={mbt_light:{name:"Chassi MBT Leve",category:"Main Battle Tank",weight_class:"light",base_weight:6e3,base_cost:85e3,max_weight_capacity:35e3,max_armor_thickness:150,base_speed:52,terrain_mult:{road:1,offroad:.88,mud:.78,snow:.82},maintenance_complexity:.7,fuel_consumption_base:1,crew_comfort:.7,tech_requirement:{year:1945,level:55},reliability:.84,crew_capacity:{min:3,max:4,optimal:3},turret_space:3,internal_volume:45,ground_pressure:.78,variants:["MBT","Tank Destroyer","SPAA","Command"],compatible_engines:["light","medium"],compatible_transmissions:["manual","semi_auto"],compatible_suspensions:["leaf_spring","coil_spring","torsion_bar","christie"],max_main_gun_caliber:105,min_main_gun_caliber:37,compatible_secondary_weapons:["mg_7_62mm","mg_12_7mm","autocannon_20mm"],max_engine_power:650,min_engine_power:180,large_caliber_capable:!1,aa_optimized:!1},mbt_medium:{name:"Chassi MBT M√©dio",category:"Main Battle Tank",weight_class:"medium",base_weight:13e3,base_cost:11e4,max_weight_capacity:45e3,max_armor_thickness:200,base_speed:48,terrain_mult:{road:1,offroad:.82,mud:.72,snow:.75},maintenance_complexity:.8,fuel_consumption_base:1.2,crew_comfort:.75,tech_requirement:{year:1948,level:62},reliability:.81,crew_capacity:{min:3,max:5,optimal:4},turret_space:3.4,internal_volume:52,ground_pressure:.82,variants:["MBT","Tank Destroyer","Recovery","Bridge Layer"],compatible_engines:["medium","heavy"],compatible_transmissions:["manual","semi_auto","automatic"],compatible_suspensions:["coil_spring","torsion_bar","hydropneumatic","interleaved"],max_main_gun_caliber:125,min_main_gun_caliber:75,compatible_secondary_weapons:["mg_7_62mm","mg_12_7mm","mg_14_5mm","autocannon_20mm","autocannon_25mm"],max_engine_power:900,min_engine_power:400,large_caliber_capable:!1,aa_optimized:!1},mbt_super_heavy:{name:"Chassi MBT Super-Pesado",category:"Super Heavy Tank",weight_class:"super_heavy",base_weight:46e3,base_cost:28e4,max_weight_capacity:75e3,max_armor_thickness:350,base_speed:35,terrain_mult:{road:1,offroad:.65,mud:.45,snow:.55},maintenance_complexity:1.4,fuel_consumption_base:2.2,crew_comfort:.85,tech_requirement:{year:1953,level:85},reliability:.72,crew_capacity:{min:4,max:6,optimal:5},turret_space:4.2,internal_volume:68,ground_pressure:.95,variants:["Heavy MBT","Heavy Tank Destroyer","Breakthrough Tank"]},mbt_heavy:{name:"Chassi MBT Pesado",category:"Main Battle Tank",weight_class:"heavy",base_weight:21e3,base_cost:165e3,max_weight_capacity:65e3,max_armor_thickness:280,base_speed:42,terrain_mult:{road:1,offroad:.75,mud:.58,snow:.65},maintenance_complexity:1,fuel_consumption_base:1.6,crew_comfort:.82,tech_requirement:{year:1950,level:72},reliability:.78,crew_capacity:{min:4,max:5,optimal:4},turret_space:3.8,internal_volume:58,ground_pressure:.95,variants:["MBT","Heavy Tank Destroyer","Assault Gun"]},light_tracked_basic:{name:"Chassi Leve Tracked B√°sico",category:"Light Tracked",weight_class:"light",base_weight:4500,base_cost:42e3,max_weight_capacity:25e3,max_armor_thickness:35,base_speed:65,terrain_mult:{road:1,offroad:.92,mud:.82,snow:.75},maintenance_complexity:.55,fuel_consumption_base:.75,crew_comfort:.65,tech_requirement:{year:1942,level:45},reliability:.87,crew_capacity:{min:2,max:3,optimal:2},turret_space:1.8,internal_volume:28,ground_pressure:.45,variants:["APC","IFV","Mortar Carrier","Command","Ambulance"],compatible_engines:["light","medium"],compatible_transmissions:["manual","semi_auto"],compatible_suspensions:["coil_spring","torsion_bar"],min_engine_power:120,max_engine_power:450},light_tracked_advanced:{name:"Chassi Leve Tracked Avan√ßado",category:"Light Tracked",weight_class:"light",base_weight:5500,base_cost:58e3,max_weight_capacity:32e3,max_armor_thickness:50,base_speed:68,terrain_mult:{road:1,offroad:.95,mud:.85,snow:.78},maintenance_complexity:.7,fuel_consumption_base:.85,crew_comfort:.72,tech_requirement:{year:1948,level:58},reliability:.85,crew_capacity:{min:2,max:4,optimal:3},turret_space:2.2,internal_volume:35,ground_pressure:.52,variants:["IFV","SPAA","AT Platform","Recon","Engineer"],compatible_engines:["light","medium"],compatible_transmissions:["manual","semi_auto","automatic"],compatible_suspensions:["coil_spring","torsion_bar","hydropneumatic"],min_engine_power:150,max_engine_power:550},heavy_tracked:{name:"Chassi Pesado Tracked",category:"Heavy Tracked",weight_class:"heavy",base_weight:2e4,base_cost:95e3,max_weight_capacity:48e3,max_armor_thickness:120,base_speed:45,terrain_mult:{road:1,offroad:.78,mud:.65,snow:.68},maintenance_complexity:.9,fuel_consumption_base:1.4,crew_comfort:.78,tech_requirement:{year:1946,level:65},reliability:.8,crew_capacity:{min:3,max:6,optimal:4},turret_space:3,internal_volume:48,ground_pressure:.88,variants:["Heavy APC","SPG","Recovery","Engineer"],compatible_engines:["medium","heavy"],compatible_transmissions:["manual","semi_auto","automatic"],compatible_suspensions:["torsion_bar","interleaved","hydropneumatic"],min_engine_power:450,max_engine_power:1e3},wheeled_4x4:{name:"Chassi com Rodas 4x4",category:"Wheeled",weight_class:"light",base_weight:3500,base_cost:32e3,max_weight_capacity:18e3,max_armor_thickness:25,base_speed:95,terrain_mult:{road:1.4,offroad:.65,mud:.35,snow:.45},maintenance_complexity:.45,fuel_consumption_base:.6,crew_comfort:.75,tech_requirement:{year:1940,level:35},reliability:.9,crew_capacity:{min:2,max:4,optimal:2},turret_space:1.2,internal_volume:18,ground_pressure:.68,variants:["Scout","Light APC","Command","AT Platform"],compatible_engines:["light"],compatible_transmissions:["automatic","semi_auto"],compatible_suspensions:["coil_spring"],min_engine_power:100,max_engine_power:300,max_main_gun_caliber:37,large_caliber_capable:!1},wheeled_6x6:{name:"Chassi com Rodas 6x6",category:"Wheeled",weight_class:"medium",base_weight:4500,base_cost:45e3,max_weight_capacity:28e3,max_armor_thickness:35,base_speed:88,terrain_mult:{road:1.3,offroad:.72,mud:.48,snow:.55},maintenance_complexity:.55,fuel_consumption_base:.8,crew_comfort:.78,tech_requirement:{year:1945,level:48},reliability:.88,crew_capacity:{min:2,max:6,optimal:3},turret_space:1.8,internal_volume:32,ground_pressure:.72,variants:["APC","IFV","SPAA","Mortar","Command"],compatible_engines:["light","medium"],compatible_transmissions:["automatic","semi_auto"],compatible_suspensions:["coil_spring","hydropneumatic"],min_engine_power:150,max_engine_power:450,max_main_gun_caliber:57,large_caliber_capable:!1},wheeled_8x8:{name:"Chassi com Rodas 8x8",category:"Wheeled",weight_class:"heavy",base_weight:6e3,base_cost:68e3,max_weight_capacity:38e3,max_armor_thickness:45,base_speed:85,terrain_mult:{road:1.25,offroad:.78,mud:.58,snow:.62},maintenance_complexity:.68,fuel_consumption_base:1,crew_comfort:.82,tech_requirement:{year:1950,level:62},reliability:.85,crew_capacity:{min:3,max:8,optimal:4},turret_space:2.5,internal_volume:42,ground_pressure:.78,variants:["Heavy APC","IFV","Tank Destroyer","Artillery","Recovery"],compatible_engines:["light","medium"],compatible_transmissions:["automatic","semi_auto"],compatible_suspensions:["coil_spring","hydropneumatic"],max_main_gun_caliber:90,min_main_gun_caliber:25,compatible_secondary_weapons:["mg_7_62mm","mg_12_7mm","autocannon_20mm","autocannon_25mm"],max_engine_power:750,min_engine_power:300,large_caliber_capable:!1,aa_optimized:!1,wheeled_restrictions:!0},amphibious_tracked:{name:"Chassi Anf√≠bio Tracked",category:"Amphibious",weight_class:"medium",base_weight:5e3,base_cost:95e3,max_weight_capacity:35e3,max_armor_thickness:60,base_speed:48,water_speed:8,terrain_mult:{road:1,offroad:.85,mud:.92,snow:.72,water:1},maintenance_complexity:1.1,fuel_consumption_base:1.3,crew_comfort:.68,tech_requirement:{year:1948,level:68},reliability:.78,crew_capacity:{min:3,max:5,optimal:3},turret_space:2.8,internal_volume:38,ground_pressure:.65,variants:["Amphibious Tank","Marine APC","Beach Assault"],special_features:["waterproofed","swimming_capability","bilge_pumps"]},airtransportable:{name:"Chassi Aerotransport√°vel",category:"Airmobile",weight_class:"light",base_weight:3e3,base_cost:52e3,max_weight_capacity:22e3,max_armor_thickness:30,base_speed:62,terrain_mult:{road:1,offroad:.88,mud:.75,snow:.72},maintenance_complexity:.8,fuel_consumption_base:.85,crew_comfort:.65,tech_requirement:{year:1950,level:72},reliability:.82,crew_capacity:{min:2,max:3,optimal:2},turret_space:1.5,internal_volume:22,ground_pressure:.38,variants:["Airborne Tank","Air-Mobile APC","Recon"],special_features:["lightweight_construction","air_droppable","quick_deployment"]},modular_experimental:{name:"Chassi Modular Experimental",category:"Experimental",weight_class:"variable",base_weight:25e3,base_cost:125e3,max_weight_capacity:5e4,max_armor_thickness:120,base_speed:55,terrain_mult:{road:1,offroad:.82,mud:.68,snow:.72},maintenance_complexity:1.6,fuel_consumption_base:1.1,crew_comfort:.85,tech_requirement:{year:1954,level:88},reliability:.75,crew_capacity:{min:2,max:6,optimal:3},turret_space:3.5,internal_volume:55,ground_pressure:.75,variants:["Modular MBT","Multi-Role","Reconfigurable"],special_features:["modular_armor","swappable_components","multi_role"],experimental:!0},spaa_light:{name:"Chassi SPAA Leve",category:"Anti-Aircraft",weight_class:"light",base_weight:12e3,base_cost:58e3,max_weight_capacity:28e3,max_armor_thickness:40,base_speed:65,terrain_mult:{road:1,offroad:.88,mud:.75,snow:.78},maintenance_complexity:.8,fuel_consumption_base:.9,crew_comfort:.7,tech_requirement:{year:1943,level:50},reliability:.85,crew_capacity:{min:3,max:5,optimal:4},turret_space:2.5,internal_volume:32,ground_pressure:.55,variants:["SPAA","Mobile AA"],special_features:["aa_fire_control","radar_compatible","360_traverse"],compatible_engines:["light","medium"],compatible_transmissions:["manual","semi_auto"],compatible_suspensions:["coil_spring","torsion_bar","christie"],max_main_gun_caliber:0,min_main_gun_caliber:0,compatible_secondary_weapons:[],max_engine_power:600,min_engine_power:300,large_caliber_capable:!1,aa_optimized:!0,aa_only:!0,compatible_aa_weapons:["mg_23mm","mg_30mm","mg_37mm","mg_40mm"]},spaa_medium:{name:"Chassi SPAA M√©dio",category:"Anti-Aircraft",weight_class:"medium",base_weight:18e3,base_cost:85e3,max_weight_capacity:42e3,max_armor_thickness:60,base_speed:55,terrain_mult:{road:1,offroad:.82,mud:.68,snow:.72},maintenance_complexity:.9,fuel_consumption_base:1.2,crew_comfort:.75,tech_requirement:{year:1945,level:60},reliability:.82,crew_capacity:{min:4,max:6,optimal:5},turret_space:3.2,internal_volume:45,ground_pressure:.68,variants:["Heavy SPAA","Multi-Target AA"],special_features:["advanced_fire_control","radar_integrated","ammo_handling"],aa_optimized:!0},spg_chassis:{name:"Chassi SPG/SPH",category:"Self-Propelled Artillery",weight_class:"heavy",base_weight:12e3,base_cost:95e3,max_weight_capacity:52e3,max_armor_thickness:80,base_speed:45,terrain_mult:{road:1,offroad:.75,mud:.62,snow:.68},maintenance_complexity:.9,fuel_consumption_base:1.4,crew_comfort:.65,tech_requirement:{year:1944,level:55},reliability:.8,crew_capacity:{min:4,max:8,optimal:6},turret_space:4.5,internal_volume:55,ground_pressure:.85,variants:["SPG","SPH","Howitzer","Artillery"],special_features:["large_gun_mount","ammo_storage","artillery_systems"],compatible_engines:["heavy","super_heavy"],compatible_transmissions:["manual","automatic","planetary"],compatible_suspensions:["torsion_bar","hydropneumatic","interleaved"],max_main_gun_caliber:180,min_main_gun_caliber:130,compatible_secondary_weapons:["mg_7_62mm","mg_12_7mm"],max_engine_power:1200,min_engine_power:600,large_caliber_capable:!0,aa_optimized:!1,artillery_specialized:!0}},L={gasoline_i4_light:{name:"4 Cilindros Gasolina",category:"light",fuel_type:"gasoline",tech_requirement:{year:1940,level:25},base:{power:180,weight:280,cost:4500,consumption:1,reliability:.92,maintenance_hours:1.5,energy_output:12},tuning:{light:{name_suffix:" (L)",power:-5,weight:-15},medium:{name_suffix:" (M)",power:15,weight:25},heavy:{name_suffix:" (H)",power:35,weight:60}},optimal_chassis:["mbt_light","wheeled_6x6","airtransportable"]},gasoline_v6_light:{name:"V6 Gasolina Leve",category:"light",fuel_type:"gasoline",tech_requirement:{year:1940,level:35},base:{power:320,weight:480,cost:8500,consumption:1.2,reliability:.85,maintenance_hours:2,fire_risk:.18,cold_start:.92,torque_curve:{low:.65,mid:1,high:.85},operational_temp:{min:-15,max:45},energy_output:18},tuning:{light:{name_suffix:" (L)",power:-10,weight:-30},medium:{name_suffix:" (M)",power:20,weight:40},heavy:{name_suffix:" (H)",power:40,weight:80}}},diesel_i4_light:{name:"I4 Diesel Leve",category:"light",fuel_type:"diesel",tech_requirement:{year:1941,level:40},base:{power:280,weight:420,cost:9500,consumption:.8,reliability:.88,maintenance_hours:1.6,fire_risk:.08,cold_start:.72,torque_curve:{low:1.25,mid:1,high:.65},energy_output:16},tuning:{light:{name_suffix:" (L)",power:-10,weight:-20},medium:{name_suffix:" (M)",power:20,weight:35},heavy:{name_suffix:" (H)",power:45,weight:70}},optimal_chassis:["mbt_light","wheeled_6x6","airtransportable"]},gasoline_v8_medium:{name:"V8 Gasolina M√©dio",category:"medium",fuel_type:"gasoline",tech_requirement:{year:1942,level:42},base:{power:450,weight:650,cost:12e3,consumption:1.35,reliability:.82,maintenance_hours:2.2,fire_risk:.16,cold_start:.94,torque_curve:{low:.72,mid:1,high:.88},energy_output:24},tuning:{light:{name_suffix:" (L)",power:-60,weight:-90},medium:{name_suffix:" (M)",power:0,weight:0},heavy:{name_suffix:" (H)",power:70,weight:110}},optimal_chassis:["mbt_medium","tracked_medium","wheeled_8x8"]},diesel_v6_medium:{name:"V6 Diesel M√©dio",category:"medium",fuel_type:"diesel",tech_requirement:{year:1943,level:45},base:{power:520,weight:720,cost:15e3,consumption:1.1,reliability:.86,maintenance_hours:2,fire_risk:.07,cold_start:.75,torque_curve:{low:1.2,mid:1,high:.7},energy_output:28},tuning:{light:{name_suffix:" (L)",power:-80,weight:-100},medium:{name_suffix:" (M)",power:0,weight:0},heavy:{name_suffix:" (H)",power:90,weight:140}},optimal_chassis:["mbt_medium","tracked_medium","amphibious_tracked"]},gasoline_v8_supercharged:{name:"V8 Gasolina Supercharger",category:"heavy",fuel_type:"gasoline",tech_requirement:{year:1944,level:58},base:{power:750,weight:890,cost:22e3,consumption:1.8,reliability:.78,maintenance_hours:3.2,fire_risk:.22,cold_start:.85,torque_curve:{low:.85,mid:1,high:.95},energy_output:45},tuning:{light:{name_suffix:" (lim.)",power:-150,weight:-180,reliability:.03},medium:{name_suffix:" (M)",power:-60,weight:-80},heavy:{name_suffix:" (H)",power:0,weight:0}},optimal_chassis:["mbt_heavy","mbt_super_heavy","tracked_heavy"]},gasoline_v12_contextual:{name:"V12 Gasolina (Ajust√°vel)",category:"medium",fuel_type:"gasoline",tech_requirement:{year:1946,level:65},base:{power:800,weight:1100,cost:3e4,consumption:1.9,reliability:.8,maintenance_hours:4,energy_output:50,fire_risk:.2,cold_start:.88,torque_curve:{low:.78,mid:1,high:.92}},tuning:{light:{name_suffix:" (Leve)",power:-150,weight:-250,cost:-4e3,consumption:-.4,reliability:.05},medium:{name_suffix:" (M√©dio)",power:-50,weight:-100,cost:-2e3,consumption:-.2,reliability:.02},heavy:{name_suffix:" (Pesado)",power:150,weight:180,cost:5e3,consumption:.2,reliability:-.05}}},diesel_v8_heavy:{name:"V8 Diesel Pesado",category:"heavy",fuel_type:"diesel",tech_requirement:{year:1945,level:55},base:{power:820,weight:1050,cost:28e3,consumption:1.4,reliability:.82,maintenance_hours:2.8,fire_risk:.08,cold_start:.68,torque_curve:{low:1.35,mid:1,high:.65},energy_output:54},tuning:{light:{name_suffix:" (L)",power:-160,weight:-180},medium:{name_suffix:" (M)",power:-60,weight:-80},heavy:{name_suffix:" (H)",power:0,weight:0}},optimal_chassis:["mbt_heavy","mbt_super_heavy","spg_chassis"]},diesel_v12_superheavy:{name:"V12 Diesel Super Pesado",category:"super_heavy",fuel_type:"diesel",tech_requirement:{year:1948,level:72},base:{power:1200,weight:1650,cost:48e3,consumption:1.8,reliability:.78,maintenance_hours:3.5,fire_risk:.09,cold_start:.65,torque_curve:{low:1.4,mid:1,high:.6},energy_output:79},tuning:{light:{name_suffix:" (L)",power:-250,weight:-250},medium:{name_suffix:" (M)",power:-120,weight:-140},heavy:{name_suffix:" (H)",power:0,weight:0}},optimal_chassis:["mbt_super_heavy","tracked_heavy"]},gasoline_v16_experimental:{name:"V16 Gasolina Experimental",category:"super_heavy",fuel_type:"gasoline",tech_requirement:{year:1952,level:85},base:{power:1450,weight:1950,cost:65e3,consumption:2.8,reliability:.72,maintenance_hours:5,fire_risk:.25,cold_start:.82,torque_curve:{low:.88,mid:1,high:.98},energy_output:87},tuning:{light:{name_suffix:" (L)",power:-300,weight:-300},medium:{name_suffix:" (M)",power:-150,weight:-160},heavy:{name_suffix:" (H)",power:0,weight:0}},optimal_chassis:["modular_experimental"],experimental:!0}},D={manual_2speed_simple:{name:"Manual Simples 2 Marchas",type:"manual",gears:2,weight:180,cost:2200,efficiency:.72,max_input_torque:800,reliability:.98,maintenance_complexity:.15,driver_skill_required:.95,tech_requirement:{year:1925,level:15},gear_ratios:[6.8,1],reverse_ratio:8.2,shift_time:4.5,max_speed_road:35,max_speed_offroad:22,terrain_performance:{mud:1.15,sand:1.08,snow:1.12},fuel_economy_bonus:.08,description:"Transmiss√£o extremamente simples e robusta, ideal para ve√≠culos utilit√°rios",historical_note:"Baseada em designs dos anos 1920-30, muito comum em ve√≠culos civis convertidos"},manual_3speed_utility:{name:"Manual Utilit√°ria 3 Marchas",type:"manual",gears:3,weight:240,cost:3200,efficiency:.78,max_input_torque:1100,reliability:.96,maintenance_complexity:.25,driver_skill_required:.88,tech_requirement:{year:1935,level:22},gear_ratios:[5.8,3.2,1],reverse_ratio:6.5,shift_time:3.8,max_speed_road:45,max_speed_offroad:32,terrain_performance:{mud:1.12,sand:1.05,snow:1.08},description:"Transmiss√£o robusta para ve√≠culos de apoio e transporte",optimal_applications:["transport","utility","light_armor"]},manual_4speed_combat:{name:"Manual de Combate 4 Marchas",type:"manual",gears:4,weight:310,cost:4800,efficiency:.82,max_input_torque:1450,reliability:.94,maintenance_complexity:.35,driver_skill_required:.82,tech_requirement:{year:1940,level:30},gear_ratios:[4.8,2.9,1.9,1],reverse_ratio:5.4,shift_time:2.8,max_speed_road:58,max_speed_offroad:42,terrain_performance:{mud:1.05,sand:1.02,snow:1.04},description:"Transmiss√£o padr√£o para tanques m√©dios, equilibrada para combate",optimal_applications:["main_battle_tank","medium_tank","tank_destroyer"]},manual_5speed_advanced:{name:"Manual Avan√ßada 5 Marchas",type:"manual",gears:5,weight:385,cost:7200,efficiency:.85,max_input_torque:1650,reliability:.92,maintenance_complexity:.45,driver_skill_required:.75,tech_requirement:{year:1948,level:42},gear_ratios:[4.5,2.8,1.9,1.3,1],reverse_ratio:5.1,shift_time:2.2,max_speed_road:68,max_speed_offroad:52,terrain_performance:{mud:1.02,sand:.98,snow:1.01},fuel_economy_bonus:.12,description:"Transmiss√£o moderna com marcha extra para economia de combust√≠vel",optimal_applications:["reconnaissance","light_tank","wheeled_vehicles"]},manual_6speed_racing:{name:"Manual Esportiva 6 Marchas",type:"manual",gears:6,weight:420,cost:12500,efficiency:.87,max_input_torque:1800,reliability:.89,maintenance_complexity:.65,driver_skill_required:.65,tech_requirement:{year:1952,level:58},gear_ratios:[4.2,2.6,1.8,1.4,1.1,1],reverse_ratio:4.8,shift_time:1.8,max_speed_road:85,max_speed_offroad:62,terrain_performance:{road:1.15,mud:.95,sand:.92,snow:.94},acceleration_bonus:.18,description:"Transmiss√£o de alta performance para ve√≠culos leves e r√°pidos",optimal_applications:["reconnaissance","armored_car","light_tank"],doctrinal_bonus:{NATO:.1,neutral:.05}},semi_auto_preselector:{name:"Semi-Autom√°tica Pr√©-Seletora",type:"semi_auto",gears:4,weight:450,cost:9800,efficiency:.81,max_input_torque:1950,reliability:.87,maintenance_complexity:.75,driver_skill_required:.55,tech_requirement:{year:1943,level:48},gear_ratios:[4.1,2.4,1.6,1],shift_time:1.5,max_speed_road:72,max_speed_offroad:55,pre_selection:!0,clutch_assisted:!0,description:"Sistema brit√¢nico de pr√©-sele√ß√£o, usado em tanques Cromwell",historical_note:"Tecnologia brit√¢nica Wilson, permite mudan√ßas r√°pidas sem desacelerar",optimal_applications:["british_tanks","fast_tanks"],doctrinal_bonus:{NATO:.15}},semi_auto_synchromesh:{name:"Semi-Autom√°tica Sincronizada",type:"semi_auto",gears:5,weight:520,cost:11500,efficiency:.83,max_input_torque:2100,reliability:.85,maintenance_complexity:.85,driver_skill_required:.45,tech_requirement:{year:1947,level:52},gear_ratios:[3.8,2.3,1.5,1.2,1],shift_time:1.2,max_speed_road:78,max_speed_offroad:58,synchromesh:!0,smooth_shifting:!0,description:"Transmiss√£o com sincronizadores, mudan√ßas suaves mesmo em combate",optimal_applications:["medium_tank","main_battle_tank","heavy_tank"]},automatic_torque_converter:{name:"Autom√°tica com Conversor de Torque",type:"automatic",gears:3,weight:680,cost:18500,efficiency:.73,max_input_torque:2800,reliability:.82,maintenance_complexity:1.2,driver_skill_required:.15,tech_requirement:{year:1947,level:62},gear_ratios:[3.6,2.2,1],torque_converter:!0,torque_multiplication:2.4,shift_time:.8,max_speed_road:65,max_speed_offroad:42,fuel_penalty:.18,smooth_operation:!0,description:"Primeira gera√ß√£o de transmiss√µes autom√°ticas militares",historical_note:"Baseada em tecnologia da GM Hydra-Matic, adaptada para uso militar",optimal_applications:["heavy_tank","assault_gun","self_propelled_artillery"],crew_fatigue_reduction:.25,energy_consumption:3},automatic_4speed_advanced:{name:"Autom√°tica Avan√ßada 4 Marchas",type:"automatic",gears:4,weight:750,cost:24e3,efficiency:.76,max_input_torque:3200,reliability:.79,maintenance_complexity:1.4,driver_skill_required:.12,tech_requirement:{year:1952,level:68},gear_ratios:[3.4,2.1,1.4,1],torque_converter:!0,torque_multiplication:2.8,shift_time:.6,max_speed_road:72,max_speed_offroad:48,fuel_penalty:.15,adaptive_shifting:!0,description:"Transmiss√£o autom√°tica de segunda gera√ß√£o, mais eficiente",optimal_applications:["main_battle_tank","command_vehicle","recovery_vehicle"],crew_fatigue_reduction:.35,doctrinal_bonus:{NATO:.12},energy_consumption:3},planetary_differential_steering:{name:"Planet√°rio com Dire√ß√£o Diferencial",type:"planetary",gears:"variable",weight:920,cost:32e3,efficiency:.77,max_input_torque:4800,reliability:.75,maintenance_complexity:1.8,driver_skill_required:.35,tech_requirement:{year:1949,level:72},steering_system:"differential",pivot_turn:!0,max_speed_road:52,max_speed_offroad:38,maneuverability_bonus:.35,description:"Sistema alem√£o avan√ßado com dire√ß√£o por alavancas",historical_note:"Usado em tanques alem√£es Panzer IV tardios e Panther",optimal_applications:["heavy_tank","tank_destroyer","assault_gun"],doctrinal_bonus:{Warsaw:.18},terrain_performance:{urban:1.25,forest:1.15},energy_consumption:4},planetary_hydraulic_assist:{name:"Planet√°rio com Assist√™ncia Hidr√°ulica",type:"planetary",gears:"variable",weight:1050,cost:42e3,efficiency:.79,max_input_torque:5500,reliability:.72,maintenance_complexity:2.1,driver_skill_required:.28,tech_requirement:{year:1953,level:78},hydraulic_assist:!0,power_steering:!0,pivot_turn:!0,max_speed_road:58,max_speed_offroad:42,maneuverability_bonus:.45,fuel_penalty:.08,description:"Sistema planet√°rio com assist√™ncia hidr√°ulica para ve√≠culos super-pesados",optimal_applications:["superheavy_tank","heavy_assault_gun","bunker_buster"],crew_fatigue_reduction:.4,doctrinal_bonus:{NATO:.08,Warsaw:.15},energy_consumption:4},cvt_experimental:{name:"CVT Experimental",type:"cvt",gears:"infinite",weight:850,cost:55e3,efficiency:.81,max_input_torque:2200,reliability:.68,maintenance_complexity:2.5,driver_skill_required:.2,tech_requirement:{year:1954,level:85},continuously_variable:!0,optimal_rpm_range:!0,max_speed_road:75,max_speed_offroad:55,fuel_economy_bonus:.22,acceleration_bonus:.15,description:"Transmiss√£o continuamente vari√°vel experimental",historical_note:"Tecnologia experimental, apenas para prot√≥tipos avan√ßados",optimal_applications:["prototype","experimental_vehicle"],prototype_only:!0,research_cost_multiplier:3.5},electric_single_speed:{name:"El√©trica Velocidade √önica",type:"electric",gears:1,weight:120,cost:28e3,efficiency:.94,max_input_torque:3500,reliability:.91,maintenance_complexity:.8,driver_skill_required:.05,tech_requirement:{year:1952,level:82},instant_torque:!0,silent_operation:!0,max_speed_road:45,max_speed_offroad:35,torque_at_zero_rpm:!0,description:"Transmiss√£o el√©trica experimental para ve√≠culos h√≠bridos",historical_note:"Baseada em experimentos de Ferdinand Porsche com o Elefant",optimal_applications:["experimental_vehicle","stealth_vehicle"],special_requirements:["electric_motor","battery_pack"],stealth_bonus:.6,prototype_only:!0,energy_consumption:8},hydrostatic_infinite:{name:"Hidrost√°tica de Varia√ß√£o Infinita",type:"hydrostatic",gears:"infinite",weight:780,cost:38e3,efficiency:.75,max_input_torque:4200,reliability:.76,maintenance_complexity:2,driver_skill_required:.25,tech_requirement:{year:1953,level:76},hydraulic_pump:!0,hydraulic_motor:!0,infinite_speed_control:!0,max_speed_road:48,max_speed_offroad:38,maneuverability_bonus:.4,precise_control:!0,description:"Sistema hidrost√°tico para controle preciso de velocidade",optimal_applications:["engineering_vehicle","recovery_vehicle","bridge_layer"],special_capabilities:["precise_positioning","variable_speed_pto"],energy_consumption:5}},te={leaf_spring:{name:"Mola de L√¢mina",weight:180,cost:2500,comfort_factor:.65,stability_factor:.85,terrain_performance:.75,reliability:.95,maintenance_complexity:.3,tech_requirement:{year:1930,level:20},ground_clearance:.35,description:"Sistema mais simples e confi√°vel, mas pouco confort√°vel"},coil_spring:{name:"Mola Helicoidal",weight:220,cost:4e3,comfort_factor:.78,stability_factor:.88,terrain_performance:.82,reliability:.9,maintenance_complexity:.5,tech_requirement:{year:1940,level:35},ground_clearance:.42,description:"Melhor conforto que mola de l√¢mina, mais complexa"},torsion_bar:{name:"Barra de Tor√ß√£o",weight:280,cost:6e3,comfort_factor:.85,stability_factor:.9,terrain_performance:.88,reliability:.85,maintenance_complexity:.7,tech_requirement:{year:1942,level:45},ground_clearance:.45,internal_space_savings:.1,description:"Padr√£o da era moderna, bom equil√≠brio"},christie_suspension:{name:"Suspens√£o Christie",weight:320,cost:8e3,comfort_factor:.82,stability_factor:.95,terrain_performance:.92,speed_bonus:.12,reliability:.78,maintenance_complexity:1,tech_requirement:{year:1938,level:55},ground_clearance:.48,high_speed_stability:!0,description:"Excelente para alta velocidade, manuten√ß√£o complexa"},hydropneumatic:{name:"Suspens√£o Hidropneum√°tica",weight:450,cost:15e3,comfort_factor:.95,stability_factor:.92,terrain_performance:.95,reliability:.72,maintenance_complexity:1.8,tech_requirement:{year:1950,level:75},ground_clearance:.55,variable_height:!0,stabilization_bonus:.25,power_requirement:150,description:"M√°ximo conforto e performance, muito complexa",energy_consumption:2},adaptive_experimental:{name:"Suspens√£o Adaptativa Experimental",weight:520,cost:25e3,comfort_factor:.98,stability_factor:.96,terrain_performance:.98,reliability:.68,maintenance_complexity:2.1,tech_requirement:{year:1954,level:85},experimental:!0,ground_clearance:.6,variable_height:!0,automatic_adjustment:!0,stabilization_bonus:.35,power_requirement:300,description:"Sistema que se adapta automaticamente ao terreno",energy_consumption:3},interleaved_roadwheels:{name:"Rodas Intercaladas",weight:380,cost:9500,comfort_factor:.88,stability_factor:.94,terrain_performance:.9,reliability:.75,maintenance_complexity:1.4,tech_requirement:{year:1940,level:60},ground_clearance:.52,track_contact_bonus:.15,maintenance_difficulty:!0,description:"Melhor distribui√ß√£o de peso, manuten√ß√£o dif√≠cil"}},z={mild_steel:{name:"A√ßo Comum",effectiveness_factor:.75,weight_factor:1,cost_factor:1,weldability:.95,availability:1,tech_requirement:{year:1939,level:20},spall_resistance:.6},rolled_homogeneous_armor:{name:"A√ßo Laminado Homog√™neo (RHA)",effectiveness_factor:1,weight_factor:1,cost_factor:1.4,weldability:.85,availability:.8,tech_requirement:{year:1942,level:50},spall_resistance:.8},face_hardened_armor:{name:"Blindagem Endurecida Superficialmente",effectiveness_factor:1.15,weight_factor:1.05,cost_factor:1.8,weldability:.7,availability:.6,tech_requirement:{year:1944,level:65},spall_resistance:.85},cast_armor:{name:"Blindagem Fundida",effectiveness_factor:.9,weight_factor:1.25,cost_factor:1.2,weldability:.6,availability:.7,tech_requirement:{year:1940,level:45},spall_resistance:.7,complex_shapes:!0},composite_experimental:{name:"Blindagem Composta Experimental",effectiveness_factor:1.35,weight_factor:1.15,cost_factor:3.5,weldability:.4,availability:.2,tech_requirement:{year:1953,level:85},spall_resistance:.95,experimental:!0,heat_resistance:1.5}},ae={sandbags:{name:"Sacos de Areia",type:"improvised",protection_bonus:15,weight:500,cost:200,coverage:["frontal","lateral"],max_thickness:300,tech_requirement:{year:1939,level:0},effectiveness_vs:{ap:.3,he:.7,heat:.2},durability:.4,weather_resistance:.2,description:"Prote√ß√£o barata e improvisada, absorve fragmentos"},concrete_blocks:{name:"Blocos de Concreto",type:"improvised",protection_bonus:25,weight:800,cost:300,coverage:["frontal"],max_thickness:400,tech_requirement:{year:1940,level:10},effectiveness_vs:{ap:.4,he:.8,heat:.3},durability:.6,weather_resistance:.9,description:"Prote√ß√£o s√≥lida mas extremamente pesada"},wood_logs:{name:"Toras de Madeira",type:"improvised",protection_bonus:8,weight:300,cost:50,coverage:["lateral","traseira"],max_thickness:200,tech_requirement:{year:1941,level:0},effectiveness_vs:{ap:.1,he:.5,heat:.3},durability:.3,fire_risk:.25,weather_resistance:.1,description:"Prote√ß√£o improvisada muito barata, risco de inc√™ndio"},spare_tracks:{name:"Esteiras Sobressalentes",type:"field_modification",protection_bonus:12,weight:200,cost:150,coverage:["frontal","lateral"],max_thickness:50,tech_requirement:{year:1942,level:20},effectiveness_vs:{ap:.6,he:.4,heat:.2},durability:.8,mobility_penalty:.02,description:"Prote√ß√£o usando pe√ßas sobressalentes, pr√°tica comum"},fuel_drums_empty:{name:"Tambores Vazios",type:"improvised",protection_bonus:5,weight:150,cost:100,coverage:["traseira","lateral"],max_thickness:200,tech_requirement:{year:1940,level:0},effectiveness_vs:{ap:.1,he:.3,heat:.2},durability:.2,description:"Prote√ß√£o m√≠nima, mais psicol√≥gica que real"},welded_plates_light:{name:"Placas Soldadas Leves",type:"welded_addition",protection_bonus:20,weight:400,cost:1800,coverage:["frontal","lateral"],max_thickness:25,tech_requirement:{year:1942,level:35},effectiveness_vs:{ap:.8,he:.7,heat:.6},durability:.9,weld_quality_factor:.85,description:"Placas de a√ßo leve soldadas, solu√ß√£o econ√¥mica"},welded_plates_medium:{name:"Placas Soldadas M√©dias",type:"welded_addition",protection_bonus:35,weight:600,cost:2800,coverage:["frontal","lateral"],max_thickness:40,tech_requirement:{year:1943,level:45},effectiveness_vs:{ap:.9,he:.8,heat:.7},durability:.9,weld_quality_factor:.9,description:"Placas de espessura m√©dia, bom equil√≠brio"},welded_plates_heavy:{name:"Placas Soldadas Pesadas",type:"welded_addition",protection_bonus:50,weight:900,cost:4200,coverage:["frontal"],max_thickness:80,tech_requirement:{year:1944,level:55},effectiveness_vs:{ap:.95,he:.85,heat:.8},durability:.95,weld_quality_factor:.95,mobility_penalty:.05,description:"Placas pesadas soldadas, m√°xima prote√ß√£o"},welded_additional_plates:{name:"Placas Adicionais Soldadas",type:"welded_armor",protection_bonus:35,weight:450,cost:800,coverage:["frontal","lateral"],max_thickness:60,tech_requirement:{year:1943,level:35},effectiveness_vs:{ap:.85,he:.9,heat:.8},durability:.8,availability:.8,description:"Placas de blindagem soldadas nas oficinas, prote√ß√£o adicional confi√°vel"},sherman_applique:{name:"Blindagem Aplique Sherman",type:"field_modification",protection_bonus:25,weight:500,cost:2e3,coverage:["frontal"],max_thickness:38,tech_requirement:{year:1944,level:40},effectiveness_vs:{ap:.85,he:.75,heat:.7},durability:.88,historical:!0,description:"Kit de blindagem adicional para M4 Sherman"},era_primitive:{name:"ERA Primitiva Experimental",type:"reactive_armor",protection_bonus:80,weight:300,cost:8e3,coverage:["frontal"],max_thickness:15,tech_requirement:{year:1954,level:85},effectiveness_vs:{ap:.6,he:.95,heat:1.2},durability:.7,experimental:!0,reliability:.75,maintenance_complexity:2,description:"Primeira gera√ß√£o de blindagem reativa explosiva",energy_consumption:1},era_advanced_prototype:{name:"ERA Avan√ßada (Prot√≥tipo)",type:"reactive_armor",protection_bonus:120,weight:250,cost:15e3,coverage:["frontal","lateral"],max_thickness:12,tech_requirement:{year:1954,level:95},effectiveness_vs:{ap:.8,he:1.1,heat:1.4},durability:.8,experimental:!0,prototype_only:!0,reliability:.65,maintenance_complexity:3,description:"Prot√≥tipo avan√ßado de ERA, tecnologia experimental",energy_consumption:2},cage_armor:{name:"Blindagem Gaiola",type:"standoff_armor",protection_bonus:8,weight:120,cost:800,coverage:["lateral","traseira"],max_thickness:200,tech_requirement:{year:1944,level:35},effectiveness_vs:{ap:.1,he:.4,heat:.9},durability:.6,mobility_penalty:.03,description:"Grades met√°licas contra granadas HEAT"},spaced_armor:{name:"Blindagem Espa√ßada",type:"spaced_armor",protection_bonus:30,weight:400,cost:2500,coverage:["frontal","lateral"],max_thickness:20,tech_requirement:{year:1943,level:50},effectiveness_vs:{ap:.7,he:.9,heat:1.1},durability:.8,air_gap:150,description:"Placas com espa√ßamento de ar, quebra proj√©teis HEAT"},schurzen:{name:"Sch√ºrzen (Saias Laterais)",type:"side_skirts",protection_bonus:15,weight:180,cost:600,coverage:["lateral"],max_thickness:5,tech_requirement:{year:1943,level:30},effectiveness_vs:{ap:.2,he:.8,heat:.6},durability:.5,historical:!0,description:"Saias laterais alem√£s, prote√ß√£o contra proj√©teis HE"},composite_ceramic:{name:"Comp√≥sito Cer√¢mico Experimental",type:"composite_armor",protection_bonus:90,weight:600,cost:12e3,coverage:["frontal"],max_thickness:60,tech_requirement:{year:1954,level:90},effectiveness_vs:{ap:1.3,he:1,heat:1.1},durability:.85,experimental:!0,prototype_only:!0,heat_resistance:1.5,description:"Blindagem comp√≥sita experimental com cer√¢mica"},laminated_armor:{name:"Blindagem Laminada Experimental",type:"laminated_armor",protection_bonus:70,weight:550,cost:9500,coverage:["frontal","lateral"],max_thickness:50,tech_requirement:{year:1953,level:80},effectiveness_vs:{ap:1.1,he:.95,heat:1},durability:.9,experimental:!0,spall_resistance:1.3,description:"M√∫ltiplas camadas de materiais diferentes"}},$={vertical_90:{name:"Vertical (90¬∞)",angle:90,effectiveness_multiplier:1,internal_space_factor:1,crew_capacity_penalty:0,weight_distribution:1,visibility_penalty:0,description:"Blindagem vertical tradicional"},sloped_75:{name:"Inclinada 75¬∞",angle:75,effectiveness_multiplier:1.1,internal_space_factor:.95,crew_capacity_penalty:0,weight_distribution:1.05,visibility_penalty:.05,description:"Inclina√ß√£o leve, bom equil√≠brio"},sloped_60:{name:"Inclinada 60¬∞",angle:60,effectiveness_multiplier:1.25,internal_space_factor:.9,crew_capacity_penalty:0,weight_distribution:1.1,visibility_penalty:.1,gun_depression_penalty:2,description:"Inclina√ß√£o moderada, boa prote√ß√£o"},sloped_45:{name:"Inclinada 45¬∞",angle:45,effectiveness_multiplier:1.41,internal_space_factor:.85,crew_capacity_penalty:0,weight_distribution:1.15,visibility_penalty:.15,gun_depression_penalty:4,description:"Inclina√ß√£o acentuada, excelente prote√ß√£o"},sloped_30:{name:"Extremamente Inclinada 30¬∞",angle:30,effectiveness_multiplier:2,internal_space_factor:.75,crew_capacity_penalty:1,weight_distribution:1.25,visibility_penalty:.25,gun_depression_penalty:8,ammo_capacity_penalty:.2,description:"Prote√ß√£o m√°xima, severas limita√ß√µes internas"},pike_nose:{name:"Nariz de L√∫cio",angle:55,effectiveness_multiplier:1.35,internal_space_factor:.8,crew_capacity_penalty:0,weight_distribution:1.2,visibility_penalty:.2,gun_depression_penalty:3,complex_manufacturing:!0,cost_multiplier:1.3,description:"Design angulado complexo, como IS-3"},mantlet_heavy:{name:"Mantlet Pesado",angle:85,effectiveness_multiplier:1.4,internal_space_factor:.9,crew_capacity_penalty:0,weight_distribution:1.3,visibility_penalty:.1,turret_only:!0,gun_handling_penalty:.1,description:"Mantlet blindado refor√ßado"}},Ne={gun_76mm_m1:{name:"Canh√£o 76mm M1 (L/52)",caliber:76,barrel_length:52,weight:1200,cost:15e3,penetration_100m:135,penetration_500m:120,penetration_1000m:105,accuracy:.85,rate_of_fire:8,ammunition_weight:6.8,recoil_force:28e3,tech_requirement:{year:1942,level:55},available_ammunition:["ap","apcr","he","smoke"]},gun_85mm_zis:{name:"Canh√£o 85mm ZiS-S-53 (L/54)",caliber:85,barrel_length:54,weight:1650,cost:18e3,penetration_100m:165,penetration_500m:145,penetration_1000m:125,accuracy:.82,rate_of_fire:6,ammunition_weight:9.2,recoil_force:35e3,tech_requirement:{year:1943,level:60},available_ammunition:["ap","aphe","he","smoke"]},gun_90mm_m3:{name:"Canh√£o 90mm M3 (L/53)",caliber:90,barrel_length:53,weight:1900,cost:22e3,penetration_100m:180,penetration_500m:160,penetration_1000m:140,accuracy:.88,rate_of_fire:7,ammunition_weight:10.5,recoil_force:42e3,tech_requirement:{year:1944,level:65},available_ammunition:["ap","apcr","hvap","he","smoke"]},gun_105mm_l7:{name:"Canh√£o 105mm L7 (L/51)",caliber:105,barrel_length:51,weight:2300,cost:35e3,penetration_100m:220,penetration_500m:195,penetration_1000m:170,accuracy:.9,rate_of_fire:5,ammunition_weight:18.6,recoil_force:58e3,tech_requirement:{year:1951,level:75},available_ammunition:["apds","heat","hesh","he","smoke"],advanced:!0},gun_122mm_d25:{name:"Canh√£o 122mm D-25T (L/43)",caliber:122,barrel_length:43,weight:2800,cost:28e3,penetration_100m:200,penetration_500m:175,penetration_1000m:150,accuracy:.75,rate_of_fire:3,ammunition_weight:25,recoil_force:75e3,tech_requirement:{year:1943,level:70},available_ammunition:["ap","aphe","he","smoke"],heavy_hitting:!0},gun_100mm_d10t:{name:"Canh√£o D-10T 100mm (L/56)",caliber:100,barrel_length:56,weight:2700,cost:26e3,penetration_100m:175,penetration_500m:155,penetration_1000m:135,accuracy:.87,rate_of_fire:8,ammunition_weight:15.6,recoil_force:48e3,tech_requirement:{year:1947,level:68},available_ammunition:["ap","aphe","apcr","he","hvap"]},gun_57mm_zis2:{name:"Canh√£o ZiS-2 57mm (L/73)",caliber:57,barrel_length:73,weight:1400,cost:16e3,penetration_100m:145,penetration_500m:125,penetration_1000m:110,accuracy:.92,rate_of_fire:15,ammunition_weight:2.8,recoil_force:24e3,tech_requirement:{year:1941,level:55},available_ammunition:["ap","apcr","he"],high_velocity:!0},gun_120mm_m58:{name:"Canh√£o M58 120mm (L/44)",caliber:120,barrel_length:44,weight:3200,cost:48e3,penetration_100m:240,penetration_500m:215,penetration_1000m:185,accuracy:.88,rate_of_fire:4,ammunition_weight:22.3,recoil_force:82e3,tech_requirement:{year:1954,level:80},available_ammunition:["apds","heat","hesh","he","smoke"],advanced:!0,experimental:!0},gun_84mm_20pdr:{name:"Canh√£o 20-pdr 84mm (L/66)",caliber:84,barrel_length:66,weight:2100,cost:3e4,penetration_100m:190,penetration_500m:170,penetration_1000m:145,accuracy:.9,rate_of_fire:6,ammunition_weight:9.1,recoil_force:45e3,tech_requirement:{year:1948,level:72},available_ammunition:["ap","apds","hesh","he","smoke"]}},ie={mg_7_62mm:{name:"Metralhadora 7.62mm",caliber:7.62,weight:65,cost:1800,ammunition_weight:.022,ammo_capacity:1500,rate_of_fire:650,effective_range:800,reliability:.9,tech_requirement:{year:1940,level:40},penetration_armor:8,mount_options:["coaxial","hull","pintle"],description:"Metralhadora padr√£o para uso coaxial e defesa de infantaria"},mg_7_92mm:{name:"Metralhadora 7.92mm",caliber:7.92,weight:70,cost:1950,ammunition_weight:.025,ammo_capacity:1200,rate_of_fire:700,effective_range:900,reliability:.88,tech_requirement:{year:1940,level:42},penetration_armor:10,mount_options:["coaxial","hull","pintle"],description:"Metralhadora de maior calibre, mais poder de parada"},mg_8mm:{name:"Metralhadora 8mm",caliber:8,weight:68,cost:1900,ammunition_weight:.024,ammo_capacity:1300,rate_of_fire:620,effective_range:850,reliability:.89,tech_requirement:{year:1941,level:41},penetration_armor:9,mount_options:["coaxial","hull","pintle"],description:"Metralhadora equilibrada entre poder e economia"},mg_12_7mm:{name:"Metralhadora Pesada 12.7mm",caliber:12.7,weight:85,cost:2800,ammunition_weight:.108,ammo_capacity:500,rate_of_fire:550,effective_range:1500,aa_capable:!0,reliability:.88,tech_requirement:{year:1942,level:45},penetration_armor:20,mount_options:["turret","hull","commander","aa_mount"],description:"Metralhadora antia√©rea, eficaz contra ve√≠culos leves"},mg_13mm:{name:"Metralhadora Pesada 13mm",caliber:13,weight:95,cost:3200,ammunition_weight:.125,ammo_capacity:450,rate_of_fire:500,effective_range:1600,aa_capable:!0,reliability:.86,tech_requirement:{year:1943,level:47},penetration_armor:24,mount_options:["turret","hull","aa_mount"],description:"Vers√£o mais potente, maior penetra√ß√£o"},mg_14_5mm:{name:"Metralhadora Pesada 14.5mm",caliber:14.5,weight:120,cost:3500,ammunition_weight:.155,ammo_capacity:400,rate_of_fire:450,effective_range:2e3,aa_capable:!0,reliability:.85,tech_requirement:{year:1944,level:50},penetration_armor:32,mount_options:["turret","hull","aa_mount"],description:"Metralhadora antitanque leve, muito eficaz contra blindagem leve"},mg_15mm:{name:"Metralhadora Pesada 15mm",caliber:15,weight:130,cost:3800,ammunition_weight:.17,ammo_capacity:350,rate_of_fire:400,effective_range:2200,aa_capable:!0,reliability:.83,tech_requirement:{year:1944,level:52},penetration_armor:38,mount_options:["turret","aa_mount"],description:"Quase um canh√£o autom√°tico, m√°xima pot√™ncia para metralhadora"},autocannon_20mm:{name:"Canh√£o Autom√°tico 20mm",caliber:20,weight:180,cost:5200,ammunition_weight:.12,ammo_capacity:300,rate_of_fire:350,effective_range:2500,aa_capable:!0,reliability:.82,tech_requirement:{year:1943,level:55},penetration_armor:45,mount_options:["turret","aa_mount"],ammunition_types:["AP","HE","HEI"],description:"Canh√£o autom√°tico vers√°til, excelente contra aeronaves e blindagem leve"},autocannon_20mm_rapid:{name:"Canh√£o Autom√°tico 20mm R√°pido",caliber:20,weight:200,cost:6200,ammunition_weight:.12,ammo_capacity:400,rate_of_fire:600,effective_range:2200,aa_capable:!0,reliability:.78,tech_requirement:{year:1944,level:58},penetration_armor:42,mount_options:["turret","aa_mount"],ammunition_types:["AP","HE","HEI"],description:"Vers√£o de alta cad√™ncia para defesa antia√©rea"},autocannon_23mm:{name:"Canh√£o Autom√°tico 23mm",caliber:23,weight:210,cost:5800,ammunition_weight:.15,ammo_capacity:280,rate_of_fire:320,effective_range:2800,aa_capable:!0,reliability:.8,tech_requirement:{year:1944,level:56},penetration_armor:52,mount_options:["turret","aa_mount"],ammunition_types:["AP","HE","HEI"],description:"Maior poder de fogo, eficaz contra blindagens m√©dias"},autocannon_25mm:{name:"Canh√£o Autom√°tico 25mm",caliber:25,weight:220,cost:6800,ammunition_weight:.18,ammo_capacity:250,rate_of_fire:280,effective_range:3e3,aa_capable:!0,reliability:.8,tech_requirement:{year:1945,level:60},penetration_armor:58,mount_options:["turret","aa_mount"],ammunition_types:["AP","HE","HEI","APCR"],description:"Canh√£o pesado, capaz de enfrentar tanques m√©dios"},autocannon_30mm:{name:"Canh√£o Autom√°tico 30mm",caliber:30,weight:280,cost:8500,ammunition_weight:.28,ammo_capacity:200,rate_of_fire:200,effective_range:3500,aa_capable:!0,reliability:.77,tech_requirement:{year:1945,level:65},penetration_armor:72,mount_options:["turret","aa_mount"],ammunition_types:["AP","HE","HEI","APCR"],description:"Canh√£o autom√°tico pesado, quase artilharia antitanque"},flamethrower:{name:"Lan√ßa-Chamas",caliber:0,weight:150,cost:4500,ammunition_weight:2.5,ammo_capacity:200,rate_of_fire:0,effective_range:150,aa_capable:!1,reliability:.85,tech_requirement:{year:1943,level:45},penetration_armor:0,mount_options:["hull","turret"],special_effects:["bunker_clearing","infantry_terror"],description:"Arma especializada contra fortifica√ß√µes e infantaria"},smoke_launcher:{name:"Lan√ßador de Fuma√ßa",caliber:76,weight:45,cost:800,ammunition_weight:1.2,ammo_capacity:8,rate_of_fire:0,effective_range:400,aa_capable:!1,reliability:.95,tech_requirement:{year:1942,level:35},penetration_armor:0,mount_options:["turret","hull"],special_effects:["smoke_screen","concealment"],description:"Sistema defensivo para criar cortinas de fuma√ßa"}},ne={cannon_20mm:{name:"Canh√£o AA 20mm",caliber:20,weight:180,cost:8500,rate_of_fire:800,effective_range:2e3,max_elevation:85,traverse_speed:50,ammunition_weight:.12,ammo_capacity:400,tech_requirement:{year:1943,level:50},penetration_armor:25,aa_effectiveness:.7,mount_options:["single","twin","quad"],description:"Canh√£o autom√°tico leve, alta cad√™ncia de tiro"},mg_23mm:{name:"Canh√£o AA 23mm",caliber:23,weight:280,cost:12e3,rate_of_fire:650,effective_range:2500,max_elevation:85,traverse_speed:45,ammunition_weight:.18,ammo_capacity:250,tech_requirement:{year:1945,level:55},penetration_armor:30,aa_effectiveness:.75,mount_options:["single","twin","quad"],description:"Canh√£o autom√°tico m√©dio, equilibrado"},cannon_25mm:{name:"Canh√£o AA 25mm",caliber:25,weight:320,cost:14e3,rate_of_fire:550,effective_range:2800,max_elevation:85,traverse_speed:42,ammunition_weight:.22,ammo_capacity:220,tech_requirement:{year:1944,level:52},penetration_armor:35,aa_effectiveness:.78,mount_options:["single","twin","triple"],description:"Canh√£o autom√°tico vers√°til, boa penetra√ß√£o"},cannon_30mm:{name:"Canh√£o AA 30mm",caliber:30,weight:420,cost:18e3,rate_of_fire:450,effective_range:3e3,max_elevation:85,traverse_speed:40,ammunition_weight:.35,ammo_capacity:200,tech_requirement:{year:1946,level:60},penetration_armor:45,aa_effectiveness:.85,mount_options:["single","twin"],description:"Canh√£o pesado, alto poder de parada"},cannon_37mm:{name:"Canh√£o AA 37mm",caliber:37,weight:580,cost:22e3,rate_of_fire:180,effective_range:3500,max_elevation:85,traverse_speed:35,ammunition_weight:.68,ammo_capacity:150,tech_requirement:{year:1943,level:58},penetration_armor:55,aa_effectiveness:.82,mount_options:["single","twin"],description:"Canh√£o de calibre m√©dio, boa precis√£o"},bofors_40mm:{name:"Canh√£o AA 40mm",caliber:40,weight:650,cost:25e3,rate_of_fire:120,effective_range:4e3,max_elevation:90,traverse_speed:35,ammunition_weight:.95,ammo_capacity:160,tech_requirement:{year:1943,level:65},penetration_armor:65,aa_effectiveness:.9,mount_options:["single","twin","quad"],description:"Canh√£o padr√£o NATO, excelente efic√°cia"},cannon_57mm:{name:"Canh√£o AA 57mm",caliber:57,weight:980,cost:35e3,rate_of_fire:90,effective_range:5e3,max_elevation:85,traverse_speed:28,ammunition_weight:2.8,ammo_capacity:100,tech_requirement:{year:1944,level:68},penetration_armor:85,aa_effectiveness:.88,dual_purpose:!0,mount_options:["single","twin"],description:"Canh√£o dual-purpose, eficaz contra terra e ar"},flak_88mm:{name:"Canh√£o AA 88mm",caliber:88,weight:1800,cost:45e3,rate_of_fire:15,effective_range:8e3,max_elevation:85,traverse_speed:20,ammunition_weight:9.5,ammo_capacity:80,tech_requirement:{year:1944,level:70},penetration_armor:180,aa_effectiveness:.95,dual_purpose:!0,mount_options:["single"],description:"Canh√£o pesado dual-purpose, lend√°ria efic√°cia"}},Te={optical_sight:{name:"Mira √ìptica B√°sica",type:"optical",weight:25,cost:800,tech_requirement:{year:1940,level:30},accuracy_bonus:.1,night_capable:!1,weather_penalty:.3,description:"Mira √≥ptica simples, opera√ß√£o manual"},mechanical_computer:{name:"Computador Mec√¢nico",type:"mechanical",weight:180,cost:5e3,tech_requirement:{year:1943,level:55},accuracy_bonus:.25,night_capable:!1,weather_penalty:.2,lead_calculation:!0,description:"Sistema mec√¢nico para c√°lculo de tiro avan√ßado"},radar_tracking:{name:"Radar de Rastreamento",type:"radar",weight:450,cost:15e3,tech_requirement:{year:1944,level:68},accuracy_bonus:.4,night_capable:!0,weather_penalty:.1,lead_calculation:!0,automatic_tracking:!0,detection_range:15e3,description:"Sistema de radar primitivo para rastreamento de alvos",energy_consumption:3},early_computer:{name:"Computador Eletr√¥nico Primitivo",type:"electronic",weight:280,cost:25e3,tech_requirement:{year:1945,level:75},accuracy_bonus:.5,night_capable:!0,weather_penalty:.05,lead_calculation:!0,automatic_tracking:!0,multiple_targets:2,description:"Sistema eletr√¥nico avan√ßado, m√∫ltiplos alvos"}},Pe={single:{name:"Montagem √önica",gun_count:1,weight_multiplier:1,cost_multiplier:1,ammo_multiplier:1,accuracy_bonus:.1,description:"Uma arma, m√°xima precis√£o"},twin:{name:"Montagem Dupla",gun_count:2,weight_multiplier:1.8,cost_multiplier:1.7,ammo_multiplier:2,accuracy_bonus:0,firepower_multiplier:1.9,description:"Duas armas, bom equil√≠brio"},triple:{name:"Montagem Tripla",gun_count:3,weight_multiplier:2.6,cost_multiplier:2.4,ammo_multiplier:3,accuracy_penalty:-.1,firepower_multiplier:2.7,description:"Tr√™s armas, alto poder de fogo"},quad:{name:"Montagem Qu√°drupla",gun_count:4,weight_multiplier:3.2,cost_multiplier:3,ammo_multiplier:4,accuracy_penalty:-.2,firepower_multiplier:3.4,description:"Quatro armas, m√°ximo poder de fogo"}},se={basic_periscope:{name:"Perisc√≥pio B√°sico",weight:15,cost:800,magnification:"1x",field_of_view:60,accuracy_bonus:0,range_estimation:0,tech_requirement:{year:1935,level:25},night_vision:!1,reliability:.95,energy_consumption:1},telescopic_sight:{name:"Mira Telesc√≥pica 4x",weight:35,cost:2500,magnification:"4x",field_of_view:15,accuracy_bonus:.15,range_estimation:.1,tech_requirement:{year:1940,level:40},night_vision:!1,reliability:.9,energy_consumption:1},coincidence_rangefinder:{name:"Tel√™metro de Coincid√™ncia",weight:85,cost:8e3,magnification:"8x",field_of_view:8,accuracy_bonus:.25,range_estimation:.3,max_range:3e3,tech_requirement:{year:1942,level:55},night_vision:!1,reliability:.85,requires_training:!0,energy_consumption:1},stereoscopic_rangefinder:{name:"Tel√™metro Estereosc√≥pico",weight:120,cost:15e3,magnification:"10x",field_of_view:6,accuracy_bonus:.3,range_estimation:.45,max_range:4e3,tech_requirement:{year:1945,level:65},night_vision:!1,reliability:.82,requires_training:!0,energy_consumption:1},infrared_sight_basic:{name:"Mira Infravermelha B√°sica",weight:150,cost:25e3,magnification:"3x",field_of_view:20,accuracy_bonus:.1,range_estimation:.05,effective_range:800,tech_requirement:{year:1943,level:70},night_vision:!0,reliability:.75,power_consumption:800,operational_time:4,energy_consumption:4},infrared_sight_advanced:{name:"Sistema IV Avan√ßado",weight:200,cost:45e3,magnification:"6x",field_of_view:12,accuracy_bonus:.2,range_estimation:.15,effective_range:1200,tech_requirement:{year:1950,level:80},night_vision:!0,reliability:.78,power_consumption:1200,operational_time:6,experimental:!0,energy_consumption:4}},oe={signal_flags:{name:"Bandeiras de Sinaliza√ß√£o",weight:5,cost:100,range:2,reliability:.95,weather_resistance:.3,tech_requirement:{year:1900,level:10},requires_training:!1,energy_consumption:0},radio_basic:{name:"R√°dio B√°sico",weight:25,cost:2500,range:5,reliability:.8,weather_resistance:.7,tech_requirement:{year:1940,level:35},power_consumption:50,frequency_bands:1,energy_consumption:3},radio_advanced:{name:"R√°dio Avan√ßado",weight:35,cost:5e3,range:15,reliability:.85,weather_resistance:.8,tech_requirement:{year:1944,level:50},power_consumption:80,frequency_bands:3,encryption_capable:!1,energy_consumption:6},radio_fm:{name:"R√°dio FM Militar",weight:45,cost:8500,range:25,reliability:.9,weather_resistance:.9,tech_requirement:{year:1948,level:65},power_consumption:120,frequency_bands:10,encryption_capable:!0,energy_consumption:7},radio_command:{name:"Esta√ß√£o de Comando",weight:80,cost:15e3,range:50,reliability:.87,weather_resistance:.85,tech_requirement:{year:1945,level:60},power_consumption:200,frequency_bands:5,encryption_capable:!0,command_bonus:2,special:"artillery_coordination",energy_consumption:8}},re={spall_liner:{name:"Revestimento Anti-Fragmentos",weight:200,cost:8e3,crew_survival_bonus:.25,internal_damage_reduction:.2,tech_requirement:{year:1943,level:50},installation_complexity:.6,space_required:.3,energy_consumption:1},wet_ammunition_storage:{name:"Armazenamento √ömido de Muni√ß√£o",weight:150,cost:6e3,explosion_resistance:.4,ammo_capacity_reduction:.15,fire_suppression_bonus:.5,tech_requirement:{year:1944,level:55},maintenance_complexity:.3,energy_consumption:1},fire_suppression_system:{name:"Sistema Supress√£o Autom√°tica",weight:80,cost:12e3,fire_suppression_bonus:.75,power_consumption:100,activation_time:2,tech_requirement:{year:1950,level:70},reliability:.88,refill_cost:500,energy_consumption:1},escape_hatches:{name:"Escotilhas de Emerg√™ncia",weight:120,cost:3e3,crew_survival_bonus:.15,escape_time_reduction:.4,armor_integrity_reduction:.05,tech_requirement:{year:1940,level:30},energy_consumption:1},commanders_cupola:{name:"C√∫pula do Comandante",weight:180,cost:5500,visibility_bonus:.3,command_efficiency:.2,armor_thickness:25,rotating:!0,tech_requirement:{year:1942,level:45},vulnerability_increase:.1,energy_consumption:1},periscope_array:{name:"Array de Perisc√≥pios",weight:45,cost:3200,visibility_bonus:.15,blind_spot_reduction:.25,tech_requirement:{year:1940,level:40},fragility_factor:1.3,energy_consumption:1},searchlight_infrared:{name:"Holofote Infravermelho",weight:60,cost:8e3,night_combat_bonus:.35,detection_range:600,power_consumption:500,tech_requirement:{year:1945,level:65},gives_away_position:!0,energy_consumption:6},extra_fuel_tanks_external:{name:"Tanques Externos de Combust√≠vel",weight:300,cost:3e3,range_bonus:.5,fire_vulnerability:.25,jettison_capable:!0,armor_reduction_sides:.1,tech_requirement:{year:1940,level:25},energy_consumption:1},extra_fuel_tanks_internal:{name:"Tanques Internos Extras",weight:400,cost:4500,range_bonus:.35,fire_vulnerability:.1,internal_space_reduction:.15,tech_requirement:{year:1942,level:35},energy_consumption:1},deep_wading_kit:{name:"Kit Vadeamento Profundo",weight:250,cost:6e3,water_crossing_depth:4,installation_time:2,speed_reduction_water:.6,tech_requirement:{year:1943,level:50},available_to:["NATO","Warsaw"],energy_consumption:1},mine_roller:{name:"Rolos Detectores de Mina",weight:800,cost:8500,mine_clearance_capability:!0,speed_reduction:.3,ground_pressure_increase:.25,detachable:!0,tech_requirement:{year:1942,level:45},energy_consumption:1},dozer_blade:{name:"L√¢mina Bulldozer",weight:600,cost:7500,earthwork_capability:!0,obstacle_clearing:!0,speed_reduction:.2,frontal_protection_bonus:.15,tech_requirement:{year:1944,level:40},energy_consumption:1},camouflage_nets:{name:"Redes de Camuflagem",weight:50,cost:800,concealment_bonus:.2,setup_time:15,air_detection_reduction:.25,tech_requirement:{year:1940,level:20},weather_degradation:!0,energy_consumption:1},smoke_dispensers:{name:"Lan√ßa-fum√≠genos",weight:80,cost:5e3,smoke_deployment_range:50,concealment_duration:3,reload_time:30,tech_requirement:{year:1943,level:40},ammo_capacity:12,energy_consumption:1},exhaust_smoke_system:{name:"Sistema Fum√≠geno por Escape",weight:35,cost:3500,continuous_smoke:!0,fuel_consumption_increase:.15,engine_performance_reduction:.08,tech_requirement:{year:1941,level:35},available_to:["Warsaw"],energy_consumption:1},radio_jammer:{name:"Jammer de R√°dio",weight:120,cost:18e3,enemy_communication_disruption:.6,jamming_range:10,power_consumption:300,tech_requirement:{year:1952,level:80},experimental:!0,energy_consumption:9},radar_detector:{name:"Detector de Radar",weight:45,cost:15e3,radar_warning:!0,detection_range:25,power_consumption:80,tech_requirement:{year:1954,level:85},experimental:!0,energy_consumption:12},improved_ventilation:{name:"Ventila√ß√£o Melhorada",weight:90,cost:2500,crew_endurance_bonus:.15,nbc_protection_bonus:.2,power_consumption:150,tech_requirement:{year:1948,level:45},energy_consumption:1},crew_heater:{name:"Aquecedor da Tripula√ß√£o",weight:35,cost:1800,cold_weather_performance:.25,crew_comfort_bonus:.2,power_consumption:200,fuel_consumption_increase:.05,tech_requirement:{year:1942,level:30},energy_consumption:1},improved_seats:{name:"Assentos Ergon√¥micos",weight:60,cost:2200,crew_fatigue_reduction:.18,accuracy_bonus_long_missions:.08,tech_requirement:{year:1945,level:35},available_to:["NATO"],energy_consumption:1},field_repair_kit:{name:"Kit Reparos de Campo",weight:150,cost:4500,field_repair_capability:.3,maintenance_time_reduction:.2,consumable_cost_per_use:200,tech_requirement:{year:1940,level:40},energy_consumption:1},spare_parts_storage:{name:"Compartimento Pe√ßas Sobressalente",weight:200,cost:3e3,reliability_bonus:.12,maintenance_interval_extension:.15,internal_space_reduction:.1,tech_requirement:{year:1941,level:35},energy_consumption:1},diagnostic_equipment:{name:"Equipamento Diagn√≥stico",weight:80,cost:12e3,fault_detection_speed:.5,preventive_maintenance_bonus:.25,power_consumption:100,tech_requirement:{year:1950,level:75},requires_training:!0,energy_consumption:1}},ce={basic_optical:{name:"Mira √ìptica B√°sica",weight:25,cost:2e3,type:"optical",accuracy_bonus:0,range_bonus:0,night_fighting:.1,tech_requirement:{year:1940,level:30},energy_consumption:0},coincidence_rangefinder:{name:"Tel√™metro de Coincid√™ncia",weight:85,cost:8e3,type:"optical",accuracy_bonus:.15,range_bonus:.2,night_fighting:.1,tech_requirement:{year:1944,level:55},energy_consumption:1},stereoscopic_rangefinder:{name:"Tel√™metro Estereosc√≥pico",weight:120,cost:15e3,type:"optical",accuracy_bonus:.25,range_bonus:.35,night_fighting:.15,tech_requirement:{year:1948,level:65},available_to:["NATO","neutral"],energy_consumption:2},early_ballistic_computer:{name:"Computador Bal√≠stico Primitivo",weight:200,cost:45e3,type:"electronic",accuracy_bonus:.35,range_bonus:.5,night_fighting:.2,first_hit_probability:.4,tech_requirement:{year:1952,level:80},experimental:!0,power_consumption:500}},Oe={mbt_standard:{name:"Tanque de Batalha Padr√£o",role:"main_battle_tank",priority_components:{main_gun:{min_penetration:160,weight_factor:.25},armor:{min_effectiveness:120,weight_factor:.3},mobility:{min_power_to_weight:12,weight_factor:.2},reliability:{min_reliability:.8,weight_factor:.25}},recommended_equipment:["spall_liner","wet_ammunition_storage","commanders_cupola"],crew_size:4,doctrine_variants:{NATO:{accuracy_focus:!0,advanced_optics:!0},Warsaw:{armor_focus:!0,simplified_systems:!0},neutral:{balanced_approach:!0,cost_effective:!0}}},mbt_heavy:{name:"Tanque Pesado de Batalha",role:"heavy_battle_tank",priority_components:{main_gun:{min_penetration:200,weight_factor:.3},armor:{min_effectiveness:180,weight_factor:.4},mobility:{min_power_to_weight:8,weight_factor:.15},reliability:{min_reliability:.75,weight_factor:.15}},recommended_equipment:["spall_liner","fire_suppression_system","extra_fuel_tanks_internal"],crew_size:5,weight_class:"heavy"},tank_destroyer_mobile:{name:"Ca√ßa-Tanques M√≥vel",role:"tank_destroyer",priority_components:{main_gun:{min_penetration:180,weight_factor:.35},mobility:{min_power_to_weight:15,weight_factor:.3},concealment:{stealth_focus:!0,weight_factor:.2},reliability:{min_reliability:.85,weight_factor:.15}},recommended_equipment:["camouflage_nets","smoke_dispensers","improved_optics"],crew_size:4,armor_philosophy:"minimal_frontal_only"},tank_destroyer_assault:{name:"Ca√ßa-Tanques de Assalto",role:"assault_tank_destroyer",priority_components:{main_gun:{min_penetration:220,weight_factor:.3},armor:{min_effectiveness:150,weight_factor:.35},mobility:{min_power_to_weight:10,weight_factor:.2},reliability:{min_reliability:.78,weight_factor:.15}},recommended_equipment:["spall_liner","extra_ammunition","dozer_blade"],crew_size:4,armor_philosophy:"heavy_frontal_casemate"},spaa_light:{name:"Antia√©rea Autopropulsada Leve",role:"self_propelled_anti_aircraft",priority_components:{main_gun:{aa_capability:!0,weight_factor:.3},mobility:{min_power_to_weight:18,weight_factor:.35},detection:{radar_capable:!0,weight_factor:.2},reliability:{min_reliability:.85,weight_factor:.15}},recommended_equipment:["radio_advanced","radar_detector","quad_maxim"],crew_size:3,armor_philosophy:"light_protection_only",special_requirements:["open_turret","high_elevation_gun"]},apc_standard:{name:"Transporte Blindado de Pessoal",role:"armored_personnel_carrier",priority_components:{mobility:{min_power_to_weight:15,weight_factor:.3},troop_capacity:{min_troops:8,weight_factor:.25},protection:{min_armor:25,weight_factor:.25},reliability:{min_reliability:.88,weight_factor:.2}},recommended_equipment:["improved_ventilation","radio_basic","periscope_array"],crew_size:3,troop_capacity:10,armor_philosophy:"all_around_light_protection"},recovery_vehicle:{name:"Ve√≠culo de Recupera√ß√£o",role:"armored_recovery_vehicle",priority_components:{mobility:{min_power_to_weight:12,weight_factor:.25},reliability:{min_reliability:.9,weight_factor:.3},utility:{recovery_capability:!0,weight_factor:.35},protection:{min_armor:40,weight_factor:.1}},recommended_equipment:["field_repair_kit","spare_parts_storage","diagnostic_equipment"],crew_size:4,special_requirements:["winch_system","crane_capability","welding_equipment"],armor_philosophy:"basic_protection"},self_propelled_artillery:{name:"Artilharia Autopropulsada",role:"self_propelled_artillery",priority_components:{main_gun:{indirect_fire:!0,weight_factor:.35},mobility:{min_power_to_weight:10,weight_factor:.25},communication:{long_range_radio:!0,weight_factor:.25},reliability:{min_reliability:.82,weight_factor:.15}},recommended_equipment:["radio_command","extra_fuel_tanks_internal","camouflage_nets"],crew_size:5,armor_philosophy:"minimal_protection",special_requirements:["high_elevation_gun","large_ammunition_storage"]},command_vehicle:{name:"Ve√≠culo de Comando",role:"command_vehicle",priority_components:{communication:{advanced_radio:!0,weight_factor:.4},mobility:{min_power_to_weight:14,weight_factor:.25},protection:{min_armor:60,weight_factor:.2},reliability:{min_reliability:.88,weight_factor:.15}},recommended_equipment:["radio_command","improved_ventilation","commanders_cupola","periscope_array"],crew_size:6,special_requirements:["multiple_radios","map_table","extended_range_antennas"],armor_philosophy:"medium_protection"},engineer_vehicle:{name:"Ve√≠culo de Engenharia",role:"engineer_vehicle",priority_components:{utility:{engineering_capability:!0,weight_factor:.35},mobility:{min_power_to_weight:12,weight_factor:.3},protection:{min_armor:50,weight_factor:.2},reliability:{min_reliability:.85,weight_factor:.15}},recommended_equipment:["dozer_blade","mine_roller","field_repair_kit","deep_wading_kit"],crew_size:4,special_requirements:["engineering_tools","obstacle_clearing"],armor_philosophy:"frontal_protection_focus"},flamethrower_tank:{name:"Tanque Lan√ßa-Chamas",role:"flamethrower_tank",priority_components:{special_weapon:{flamethrower:!0,weight_factor:.35},protection:{min_armor:80,weight_factor:.3},mobility:{min_power_to_weight:11,weight_factor:.2},reliability:{min_reliability:.8,weight_factor:.15}},recommended_equipment:["fire_suppression_system","spall_liner","escape_hatches"],crew_size:4,special_requirements:["flame_fuel_tank","protective_equipment"],armor_philosophy:"heavy_all_around",high_risk_role:!0}};let le=null,m={name:"",type:null,chassis:null,engine:null,transmission:null,suspension:null,armorMaterial:"rolled_homogeneous_armor",armorThickness:0,crewSize:3,trainingLevel:"standard",armor_material:null,armor_thickness:80,additional_armor:[],armorAngle:"vertical_90",main_gun_caliber:75,main_gun_length_ratio:40,ammo_view:"AP",secondary_weapons:[],aa_gun:null,ammunition:{},optics:null,communication:null,fcs:null,special_equipment:[],crew_positions:[],crew_training:"regular",crew_specialization:"none",crew_ergonomics:"basic",quantity:1};const E={chassis:O,engines:L,transmissions:D,suspensions:te,armor_materials:z,additional_armor:ae,armor_angles:$,main_guns:Ne,secondary_weapons:ie,aa_guns:ne,aa_fire_control:Te,aa_mount_configs:Pe,optics_systems:se,communication:oe,special_equipment:re,fire_control:ce,vehicle_templates:Oe};async function de(){try{const{getFirestore:o}=await R(async()=>{const{getFirestore:a}=await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js");return{getFirestore:a}},[]),{getApps:e,getApp:t}=await R(async()=>{const{getApps:a,getApp:s}=await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js");return{getApps:a,getApp:s}},[]),i=e().length?t():null;i&&(le=o(i),await $e())}catch(o){console.error("Error initializing Firebase:",o),pe()}}async function $e(){try{const{collection:o,getDocs:e}=await R(async()=>{const{collection:a,getDocs:s}=await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js");return{collection:a,getDocs:s}},[]),t=await e(o(le,"paises")),i={};t.forEach(a=>{const s=a.data(),n=Ae(a.id);i[a.id]={name:a.id,industry:s.Industria||50,vehicles:s.Veiculos||50,steel_production:s.CapacidadeProducaoAco||0,vehicle_production:s.CapacidadeProducaoVeiculos||0,budget:s.Orcamento||0,doctrine:n,tech_level:Le(s),year:1954,available_materials:ke(n,s),research_points:s.PontosP||0}}),window.gameCountries=i,ue()}catch(o){console.error("Error loading countries:",o),pe()}}function Ae(o){const e=["EUA","Reino Unido","Fran√ßa","Alemanha Ocidental","Canad√°","It√°lia","Holanda","B√©lgica"],t=["URSS","Alemanha Oriental","Pol√¥nia","Checoslov√°quia","Hungria","Rom√™nia","Bulg√°ria","China"];return e.includes(o)?"NATO":t.includes(o)?"Warsaw":"neutral"}function Le(o){const e=o.Tecnologia||50,t=(o.Veiculos||50)*.3,i=(o.Industria||50)*.2;return Math.min(100,e+t+i)}function ke(o,e){const t=["mild_steel","rolled_homogeneous_armor"],i=e.Industria||50,a=e.Tecnologia||50;return i>=70&&a>=60&&t.push("face_hardened_armor"),o==="NATO"&&a>=75&&t.push("composite_experimental"),t}function h(o,e){if(!o||!e||!E[o])return null;const t=E[o][e];if(!t)return null;if(!t.base||!t.tuning)return{...t};const i=window.currentVehicle.chassis;if(!i)return{...t.base,name:t.name};const s=E.chassis[i]?.weight_class||"medium",n=t.tuning[s];let r={...t.base};if(r.name=t.name,n)for(const[c,l]of Object.entries(n))c==="name_suffix"?r.name+=l:typeof r[c]=="number"?r[c]+=l:r[c]=l;return r}function j(o,e){const t=E[o]?.[e];if(!t)return{compatible:!1,reason:"Componente n√£o encontrado"};const i=h(o,e);if(!i)return{compatible:!1,reason:"Falha ao resolver componente"};const a=me();if(!a)return{compatible:!0};const s=t.tech_requirement||i.tech_requirement;if(s&&a.tech_level<s.level)return{compatible:!1,reason:`Tecnologia insuficiente. Necess√°rio: ${s.level}%`};if(s&&a.year<s.year)return{compatible:!1,reason:`N√£o dispon√≠vel em ${a.year}`};if((t.experimental||i.experimental)&&a.research_points<100)return{compatible:!1,reason:"Requer 100+ pontos de P&D"};if(!m.chassis)return{compatible:!0};const n=E.chassis[m.chassis];if(!n)return{compatible:!0};if(o==="engines"){if(n.compatible_engines&&!n.compatible_engines.includes(t.category))return{compatible:!1,reason:`Chassi n√£o suporta motores da categoria '${t.category}'`};if(n.max_engine_power&&i.power>n.max_engine_power)return{compatible:!1,reason:`Pot√™ncia excede o limite de ${n.max_engine_power}hp`};if(n.min_engine_power&&i.power<n.min_engine_power)return{compatible:!1,reason:`Pot√™ncia abaixo do m√≠nimo de ${n.min_engine_power}hp`}}return o==="transmissions"&&n.compatible_transmissions&&!n.compatible_transmissions.includes(i.type)?{compatible:!1,reason:`Chassi n√£o suporta transmiss√£o do tipo '${i.type}'`}:o==="suspensions"&&n.compatible_suspensions&&!n.compatible_suspensions.includes(e)?{compatible:!1,reason:"Suspens√£o n√£o compat√≠vel com este chassi"}:o==="secondary_weapons"&&n.compatible_secondary_weapons&&!n.compatible_secondary_weapons.includes(e)?{compatible:!1,reason:"Arma secund√°ria n√£o compat√≠vel"}:{compatible:!0}}function K(){if(!m.chassis||!m.engine)return{error:"Chassi e motor s√£o obrigat√≥rios"};const o=h("chassis",m.chassis),e=h("engines",m.engine),t=h("transmissions",m.transmission),i=h("main_guns",m.mainGun);let a=o.base_weight+e.weight;if(t&&(a+=t.weight),i&&(a+=i.weight),m.armorThickness&&m.armorMaterial){const M=h("armor_materials",m.armorMaterial);if(M){const N=o.weight_class==="light"?25:o.weight_class==="medium"?35:50,F=m.armorThickness*.001*N*7850*M.weight_factor;a+=F}}let s=m.crewSize||3;const n=h("armor_angles",m.armorAngle||"vertical_90");n?.crew_capacity_penalty&&(s=Math.max(1,s-n.crew_capacity_penalty));const r=s*80;a+=r;const c=m.special_equipment||[];Array.isArray(c)&&c.forEach(M=>{const N=h("special_equipment",M);N&&(a+=N.weight)});const l=a>o.max_weight_capacity,d=(a-o.max_weight_capacity)/o.max_weight_capacity*100,u=e.power/(a/1e3),p=t?t.efficiency:.85,f=o.base_speed,g=Math.min(1.5,u/15),y=a>o.max_weight_capacity*.8?.85:1,_={road:Math.round(f*g*p*y*o.terrain_mult.road),offroad:Math.round(f*g*p*y*o.terrain_mult.offroad),mud:Math.round(f*g*p*y*o.terrain_mult.mud),snow:Math.round(f*g*p*y*o.terrain_mult.snow)},b=e.consumption,v=o.fuel_consumption_base,T=a>o.base_weight*1.5?1.3:1,S=b*v*T;let x=0;if(m.armorThickness&&m.armorMaterial){const M=h("armor_materials",m.armorMaterial),N=h("armor_angles",m.armorAngle||"vertical_90"),F=m.additionalArmor||[];if(M){let q=m.armorThickness;q*=M.effectiveness_factor||1,N?.effectiveness_multiplier&&(q*=N.effectiveness_multiplier),F.forEach(ye=>{const W=h("additional_armor",ye);W?.protection_bonus&&(q+=W.protection_bonus*(W.effectiveness_vs?.ap||1))}),x=Math.round(q)}}let C=(e.reliability+o.reliability)/2;t&&(C=(C*2+t.reliability)/3);const he={rookie:-.15,standard:0,veteran:.1,elite:.2}[m.trainingLevel]||0;C+=he,l&&(C*=.9),e.experimental&&(C*=.85),m.special_equipment?.length>3&&(C*=.95);const we=Math.round(Math.min(100,Math.max(0,C*100)));return{totalWeight:Math.round(a),powerToWeight:Math.round(u*10)/10,topSpeed:_,fuelConsumption:Math.round(S*10)/10,armorProtection:x,reliability:we,crewSize:s,effectiveCrewSize:s,trainingLevel:m.trainingLevel||"standard",overweight:l,overweightPercent:l?Math.round(d):0,armorAnglePenalties:n?{crewPenalty:n.crew_capacity_penalty||0,gunDepressionPenalty:n.gun_depression_penalty||0}:null,warnings:qe(a,o,e,u,n)}}function qe(o,e,t,i,a){const s=[];return o>e.max_weight_capacity&&s.push({level:"error",message:`Ve√≠culo ${Math.round((o-e.max_weight_capacity)/e.max_weight_capacity*100)}% acima do limite de peso do chassi`}),i<10&&s.push({level:"warning",message:"Rela√ß√£o pot√™ncia/peso baixa. Ve√≠culo ser√° lento e com dificuldades em terrenos dif√≠ceis"}),i>25&&s.push({level:"warning",message:"Rela√ß√£o pot√™ncia/peso muito alta. Pode causar problemas de controle e confiabilidade"}),t.experimental&&s.push({level:"info",message:"Motor experimental: maior pot√™ncia, mas menor confiabilidade e custos de manuten√ß√£o elevados"}),t.fuel_type==="kerosene"&&s.push({level:"warning",message:"Combust√≠vel especial (querosene): log√≠stica complexa e consumo elevado"}),a&&(a.crew_capacity_penalty>0&&s.push({level:"warning",message:`Blindagem extremamente inclinada reduz tripula√ß√£o em ${a.crew_capacity_penalty} membros`}),a.gun_depression_penalty>5&&s.push({level:"warning",message:`√Çngulo da blindagem limita depress√£o do canh√£o em ${a.gun_depression_penalty}¬∞`})),s}function Q(){let o=0,e=0,t=0;const i=me();if(!i)return{error:"Pa√≠s n√£o identificado"};if(m.chassis){const _=h("chassis",m.chassis);o+=_.base_cost,e+=_.base_cost*.001*_.maintenance_complexity}if(m.engine){const _=h("engines",m.engine);o+=_.cost,e+=_.maintenance_hours*50;const b=_.fuel_type==="kerosene"?2.5:_.fuel_type==="diesel"?1.2:1;t+=_.consumption*1e3*b}if(m.transmission){const _=h("transmissions",m.transmission);o+=_.cost,e+=_.cost*8e-4*_.maintenance_complexity}if(m.mainGun){const _=h("main_guns",m.mainGun);o+=_.cost,e+=25}if(m.armorThickness&&m.armorMaterial){const _=h("armor_materials",m.armorMaterial),b=h("chassis",m.chassis);if(_&&b){const v=b.weight_class==="light"?25:b.weight_class==="medium"?35:50,S=m.armorThickness*.001*v*7850*2*_.cost_factor;o+=S}}const a={rookie:5e3,standard:8e3,veteran:15e3,elite:25e3},s=m.crewSize||3,n=m.trainingLevel||"standard",r=a[n]*s;o+=r;const c=m.special_equipment||[];if(Array.isArray(c)&&c.forEach(_=>{const b=h("special_equipment",_);b&&(o+=b.cost,b.power_consumption&&(t+=b.power_consumption*.15*8760))}),m.fcs){const _=h("fire_control",m.fcs);_&&(o+=_.cost,_.power_consumption&&(t+=_.power_consumption*.15*8760))}const d={NATO:1.25,Warsaw:.85,neutral:1.1}[i.doctrine]||1;o*=d;let u=0;[m.engine,m.mainGun,m.fcs].forEach(_=>{if(_){const b=h(Object.keys(E).find(v=>E[v][_]),_);b&&b.experimental&&(u+=o*.15)}});const p=o+u,f=p*m.quantity;Ve();const g=i.vehicle_production||1e5,y=Math.max(1,Math.ceil(f/g*12));return{unitCost:Math.round(p),totalCost:Math.round(f),maintenanceCostPerHour:Math.round(e),annualOperatingCost:Math.round(t),researchCost:Math.round(u),crewTrainingCost:Math.round(r),productionTimeMonths:y,affordability:f<=i.budget?"affordable":"expensive",budgetPercentage:Math.round(f/i.budget*100)}}function Ve(){let o=1;if(m.engine){const e=h("engines",m.engine);e.experimental&&(o+=.5),e.fuel_type==="kerosene"&&(o+=.3)}if(m.transmission){const e=h("transmissions",m.transmission);o+=e.maintenance_complexity*.2}return o}function me(){const o=localStorage.getItem("loggedCountry")||localStorage.getItem("currentCountry")||localStorage.getItem("selectedCountry")||localStorage.getItem("playerCountry");return o&&window.gameCountries&&window.gameCountries[o]?window.gameCountries[o]:{name:"Default Country",doctrine:"NATO",budget:1e9,vehicle_production:5e4}}function Ie(){console.log("Setting up advanced UI...")}function ue(){console.log("Countries loaded:",Object.keys(window.gameCountries||{}))}function pe(){window.gameCountries={EUA:{name:"EUA",doctrine:"NATO",tech_level:85,budget:1e9},URSS:{name:"URSS",doctrine:"Warsaw",tech_level:80,budget:8e8},Brasil:{name:"Brasil",doctrine:"neutral",tech_level:45,budget:5e7}},ue()}document.addEventListener("DOMContentLoaded",function(){console.log("Initializing Advanced Vehicle Creator..."),de(),Ie()});function w(){console.log("üîÑ Iniciando atualiza√ß√£o completa dos c√°lculos..."),console.log("üîç Estado atual do currentVehicle:",m);try{if(window.currentVehicle){const o=new Set(Array.isArray(window.currentVehicle.additionalArmor)?window.currentVehicle.additionalArmor:[]),e=new Set(Array.isArray(window.currentVehicle.additional_armor)?window.currentVehicle.additional_armor:[]),t=Array.from(new Set([...o,...e]));window.currentVehicle.additionalArmor=t,window.currentVehicle.additional_armor=t}}catch(o){console.error("‚ùå Erro na sincroniza√ß√£o de blindagem adicional:",o)}if(!m?.chassis){console.log("‚ö†Ô∏è Nenhum chassi selecionado - atualiza√ß√µes limitadas");try{I(),H(),A(),console.log("‚úÖ Atualiza√ß√µes b√°sicas conclu√≠das sem chassi")}catch(o){console.error("‚ùå Erro nas atualiza√ß√µes b√°sicas:",o)}return}try{console.log("üîß Iniciando c√°lculo de f√≠sica...");const o=K();if(console.log("üîß F√≠sica calculada:",o),o.error){console.error("‚ùå Erro na f√≠sica:",o.error);return}console.log("üí∞ Iniciando c√°lculo de custos...");const e=window.CostSystem?window.CostSystem.calculateCosts(m):Q();console.log("üí∞ Custos calculados:",e),e.error&&console.error("‚ùå Erro nos custos:",e.error),console.log("üì± Atualizando displays..."),He(o,e),console.log("‚ö° Atualizando energia..."),I(),console.log("üèÉ Atualizando performance..."),H(),console.log("üí∞ Atualizando custos..."),A(),console.log("üìä Atualizando gr√°fico..."),window.updatePerformanceChart&&window.updatePerformanceChart(o),console.log("‚úÖ Todos os c√°lculos foram atualizados com sucesso")}catch(o){console.error("‚ùå Erro ao atualizar c√°lculos do ve√≠culo:",o),console.error("‚ùå Stack trace:",o.stack)}}function He(o,e){const t=document.getElementById("total-weight");t&&o.totalWeight&&(t.textContent=o.totalWeight+"kg");const i=document.getElementById("armor-protection");i&&o.armorProtection&&(i.innerHTML=`<span class="text-brand-400">${o.armorProtection}mm efetivos</span>`);const a=document.getElementById("crew-size");if(a&&o.effectiveCrewSize){const n=o.effectiveCrewSize<(m.crewSize||3)?`${o.effectiveCrewSize}/${m.crewSize||3} (reduzida)`:o.effectiveCrewSize.toString();a.textContent=n}const s=document.getElementById("power-to-weight");s&&o.powerToWeight&&(s.textContent=o.powerToWeight+" hp/ton")}window.initFirebase=de;window.VEHICLE_COMPONENTS=E;window.currentVehicle=m;window.checkComponentCompatibility=j;window.calculateVehiclePhysics=K;window.calculateVehicleCosts=Q;window.updateVehicleCalculations=w;window.getResolvedComponent=h;document.addEventListener("DOMContentLoaded",function(){setTimeout(()=>{window.CostSystem?(console.log("‚úÖ CostSystem initialized with components"),A()):console.warn("‚ö†Ô∏è CostSystem not found - cost calculations may not work")},100)});function De(o){if(!window.currentVehicle?.chassis||!window.VEHICLE_COMPONENTS)return{compatible:!0};const e=h("chassis",window.currentVehicle.chassis);return e?e.aa_only&&o>0?{compatible:!1,reason:"Chassis SPAA n√£o permite canh√£o principal. Use apenas armas AA."}:e.artillery_specialized&&o<e.min_main_gun_caliber?{compatible:!1,reason:`Chassis SPG requer calibres de pelo menos ${e.min_main_gun_caliber}mm`}:e.max_main_gun_caliber&&o>e.max_main_gun_caliber?{compatible:!1,reason:`Calibre muito grande (${o}mm). Chassis suporta at√© ${e.max_main_gun_caliber}mm`}:o>130&&!e.large_caliber_capable?{compatible:!1,reason:"Calibres >130mm s√≥ s√£o permitidos em chassis SPG especializados"}:{compatible:!0}:{compatible:!0}}function Be(){!window.currentVehicle?.chassis||!window.VEHICLE_COMPONENTS||h("chassis",window.currentVehicle.chassis)}window.checkMainGunCaliber=De;window.updateChassisLimits=Be;window.filterCompatibleComponents=function(o){if(!window.VEHICLE_COMPONENTS||!window.currentVehicle?.chassis)return window.VEHICLE_COMPONENTS?.[o]||{};const e=window.VEHICLE_COMPONENTS[o],t={};for(const i in e)window.checkComponentCompatibility(o,i).compatible&&(t[i]=e[i]);return t};window.selectChassis=function(o){if(!window.VEHICLE_COMPONENTS?.chassis[o]){console.error("Chassis not found:",o);return}window.currentVehicle.chassis=o,console.log("Selected chassis:",o),window.currentVehicle.engine&&(j("engines",window.currentVehicle.engine).compatible||(window.currentVehicle.engine=null)),window.currentVehicle.transmission&&(j("transmissions",window.currentVehicle.transmission).compatible||(window.currentVehicle.transmission=null)),document.querySelectorAll(".chassis-card").forEach(t=>{t.classList.remove("ring-2","ring-brand-500","bg-brand-500/10")});const e=document.querySelector(`[onclick="selectChassis('${o}')"]`);e&&e.classList.add("ring-2","ring-brand-500","bg-brand-500/10"),window.vehicleCreatorApp&&window.vehicleCreatorApp.loadTabContent(window.vehicleCreatorApp.currentTab),w()};window.selectEngine=function(o){if(!window.VEHICLE_COMPONENTS?.engines[o]){console.error("Engine not found:",o);return}window.currentVehicle.engine=o,console.log("Selected engine:",o),document.querySelectorAll(".component-card").forEach(t=>{t.onclick&&t.onclick.toString().includes("selectEngine")&&(t.classList.remove("selected","bg-brand-900/30","border-brand-400","shadow-brand-500/20","shadow-lg"),t.classList.add("bg-slate-800/40","border-slate-700/50"))});const e=document.querySelector(`[onclick="selectEngine('${o}')"]`);e&&(e.classList.remove("bg-slate-800/40","border-slate-700/50"),e.classList.add("selected","bg-brand-900/30","border-brand-400","shadow-brand-500/20","shadow-lg")),w()};window.selectTransmission=function(o){if(!window.VEHICLE_COMPONENTS?.transmissions[o]){console.error("Transmission not found:",o);return}window.currentVehicle.transmission=o,console.log("Selected transmission:",o),document.querySelectorAll(".transmission-card").forEach(t=>{t.classList.remove("ring-2","ring-brand-500","bg-brand-500/10")});const e=document.querySelector(`[onclick="selectTransmission('${o}')"]`);e&&e.classList.add("ring-2","ring-brand-500","bg-brand-500/10"),w()};window.selectSuspension=function(o){if(!window.VEHICLE_COMPONENTS?.suspensions[o]){console.error("Suspension not found:",o);return}window.currentVehicle.suspension=o,console.log("Selected suspension:",o),document.querySelectorAll(".suspension-card").forEach(t=>{t.classList.remove("ring-2","ring-brand-500","bg-brand-500/10")});const e=document.querySelector(`[onclick="selectSuspension('${o}')"]`);e&&e.classList.add("ring-2","ring-brand-500","bg-brand-500/10"),w()};function X(){if(!window.currentVehicle?.chassis||!window.currentVehicle?.engine){window.vehicleCreatorApp?.performanceChart&&(window.vehicleCreatorApp.performanceChart.data.datasets[0].data=[0,0,0,0,0,0],window.vehicleCreatorApp.performanceChart.update());return}const o=K(),e=window.CostSystem?window.CostSystem.calculateCosts(window.currentVehicle):Q(),t={speed:Math.min(100,o.topSpeed.road/80*100),armor:Math.min(100,o.armorProtection/250*100),power:Math.min(100,o.powerToWeight/20*100),reliability:o.reliability,economy:Math.max(0,100-o.fuelConsumption/100*100),maintenance:Math.max(0,100-e.maintenanceCostPerHour/500*100)};window.vehicleCreatorApp?.performanceChart&&(window.vehicleCreatorApp.performanceChart.data.datasets[0].data=[t.speed,t.armor,t.power,t.reliability,t.economy,t.maintenance],window.vehicleCreatorApp.performanceChart.update()),I(),H(),A()}function I(){if(!window.EnergySystem||!window.currentVehicle)return;const o=document.getElementById("energy-analysis");if(o){const e=window.EnergySystem.renderEnergyDisplay(window.currentVehicle);o.innerHTML=e}}function H(){if(!window.PerformanceSystem||!window.currentVehicle)return;const o=document.getElementById("performance-analysis");if(o){const e=window.PerformanceSystem.renderPerformanceDisplay(window.currentVehicle);o.innerHTML=e}}function A(){if(!window.CostSystem||!m)return;const o=document.getElementById("cost-breakdown");if(o){const e=window.CostSystem.renderCostDisplay(m);o.innerHTML=e}}document.addEventListener("DOMContentLoaded",function(){setTimeout(()=>{I(),H(),A()},1e3)});window.updateMainGunCaliber=function(o){const e=parseInt(o);if(window.currentVehicle){const t=window.currentVehicle?.chassis?window.VEHICLE_COMPONENTS?.chassis?.[window.currentVehicle.chassis]:null,i=t?.min_main_gun_caliber??20,a=t?.max_main_gun_caliber??180,s=Math.max(i,Math.min(a,e));window.currentVehicle.main_gun_caliber=s;const n=document.getElementById("main-gun-caliber-display"),r=document.getElementById("main-gun-header-caliber"),c=document.getElementById("summary-main-gun-caliber"),l=document.getElementById("main-gun-caliber-slider");l&&(l.min=String(i),l.max=String(a),l.value=String(s)),n&&(n.textContent=s+"mm"),r&&(r.textContent=s+" mm"),c&&(c.textContent=s+"mm"),B(),k(),console.log("Main gun caliber updated:",s),typeof w=="function"?w():typeof X=="function"&&X()}};window.updateMainGunLength=function(o){const e=parseInt(o);window.currentVehicle&&e>=30&&e<=70&&(window.currentVehicle.main_gun_length_ratio=e,console.log("Main gun length updated:",e),_e(e),B(),k(),typeof w=="function"&&w())};window.updateMainGunAmmo=function(o){const e=["AP","HE","APCR","HEAT","APDS"];window.currentVehicle&&e.includes(o)&&(window.currentVehicle.ammo_view=o,console.log("Main gun ammo type updated:",o),ge(o),B(),k(),typeof w=="function"&&w())};window.toggleAAGun=function(o){if(!window.currentVehicle)return;window.currentVehicle.aa_guns||(window.currentVehicle.aa_guns=[]);const e=window.currentVehicle.aa_guns.indexOf(o);e>-1?(window.currentVehicle.aa_guns.splice(e,1),console.log("AA gun removed:",o)):(window.currentVehicle.aa_guns.push(o),console.log("AA gun added:",o)),B(),typeof w=="function"&&w(),setTimeout(()=>{window.tabLoaders&&typeof window.tabLoaders.loadWeaponsTab=="function"&&window.tabLoaders.loadWeaponsTab()},100)};function _e(o){document.querySelectorAll('[onclick^="updateMainGunLength("]').forEach(i=>{i.classList.remove("bg-brand-600","text-white"),i.classList.add("bg-slate-700","text-slate-300")});const t=document.querySelector(`[onclick="updateMainGunLength(${o})"]`);t&&(t.classList.remove("bg-slate-700","text-slate-300"),t.classList.add("bg-brand-600","text-white"))}function ge(o){document.querySelectorAll('[onclick^="updateMainGunAmmo("]').forEach(i=>{i.classList.remove("bg-brand-600","text-white"),i.classList.add("bg-slate-700","text-slate-300")});const t=document.querySelector(`[onclick="updateMainGunAmmo('${o}')"]`);t&&(t.classList.remove("bg-slate-700","text-slate-300"),t.classList.add("bg-brand-600","text-white"))}function B(){const o=window.currentVehicle||{},e=o.main_gun_caliber||0,t=o.main_gun_length_ratio||40,i=o.ammo_view||"AP",a=document.getElementById("main-gun-header-caliber");a&&e>0&&(a.textContent=e+" mm");const s=document.getElementById("summary-main-gun-caliber");s&&e>0&&(s.textContent=e+" mm");const n=e*t/25,c=Math.round(n*({AP:1,APCR:1.4,APDS:1.8,HEAT:1.6,HE:.15}[i]||1)),l=document.getElementById("summary-penetration");l&&(l.textContent=c+" mm");const d=document.getElementById("main-gun-penetration");if(d&&(d.textContent=c+" mm",console.log("Updated main gun penetration to:",c+"mm","for ammo type:",i)),_e(t),ge(i),window.tabLoaders&&typeof window.tabLoaders.calculateGunPenetration=="function"){const u=window.tabLoaders.calculateGunPenetration(e,t),p=window.tabLoaders.calculateGunCost(e,t),f=document.getElementById("main-gun-penetration");f&&(f.textContent=u+" mm");const g=document.getElementById("main-gun-cost");g&&(g.textContent="$"+p+"K")}}window.calculateEstimatedPenetration=function(o,e,t){const i=Math.max(1,Number(o)||0),a=Math.max(10,Number(e)||40),s=.85+.15*(a/40),n=(t||"AP").toUpperCase();let r;switch(n){case"AP":r=i*3*s;break;case"APCR":r=i*3.6*s;break;case"APDS":r=i*5*s;break;case"APHE":r=i*2.6*s;break;case"HEAT":r=i*4.2*(.95+.05*(a/40));break;case"HE":r=0;break;default:r=i*3*s}return Math.round(r)};window.updateGunLength=function(o){const e=parseInt(o);window.currentVehicle&&(window.currentVehicle.main_gun_length_ratio=e,J(),typeof w=="function"&&w())};window.setAmmoView=function(o){window.currentVehicle&&(window.currentVehicle.ammo_view=String(o||"AP").toUpperCase(),J())};function J(){const o=window.currentVehicle||{},e=(o.ammo_view||"AP").toUpperCase(),t=window.calculateEstimatedPenetration(o.main_gun_caliber||0,o.main_gun_length_ratio||40,e),i=document.getElementById("gun-penetration-estimate");i&&(i.textContent=`${t} mm`);try{document.querySelectorAll("[data-ammo-chip]").forEach(a=>{a.getAttribute("data-ammo-chip")===e?(a.classList.add("selected","bg-brand-900/30","border-brand-400"),a.classList.remove("bg-slate-700/30","border-slate-700/50")):(a.classList.remove("selected","bg-brand-900/30","border-brand-400"),a.classList.add("bg-slate-700/30","border-slate-700/50"))}),document.querySelectorAll("[data-length-chip]").forEach(a=>{parseInt(a.getAttribute("data-length-chip"))===(o.main_gun_length_ratio||40)?(a.classList.add("selected","bg-brand-900/30","border-brand-400"),a.classList.remove("bg-slate-700/30","border-slate-700/50")):(a.classList.remove("selected","bg-brand-900/30","border-brand-400"),a.classList.add("bg-slate-700/30","border-slate-700/50"))})}catch{}}window.updateGunPreview=J;window.selectSecondaryWeapon=function(o){};window.toggleSecondaryWeapon=function(o){if(!window.currentVehicle)return;Array.isArray(window.currentVehicle.secondary_weapons)||(window.currentVehicle.secondary_weapons=[]);const e=window.currentVehicle.secondary_weapons.indexOf(o);e>=0?window.currentVehicle.secondary_weapons.splice(e,1):window.currentVehicle.secondary_weapons.push(o);try{const t=document.querySelector(`[onclick="toggleSecondaryWeapon('${o}')"]`);t&&(window.currentVehicle.secondary_weapons.includes(o)?(t.classList.add("selected","bg-brand-900/30","border-brand-400"),t.classList.remove("bg-slate-800/40","border-slate-700/50")):(t.classList.remove("selected","bg-brand-900/30","border-brand-400"),t.classList.add("bg-slate-800/40","border-slate-700/50")))}catch{}w(),k()};window.selectFireControl=function(o){if(window.currentVehicle){window.currentVehicle.fcs=o;try{document.querySelectorAll(".component-card").forEach(t=>{t.onclick&&t.onclick.toString().includes("selectFireControl")&&(t.classList.remove("selected","bg-brand-900/30","border-brand-400"),t.classList.add("bg-slate-800/40","border-slate-700/50"))});const e=document.querySelector(`[onclick="selectFireControl('${o}')"]`);e&&(e.classList.add("selected","bg-brand-900/30","border-brand-400"),e.classList.remove("bg-slate-800/40","border-slate-700/50"))}catch{}w()}};window.selectOptics=function(o){if(window.currentVehicle){window.currentVehicle.optics=o;try{document.querySelectorAll(".component-card").forEach(t=>{t.onclick&&t.onclick.toString().includes("selectOptics")&&(t.classList.remove("selected","bg-brand-900/30","border-brand-400"),t.classList.add("bg-slate-800/40","border-slate-700/50"))});const e=document.querySelector(`[onclick="selectOptics('${o}')"]`);e&&(e.classList.add("selected","bg-brand-900/30","border-brand-400"),e.classList.remove("bg-slate-800/40","border-slate-700/50"))}catch{}w()}};window.selectCommunication=function(o){if(window.currentVehicle){window.currentVehicle.communication=o;try{document.querySelectorAll(".component-card").forEach(t=>{t.onclick&&t.onclick.toString().includes("selectCommunication")&&(t.classList.remove("selected","bg-brand-900/30","border-brand-400"),t.classList.add("bg-slate-800/40","border-slate-700/50"))});const e=document.querySelector(`[onclick="selectCommunication('${o}')"]`);e&&(e.classList.add("selected","bg-brand-900/30","border-brand-400"),e.classList.remove("bg-slate-800/40","border-slate-700/50"))}catch{}w()}};window.updateCrewSize=function(o){if(!window.currentVehicle)return;const e=parseInt(o);if(Number.isFinite(e)){window.currentVehicle.crewSize=e;try{const t=document.getElementById("crew-size-display");t&&(t.textContent=String(e)),Fe(e)}catch{}w()}};function Fe(o){const e={2:["Motorista","Gunner"],3:["Motorista","Gunner","Comandante"],4:["Motorista","Gunner","Comandante","Carregador"],5:["Motorista","Gunner","Comandante","Carregador","Operador de R√°dio"]},i=(e[o]||e[3]).map((s,n)=>`
        <div class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700/50">
            <span class="w-6 h-6 flex items-center justify-center text-xs font-bold bg-brand-900/50 text-brand-300 rounded-full">${n+1}</span>
            <span class="text-slate-200 text-sm">${s}</span>
        </div>
    `).join("");let a=document.getElementById("crew-roles-container");if(!a){const s=document.getElementById("crew-size-slider"),n=s?s.closest(".rounded-xl.p-6")||s.closest(".p-6"):null,r=document.createElement("div");r.className="bg-slate-800/40 border border-slate-700/50 rounded-xl p-6",r.innerHTML=`
            <h3 class="text-lg font-semibold text-slate-100 mb-4">Fun√ß√µes da Tripula√ß√£o</h3>
            <div id="crew-roles-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">${i}</div>
        `,n&&n.parentElement?n.parentElement.insertBefore(r,n.nextSibling):document.getElementById("tab-content")?.appendChild(r),a=r.querySelector("#crew-roles-container")}a&&(a.innerHTML=i)}window.updateCrewTraining=function(o){window.currentVehicle&&(window.currentVehicle.trainingLevel=o,w())};window.selectTrainingLevel=function(o){if(window.currentVehicle){window.currentVehicle.trainingLevel=o;try{document.querySelectorAll('[onclick^="selectTrainingLevel("]').forEach(t=>{t.classList.remove("selected","bg-brand-900/30","border-brand-400"),t.classList.add("bg-slate-700/30","border-slate-700/50")});const e=document.querySelector(`[onclick="selectTrainingLevel('${o}')"]`);e&&(e.classList.add("selected","bg-brand-900/30","border-brand-400"),e.classList.remove("bg-slate-700/30","border-slate-700/50"))}catch{}w()}};window.selectAAGun=function(o){if(window.currentVehicle){window.currentVehicle.aa_gun=o;try{document.querySelectorAll('[onclick^="selectAAGun("]').forEach(t=>{t.classList.remove("selected","bg-brand-900/30","border-brand-400"),t.classList.add("bg-slate-800/40","border-slate-700/50")});const e=document.querySelector(`[onclick="selectAAGun('${o}')"]`);e&&(e.classList.add("selected","bg-brand-900/30","border-brand-400"),e.classList.remove("bg-slate-800/40","border-slate-700/50"))}catch{}w(),k()}};window.toggleSpecialEquipment=function(o){if(!window.currentVehicle)return;Array.isArray(window.currentVehicle.special_equipment)||(window.currentVehicle.special_equipment=[]);const e=window.currentVehicle.special_equipment.indexOf(o);e>=0?window.currentVehicle.special_equipment.splice(e,1):window.currentVehicle.special_equipment.push(o);try{const t=document.querySelector(`[onclick="toggleSpecialEquipment('${o}')"]`);t&&(window.currentVehicle.special_equipment.includes(o)?(t.classList.add("selected","bg-brand-900/30","border-brand-400"),t.classList.remove("bg-slate-800/40","border-slate-700/50")):(t.classList.remove("selected","bg-brand-900/30","border-brand-400"),t.classList.add("bg-slate-800/40","border-slate-700/50")))}catch{}w()};window.showVehicleSummaryModal=function(){const o=document.getElementById("vehicle-summary-modal");o&&(Je(),o.classList.remove("hidden"),document.body.style.overflow="hidden")};window.hideVehicleSummaryModal=function(){const o=document.getElementById("vehicle-summary-modal");o&&(o.classList.add("hidden"),document.body.style.overflow="")};function We(){if(!m.chassis)return'<div class="text-slate-400 text-sm">Nenhum chassi selecionado</div>';const o=O[m.chassis];return o?`
        <div class="space-y-3">
            <h4 class="text-lg font-semibold text-slate-200">Chassi</h4>
            <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                <div class="text-sm font-medium text-slate-300 mb-2">${o.name}</div>
                <div class="grid grid-cols-2 gap-2 text-xs text-slate-400">
                    <div>Classe: ${o.weight_class||"N/A"}</div>
                    <div>Peso Base: ${(o.base_weight/1e3).toFixed(1)}t</div>
                    <div>Velocidade Base: ${o.base_speed||"N/A"} km/h</div>
                    <div>Tripula√ß√£o: ${o.crew_capacity||"N/A"}</div>
                </div>
            </div>
        </div>
    `:'<div class="text-slate-400 text-sm">Chassi n√£o encontrado</div>'}function Re(){let o='<h4 class="text-lg font-semibold text-slate-200">Sistema de Propuls√£o</h4>';if(m.engine){const e=L[m.engine];if(e){const t=h("engines",m.engine);o+=`
                <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                    <div class="text-sm font-medium text-slate-300 mb-2">üîß ${e.name}</div>
                    <div class="grid grid-cols-2 gap-2 text-xs text-slate-400">
                        <div>Pot√™ncia: ${t?.power||e.max_power||"N/A"} hp</div>
                        <div>Combust√≠vel: ${t?.fuel_type||e.fuel_type||"N/A"}</div>
                        <div>Consumo: ${t?.consumption||e.consumption||"N/A"} L/h</div>
                        <div>Peso: ${t?.weight||e.weight||"N/A"} kg</div>
                    </div>
                </div>
            `}}if(m.transmission){const e=D[m.transmission];e&&(o+=`
                <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                    <div class="text-sm font-medium text-slate-300 mb-2">‚öôÔ∏è ${e.name}</div>
                    <div class="grid grid-cols-2 gap-2 text-xs text-slate-400">
                        <div>Tipo: ${e.type||"N/A"}</div>
                        <div>Marchas: ${e.gears||"N/A"}</div>
                        <div>Efici√™ncia: ${Math.round((e.efficiency||.85)*100)}%</div>
                        <div>Peso: ${e.weight||"N/A"} kg</div>
                    </div>
                </div>
            `)}if(m.suspension){const e=te[m.suspension];e&&(o+=`
                <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                    <div class="text-sm font-medium text-slate-300 mb-2">üöó ${e.name}</div>
                    <div class="grid grid-cols-2 gap-2 text-xs text-slate-400">
                        <div>Tipo: ${e.type||"N/A"}</div>
                        <div>Curso: ${e.travel||"N/A"} mm</div>
                        <div>Conforto: ${e.comfort_rating||"N/A"}/5</div>
                        <div>Peso: ${e.weight||"N/A"} kg</div>
                    </div>
                </div>
            `)}return o}function ze(){let o="";if(m.main_gun_caliber&&m.main_gun_caliber>0){const e=m.main_gun_caliber,t=m.main_gun_length_ratio||40,i=m.ammo_view||"AP",a=fe();o+=`
            <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                <div class="text-sm font-medium text-slate-300 mb-2">üéØ Canh√£o Principal</div>
                <div class="space-y-1 text-xs text-slate-400">
                    <div>Calibre: ${e}mm</div>
                    <div>Comprimento: L/${t}</div>
                    <div>Muni√ß√£o: ${i}</div>
                    <div>Penetra√ß√£o: ${a}mm</div>
                </div>
            </div>
        `}if(m.secondary_weapons&&m.secondary_weapons.length>0&&m.secondary_weapons.forEach(e=>{const t=ie[e];t&&(o+=`
                    <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                        <div class="text-sm font-medium text-slate-300 mb-2">üî´ ${t.name}</div>
                        <div class="space-y-1 text-xs text-slate-400">
                            <div>Calibre: ${t.caliber||"N/A"}mm</div>
                            <div>ROF: ${t.rate_of_fire||"N/A"} rpm</div>
                            <div>Muni√ß√£o: ${t.ammo_capacity||"N/A"}</div>
                        </div>
                    </div>
                `)}),m.aa_gun){const e=ne[m.aa_gun];e&&(o+=`
                <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                    <div class="text-sm font-medium text-slate-300 mb-2">üéØ ${e.name}</div>
                    <div class="space-y-1 text-xs text-slate-400">
                        <div>Calibre: ${e.caliber}mm</div>
                        <div>ROF: ${e.rate_of_fire} rpm</div>
                        <div>Alcance: ${e.effective_range}m</div>
                    </div>
                </div>
            `)}return o||(o='<div class="text-slate-400 text-sm col-span-3">Nenhum armamento selecionado</div>'),o}function je(){let o='<div class="space-y-3">';o+='<h4 class="text-lg font-semibold text-slate-200">Blindagem Principal</h4>';const e=m.armorThickness||m.armor_thickness||0,t=m.armorMaterial||m.armor_material,i=m.armorAngle;if(e>0){let s="A√ßo Padr√£o";t&&z[t]&&(s=z[t].name);let n="Vertical (90¬∞)";i&&$[i]&&(n=$[i].name),o+=`
            <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                <div class="grid grid-cols-2 gap-2 text-xs text-slate-400">
                    <div>Espessura: ${e}mm</div>
                    <div>Material: ${s}</div>
                    <div>√Çngulo: ${n}</div>
                    <div>Prote√ß√£o Efetiva: ${Qe()}mm</div>
                </div>
            </div>
        `}else o+='<div class="text-slate-400 text-sm">Blindagem n√£o configurada</div>';o+="</div>";const a=m.additional_armor||m.additionalArmor||[];return a.length>0&&(o+='<div class="space-y-3">',o+='<h4 class="text-lg font-semibold text-slate-200">Blindagem Adicional</h4>',a.forEach(s=>{const n=ae[s];n&&(o+=`
                    <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                        <div class="text-sm font-medium text-slate-300 mb-2">${n.name}</div>
                        <div class="grid grid-cols-2 gap-2 text-xs text-slate-400">
                            <div>Prote√ß√£o: +${n.protection_bonus||0}mm</div>
                            <div>Peso: +${n.weight_penalty||0}kg</div>
                        </div>
                    </div>
                `)}),o+="</div>"),o}function Ue(){let o="";if(m.fcs){const e=ce[m.fcs];e&&(o+=`
                <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                    <div class="text-sm font-medium text-slate-300 mb-2">üéØ Controle de Tiro</div>
                    <div class="text-xs text-slate-200 mb-1">${e.name}</div>
                    <div class="space-y-1 text-xs text-slate-400">
                        <div>Tipo: ${e.type||"N/A"}</div>
                        <div>Precis√£o: +${e.accuracy_bonus||0}%</div>
                        <div>Consumo: ${e.power_consumption||0}kW</div>
                    </div>
                </div>
            `)}if(m.optics){const e=se[m.optics];e&&(o+=`
                <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                    <div class="text-sm font-medium text-slate-300 mb-2">üëÅÔ∏è Sistema √ìtico</div>
                    <div class="text-xs text-slate-200 mb-1">${e.name}</div>
                    <div class="space-y-1 text-xs text-slate-400">
                        <div>Zoom: ${e.magnification||"N/A"}x</div>
                        <div>Vis√£o Noturna: ${e.night_vision?"Sim":"N√£o"}</div>
                        <div>Termal: ${e.thermal?"Sim":"N√£o"}</div>
                    </div>
                </div>
            `)}if(m.communication){const e=oe[m.communication];e&&(o+=`
                <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                    <div class="text-sm font-medium text-slate-300 mb-2">üì° Comunica√ß√£o</div>
                    <div class="text-xs text-slate-200 mb-1">${e.name}</div>
                    <div class="space-y-1 text-xs text-slate-400">
                        <div>Alcance: ${e.range||"N/A"}km</div>
                        <div>Canais: ${e.channels||"N/A"}</div>
                        <div>Criptografia: ${e.encrypted?"Sim":"N√£o"}</div>
                    </div>
                </div>
            `)}return o||(o='<div class="text-slate-400 text-sm col-span-3">Nenhum sistema eletr√¥nico selecionado</div>'),o}function Ge(){const o=m.crewSize||3,e=m.trainingLevel||"standard",t={rookie:"Recruta",standard:"Padr√£o",veteran:"Veterano",elite:"Elite"},i={2:["Motorista","Artilheiro"],3:["Motorista","Artilheiro","Comandante"],4:["Motorista","Artilheiro","Comandante","Carregador"],5:["Motorista","Artilheiro","Comandante","Carregador","Operador de R√°dio"]};let a=`
        <div class="space-y-3">
            <h4 class="text-lg font-semibold text-slate-200">Composi√ß√£o</h4>
            <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                <div class="grid grid-cols-2 gap-2 text-xs text-slate-400 mb-3">
                    <div>Tamanho: ${o} membros</div>
                    <div>Treinamento: ${t[e]}</div>
                </div>
                <div class="space-y-1">
                    ${(i[o]||i[3]).map((r,c)=>`<div class="flex items-center gap-2 text-xs text-slate-300">
                            <span class="w-5 h-5 bg-brand-900/50 text-brand-300 rounded-full flex items-center justify-center text-xs font-bold">${c+1}</span>
                            ${r}
                        </div>`).join("")}
                </div>
            </div>
        </div>
    `;const n={rookie:{accuracy:-10,reload:-15,mobility:-5},standard:{accuracy:0,reload:0,mobility:0},veteran:{accuracy:10,reload:15,mobility:5},elite:{accuracy:20,reload:25,mobility:10}}[e];return a+=`
        <div class="space-y-3">
            <h4 class="text-lg font-semibold text-slate-200">Impacto no Desempenho</h4>
            <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                <div class="space-y-1 text-xs">
                    <div class="flex justify-between">
                        <span class="text-slate-400">Precis√£o:</span>
                        <span class="${n.accuracy>=0?"text-green-400":"text-red-400"}">
                            ${n.accuracy>0?"+":""}${n.accuracy}%
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-400">Recarga:</span>
                        <span class="${n.reload>=0?"text-green-400":"text-red-400"}">
                            ${n.reload>0?"+":""}${n.reload}%
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-400">Mobilidade:</span>
                        <span class="${n.mobility>=0?"text-green-400":"text-red-400"}">
                            ${n.mobility>0?"+":""}${n.mobility}%
                        </span>
                    </div>
                </div>
            </div>
        </div>
    `,a}function Ke(){const o=m.special_equipment||m.specialEquipment||[];if(!o||o.length===0)return"";let e=`
        <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                <span class="text-2xl">üõ†Ô∏è</span>
                Equipamentos Especiais
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    `;return o.forEach(t=>{const i=re[t];i&&(e+=`
                <div class="bg-slate-900/40 border border-slate-700/30 rounded-lg p-3">
                    <div class="text-sm font-medium text-slate-300 mb-2">${i.name}</div>
                    <div class="text-xs text-slate-400 mb-2">${i.description||""}</div>
                    <div class="space-y-1 text-xs text-slate-400">
                        <div>Peso: ${i.weight||0}kg</div>
                        <div>Consumo: ${i.energy_consumption||0}kW</div>
                        <div>Custo: $${(i.cost||0).toLocaleString()}</div>
                    </div>
                </div>
            `)}),e+="</div></div>",e}function Qe(){const o=m.armorThickness||m.armor_thickness||0,e=m.armorAngle;let t=o;return e&&$[e]&&(t*=$[e].effectiveness_multiplier||1),Math.round(t)}function Je(){const o=document.getElementById("vehicle-summary-content");if(!o)return;const t=1954+(window.gameState?.currentTurn||0),i=m.name||`Ve√≠culo Experimental ${Math.floor(Math.random()*1e3)}`,a=Xe(),s=et(),n=at();o.innerHTML=`
        <div class="space-y-8">
            <!-- Header Info -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-400 mb-2">Nome do Ve√≠culo</label>
                        <input 
                            type="text" 
                            id="vehicle-name-input"
                            value="${i}"
                            class="w-full px-4 py-3 bg-slate-800/60 border border-slate-700 rounded-lg text-white focus:ring-2 focus:ring-brand-500 focus:border-transparent"
                            placeholder="Nome do seu ve√≠culo"
                        >
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-400 mb-2">Ano de Desenvolvimento</label>
                            <div class="px-4 py-3 bg-slate-800/40 border border-slate-700 rounded-lg text-brand-300 font-semibold">
                                ${t}
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-400 mb-2">Tipo</label>
                            <div class="px-4 py-3 bg-slate-800/40 border border-slate-700 rounded-lg text-brand-300 font-semibold">
                                ${Ye()}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Vehicle Image Upload -->
                <div class="relative">
                    <div id="vehicle-image-container" class="flex items-center justify-center bg-slate-800/40 border-2 border-dashed border-slate-600 rounded-xl p-8 transition-all duration-200 hover:border-brand-500 hover:bg-slate-800/60 cursor-pointer min-h-[200px]" onclick="triggerImageUpload()">
                        <div class="text-center">
                            <div id="vehicle-image-preview" class="hidden">
                                <img id="uploaded-vehicle-image" class="max-w-full max-h-48 rounded-lg object-contain mx-auto mb-4" alt="Imagem do Ve√≠culo">
                            </div>
                            <div id="vehicle-image-placeholder">
                                <div class="text-6xl mb-4">${Ze()}</div>
                                <p class="text-slate-400 mb-2">Clique para adicionar imagem do ve√≠culo</p>
                                <p class="text-xs text-slate-500">PNG, JPG ou GIF at√© 5MB</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hidden file input -->
                    <input 
                        type="file" 
                        id="vehicle-image-input" 
                        class="hidden" 
                        accept="image/*" 
                        onchange="handleImageUpload(event)"
                    >
                    
                    <!-- Remove image button (shown when image is uploaded) -->
                    <button 
                        id="remove-image-btn" 
                        onclick="removeVehicleImage()" 
                        class="hidden absolute top-2 right-2 w-8 h-8 bg-red-600 hover:bg-red-700 text-white rounded-full flex items-center justify-center transition-colors"
                        title="Remover imagem"
                    >
                        <span class="text-sm">√ó</span>
                    </button>
                </div>
            </div>
            
            <!-- Technical Specifications -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Performance Stats -->
                <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                        <span class="text-2xl">‚ö°</span>
                        Desempenho
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                            <span class="text-slate-300">Velocidade M√°xima</span>
                            <span class="font-semibold text-brand-300">${a.maxSpeed||0} km/h</span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                            <span class="text-slate-300">Acelera√ß√£o</span>
                            <span class="font-semibold text-brand-300">${a.acceleration||0} km/h/s</span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                            <span class="text-slate-300">Peso Total</span>
                            <span class="font-semibold text-brand-300">${a.totalWeight||0} tons</span>
                        </div>
                        <div class="flex justify-between items-center py-2">
                            <span class="text-slate-300">Pot√™ncia Espec√≠fica</span>
                            <span class="font-semibold text-brand-300">${a.powerToWeight||0} hp/ton</span>
                        </div>
                    </div>
                </div>
                
                <!-- Combat Stats -->
                <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                        <span class="text-2xl">üí•</span>
                        Capacidade de Combate
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                            <span class="text-slate-300">Armamento Principal</span>
                            <span class="font-semibold text-brand-300">${m.main_gun_caliber||0}mm</span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                            <span class="text-slate-300">Penetra√ß√£o</span>
                            <span class="font-semibold text-brand-300">${fe()}mm</span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                            <span class="text-slate-300">Blindagem Frontal</span>
                            <span class="font-semibold text-brand-300">${m.armorThickness||0}mm</span>
                        </div>
                        <div class="flex justify-between items-center py-2">
                            <span class="text-slate-300">Tripula√ß√£o</span>
                            <span class="font-semibold text-brand-300">${m.crewSize||3} membros</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Detailed Components Sections -->
            
            <!-- Chassis & Drivetrain -->
            <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                    <span class="text-2xl">üèóÔ∏è</span>
                    Chassi e Sistema de Propuls√£o
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-3">
                        ${We()}
                    </div>
                    <div class="space-y-3">
                        ${Re()}
                    </div>
                </div>
            </div>
            
            <!-- Armaments -->
            <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                    <span class="text-2xl">üî´</span>
                    Sistema de Armamento
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${ze()}
                </div>
            </div>
            
            <!-- Armor System -->
            <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                    <span class="text-2xl">üõ°Ô∏è</span>
                    Sistema de Blindagem
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    ${je()}
                </div>
            </div>
            
            <!-- Electronics & Systems -->
            <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                    <span class="text-2xl">üì°</span>
                    Sistemas Eletr√¥nicos
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    ${Ue()}
                </div>
            </div>
            
            <!-- Crew -->
            <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                    <span class="text-2xl">üë•</span>
                    Tripula√ß√£o
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    ${Ge()}
                </div>
            </div>
            
            <!-- Special Equipment -->
            ${Ke()}
            
            <!-- Cost & Energy -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                        <span class="text-2xl">üí∞</span>
                        Custos
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                            <span class="text-slate-300">Custo por Unidade</span>
                            <span class="font-semibold text-green-400">$${((s.perUnit||0)/1e3).toFixed(0)}K</span>
                        </div>
                        <div class="flex justify-between items-center py-2">
                            <span class="text-slate-300">Manuten√ß√£o por Unidade/Ano</span>
                            <span class="font-semibold text-yellow-400">$${tt().toFixed(0)}K</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                        <span class="text-2xl">‚ö°</span>
                        Energia
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                            <span class="text-slate-300">Consumo Total</span>
                            <span class="font-semibold text-blue-400">${n.total||0} kW</span>
                        </div>
                        <div class="flex justify-between items-center py-2">
                            <span class="text-slate-300">Efici√™ncia</span>
                            <span class="font-semibold text-blue-400">${n.efficiency||0}%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `,setTimeout(()=>{setupImageDragDrop(),m.vehicleImage&&Y(m.vehicleImage),ct()},100)}function Ye(){if(!m.chassis)return"N√£o Selecionado";const o=O[m.chassis];return o?o.name:"Chassi Personalizado"}function Ze(){if(!m.chassis)return"üöó";const o=O[m.chassis];if(!o)return"üöó";switch(o.weight_class){case"light":return"üöô";case"medium":return"üöö";case"heavy":return"üöõ";case"super_heavy":return"üèóÔ∏è";default:return"üöó"}}function fe(){const o=m.main_gun_caliber||75,e=m.main_gun_length_ratio||40,t=m.ammo_view||"AP",i=o*e/25;return Math.round(i*({AP:1,APCR:1.4,APDS:1.8,HEAT:1.6,HE:.15}[t]||1))}window.exportVehicleToPDF=function(){const o=document.getElementById("vehicle-name-input")?.value||"Veiculo",e=document.createElement("div");e.innerHTML=document.getElementById("vehicle-summary-content").innerHTML;let t="";m.vehicleImage&&(t=`
            <div style="text-align: center; margin: 20px 0;">
                <img src="${m.vehicleImage}" 
                     style="max-width: 300px; max-height: 300px; border-radius: 8px; border: 1px solid #dee2e6;" 
                     alt="Imagem do Ve√≠culo">
            </div>
        `);const i=window.open("","_blank");i.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Ficha do Ve√≠culo - ${o}</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; color: #333; line-height: 1.4; }
                .space-y-8 > * { margin-bottom: 2rem; }
                .grid { display: grid; gap: 1rem; }
                .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
                .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
                .bg-slate-800 { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 1rem; border-radius: 8px; }
                .text-xl { font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem; }
                .font-semibold { font-weight: 600; }
                .text-brand-300 { color: #3b82f6; }
                .text-yellow-400 { color: #f59e0b; }
                .text-blue-400 { color: #60a5fa; }
                .text-green-400 { color: #10b981; }
                input { border: 1px solid #ccc; padding: 8px; border-radius: 4px; }
                h1 { color: #1f2937; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; }
                .hidden { display: none !important; }
                @media print {
                    body { margin: 0; }
                    .no-print { display: none !important; }
                }
            </style>
        </head>
        <body>
            <h1>üìã Ficha Completa do Ve√≠culo - ${o}</h1>
            ${t}
            ${e.innerHTML}
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #dee2e6; text-align: center; color: #6b7280; font-size: 12px;">
                Gerado automaticamente pelo Sistema de Cria√ß√£o de Ve√≠culos War1954
            </div>
        </body>
        </html>
    `),i.document.close(),i.focus(),i.print(),i.close()};function k(){if(!m)return;const o=Array.isArray(m.secondary_weapons)?m.secondary_weapons.length:0,e=document.getElementById("summary-secondary-dps");e&&(e.textContent=o+".0");const t=m.aa_gun?1:0,i=document.getElementById("summary-aa-dps");i&&(i.textContent=t+".0")}function Xe(){if(!m)return{maxSpeed:0,acceleration:0,totalWeight:0,powerToWeight:0};const o=m.chassis?O[m.chassis]:null,e=m.engine?L[m.engine]:null,t=m.transmission?D[m.transmission]:null,i=(o?.base_weight||2e4)/1e3,a=(m.armorThickness||80)*.05,s=(e?.weight||2e3)/1e3,n=Math.round((i+a+s)*10)/10,r=e?.max_power||300,c=Math.round(r/n*10)/10,l=t?.efficiency||.85,d=Math.round(Math.min(o?.base_speed||50,c*2.5*l)),u=Math.round(c*l*.08*100)/100;return{maxSpeed:d,acceleration:u,totalWeight:n,powerToWeight:c}}function et(){if(!m)return{total:0,perUnit:0};if(window.CostSystem&&typeof window.CostSystem.calculateCosts=="function"){const o=window.CostSystem.calculateCosts(m);return{total:Math.round(o.production),perUnit:Math.round(o.production)}}return console.warn("CostSystem n√£o dispon√≠vel, usando c√°lculo simplificado"),{total:0,perUnit:0}}function tt(){return m&&window.CostSystem&&typeof window.CostSystem.calculateCosts=="function"?(window.CostSystem.calculateCosts(m).maintenance||0)/1e3:0}function at(){if(!m)return{total:0,efficiency:0};const e=(m.engine?L[m.engine]:null)?.max_power||300,t=Math.round(e*.8),i=(m.optics_system?15:0)+(m.communication_system?10:0)+(m.fcs?20:0)+(m.special_equipment?.length||0)*5,a=t+i,n=((m.transmission?D[m.transmission]:null)?.efficiency||.85)*100,r=Math.round(n*.9);return{total:a,efficiency:r}}window.triggerImageUpload=function(){document.getElementById("vehicle-image-input").click()};window.handleImageUpload=function(o){const e=o.target.files[0];if(!e||!be(e))return;const t=new FileReader;t.onload=function(i){const a=i.target.result;m.vehicleImage=a,Y(a),console.log("Imagem do ve√≠culo carregada com sucesso")},t.readAsDataURL(e)};function be(o){return["image/jpeg","image/png","image/gif","image/webp"].includes(o.type)?o.size>5242880?(ee("Imagem muito grande. M√°ximo 5MB."),!1):!0:(ee("Formato n√£o suportado. Use PNG, JPG, GIF ou WebP."),!1)}function Y(o){const e=document.getElementById("vehicle-image-placeholder"),t=document.getElementById("vehicle-image-preview"),i=document.getElementById("uploaded-vehicle-image"),a=document.getElementById("remove-image-btn"),s=document.getElementById("vehicle-image-container");e&&t&&i&&a&&s&&(e.classList.add("hidden"),t.classList.remove("hidden"),a.classList.remove("hidden"),i.src=o,s.classList.remove("border-dashed","cursor-pointer"),s.classList.add("border-solid"),s.onclick=null)}window.removeVehicleImage=function(){const o=document.getElementById("vehicle-image-placeholder"),e=document.getElementById("vehicle-image-preview"),t=document.getElementById("uploaded-vehicle-image"),i=document.getElementById("remove-image-btn"),a=document.getElementById("vehicle-image-container"),s=document.getElementById("vehicle-image-input");o&&e&&t&&i&&a&&s&&(e.classList.add("hidden"),o.classList.remove("hidden"),i.classList.add("hidden"),t.src="",s.value="",delete m.vehicleImage,a.classList.add("border-dashed","cursor-pointer"),a.classList.remove("border-solid"),a.onclick=triggerImageUpload,console.log("Imagem do ve√≠culo removida"))};function ee(o){const e=document.getElementById("vehicle-image-container");if(e){const t=document.createElement("div");t.className="absolute top-2 left-2 right-2 bg-red-600 text-white text-xs px-3 py-2 rounded-lg z-10",t.textContent=o,e.appendChild(t),setTimeout(()=>{e.contains(t)&&e.removeChild(t)},3e3)}}window.setupImageDragDrop=function(){const o=document.getElementById("vehicle-image-container");o&&(o.addEventListener("dragover",function(e){e.preventDefault(),o.classList.add("border-brand-500","bg-slate-800/80")}),o.addEventListener("dragleave",function(e){e.preventDefault(),o.classList.remove("border-brand-500","bg-slate-800/80")}),o.addEventListener("drop",function(e){e.preventDefault(),o.classList.remove("border-brand-500","bg-slate-800/80");const t=e.dataTransfer.files;if(t.length>0){const i=t[0];if(be(i)){const a=new FileReader;a.onload=function(s){const n=s.target.result;m.vehicleImage=n,Y(n),console.log("Imagem arrastada e carregada com sucesso")},a.readAsDataURL(i)}}}))};window.submitForApproval=async function(){const o=document.getElementById("vehicle-name-input")?.value,e=parseInt(document.getElementById("vehicle-quantity-input")?.value)||50,t=document.getElementById("submit-approval-btn");if(document.getElementById("submission-status"),!o||o.trim().length<3){P("‚ùå Nome do ve√≠culo deve ter pelo menos 3 caracteres","error");return}if(e<1||e>1e3){P("‚ùå Quantidade deve estar entre 1 e 1000 unidades","error");return}if(!m.chassis||!m.engine){P("‚ùå Chassi e Motor s√£o obrigat√≥rios","error");return}m.name=o.trim(),t&&(t.disabled=!0,t.innerHTML='<span class="flex items-center gap-2"><span class="animate-spin">‚è≥</span><span>Enviando...</span></span>');try{const i=it(m),a=window.firebase?.auth()?.currentUser;if(!a)throw new Error("Usu√°rio n√£o est√° logado");let s;try{s=await ot(a.uid),console.log("üèÅ Pa√≠s detectado:",s)}catch(l){throw console.error("Erro ao detectar pa√≠s:",l),new Error("Erro ao detectar pa√≠s do usu√°rio: "+l.message)}if(!s)throw new Error("Usu√°rio n√£o est√° vinculado a um pa√≠s. Contate o administrador.");if(s.id==="admin-manual"){const l=document.getElementById("vehicle-target-country")?.value;if(l&&l!==""){console.log("üéØ Admin selecionou pa√≠s:",l);try{const u=await window.firebase.firestore().collection("paises").doc(l).get();if(u.exists){const p=u.data();s={id:l,name:p.Pais||"Pa√≠s Selecionado"},console.log("‚úÖ Pa√≠s resolvido:",s)}else s={id:l,name:l},console.log("‚ö†Ô∏è Pa√≠s n√£o encontrado, usando ID:",s)}catch(d){console.log("üí• Erro ao buscar dados do pa√≠s selecionado:",d),s={id:l,name:l}}}else throw new Error("Admin/Narrador deve selecionar um pa√≠s de destino.")}const r={vehicleData:U({...m,submissionId:st(),version:"1.0"}),playerId:a.uid,playerName:a.displayName||a.email||"Usu√°rio Desconhecido",playerEmail:a.email||"",countryId:s.id,countryName:s.name,quantity:e,category:i,status:"pending",submittedAt:window.firebase.firestore.Timestamp.now(),lastUpdated:window.firebase.firestore.Timestamp.now(),reviewedBy:null,reviewedAt:null,reviewComments:"",approvedQuantity:0};console.log("üì∏ Gerando captura da ficha t√©cnica...");const c=await lt(r);c&&typeof c=="object"?(r.imageUrl=c.pngUrl,r.vehicleSheetImageUrl=c.htmlUrl||c.pngUrl,r.hasVisualSheet=!!c.pngUrl):(r.vehicleSheetImageUrl=c,r.hasVisualSheet=c&&c.startsWith("http")),console.log("üßπ Dados limpos para envio:",r),console.log("üìä Tamanho dos dados:",JSON.stringify(r).length,"caracteres"),await rt(r),P(`‚úÖ Ve√≠culo "${o}" enviado para aprova√ß√£o! (${e} unidades)`,"success"),setTimeout(()=>{t&&(t.disabled=!1,t.innerHTML='<span class="flex items-center gap-2"><span>üìã</span><span>Enviar para Aprova√ß√£o</span></span>')},3e3)}catch(i){console.error("üí• Erro ao enviar para aprova√ß√£o:",i),console.error("üîç Detalhes do erro:",{code:i.code,message:i.message,details:i.details||i.stack});let a=i.message;i.code==="invalid-argument"?a="Dados do ve√≠culo inv√°lidos. Verifique se todos os campos est√£o preenchidos corretamente.":i.code==="permission-denied"&&(a="Permiss√£o negada. Verifique suas credenciais."),P(`‚ùå Erro: ${a}`,"error"),t&&(t.disabled=!1,t.innerHTML='<span class="flex items-center gap-2"><span>üìã</span><span>Enviar para Aprova√ß√£o</span></span>')}};function P(o,e){const t=document.getElementById("submission-status");if(!t)return;const i=e==="success"?"bg-green-600/20 border-green-500/50 text-green-300":"bg-red-600/20 border-red-500/50 text-red-300";t.className=`mt-3 rounded-lg p-3 text-sm border ${i}`,t.textContent=o,t.classList.remove("hidden"),setTimeout(()=>{t.classList.add("hidden")},5e3)}function it(o){const e=nt(o),t=(o.main_gun_caliber||0)>0,i=o.main_gun_caliber||0;return t&&i>=100&&e>40?"MBT":t&&i>=70&&e>20?"Medium Tank":t&&e<20?"Light Tank":o.secondary_weapons?.length>0?"IFV":"APC"}function nt(o){const e=O[o.chassis],t=L[o.engine],i=e?.base_weight||2e4,a=t?.weight||1e3,s=(o.armorThickness||50)*100;return(i+a+s)/1e3}function st(){return"VEH-"+Date.now()+"-"+Math.random().toString(36).substr(2,5)}function U(o,e=0){if(e>10)return console.warn("‚ö†Ô∏è M√°xima profundidade atingida, truncando objeto"),null;if(o==null||typeof o=="function"||typeof o=="symbol")return null;if(typeof o!="object")return typeof o=="number"?isFinite(o)?Math.round(o*1e3)/1e3:0:typeof o=="string"&&o.length>1e4?o.substring(0,1e4)+"...":o;if(o instanceof Date)return o.toISOString();if(o.nodeType||o instanceof Element||o instanceof HTMLElement)return null;try{JSON.stringify(o)}catch(a){return console.warn("‚ö†Ô∏è Objeto com refer√™ncias circulares detectado, convertendo para string:",a.message),o.toString()}if(Array.isArray(o)){const a=[];for(let s=0;s<o.length&&s<100;s++){const n=U(o[s],e+1);n!=null&&a.push(n)}return a}const t={};let i=0;for(const[a,s]of Object.entries(o)){if(i>=50){console.warn("‚ö†Ô∏è Muitas propriedades, truncando objeto");break}if(a.startsWith("_")||a.startsWith("$")||a.includes("constructor")||a.includes("prototype")||a.includes("__")||typeof a!="string"||a.length>100)continue;const n=U(s,e+1);if(n!=null){if(typeof n=="object"&&!Array.isArray(n)){const r=JSON.stringify(n).length;r>1e3?t[a]={type:"complex_object",summary:Object.keys(n).slice(0,10),size:r}:t[a]=n}else t[a]=n;i++}}return t}async function ot(o){try{if(console.log("üîç Buscando pa√≠s para usu√°rio:",o),!window.firebase||!window.firebase.firestore)throw new Error("Firebase n√£o est√° dispon√≠vel");const e=window.firebase.firestore();console.log("üìã Verificando documento do usu√°rio...");const t=await e.collection("usuarios").doc(o).get();if(t.exists){const a=t.data();if(console.log("üë§ Dados do usu√°rio:",a),a.papel==="admin"||a.papel==="narrador")return console.log("üîë Usu√°rio √© admin/narrador - permitindo sele√ß√£o manual"),{id:"admin-manual",name:"Admin/Narrador (Sele√ß√£o Manual)"};if(a.paisId){console.log("üåç PaisId encontrado no usu√°rio:",a.paisId);try{const s=await e.collection("paises").doc(a.paisId).get();if(s.exists){const n=s.data();return console.log("‚úÖ Dados do pa√≠s:",n),{id:a.paisId,name:n.Pais||"Pa√≠s Desconhecido"}}}catch(s){console.log("‚ö†Ô∏è Erro ao buscar dados do pa√≠s:",s.message)}return{id:a.paisId,name:`Pa√≠s: ${a.paisId}`}}}console.log("üîé Buscando na cole√ß√£o pa√≠ses...");const i=await e.collection("paises").where("Player","==",o).limit(1).get();if(!i.empty){const a=i.docs[0],s=a.data();return console.log("üéØ Pa√≠s encontrado via busca:",a.id,s),{id:a.id,name:s.Pais||"Pa√≠s Desconhecido"}}return console.log("‚ùå Nenhum pa√≠s encontrado para o usu√°rio"),null}catch(e){throw console.error("üí• Erro ao buscar pa√≠s do usu√°rio:",e),e}}async function rt(o){if(!window.firebase||!window.firebase.firestore)throw new Error("Firebase n√£o inicializado");const e=window.firebase.firestore();console.log("üì§ Enviando dados para Firebase:",o);const t=await e.collection("vehicles_pending").add(o);return console.log("‚úÖ Ve√≠culo enviado para aprova√ß√£o com ID:",t.id),t.id}async function ct(){try{console.log("‚öôÔ∏è Configurando sele√ß√£o de pa√≠s...");const o=window.firebase?.auth()?.currentUser;if(!o){console.log("‚ùå Usu√°rio n√£o logado");return}const e=document.getElementById("admin-country-selection"),t=document.getElementById("vehicle-target-country");if(!e||!t){console.log("‚ùå Elementos n√£o encontrados");return}const i=window.firebase.firestore(),a=await i.collection("usuarios").doc(o.uid).get();if(!a.exists){console.log("‚ùå Documento do usu√°rio n√£o existe");return}const s=a.data();if(console.log("üë§ Papel do usu√°rio:",s.papel),s.papel==="admin"||s.papel==="narrador"){console.log("‚úÖ Mostrando sele√ß√£o de pa√≠s para admin/narrador"),e.classList.remove("hidden"),console.log("üìã Carregando pa√≠ses...");const r=await i.collection("paises").get();t.innerHTML='<option value="">Selecione um pa√≠s...</option>',r.docs.forEach(l=>{const d=l.data(),u=document.createElement("option");u.value=l.id,u.textContent=d.Pais||l.id,t.appendChild(u)}),console.log(`üìä ${r.docs.length} pa√≠ses carregados`);const c=document.body.textContent?.match(/pais_\d+_\d+/)?.[0];if(c){const l=Array.from(t.options).find(d=>d.value===c);l&&(l.selected=!0,console.log("üéØ Pa√≠s do cabe√ßalho pr√©-selecionado:",c))}else{const l=Array.from(t.options).find(d=>d.textContent.toLowerCase().includes("urss")||d.textContent.toLowerCase().includes("uni√£o sovi√©tica")||d.textContent.toLowerCase().includes("soviet"));l&&(l.selected=!0,console.log("üéØ URSS pr√©-selecionada"))}}else console.log("üîí Ocultando sele√ß√£o para jogador normal"),e.classList.add("hidden")}catch(o){console.error("üí• Erro ao configurar sele√ß√£o de pa√≠s:",o);const e=document.getElementById("vehicle-target-country");e&&(e.innerHTML='<option value="">Erro ao carregar pa√≠ses</option>')}}async function lt(o){try{console.log("üöÄ === INICIANDO CAPTURA DE FICHA ==="),console.log("üìã Dados da submiss√£o:",o);const e=document.getElementById("vehicle-summary-content");if(console.log("üéØ Elemento da ficha encontrado:",!!e),!e)throw new Error("Elemento da ficha n√£o encontrado");if(console.log("üñºÔ∏è html2canvas dispon√≠vel:",typeof html2canvas<"u"),typeof html2canvas>"u")return console.log("‚ö†Ô∏è html2canvas n√£o dispon√≠vel, usando m√©todo alternativo"),{pngUrl:null,htmlUrl:await V(o)};if(console.log("üî• Firebase dispon√≠vel:",!!window.firebase),console.log("‚òÅÔ∏è Storage dispon√≠vel:",!!window.firebase?.storage),!window.firebase?.storage)return console.error("‚ùå Firebase Storage n√£o dispon√≠vel!"),{pngUrl:null,htmlUrl:await V(o)};const t={backgroundColor:"#1e293b",width:1200,height:Math.max(e.scrollHeight,800),useCORS:!0,scale:2,logging:!1};console.log("üñºÔ∏è Capturando imagem da ficha...");const i=await html2canvas(e,t);console.log("‚úÖ Canvas capturado:",i.width+"x"+i.height),console.log("üíæ Convertendo para arquivo...");const a=await new Promise(r=>{i.toBlob(r,"image/png",.9)});if(console.log("‚úÖ Blob criado:",a?.size,"bytes"),!a)throw new Error("Falha ao criar blob da imagem");console.log("‚òÅÔ∏è Fazendo upload para Firebase Storage...");const s=await dt(a,o);console.log("‚úÖ Imagem PNG da ficha enviada:",s),console.log("üîó URL completa:",s);const n=await V(o);return{pngUrl:s,htmlUrl:n}}catch(e){console.error("üí• Erro ao capturar ficha PNG:",e);try{return console.log("üîÑ Tentando m√©todo alternativo (HTML apenas)..."),{pngUrl:null,htmlUrl:await V(o)}}catch(t){return console.error("üí• Erro no m√©todo alternativo:",t),null}}}async function dt(o,e){if(console.log("üî• === INICIANDO UPLOAD PARA FIREBASE STORAGE ==="),!window.firebase)throw new Error("Firebase n√£o inicializado");let t;try{if(console.log("üîç Tentando acessar Firebase Storage..."),window.firebase.storage)t=window.firebase.storage(),console.log("‚úÖ Storage acessado via window.firebase.storage()");else if(window.firebase.app&&window.firebase.app().storage)t=window.firebase.app().storage(),console.log("‚úÖ Storage acessado via window.firebase.app().storage()");else throw new Error("Firebase Storage n√£o encontrado")}catch(s){throw console.error("üí• Erro ao acessar Firebase Storage:",s),new Error("Firebase Storage n√£o est√° configurado corretamente")}const i=new Date().toISOString().replace(/[:.]/g,"-"),a=`vehicle-sheets/${e.countryId}/${e.vehicleData.name||"vehicle"}-${i}.png`;console.log("üìÅ Nome do arquivo:",a),console.log("üíæ Tamanho do blob:",o.size,"bytes");try{console.log("üìÇ Criando refer√™ncia do storage...");const s=t.ref(a);console.log("‚úÖ Refer√™ncia criada:",s.fullPath),console.log("‚¨ÜÔ∏è Iniciando upload...");const n=await s.put(o,{contentType:"image/png",customMetadata:{vehicleName:e.vehicleData.name||"Unknown",countryId:e.countryId,submissionId:e.vehicleData.submissionId,uploadedAt:new Date().toISOString()}});console.log("‚úÖ Upload conclu√≠do:",n.state),console.log("üîó Obtendo URL de download...");const r=await n.ref.getDownloadURL();return console.log("‚úÖ URL obtida:",r),r}catch(s){throw console.error("üí• Erro durante upload:",s),console.error("üîç Detalhes do erro:",s.code,s.message),s}}async function V(o){console.log("üìù Gerando ficha em formato texto...");const e=o.vehicleData,t=`
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ficha T√©cnica - ${e.name}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1e293b; color: white; }
        .header { text-align: center; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; margin-bottom: 20px; }
        .section { margin-bottom: 20px; padding: 15px; background: #334155; border-radius: 8px; }
        .section h3 { color: #3b82f6; margin-top: 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .info-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #475569; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìã Ficha T√©cnica do Ve√≠culo</h1>
        <h2>${e.name||"Ve√≠culo Experimental"}</h2>
        <p>Submetido para aprova√ß√£o em ${new Date().toLocaleDateString("pt-BR")}</p>
        <p>Pa√≠s: ${o.countryName} | Quantidade: ${o.quantity} unidades</p>
    </div>
    
    <div class="section">
        <h3>üèóÔ∏è Especifica√ß√µes B√°sicas</h3>
        <div class="info-row"><span>Chassi:</span><span>${e.chassis||"N/A"}</span></div>
        <div class="info-row"><span>Motor:</span><span>${e.engine||"N/A"}</span></div>
        <div class="info-row"><span>Transmiss√£o:</span><span>${e.transmission||"N/A"}</span></div>
        <div class="info-row"><span>Suspens√£o:</span><span>${e.suspension||"N/A"}</span></div>
    </div>
    
    <div class="section">
        <h3>üî´ Armamento</h3>
        <div class="info-row"><span>Canh√£o Principal:</span><span>${e.main_gun_caliber||0}mm</span></div>
        <div class="info-row"><span>Blindagem:</span><span>${e.armorThickness||e.armor_thickness||0}mm</span></div>
    </div>
    
    <div class="section">
        <h3>üìä Informa√ß√µes da Submiss√£o</h3>
        <div class="info-row"><span>ID:</span><span>${e.submissionId}</span></div>
        <div class="info-row"><span>Categoria:</span><span>${o.category}</span></div>
        <div class="info-row"><span>Status:</span><span>Pendente de Aprova√ß√£o</span></div>
    </div>
    
    <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #475569; color: #94a3b8; font-size: 12px;">
        Gerado automaticamente pelo Sistema de Cria√ß√£o de Ve√≠culos War1954
    </div>
</body>
</html>
    `,i="data:text/html;charset=utf-8,"+encodeURIComponent(t);return console.log("‚úÖ Ficha em formato HTML gerada como Data URI"),i}window.saveVehicleToFirebase=function(){P('‚ö†Ô∏è Use o bot√£o "Enviar para Aprova√ß√£o" para submeter o ve√≠culo',"error")};
