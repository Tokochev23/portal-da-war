import{_ as l}from"./preload-helper-f85Crcwt.js";/* empty css                                 */import{a as A,f as h,i as C,e as y}from"./firebase-COmVF2I9.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js";class v{constructor(){this.entities=new Map,this.components=new Map,this.nextEntityId=1,this.systems=new Set,console.log("‚úàÔ∏è AircraftECS initialized")}createAircraft(){const e=this.nextEntityId++;return this.entities.set(e,new Set),console.log(`‚ú® Aircraft entity created: ${e}`),e}destroyAircraft(e){if(!this.entities.has(e)){console.warn(`‚ö†Ô∏è Attempted to destroy non-existent aircraft: ${e}`);return}const t=this.entities.get(e);for(const i of t)this.removeComponent(e,i);this.entities.delete(e),console.log(`üóëÔ∏è Aircraft entity destroyed: ${e}`)}addComponent(e,t,i){if(!this.entities.has(e))throw new Error(`Aircraft ${e} does not exist`);this.components.has(t)||this.components.set(t,new Map),this.components.get(t).set(e,i),this.entities.get(e).add(t),console.log(`üîß Component '${t}' added to aircraft ${e}`)}removeComponent(e,t){if(!this.entities.has(e)){console.warn(`‚ö†Ô∏è Attempted to remove component from non-existent aircraft: ${e}`);return}this.components.has(t)&&(this.components.get(t).delete(e),this.entities.get(e).delete(t),console.log(`üîß Component '${t}' removed from aircraft ${e}`))}getComponent(e,t){return this.components.has(t)&&this.components.get(t).get(e)||null}hasComponent(e,t){return this.entities.has(e)&&this.entities.get(e).has(t)}getAircraftWithComponents(...e){const t=[];for(const[i,n]of this.entities)e.every(c=>n.has(c))&&t.push(i);return t}getDebugInfo(){const e={};for(const[t,i]of this.components)e[t]=i.size;return{totalAircraft:this.entities.size,componentCounts:e,registeredSystems:Array.from(this.systems).map(t=>t.constructor.name)}}}const o=new v;window.aircraftECS=o;class E{constructor(){this.activeAircraftId=null,this.initialized=!1}initialize(){this.initialized||(this.createDefaultAircraft(),this.initialized=!0,console.log("‚úàÔ∏è AircraftEntity system initialized"))}createAircraft(e="Nova Aeronave"){const t=o.createAircraft();return o.addComponent(t,"Identity",{name:e,type:"aircraft",category:null,createdAt:Date.now(),lastModified:Date.now()}),o.addComponent(t,"Structure",{airframe:null,material:"aluminum",size:"medium",baseWeight:0,maxTakeoffWeight:0,centerOfGravity:{x:0,y:0,z:0}}),o.addComponent(t,"Propulsion",{engines:[],totalThrust:0,thrustToWeight:0,fuelCapacity:0,fuelConsumption:{idle:0,cruise:0,combat:0}}),o.addComponent(t,"Aerodynamics",{wings:{type:null,area:0,features:[]},clMax:0,cd0:0,liftToDrag:0}),o.addComponent(t,"Performance",{maxSpeed:0,cruiseSpeed:0,climbRate:0,serviceceiling:0,range:0,gLimit:0}),o.addComponent(t,"Armament",{hardpoints:[],weapons:[],maxWeaponLoad:0}),o.addComponent(t,"Avionics",{radar:null,irst:null,jammer:null,countermeasures:[]}),o.addComponent(t,"Economics",{developmentCost:0,unitCost:0,maintenanceCost:0,techLevel:0}),console.log(`‚úàÔ∏è Aircraft created: ${e} (ID: ${t})`),t}createDefaultAircraft(){this.activeAircraftId||(this.activeAircraftId=this.createAircraft(),console.log(`üéØ Default aircraft created: ${this.activeAircraftId}`))}setActiveAircraft(e){if(!o.entities.has(e))throw new Error(`Aircraft ${e} does not exist`);this.activeAircraftId=e,console.log(`üéØ Active aircraft set to: ${e}`)}getActiveAircraftId(){return this.activeAircraftId}getAircraftData(e=null){const t=e||this.activeAircraftId;return!t||!o.entities.has(t)?null:{id:t,identity:o.getComponent(t,"Identity"),structure:o.getComponent(t,"Structure"),propulsion:o.getComponent(t,"Propulsion"),aerodynamics:o.getComponent(t,"Aerodynamics"),performance:o.getComponent(t,"Performance"),armament:o.getComponent(t,"Armament"),avionics:o.getComponent(t,"Avionics"),economics:o.getComponent(t,"Economics")}}updateComponent(e,t,i){const n=o.getComponent(e,t);if(!n)throw new Error(`Component ${t} not found on aircraft ${e}`);const a={...n,...i};o.addComponent(e,t,a),this.updateLastModified(e),console.log(`üîß Aircraft ${e} component '${t}' updated`)}updateLastModified(e){const t=o.getComponent(e,"Identity");if(t){const i={...t,lastModified:Date.now()};o.addComponent(e,"Identity",i)}}validateAircraft(e=null){const t=e||this.activeAircraftId,i=this.getAircraftData(t);if(!i)return{isValid:!1,errors:["Aircraft not found"]};const n=[],a=[];return i.structure?.airframe||n.push("Nenhuma fuselagem selecionada"),i.propulsion?.engines?.length||n.push("Nenhum motor selecionado"),i.aerodynamics?.wings?.type||n.push("Nenhum tipo de asa selecionado"),i.performance?.thrustToWeight<.3&&a.push("Rela√ß√£o empuxo/peso muito baixa"),{isValid:n.length===0,errors:n,warnings:a}}getAllAircraft(){return o.getAircraftWithComponents("Identity","Structure")}destroyAircraft(e){this.activeAircraftId===e&&(this.activeAircraftId=null),o.destroyAircraft(e),console.log(`üóëÔ∏è Aircraft destroyed: ${e}`)}}const s=new E;window.aircraftEntityManager=s;class _{constructor(){this.isInitialized=!1,this.legacyAircraftProxy=null,this.updating=!1,this.updateTimeout=null}initialize(){this.isInitialized||(s.initialize(),this.setupLegacyProxy(),this.setupLegacyFunctions(),this.isInitialized=!0,console.log("üîÑ Legacy bridge initialized"))}setupLegacyProxy(){this.legacyAircraftProxy=new Proxy({},{get:(e,t)=>{const i=s.getAircraftData();if(!i)return this.getDefaultValue(t);switch(t){case"name":return i.identity?.name||"Nova Aeronave";case"airframe":return i.structure?.airframe||null;case"engine":return i.propulsion?.engines?.[0]||null;case"wings":return{type:i.aerodynamics?.wings?.type||null,features:i.aerodynamics?.wings?.features||[]};case"weapons":return i.armament?.weapons||[];case"avionics":return i.avionics||{};case"quantity":return i.economics?.quantity||1;default:return e[t]}},set:(e,t,i)=>{const n=s.getActiveAircraftId();if(!n)return console.warn("‚ö†Ô∏è No active aircraft to update"),!1;if(this.updating)return!0;try{switch(this.updating=!0,t){case"name":s.updateComponent(n,"Identity",{name:i});break;case"airframe":s.updateComponent(n,"Structure",{airframe:i});break;case"engine":s.updateComponent(n,"Propulsion",{engines:i?[i]:[]});break;case"wings":if(typeof i=="object"){const a=s.getAircraftData()?.aerodynamics?.wings||{};s.updateComponent(n,"Aerodynamics",{wings:{...a,...i}})}break;case"weapons":s.updateComponent(n,"Armament",{weapons:i});break;case"avionics":s.updateComponent(n,"Avionics",i);break;case"quantity":s.updateComponent(n,"Economics",{quantity:i});break;default:e[t]=i}return window.updateAircraftCalculations&&!this.updateTimeout&&(this.updateTimeout=setTimeout(()=>{window.updateAircraftCalculations&&window.updateAircraftCalculations(),this.updateTimeout=null},100)),!0}catch(a){return console.error(`‚ùå Error setting legacy property ${t}:`,a),!1}finally{this.updating=!1}}}),window.currentAircraft=this.legacyAircraftProxy,console.log("üîó Legacy currentAircraft proxy established")}getDefaultValue(e){const t={name:"Nova Aeronave",airframe:null,engine:null,wings:{type:null,features:[]},weapons:[],avionics:{},quantity:1};return t[e]!==void 0?t[e]:null}setupLegacyFunctions(){const e=window.selectAirframe,t=window.selectAircraftEngine,i=window.toggleAircraftWeapon,n=window.updateAircraftCalculations;window.selectAirframe=a=>{e&&e(a);const c=s.getActiveAircraftId();c&&s.updateComponent(c,"Structure",{airframe:a}),console.log(`üõ©Ô∏è Airframe selected via legacy bridge: ${a}`)},window.selectAircraftEngine=a=>{t&&t(a);const c=s.getActiveAircraftId();c&&s.updateComponent(c,"Propulsion",{engines:[a]}),console.log(`‚öôÔ∏è Engine selected via legacy bridge: ${a}`)},window.toggleAircraftWeapon=a=>{i&&i(a);const c=s.getActiveAircraftId();if(c){const u=s.getAircraftData()?.armament?.weapons||[],p=u.indexOf(a);let f;p>-1?f=u.filter(w=>w!==a):f=[...u,a],s.updateComponent(c,"Armament",{weapons:f})}console.log(`üí• Weapon toggled via legacy bridge: ${a}`)},window.updateAircraftCalculations=()=>{n&&n(),console.log("üìä Aircraft calculations updated via legacy bridge")},window.getCurrentAircraft=()=>window.currentAircraft,window.getAircraftECSData=()=>s.getAircraftData(),console.log("üîó Legacy functions bridged")}validateBridge(){try{if(!window.currentAircraft)throw new Error("currentAircraft proxy not available");return typeof window.currentAircraft.name!="string"&&console.warn("‚ö†Ô∏è currentAircraft.name not returning string, but bridge is functional"),typeof window.selectAirframe!="function"&&console.warn("‚ö†Ô∏è selectAirframe function not available"),typeof window.updateAircraftCalculations!="function"&&console.warn("‚ö†Ô∏è updateAircraftCalculations function not available"),console.log("‚úÖ Legacy bridge validation passed"),!0}catch(e){return console.error("‚ùå Legacy bridge validation failed:",e),!1}}getActiveAircraftId(){return s.getActiveAircraftId()}createAircraft(e){return s.createAircraft(e)}}const g=new _;window.legacyBridge=g;let d=null;async function T(){const r=document.getElementById("initial-loading"),e=document.getElementById("loading-status"),t=i=>{e&&(e.textContent=i)};try{t("Aguardando autentica√ß√£o..."),A.onAuthStateChanged(async i=>{if(i){t("Usu√°rio autenticado. Verificando pa√≠s...");const n=await h(i.uid);if(n){t("Pa√≠s encontrado. Carregando dados de tecnologia...");const[a,c]=await Promise.all([C(n),y()]);if(a){const m=1953+(c?.turnoAtual||1),u=a.Aeronautica||50;if(d={...a,id:n,aircraftTech:u,name:a.Pais,year:m},window.currentUserCountry=d,console.log(`‚úÖ Pa√≠s do usu√°rio carregado: ${d.name} | Ano: ${d.year}`,d),t("Inicializando sistema de aeronaves..."),g.initialize(),!g.validateBridge())throw new Error("Falha na inicializa√ß√£o do sistema ECS de aeronaves");console.log("‚úÖ Aircraft ECS system initialized successfully"),window.aircraftCreatorApp&&!window.aircraftCreatorApp.isInitialized&&await window.aircraftCreatorApp.initialize()}else throw new Error(`N√£o foi poss√≠vel carregar os dados para o pa√≠s com ID: ${n}`)}else throw t("Voc√™ n√£o est√° vinculado a um pa√≠s. Redirecionando..."),setTimeout(()=>{window.location.href="index.html"},3e3),new Error("Usu√°rio n√£o vinculado a um pa√≠s.")}else throw t("Nenhum usu√°rio logado. Redirecionando para a p√°gina inicial..."),setTimeout(()=>{window.location.href="index.html"},3e3),new Error("Usu√°rio n√£o autenticado.")})}catch(i){console.error("‚ùå Erro fatal na inicializa√ß√£o do Criador de Aeronaves:",i),t(`Erro: ${i.message}`),r&&(r.innerHTML=`<div class="text-red-400 text-center p-4">${i.message}</div>`)}}async function S(){console.log("üîÑ Carregando todos os componentes da aeronave via import din√¢mico...");try{const r=await l(()=>import("./airframes-BQ2DhmGT.js"),[]),e=await l(()=>import("./aircraft_engines-CxKa-iZa.js"),[]),t=await l(()=>import("./aircraft_weapons-D0VVw60T.js"),[]),i=await l(()=>import("./avionics-C4CyQW2d.js"),[]),n=await l(()=>import("./wings-CKabl5NO.js"),[]),a=await l(()=>import("./superchargers-DOJWOdFG.js"),[]),c=await l(()=>import("./special_equipment-Dql9NOlA.js"),[]);return window.AIRCRAFT_COMPONENTS.airframes=r.airframes,window.AIRCRAFT_COMPONENTS.aircraft_engines=e.aircraft_engines,window.AIRCRAFT_COMPONENTS.aircraft_weapons=t.aircraft_weapons,window.AIRCRAFT_COMPONENTS.avionics=i.avionics,window.AIRCRAFT_COMPONENTS.wing_types=n.wing_types,window.AIRCRAFT_COMPONENTS.wing_features=n.wing_features,window.AIRCRAFT_COMPONENTS.superchargers=a.superchargers,window.AIRCRAFT_COMPONENTS.special_equipment=c.special_equipment,console.log("‚úÖ Todos os componentes foram carregados com sucesso."),!0}catch(r){return console.error("‚ùå Erro fatal ao carregar componentes dinamicamente:",r),!1}}window.loadAircraftComponents=S;window.currentAircraft={name:"Nova Aeronave",airframe:null,engine:null,wings:{type:null,features:[]},supercharger:"none",weapons:[],avionics:[],quantity:1};window.AIRCRAFT_COMPONENTS||(window.AIRCRAFT_COMPONENTS={airframes:{},aircraft_engines:{},aircraft_weapons:{},avionics:{},wing_types:{},wing_features:{},superchargers:{}});window.AIRCRAFT_COMPONENTS=window.AIRCRAFT_COMPONENTS;window.currentAircraft=window.currentAircraft;window.getCurrentUserCountry=()=>d;window.selectAirframe=function(r){if(!window.AIRCRAFT_COMPONENTS?.airframes[r]){console.error("Airframe not found:",r);return}window.currentAircraft.airframe=r,document.querySelectorAll(".airframe-card").forEach(t=>{t.classList.remove("selected","border-cyan-400","ring-1","ring-cyan-400/50"),t.classList.add("border-slate-700/50","bg-slate-800/40")});const e=document.querySelector(`[onclick="selectAirframe('${r}')"]`);e&&(e.classList.add("selected","border-cyan-400","ring-1","ring-cyan-400/50"),e.classList.remove("border-slate-700/50","bg-slate-800/40")),updateAircraftCalculations()};window.selectAircraftEngine=function(r){if(!window.AIRCRAFT_COMPONENTS?.aircraft_engines[r]){console.error("Engine not found:",r);return}window.currentAircraft.engine=r,document.querySelectorAll(".engine-card").forEach(t=>{t.classList.remove("selected","border-cyan-400","ring-1","ring-cyan-400/50"),t.classList.add("border-slate-700/50","bg-slate-800/40")});const e=document.querySelector(`[onclick="selectAircraftEngine('${r}')"]`);e&&(e.classList.add("selected","border-cyan-400","ring-1","ring-cyan-400/50"),e.classList.remove("border-slate-700/50","bg-slate-800/40")),updateAircraftCalculations()};window.toggleAircraftWeapon=function(r){window.currentAircraft.weapons||(window.currentAircraft.weapons=[]);const e=window.currentAircraft.weapons.indexOf(r);e>-1?window.currentAircraft.weapons.splice(e,1):window.currentAircraft.weapons.push(r);const t=document.querySelector(`[onclick="toggleAircraftWeapon('${r}')"]`);t&&(t.classList.toggle("selected"),t.classList.toggle("border-cyan-400")),updateAircraftCalculations()};window.updateAircraftCalculations=function(){if(window.calculateAircraftPerformance){const r=window.calculateAircraftPerformance();P(r)}if(window.calculateAircraftCosts){const r=window.calculateAircraftCosts();updateCostDisplays(r)}};function P(r){const e=document.getElementById("total-weight-display"),t=document.getElementById("max-speed-display"),i=document.getElementById("thrust-weight-ratio-display");if(e&&r.totalWeight&&(e.textContent=Math.round(r.totalWeight)+" kg"),t&&(r.maxSpeed||r.maxSpeedKph)){const n=r.maxSpeed||r.maxSpeedKph;t.textContent=Math.round(n)+" km/h"}i&&r.thrustToWeight&&(i.textContent=r.thrustToWeight.toFixed(2)+":1")}document.addEventListener("DOMContentLoaded",function(){console.log("üöÄ Inicializando sistema de aeronaves com novo fluxo..."),T()});
