import{h as l}from"./firebase-COmVF2I9.js";async function y(){try{const d=await l.collection("paises").get();if(d.empty)return 0;let e=0,t=0;return d.forEach(o=>{const a=parseFloat(o.data().PIB);isNaN(a)||(e+=a,t++)}),t>0?e/t:0}catch(d){return console.error("Error calculating global average GDP:",d),0}}class v{constructor(){this.maxLevel=10,this.baseMaintenancePercent=.005}calculateUpgradeCost(e,t,o,a=null){if(e>=this.maxLevel)return 0;const n=a||e+1;if(n>this.maxLevel)return 0;const u=t.Marinha||1,p=t.IndustrialEfficiency||30,h=t.PIB||0,c=15e-7,s=100,r=200,i=.5,g=.5,m=1+u/s,f=1+p/r,M=(o*i+h*g)*c/(m*f)*Math.pow(n,2)*Math.pow(1.6,n);return Math.round(M*1e3)}calculateMaintenanceCost(e,t){if(e===0)return 0;const o=this.baseMaintenancePercent*Math.pow(e,2)*Math.pow(1.5,e);return Math.round(t*o)}calculateProductionBonus(e){if(e===0)return{parallelMultiplier:.5,timeReduction:0,maxSimultaneous:1};const t=1+e*.3,o=Math.min(.5,e*.05),a=Math.min(15,1+e);return{parallelMultiplier:t,timeReduction:o,maxSimultaneous:a}}getLevelInfo(e,t=null,o=null){const a=this.calculateProductionBonus(e),n=t&&o!=null?this.calculateUpgradeCost(e,t,o):0;return{level:e,description:this.getLevelDescription(e),upgradeCost:n,parallelBonus:Math.round((a.parallelMultiplier-1)*100),timeReduction:Math.round(a.timeReduction*100),maxProjects:a.maxSimultaneous,maintenancePercent:e===0?0:this.baseMaintenancePercent*Math.pow(e,2)*Math.pow(1.5,e)}}getLevelDescription(e){return{0:"Sem estaleiros - Produ√ß√£o naval severamente limitada",1:"Estaleiro B√°sico - Opera√ß√µes navais simples",2:"Estaleiro Melhorado - Maior efici√™ncia produtiva",3:"Estaleiro Avan√ßado - Constru√ß√£o de navios m√©dios",4:"Estaleiro Industrial - Produ√ß√£o em s√©rie",5:"Estaleiro Moderno - Tecnologia avan√ßada",6:"Complexo Naval - M√∫ltiplos projetos simult√¢neos",7:"Arsenal Imperial - Constru√ß√£o de grandes navios",8:"Estaleiro de Elite - Efici√™ncia excepcional",9:"Complexo Estrat√©gico - Supremacia naval",10:"Arsenal Supremo - Poder naval absoluto"}[e]||"N√≠vel desconhecido"}canUpgrade(e,t,o,a){if(e>=this.maxLevel)return{canUpgrade:!1,reason:"N√≠vel m√°ximo atingido"};const n=this.calculateUpgradeCost(e,t,o);return a<n?{canUpgrade:!1,reason:`Or√ßamento insuficiente. Necess√°rio: ${n.toLocaleString()}`}:{canUpgrade:!0,upgradeCost:n}}applyShipyardBonusToProduction(e,t,o=0){const a=this.calculateProductionBonus(t),n=e.build_time_months*(1-a.timeReduction)*(1-o);return{...e,build_time_months:Math.ceil(n),max_parallel:Math.ceil((e.max_parallel||1)*a.parallelMultiplier),shipyard_efficiency:a.parallelMultiplier,time_reduction_percent:Math.round(a.timeReduction*100),production_line_bonus_percent:Math.round(o*100)}}async getCurrentShipyardLevel(e){try{const t=await l.collection("paises").doc(e).get();return t.exists&&t.data().shipyardLevel||0}catch(t){return console.error("Erro ao obter n√≠vel do estaleiro:",t),0}}async upgradeShipyard(e){try{const t=await l.collection("paises").doc(e).get();if(!t.exists)throw new Error("Pa√≠s n√£o encontrado.");const o=t.data(),a=o.shipyardLevel||0,n=parseFloat(o.PIB)||0,u=(parseFloat(o.Burocracia)||0)/100,p=(parseFloat(o.Estabilidade)||0)/100,h=n*.25*u*(p*1.5),c=await y(),s=this.canUpgrade(a,o,c,h);if(!s.canUpgrade)throw new Error(s.reason);const r=a+1,i=s.upgradeCost;return await l.collection("paises").doc(e).update({shipyardLevel:r,lastShipyardUpgrade:new Date}),await l.collection("shipyard_transactions").add({countryId:e,type:"upgrade",fromLevel:a,toLevel:r,cost:i,timestamp:new Date}),{success:!0,newLevel:r,cost:i,levelInfo:this.getLevelInfo(r,o,c)}}catch(t){return console.error("Erro ao fazer upgrade do estaleiro:",t),{success:!1,error:t.message}}}async applyMaintenanceCosts(){try{console.log("üîß Aplicando custos de manuten√ß√£o dos estaleiros...");const e=await l.collection("paises").get(),t=[];for(const o of e.docs){const a=o.data(),n=a.shipyardLevel||0;if(n===0)continue;const u=parseFloat(a.PIB)||0,p=(parseFloat(a.Burocracia)||0)/100,h=(parseFloat(a.Estabilidade)||0)/100,c=u*.25*p*(h*1.5),s=this.calculateMaintenanceCost(n,c),r=s/c*100;let i=0;r>10&&(i=-Math.min(5,Math.floor((r-10)/2)));const g=Math.max(0,(parseFloat(a.Estabilidade)||0)+i),m={lastShipyardMaintenance:new Date,shipyardMaintenanceCost:s};i!==0&&(m.Estabilidade=g),await l.collection("paises").doc(o.id).update(m),t.push({countryId:o.id,countryName:a.Pais,shipyardLevel:n,maintenanceCost:s,maintenancePercent:r.toFixed(2),stabilityImpact:i})}return console.log(`‚úÖ Manuten√ß√£o aplicada a ${t.length} pa√≠ses com estaleiros`),t}catch(e){throw console.error("‚ùå Erro ao aplicar manuten√ß√£o dos estaleiros:",e),e}}}export{v as S};
