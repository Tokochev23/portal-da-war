const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/renderer-C5IsPkZP.js","assets/utils-DLoRv3re.js","assets/resourceConsumptionCalculator-Bk-hb2mA.js","assets/resourceProductionCalculator-C5abBl5S.js","assets/consumerGoodsCalculator-RQh-OK8I.js","assets/firebase-BN3MSMQD.js","assets/preload-helper-f85Crcwt.js","assets/espionageOperationsSystem-BGbE2zV3.js","assets/worldMap-Dt5RFk0g.js"])))=>i.map(i=>d[i]);
import{_ as z}from"./preload-helper-f85Crcwt.js";/* empty css             */import{L as p,V as re,s as u}from"./utils-DLoRv3re.js";import{auth as f,signInWithGooglePreserveRole as Q,signInWithEmailPassword as X,registerWithEmailPassword as K,checkUserPermissions as J,updateTurn as le,getAllCountries as ce,getGameConfig as de,checkPlayerCountry as ue,db as G,vincularJogadorAoPaisSemRebaixar as me}from"./firebase-BN3MSMQD.js";import{r as Z,f as $,a as ge,u as F,b as H,c as he}from"./renderer-C5IsPkZP.js";import{t as pe}from"./turnEventsSystem-OI6U8ZIC.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions-compat.js";import"./resourceConsumptionCalculator-Bk-hb2mA.js";import"./resourceProductionCalculator-C5abBl5S.js";import"./consumerGoodsCalculator-RQh-OK8I.js";import"./espionageOperationsSystem-BGbE2zV3.js";import"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";class fe{constructor(){this.focusableElements=[],this.currentFocusIndex=-1,this.skipLinks=[],this.announcements=new Set,this.init()}init(){this.createSkipLinks(),this.setupKeyboardNavigation(),this.setupFocusManagement(),this.setupLiveRegions(),this.setupAnnouncements(),this.setupColorContrastMode(),this.setupReducedMotion(),p.info("Sistema de acessibilidade inicializado")}createSkipLinks(){const e=document.createElement("div");e.className="skip-links sr-only-focusable",e.innerHTML=`
            <a href="#main-content" class="skip-link">Pular para conteúdo principal</a>
            <a href="#navigation" class="skip-link">Pular para navegação</a>
            <a href="#countries-list" class="skip-link">Pular para lista de países</a>
            <a href="#player-panel" class="skip-link">Pular para painel do jogador</a>
        `,document.body.insertBefore(e,document.body.firstChild),this.addSkipLinksStyles()}addSkipLinksStyles(){const e=document.createElement("style");e.textContent=`
            .skip-links {
                position: absolute;
                top: -40px;
                left: 6px;
                z-index: 1000;
            }
            
            .skip-link {
                position: absolute;
                top: -40px;
                left: 6px;
                background: #ffb400;
                color: #0b1020;
                padding: 8px;
                text-decoration: none;
                border-radius: 4px;
                font-weight: bold;
                font-size: 14px;
                transition: top 0.3s ease;
            }
            
            .skip-link:focus {
                top: 6px;
            }
            
            .sr-only {
                position: absolute !important;
                width: 1px !important;
                height: 1px !important;
                padding: 0 !important;
                margin: -1px !important;
                overflow: hidden !important;
                clip: rect(0, 0, 0, 0) !important;
                white-space: nowrap !important;
                border: 0 !important;
            }
            
            .sr-only-focusable:focus,
            .sr-only-focusable:active {
                position: static !important;
                width: auto !important;
                height: auto !important;
                padding: inherit !important;
                margin: inherit !important;
                overflow: visible !important;
                clip: auto !important;
                white-space: inherit !important;
            }
            
            /* Focus indicators melhorados */
            *:focus {
                outline: 2px solid #ffb400;
                outline-offset: 2px;
                border-radius: 4px;
            }
            
            button:focus,
            .country-card-button:focus {
                outline: 2px solid #ffb400;
                outline-offset: 2px;
                box-shadow: 0 0 0 4px rgba(255, 180, 0, 0.2);
            }
            
            /* High contrast mode */
            @media (prefers-contrast: high) {
                .kpi-card,
                .country-card-button,
                .player-panel {
                    border: 2px solid #ffffff;
                    background: #000000;
                    color: #ffffff;
                }
                
                .text-slate-400 {
                    color: #ffffff !important;
                }
                
                .bg-slate-900\\/60 {
                    background: #000000 !important;
                }
            }
            
            /* Reduced motion */
            @media (prefers-reduced-motion: reduce) {
                *,
                *::before,
                *::after {
                    animation-duration: 0.01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: 0.01ms !important;
                    scroll-behavior: auto !important;
                }
            }
        `,document.head.appendChild(e)}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{switch(e.key){case"Tab":this.handleTabNavigation(e);break;case"Escape":this.handleEscape(e);break;case"Enter":case" ":this.handleActivation(e);break;case"ArrowDown":case"ArrowUp":case"ArrowLeft":case"ArrowRight":this.handleArrowNavigation(e);break;case"Home":case"End":this.handleHomeEnd(e);break}})}handleTabNavigation(e){if(this.updateFocusableElements(),this.focusableElements.length===0)return;const t=this.focusableElements.indexOf(document.activeElement);if(e.shiftKey){const o=t<=0?this.focusableElements.length-1:t-1;this.focusableElements[o]?.focus()}else{const o=t>=this.focusableElements.length-1?0:t+1;this.focusableElements[o]?.focus()}}handleEscape(e){document.querySelectorAll('[role="dialog"]:not(.hidden)').forEach(s=>{s.classList.add("hidden");const a=s.getAttribute("data-trigger-element");a&&document.getElementById(a)?.focus()}),document.querySelectorAll('[aria-selected="true"]').forEach(s=>s.setAttribute("aria-selected","false"))}handleActivation(e){const t=e.target;t.getAttribute("role")==="button"&&t.tagName!=="BUTTON"&&(e.preventDefault(),t.click())}handleArrowNavigation(e){const t=e.target,o=t.closest('[role="grid"], [role="listbox"], [role="tablist"]');if(!o)return;e.preventDefault();const s=Array.from(o.querySelectorAll('[role="gridcell"], [role="option"], [role="tab"]')),a=s.indexOf(t);let r;switch(e.key){case"ArrowDown":r=Math.min(a+1,s.length-1);break;case"ArrowUp":r=Math.max(a-1,0);break;case"ArrowRight":r=Math.min(a+1,s.length-1);break;case"ArrowLeft":r=Math.max(a-1,0);break}r!==void 0&&s[r]&&(s[r].focus(),s.forEach((c,l)=>{c.setAttribute("aria-selected",l===r?"true":"false")}))}handleHomeEnd(e){const o=e.target.closest('[role="grid"], [role="listbox"]');if(!o)return;e.preventDefault();const s=Array.from(o.querySelectorAll('[role="gridcell"], [role="option"]'));e.key==="Home"&&s[0]?s[0].focus():e.key==="End"&&s[s.length-1]&&s[s.length-1].focus()}setupFocusManagement(){document.addEventListener("focusin",e=>{this.announceFocusContext(e.target)})}updateFocusableElements(){const e=`
            button:not([disabled]):not(.hidden),
            [href]:not([disabled]):not(.hidden),
            input:not([disabled]):not(.hidden),
            select:not([disabled]):not(.hidden),
            textarea:not([disabled]):not(.hidden),
            [tabindex]:not([tabindex="-1"]):not([disabled]):not(.hidden),
            [role="button"]:not([disabled]):not(.hidden),
            [role="link"]:not([disabled]):not(.hidden)
        `;this.focusableElements=Array.from(document.querySelectorAll(e)).filter(t=>{const o=getComputedStyle(t);return o.display!=="none"&&o.visibility!=="hidden"})}announceFocusContext(e){let t="";const o=e.closest(".country-card-button");if(o){const r=o.querySelector(".text-sm.font-semibold")?.textContent,c=o.querySelector('[class*="font-bold"]')?.textContent;t=`País: ${r}, Índice de poder: ${c}`}e.closest(".player-panel")&&(t="Painel do jogador");const a=e.closest('[role="dialog"]');a&&(t=`Modal: ${a.querySelector("h1, h2, h3")?.textContent||"Diálogo aberto"}`),t&&this.announce(t)}setupLiveRegions(){[{id:"live-polite",level:"polite"},{id:"live-assertive",level:"assertive"},{id:"live-status",level:"polite"}].forEach(t=>{if(!document.getElementById(t.id)){const o=document.createElement("div");o.id=t.id,o.className="sr-only",o.setAttribute("aria-live",t.level),o.setAttribute("aria-atomic","true"),document.body.appendChild(o)}})}setupAnnouncements(){const e=window.showNotification;e&&(window.showNotification=(t,o,s)=>(this.announce(`${t}: ${o}`,t==="error"?"assertive":"polite"),e(t,o,s)))}announce(e,t="polite"){const o=t==="assertive"?"live-assertive":"live-polite",s=document.getElementById(o);!s||this.announcements.has(e)||(this.announcements.add(e),s.textContent="",setTimeout(()=>{s.textContent=e,setTimeout(()=>{s.textContent="",this.announcements.delete(e)},5e3)},100),p.debug(`Anúncio (${t}): ${e}`))}setupColorContrastMode(){const e=window.matchMedia("(prefers-contrast: high)");this.applyContrastMode(e.matches),e.addEventListener("change",t=>{this.applyContrastMode(t.matches)}),this.createContrastToggle()}createContrastToggle(){const e=document.createElement("button");e.id="contrast-toggle",e.className="fixed top-4 left-4 z-50 px-3 py-2 bg-slate-900 text-white border border-slate-600 rounded-lg sr-only-focusable",e.innerHTML=`
            <span class="sr-only">Alternar modo alto contraste</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a4 4 0 004-4V5z" />
            </svg>
        `,e.addEventListener("click",()=>{const t=document.body.classList.toggle("high-contrast-mode");this.announce(`Modo alto contraste ${t?"ativado":"desativado"}`),localStorage.setItem("highContrastMode",t)}),document.body.appendChild(e),localStorage.getItem("highContrastMode")==="true"&&document.body.classList.add("high-contrast-mode")}applyContrastMode(e){document.body.classList.toggle("system-high-contrast",e),e&&this.announce("Modo alto contraste do sistema detectado")}setupReducedMotion(){const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.applyMotionPreference(e.matches),e.addEventListener("change",t=>{this.applyMotionPreference(t.matches)})}applyMotionPreference(e){document.body.classList.toggle("reduce-motion",e),e&&(window.DOMUtils&&(DOMUtils.animateCounter,DOMUtils.animateCounter=(t,o,s={})=>{const a=typeof t=="string"?document.getElementById(t):t;a&&(a.textContent=o.toLocaleString(s.locale||"pt-BR"),s.onComplete?.())}),this.announce("Animações reduzidas ativadas"))}improveSemantics(){if(!(document.querySelector("main")||document.querySelector("#main-content"))){const a=document.querySelector(".mx-auto.max-w-7xl")||document.body;a&&!a.querySelector("main")&&(a.setAttribute("role","main"),a.id="main-content")}const t=document.querySelector("nav");t&&!t.id&&(t.id="navigation",t.setAttribute("aria-label","Navegação principal"));const o=document.getElementById("lista-paises-publicos");o&&(o.setAttribute("role","grid"),o.setAttribute("aria-label","Lista de países disponíveis"),o.id="countries-list",o.querySelectorAll(".country-card-button").forEach((r,c)=>{r.setAttribute("role","gridcell"),r.setAttribute("aria-rowindex",Math.floor(c/4)+1),r.setAttribute("aria-colindex",c%4+1);const l=r.querySelector(".text-sm.font-semibold")?.textContent;l&&r.setAttribute("aria-label",`Selecionar país ${l}`)})),document.querySelectorAll("input, select, textarea").forEach(a=>{if(!a.getAttribute("aria-label")&&!a.id){const r=a.parentElement.querySelector("label");if(r){const c=`input-${Math.random().toString(36).substr(2,9)}`;a.id=c,r.setAttribute("for",c)}else{const c=a.getAttribute("placeholder");c&&a.setAttribute("aria-label",c)}}a.hasAttribute("required")&&a.setAttribute("aria-required","true")})}runAccessibilityCheck(){const e=[];document.querySelectorAll("img:not([alt])").forEach(a=>{e.push(`Imagem sem texto alternativo: ${a.src}`)}),document.querySelectorAll("*").forEach(a=>{const r=getComputedStyle(a),c=r.color,l=r.backgroundColor;c&&l&&c!=="rgba(0, 0, 0, 0)"&&l!=="rgba(0, 0, 0, 0)"&&p.debug("Elemento com cores definidas:",{color:c,background:l})}),document.querySelectorAll("button:not([aria-label]):not([title])").forEach(a=>{a.textContent.trim()||e.push(`Botão sem label: ${a.outerHTML.substring(0,50)}...`)});const o=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6"));let s=0;return o.forEach(a=>{const r=parseInt(a.tagName.charAt(1));r>s+1&&e.push(`Heading level skip: ${a.tagName} after h${s}`),s=r}),e.length>0?p.warn("Issues de acessibilidade encontrados:",e):p.info("Nenhum issue crítico de acessibilidade encontrado"),e}}const I=new fe,ye={announce:(n,e)=>I.announce(n,e),focus:n=>{typeof n=="string"&&(n=document.getElementById(n)||document.querySelector(n)),n?.focus()},check:()=>I.runAccessibilityCheck(),improveSemantics:()=>I.improveSemantics()};document.addEventListener("DOMContentLoaded",()=>{I.improveSemantics(),p.info("Sistema de acessibilidade totalmente carregado")});class be{constructor(){this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),this.isTablet=/iPad|Android.*Tablet/i.test(navigator.userAgent),this.hasTouch="ontouchstart"in window,this.viewportWidth=window.innerWidth,this.searchResults=[],this.currentSearchTerm="",this.searchIndex=null,(this.isMobile||this.hasTouch)&&this.init()}init(){p.info("🔧 Inicializando otimizações mobile"),this.setupMobileViewport(),this.addMobileClasses(),this.createSearchBar(),this.setupTouchGestures(),this.createMobileMenu(),this.setupMobilePanels(),this.createQuickActions(),this.optimizeForMobile(),p.info("✅ Otimizações mobile ativadas")}setupMobileViewport(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",e.content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes",document.head.appendChild(e));const t=document.createElement("style");t.textContent=`
            .no-zoom { touch-action: manipulation; }
            button, .country-card-button { touch-action: manipulation; }
        `,document.head.appendChild(t)}addMobileClasses(){document.body.classList.add(this.isMobile?"is-mobile":"is-desktop",this.isTablet?"is-tablet":"is-phone",this.hasTouch?"has-touch":"no-touch")}setupTouchGestures(){let e=0,t=0,o=!1;document.addEventListener("touchstart",s=>{window.scrollY===0&&(e=s.touches[0].clientY,o=!1)},{passive:!0}),document.addEventListener("touchmove",s=>{window.scrollY===0&&e>0&&(t=s.touches[0].clientY,t-e>60&&!o&&(o=!0,this.showPullToRefresh(),navigator.vibrate&&navigator.vibrate(30)))},{passive:!0}),document.addEventListener("touchend",()=>{o&&this.triggerRefresh(),this.hidePullToRefresh(),e=0,o=!1},{passive:!0}),this.setupSwipeGestures(),this.setupLongPress()}setupSwipeGestures(){let e=0,t=0,o=null;document.addEventListener("touchstart",s=>{const a=s.target.closest(".country-card-button");a&&(e=s.touches[0].clientX,t=s.touches[0].clientY,o=a)},{passive:!0}),document.addEventListener("touchmove",s=>{if(!o)return;const a=e-s.touches[0].clientX,r=t-s.touches[0].clientY;Math.abs(a)>Math.abs(r)&&Math.abs(a)>50&&(s.preventDefault(),this.showCardSwipeActions(o,a>0?"left":"right"))}),document.addEventListener("touchend",()=>{o&&(this.hideCardSwipeActions(o),o=null)},{passive:!0})}setupLongPress(){let e;document.addEventListener("touchstart",t=>{const o=t.target.closest(".country-card-button");o&&(e=setTimeout(()=>{this.showCardContextMenu(o,t.touches[0].clientX,t.touches[0].clientY),navigator.vibrate&&navigator.vibrate(50)},500))},{passive:!0}),document.addEventListener("touchend",()=>clearTimeout(e),{passive:!0}),document.addEventListener("touchmove",()=>clearTimeout(e),{passive:!0})}showPullToRefresh(){let e=document.getElementById("pull-refresh-indicator");e||(e=document.createElement("div"),e.id="pull-refresh-indicator",e.className="fixed top-16 left-1/2 transform -translate-x-1/2 z-50 bg-brand-500 text-slate-950 px-4 py-2 rounded-full shadow-lg flex items-center gap-2 transition-all",e.innerHTML='<div class="animate-spin h-4 w-4 border-2 border-slate-950/30 border-t-slate-950 rounded-full"></div><span class="text-sm font-medium">Puxe para atualizar</span>',document.body.appendChild(e)),e.style.transform="translate(-50%, 0)"}hidePullToRefresh(){const e=document.getElementById("pull-refresh-indicator");e&&(e.style.transform="translate(-50%, -100%)",setTimeout(()=>e.remove(),300))}triggerRefresh(){window.loadSiteData&&window.loadSiteData();const e=document.getElementById("pull-refresh-indicator");e&&(e.innerHTML='<svg class="h-4 w-4 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><span class="text-sm font-medium">Atualizado!</span>',e.className=e.className.replace("bg-brand-500","bg-emerald-500")),ye.announce("Lista de países atualizada"),p.info("📱 Pull-to-refresh executado")}showCardSwipeActions(e,t){if(!e.querySelector(".swipe-indicator")){const o=document.createElement("div");o.className="swipe-indicator absolute inset-y-0 right-2 flex items-center text-brand-400 opacity-50",o.innerHTML=t==="left"?"👁️ Ver detalhes":"⭐ Favoritar",e.style.position="relative",e.appendChild(o)}}hideCardSwipeActions(e){const t=e.querySelector(".swipe-indicator");t&&t.remove()}showCardContextMenu(e,t,o){const s=e.querySelector(".text-sm.font-semibold")?.textContent,a=e.dataset.countryId,r=document.createElement("div");r.className="fixed z-50 bg-bg-soft border border-bg-ring/70 rounded-xl shadow-xl p-2 min-w-48",r.style.left=`${Math.min(t,window.innerWidth-200)}px`,r.style.top=`${Math.min(o,window.innerHeight-150)}px`,r.innerHTML=`
            <div class="text-sm font-medium text-slate-200 px-3 py-2 border-b border-bg-ring/50">${re.sanitizeInput(s||"País")}</div>
            <button class="context-menu-item" data-action="view">...</button>
            ...
        `,r.querySelectorAll(".context-menu-item").forEach(l=>l.addEventListener("click",()=>{this.handleContextAction(l.dataset.action,a,s),r.remove()}));const c=l=>{r.contains(l.target)||(r.remove(),document.removeEventListener("touchstart",c))};document.addEventListener("touchstart",c),document.body.appendChild(r)}handleContextAction(e,t,o){}createMobileMenu(){}showMobileMenu(){}addMobileMenuStyles(){}setupMobilePanels(){}convertToSlideUp(e,t){}showSlideUpPanel(e,t){}setupSwipeToClose(e,t){}createQuickActions(){}openQuickActions(e){}closeQuickActions(e){}optimizeForMobile(){}addShowMoreButton(e,t){}debounceScrollEvents(){}toggleFavorite(e,t){}shareCountry(e,t){}addToCompare(e,t){}showFavorites(){}updateFavoriteIndicators(){}createSearchBar(){}setupSearchFunctionality(){}performSearch(e){}createSearchIndex(e){}fuzzySearch(e,t){}fuzzyMatch(e,t){}getRegion(e){}}document.addEventListener("DOMContentLoaded",()=>{const n=new be;window.__MOBILE_OPTIMIZATIONS__=n});const M=document.getElementById("auth-button"),v=document.getElementById("main-login-btn"),ve=document.getElementById("hero-blurb"),S=document.getElementById("hero-facebook-btn");function W(){return ve||(document.querySelector("h1.text-4xl")?document.querySelector("h1.text-4xl").parentElement:null)}const y=document.getElementById("turn-post-button"),O=document.getElementById("filtro-visibilidade"),ee=document.getElementById("refresh-paises"),te=document.getElementById("search-country-input"),j=document.getElementById("turno-editor");document.getElementById("last-sync");const B=document.getElementById("lista-paises-publicos"),m=document.getElementById("country-panel-modal"),oe=document.getElementById("close-country-panel"),b=document.getElementById("auth-modal"),E=document.getElementById("login-tab"),w=document.getElementById("register-tab"),x=document.getElementById("login-form"),A=document.getElementById("register-form"),ne=document.getElementById("google-login-btn"),se=document.getElementById("close-auth-modal"),T=document.getElementById("auth-error-message"),P=document.getElementById("auth-success-message");let i={allCountries:[],gameConfig:{},isDataLoaded:!1,playerCountry:null,currentTurn:0};window.appState=i;let L="login";function D(n="login"){L=n,k(),b.classList.remove("hidden"),h()}function g(){b.classList.add("hidden"),h(),Ee()}function k(){const n=L==="login";n?(E.classList.add("bg-brand-500","text-slate-950"),E.classList.remove("text-slate-300","hover:text-slate-100"),w.classList.remove("bg-brand-500","text-slate-950"),w.classList.add("text-slate-300","hover:text-slate-100")):(w.classList.add("bg-brand-500","text-slate-950"),w.classList.remove("text-slate-300","hover:text-slate-100"),E.classList.remove("bg-brand-500","text-slate-950"),E.classList.add("text-slate-300","hover:text-slate-100")),n?(x.classList.remove("hidden"),A.classList.add("hidden"),document.getElementById("auth-modal-title").textContent="Entrar no Portal",document.getElementById("auth-modal-subtitle").textContent="Acesse sua conta"):(x.classList.add("hidden"),A.classList.remove("hidden"),document.getElementById("auth-modal-title").textContent="Criar Conta",document.getElementById("auth-modal-subtitle").textContent="Registre-se para começar")}function h(){T.classList.add("hidden"),P.classList.add("hidden")}function d(n){T.textContent=n,T.classList.remove("hidden"),P.classList.add("hidden")}function ae(n){P.textContent=n,P.classList.remove("hidden"),T.classList.add("hidden")}function Ee(){x.reset(),A.reset()}async function q(){console.log("Carregando dados do site...");try{if(document.querySelectorAll(".loading-shimmer").forEach(n=>n.style.display="inline"),i.allCountries=await ce(),i.gameConfig=await de(),i.currentTurn=i.gameConfig?.turnoAtual||0,pe.init(i.currentTurn),console.log("Países carregados:",i.allCountries.length),console.log("Config do jogo:",i.gameConfig),i.allCountries.length>0){F(i.allCountries),C();const n=document.getElementById("turno-atual");n&&i.gameConfig&&i.gameConfig.turnoAtual&&(n.textContent=`#${i.gameConfig.turnoAtual}`),document.querySelectorAll(".loading-shimmer").forEach(e=>e.style.display="none"),i.isDataLoaded=!0,Ae()}else console.warn("Nenhum país encontrado no Firestore"),u("warning","Nenhum país encontrado. Verifique a configuração do Firestore.")}catch(n){console.error("Erro ao carregar dados:",n),u("error","Erro ao carregar dados do servidor.")}Ce(),f.currentUser&&y&&i.gameConfig&&i.gameConfig.turnoAtual&&(y.textContent=`Ver turno #${i.gameConfig.turnoAtual} (Facebook)`)}function C(){const n=O.value,e=te.value.toLowerCase();let t=[];n==="todos"?t=i.allCountries:n==="publicos"?t=i.allCountries.filter(o=>o.Visibilidade&&o.Visibilidade.toLowerCase()==="público"):n==="privados"?t=i.allCountries.filter(o=>o.Visibilidade&&o.Visibilidade.toLowerCase()==="privado"):n==="com-jogadores"?t=i.allCountries.filter(o=>o.Player):n==="sem-jogadores"&&(t=i.allCountries.filter(o=>!o.Player)),e&&(t=t.filter(o=>o.Pais&&o.Pais.toLowerCase().includes(e))),console.log(`Renderizando ${t.length} países (filtro: ${n}, busca: ${e})`),ge(t),we()}M.addEventListener("click",()=>{console.log("Botão auth clicado"),f.currentUser?(console.log("Fazendo logout"),f.signOut()):(console.log("Abrindo modal de login"),D("login"))});v.addEventListener("click",()=>{console.log("Botão main login clicado"),D("login")});E.addEventListener("click",()=>{L="login",k(),h()});w.addEventListener("click",()=>{L="register",k(),h()});se.addEventListener("click",g);oe.addEventListener("click",()=>{m.classList.add("hidden")});ne.addEventListener("click",async()=>{console.log("Tentando login com Google"),h();try{const n=await Q();console.log("Resultado do login Google:",n),n.success?(g(),u("success",`Bem-vindo, ${n.user.displayName}!`)):(console.error("Erro no login Google:",n.error),d(n.error?n.error.message:"Erro no login com Google."))}catch(n){console.error("Erro inesperado no login Google:",n),d("Erro inesperado no login com Google.")}});x.addEventListener("submit",async n=>{n.preventDefault(),console.log("Submetendo form de login"),h();const e=document.getElementById("login-email").value,t=document.getElementById("login-password").value;console.log("Tentando login com email:",e);try{const o=await X(e,t);console.log("Resultado do login:",o),o.success?(g(),u("success","Login realizado com sucesso!")):(console.error("Erro no login:",o.error),d(o.error?o.error.message:"Erro no login."))}catch(o){console.error("Erro inesperado no login:",o),d("Erro inesperado no login.")}});A.addEventListener("submit",async n=>{n.preventDefault(),console.log("Submetendo form de registro"),h();const e=document.getElementById("register-name").value,t=document.getElementById("register-email").value,o=document.getElementById("register-password").value,s=document.getElementById("register-confirm-password").value;if(o!==s){d("As senhas não coincidem.");return}if(o.length<6){d("A senha deve ter pelo menos 6 caracteres.");return}console.log("Tentando registro com email:",t);try{const a=await K(t,o,e);console.log("Resultado do registro:",a),a.success?(ae("Conta criada com sucesso! Redirecionando..."),setTimeout(()=>{g(),u("success",`Bem-vindo ao WAR, ${e}!`)},1500)):(console.error("Erro no registro:",a.error),d(a.error?a.error.message:"Erro no registro."))}catch(a){console.error("Erro inesperado no registro:",a),d("Erro inesperado no registro.")}});b.addEventListener("click",n=>{n.target===b&&g()});m.addEventListener("click",n=>{n.target===m&&m.classList.add("hidden")});B&&B.addEventListener("click",async n=>{const e=n.target.closest(".country-card-button");if(!e)return;n.preventDefault();const t=e.dataset.countryId,o=i.allCountries.find(s=>s.id===t);o&&await Z(o)});document.addEventListener("keydown",n=>{n.key==="Escape"&&(b.classList.contains("hidden")||g(),m.classList.contains("hidden")||m.classList.add("hidden"))});O.addEventListener("change",C);te.addEventListener("input",C);ee.addEventListener("click",q);function we(){const n=document.querySelectorAll(".country-card-button");n.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const o=e.dataset.countryId,s=i.allCountries.find(a=>a.id===o);s&&(console.log("País clicado:",s.Pais),u("info",`Você clicou em ${s.Pais}`))})}),console.log(`Event listeners adicionados para ${n.length} países`)}function Ce(){const n=new Date,e=document.getElementById("last-sync");e&&(e.textContent=n.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}))}async function Le(n){if(console.log("Mudança de estado de autenticação:",n?"Logado":"Deslogado"),n){M.querySelector(".btn-text").textContent="Sair";const e=W();e&&e.classList.add("hidden"),y&&y.classList.remove("hidden"),v&&v.classList.add("hidden"),S&&S.classList.add("hidden"),console.log("Usuário logado:",n.displayName||n.email);try{const t=await J(n.uid);console.log("Permissões do usuário:",t),H(t.isNarrator,t.isAdmin);const o=await ue(n.uid);if(console.log("País do jogador:",o),o){const s=i.allCountries.find(a=>a.id===o);s&&(localStorage.setItem("loggedCountry",s.id),console.log("País salvo no localStorage (main):",s.id),i.playerCountry=s,console.log("DEBUG: appState.playerCountry definido como:",s),i.currentTurn=i.gameConfig.turnoAtual||0,$(s,i.gameConfig.turnoAtual))}else{const s=i.allCountries.filter(a=>!a.Player);if(s.length>0){const a=he(s);xe(a,n.uid)}else u("warning","Não há países disponíveis para seleção no momento.")}}catch(t){console.error("Erro ao processar login do usuário:",t),u("error","Erro ao carregar dados do usuário.")}}else{M.querySelector(".btn-text").textContent="Entrar",H(!1,!1),$(null),ie();const e=W();e&&e.classList.remove("hidden"),y&&y.classList.add("hidden"),v&&v.classList.remove("hidden"),S&&S.classList.remove("hidden")}}function xe(n,e){let t=null;const o=n.querySelectorAll(".pais-option"),s=n.querySelector("#confirmar-selecao"),a=n.querySelector("#cancelar-selecao"),r=n.querySelector("#busca-pais"),c=n.querySelector("#paises-visiveis");o.forEach(l=>{l.addEventListener("click",()=>{o.forEach(R=>R.classList.remove("border-brand-500","bg-brand-500/10")),l.classList.add("border-brand-500","bg-brand-500/10"),t={id:l.dataset.paisId,name:l.dataset.paisNome},s.disabled=!1})}),r&&c&&r.addEventListener("input",l=>{const R=l.target.value.toLowerCase();let V=0;o.forEach(_=>{const U=_.dataset.paisNome.toLowerCase().includes(R);_.style.display=U?"block":"none",U&&V++}),c.textContent=V}),s&&s.addEventListener("click",async()=>{if(t){s.textContent="Vinculando...",s.disabled=!0;try{await me(e,t.id),n.remove(),u("success",`Você agora governa ${t.name}!`),q()}catch(l){u("error","Erro ao vincular país. Tente novamente."),console.error("Erro ao vincular país:",l)}finally{s.textContent="Confirmar Seleção",s.disabled=!1}}}),a&&a.addEventListener("click",()=>{n.remove()})}M.addEventListener("click",()=>{console.log("Botão auth clicado"),f.currentUser?(console.log("Fazendo logout"),f.signOut()):(console.log("Abrindo modal de login"),D("login"))});v.addEventListener("click",()=>{console.log("Botão main login clicado"),D("login")});E.addEventListener("click",()=>{L="login",k(),h()});w.addEventListener("click",()=>{L="register",k(),h()});se.addEventListener("click",g);oe.addEventListener("click",()=>{m.classList.add("hidden")});ne.addEventListener("click",async()=>{console.log("Tentando login com Google"),h();try{const n=await Q();console.log("Resultado do login Google:",n),n.success?(g(),u("success",`Bem-vindo, ${n.user.displayName}!`)):(console.error("Erro no login Google:",n.error),d(n.error?n.error.message:"Erro no login com Google."))}catch(n){console.error("Erro inesperado no login Google:",n),d("Erro inesperado no login com Google.")}});x.addEventListener("submit",async n=>{n.preventDefault(),console.log("Submetendo form de login"),h();const e=document.getElementById("login-email").value,t=document.getElementById("login-password").value;console.log("Tentando login com email:",e);try{const o=await X(e,t);console.log("Resultado do login:",o),o.success?(g(),u("success","Login realizado com sucesso!")):(console.error("Erro no login:",o.error),d(o.error?o.error.message:"Erro no login."))}catch(o){console.error("Erro inesperado no login:",o),d("Erro inesperado no login.")}});A.addEventListener("submit",async n=>{n.preventDefault(),console.log("Submetendo form de registro"),h();const e=document.getElementById("register-name").value,t=document.getElementById("register-email").value,o=document.getElementById("register-password").value,s=document.getElementById("register-confirm-password").value;if(o!==s){d("As senhas não coincidem.");return}if(o.length<6){d("A senha deve ter pelo menos 6 caracteres.");return}console.log("Tentando registro com email:",t);try{const a=await K(t,o,e);console.log("Resultado do registro:",a),a.success?(ae("Conta criada com sucesso! Redirecionando..."),setTimeout(()=>{g(),u("success",`Bem-vindo ao WAR, ${e}!`)},1500)):(console.error("Erro no registro:",a.error),d(a.error?a.error.message:"Erro no registro."))}catch(a){console.error("Erro inesperado no registro:",a),d("Erro inesperado no registro.")}});b.addEventListener("click",n=>{n.target===b&&g()});m.addEventListener("click",n=>{n.target===m&&m.classList.add("hidden")});B&&B.addEventListener("click",async n=>{const e=n.target.closest(".country-card-button");if(!e)return;n.preventDefault();const t=e.dataset.countryId,o=i.allCountries.find(s=>s.id===t);o&&await Z(o)});document.addEventListener("keydown",n=>{n.key==="Escape"&&(b.classList.contains("hidden")||g(),m.classList.contains("hidden")||m.classList.add("hidden"))});O.addEventListener("change",C);ee.addEventListener("click",q);j&&j.addEventListener("change",async n=>{const e=n.target.value;if(f.currentUser&&(await J(f.currentUser.uid)).isNarrator)if(await le(e)){u("success",`Turno atualizado para #${e}`),i.gameConfig.turnoAtual=e;const s=i.allCountries.find(a=>a.Player===f.currentUser.uid);s&&localStorage.setItem("loggedCountry",s.id),$(s,e)}else u("error","Erro ao salvar turno.")});f.onAuthStateChanged(Le);let N=new Map;function Ae(){console.log("Configurando sincronização em tempo real...");const n=G.collection("paises").onSnapshot(t=>{console.log("Mudanças detectadas na coleção de países"),t.docChanges().forEach(o=>{const s={id:o.doc.id,...o.doc.data()},a=i.allCountries.findIndex(r=>r.id===o.doc.id);o.type==="added"&&a===-1?(i.allCountries.push(s),console.log(`País adicionado: ${s.Pais}`)):o.type==="modified"&&a!==-1?(i.allCountries[a]=s,console.log(`País atualizado: ${s.Pais}`)):o.type==="removed"&&a!==-1&&(i.allCountries.splice(a,1),console.log(`País removido: ${s.Pais}`))}),i.isDataLoaded&&(F(i.allCountries),C(),console.log("Interface atualizada automaticamente"))},t=>{console.error("Erro no listener de países:",t)});N.set("countries",n),window.addEventListener("realtime:update",t=>{console.log("Evento realtime:update recebido:",t.detail);const{countryId:o,section:s,field:a,newValue:r}=t.detail,c=i.allCountries.findIndex(l=>l.id===o);if(c!==-1){const l=i.allCountries[c];l[s]||(l[s]={}),l[s][a]=r,s==="geral"&&(l[a]=r),console.log(`Campo ${a} do país ${l.Pais} atualizado via broadcast:`,r),F(i.allCountries),C()}});const e=G.collection("configuracoes").doc("jogo").onSnapshot(t=>{if(t.exists){const o=t.data();if(i.gameConfig.turnoAtual!==o.turnoAtual){console.log(`Turno atualizado: ${i.gameConfig.turnoAtual} → ${o.turnoAtual}`),i.gameConfig=o;const s=document.getElementById("turno-atual");s&&(s.textContent=`#${o.turnoAtual}`),y&&(y.textContent=`Ver turno #${o.turnoAtual} (Facebook)`)}}},t=>{console.error("Erro no listener de configuração:",t)});N.set("config",e),console.log("Sincronização em tempo real ativada ✅")}function ie(){console.log("Removendo listeners de tempo real..."),N.forEach(n=>n()),N.clear()}window.addEventListener("beforeunload",()=>{ie()});document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("btn-main-agency");n&&n.addEventListener("click",()=>{i.playerCountry&&z(()=>import("./renderer-C5IsPkZP.js").then(e=>e.e),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>{const t=document.createElement("div");t.id="agency-modal",t.className="fixed inset-0 z-[70] flex items-center justify-center bg-black/70 backdrop-blur-sm",t.innerHTML=`
            <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-6xl max-h-[90vh] overflow-y-auto m-4 p-6">
              <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                  <span class="text-4xl">🕵️</span>
                  <div>
                    <h3 class="text-2xl font-bold text-slate-100">Agência de Inteligência</h3>
                    <p class="text-sm text-slate-400">${i.playerCountry.Pais}</p>
                  </div>
                </div>
                <button id="close-agency-modal" class="text-slate-400 hover:text-slate-200 text-2xl transition">×</button>
              </div>
              <div id="agency-dashboard-content">
                <div class="text-center py-12">
                  <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500 mx-auto mb-4"></div>
                  <p class="text-slate-400">Carregando...</p>
                </div>
              </div>
            </div>
          `,document.body.appendChild(t);const o=document.getElementById("close-agency-modal");o&&o.addEventListener("click",()=>t.remove()),t.addEventListener("click",s=>{s.target===t&&t.remove()}),z(()=>import("./renderer-C5IsPkZP.js").then(s=>s.d),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(s=>{const a=document.getElementById("agency-dashboard-content");a&&s.renderAgencyDashboard(i.playerCountry,a)})})})});let Y=null;async function ke(){try{if(!document.getElementById("world-map-player")){console.log("Container do mapa não encontrado");return}const{WorldMap:e}=await z(async()=>{const{WorldMap:o}=await import("./worldMap-Dt5RFk0g.js").then(s=>s.w);return{WorldMap:o}},__vite__mapDeps([8,5,6,1]));Y=new e("world-map-player"),await Y.initialize(!1);const t=document.getElementById("map-info-text-player");t&&(t.textContent="Mapa carregado com sucesso!"),console.log("Mapa mundial (players) inicializado")}catch(n){console.error("Erro ao inicializar mapa mundial:",n);const e=document.getElementById("map-info-text-player");e&&(e.textContent="Erro ao carregar mapa: "+n.message)}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM carregado, iniciando aplicação"),q(),setTimeout(()=>{ke()},500)});
