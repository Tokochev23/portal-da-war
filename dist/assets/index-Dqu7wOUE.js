const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/renderer-HdU8-N65.js","assets/utils-DLoRv3re.js","assets/resourceConsumptionCalculator-Bk-hb2mA.js","assets/resourceProductionCalculator-C5abBl5S.js","assets/consumerGoodsCalculator-RQh-OK8I.js","assets/firebase-DaxaZSOr.js","assets/preload-helper-f85Crcwt.js","assets/shipyardSystem-DYaoVOt1.js","assets/espionageOperationsSystem-CZU0ABJE.js","assets/worldMap-hNvdQcxt.js"])))=>i.map(i=>d[i]);
import{_ as D}from"./preload-helper-f85Crcwt.js";/* empty css             */import{L as h,V as ne,s as m}from"./utils-DLoRv3re.js";import{auth as f,signInWithGooglePreserveRole as ae,signInWithEmailPassword as se,registerWithEmailPassword as ie,checkUserPermissions as X,updateTurn as re,getAllCountries as le,getGameConfig as ce,requestPasswordReset as de,checkPlayerCountry as ue,handleGoogleRedirectResult as me,db as H,vincularJogadorAoPaisSemRebaixar as ge}from"./firebase-DaxaZSOr.js";import{r as K,f as R,a as he,u as z,b as j,c as fe}from"./renderer-HdU8-N65.js";import{t as pe}from"./turnEventsSystem-DkJYdwhP.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions-compat.js";import"./resourceConsumptionCalculator-Bk-hb2mA.js";import"./resourceProductionCalculator-C5abBl5S.js";import"./consumerGoodsCalculator-RQh-OK8I.js";import"./shipyardSystem-DYaoVOt1.js";import"./espionageOperationsSystem-CZU0ABJE.js";class ye{constructor(){this.focusableElements=[],this.currentFocusIndex=-1,this.skipLinks=[],this.announcements=new Set,this.init()}init(){this.createSkipLinks(),this.setupKeyboardNavigation(),this.setupFocusManagement(),this.setupLiveRegions(),this.setupAnnouncements(),this.setupColorContrastMode(),this.setupReducedMotion(),h.info("Sistema de acessibilidade inicializado")}createSkipLinks(){const e=document.createElement("div");e.className="skip-links sr-only-focusable",e.innerHTML=`
            <a href="#main-content" class="skip-link">Pular para conte√∫do principal</a>
            <a href="#navigation" class="skip-link">Pular para navega√ß√£o</a>
            <a href="#countries-list" class="skip-link">Pular para lista de pa√≠ses</a>
            <a href="#player-panel" class="skip-link">Pular para painel do jogador</a>
        `,document.body.insertBefore(e,document.body.firstChild),this.addSkipLinksStyles()}addSkipLinksStyles(){const e=document.createElement("style");e.textContent=`
            .skip-links {
                position: absolute;
                top: -40px;
                left: 6px;
                z-index: 1000;
            }
            
            .skip-link {
                position: absolute;
                top: -40px;
                left: 6px;
                background: #ffb400;
                color: #0b1020;
                padding: 8px;
                text-decoration: none;
                border-radius: 4px;
                font-weight: bold;
                font-size: 14px;
                transition: top 0.3s ease;
            }
            
            .skip-link:focus {
                top: 6px;
            }
            
            .sr-only {
                position: absolute !important;
                width: 1px !important;
                height: 1px !important;
                padding: 0 !important;
                margin: -1px !important;
                overflow: hidden !important;
                clip: rect(0, 0, 0, 0) !important;
                white-space: nowrap !important;
                border: 0 !important;
            }
            
            .sr-only-focusable:focus,
            .sr-only-focusable:active {
                position: static !important;
                width: auto !important;
                height: auto !important;
                padding: inherit !important;
                margin: inherit !important;
                overflow: visible !important;
                clip: auto !important;
                white-space: inherit !important;
            }
            
            /* Focus indicators melhorados */
            *:focus {
                outline: 2px solid #ffb400;
                outline-offset: 2px;
                border-radius: 4px;
            }
            
            button:focus,
            .country-card-button:focus {
                outline: 2px solid #ffb400;
                outline-offset: 2px;
                box-shadow: 0 0 0 4px rgba(255, 180, 0, 0.2);
            }
            
            /* High contrast mode */
            @media (prefers-contrast: high) {
                .kpi-card,
                .country-card-button,
                .player-panel {
                    border: 2px solid #ffffff;
                    background: #000000;
                    color: #ffffff;
                }
                
                .text-slate-400 {
                    color: #ffffff !important;
                }
                
                .bg-slate-900\\/60 {
                    background: #000000 !important;
                }
            }
            
            /* Reduced motion */
            @media (prefers-reduced-motion: reduce) {
                *,
                *::before,
                *::after {
                    animation-duration: 0.01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: 0.01ms !important;
                    scroll-behavior: auto !important;
                }
            }
        `,document.head.appendChild(e)}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{switch(e.key){case"Tab":this.handleTabNavigation(e);break;case"Escape":this.handleEscape(e);break;case"Enter":case" ":this.handleActivation(e);break;case"ArrowDown":case"ArrowUp":case"ArrowLeft":case"ArrowRight":this.handleArrowNavigation(e);break;case"Home":case"End":this.handleHomeEnd(e);break}})}handleTabNavigation(e){if(this.updateFocusableElements(),this.focusableElements.length===0)return;const t=this.focusableElements.indexOf(document.activeElement);if(e.shiftKey){const o=t<=0?this.focusableElements.length-1:t-1;this.focusableElements[o]?.focus()}else{const o=t>=this.focusableElements.length-1?0:t+1;this.focusableElements[o]?.focus()}}handleEscape(e){document.querySelectorAll('[role="dialog"]:not(.hidden)').forEach(n=>{n.classList.add("hidden");const s=n.getAttribute("data-trigger-element");s&&document.getElementById(s)?.focus()}),document.querySelectorAll('[aria-selected="true"]').forEach(n=>n.setAttribute("aria-selected","false"))}handleActivation(e){const t=e.target;t.getAttribute("role")==="button"&&t.tagName!=="BUTTON"&&(e.preventDefault(),t.click())}handleArrowNavigation(e){const t=e.target,o=t.closest('[role="grid"], [role="listbox"], [role="tablist"]');if(!o)return;e.preventDefault();const n=Array.from(o.querySelectorAll('[role="gridcell"], [role="option"], [role="tab"]')),s=n.indexOf(t);let r;switch(e.key){case"ArrowDown":r=Math.min(s+1,n.length-1);break;case"ArrowUp":r=Math.max(s-1,0);break;case"ArrowRight":r=Math.min(s+1,n.length-1);break;case"ArrowLeft":r=Math.max(s-1,0);break}r!==void 0&&n[r]&&(n[r].focus(),n.forEach((c,l)=>{c.setAttribute("aria-selected",l===r?"true":"false")}))}handleHomeEnd(e){const o=e.target.closest('[role="grid"], [role="listbox"]');if(!o)return;e.preventDefault();const n=Array.from(o.querySelectorAll('[role="gridcell"], [role="option"]'));e.key==="Home"&&n[0]?n[0].focus():e.key==="End"&&n[n.length-1]&&n[n.length-1].focus()}setupFocusManagement(){document.addEventListener("focusin",e=>{this.announceFocusContext(e.target)})}updateFocusableElements(){const e=`
            button:not([disabled]):not(.hidden),
            [href]:not([disabled]):not(.hidden),
            input:not([disabled]):not(.hidden),
            select:not([disabled]):not(.hidden),
            textarea:not([disabled]):not(.hidden),
            [tabindex]:not([tabindex="-1"]):not([disabled]):not(.hidden),
            [role="button"]:not([disabled]):not(.hidden),
            [role="link"]:not([disabled]):not(.hidden)
        `;this.focusableElements=Array.from(document.querySelectorAll(e)).filter(t=>{const o=getComputedStyle(t);return o.display!=="none"&&o.visibility!=="hidden"})}announceFocusContext(e){let t="";const o=e.closest(".country-card-button");if(o){const r=o.querySelector(".text-sm.font-semibold")?.textContent,c=o.querySelector('[class*="font-bold"]')?.textContent;t=`Pa√≠s: ${r}, √çndice de poder: ${c}`}e.closest(".player-panel")&&(t="Painel do jogador");const s=e.closest('[role="dialog"]');s&&(t=`Modal: ${s.querySelector("h1, h2, h3")?.textContent||"Di√°logo aberto"}`),t&&this.announce(t)}setupLiveRegions(){[{id:"live-polite",level:"polite"},{id:"live-assertive",level:"assertive"},{id:"live-status",level:"polite"}].forEach(t=>{if(!document.getElementById(t.id)){const o=document.createElement("div");o.id=t.id,o.className="sr-only",o.setAttribute("aria-live",t.level),o.setAttribute("aria-atomic","true"),document.body.appendChild(o)}})}setupAnnouncements(){const e=window.showNotification;e&&(window.showNotification=(t,o,n)=>(this.announce(`${t}: ${o}`,t==="error"?"assertive":"polite"),e(t,o,n)))}announce(e,t="polite"){const o=t==="assertive"?"live-assertive":"live-polite",n=document.getElementById(o);!n||this.announcements.has(e)||(this.announcements.add(e),n.textContent="",setTimeout(()=>{n.textContent=e,setTimeout(()=>{n.textContent="",this.announcements.delete(e)},5e3)},100),h.debug(`An√∫ncio (${t}): ${e}`))}setupColorContrastMode(){const e=window.matchMedia("(prefers-contrast: high)");this.applyContrastMode(e.matches),e.addEventListener("change",t=>{this.applyContrastMode(t.matches)}),this.createContrastToggle()}createContrastToggle(){const e=document.createElement("button");e.id="contrast-toggle",e.className="fixed top-4 left-4 z-50 px-3 py-2 bg-slate-900 text-white border border-slate-600 rounded-lg sr-only-focusable",e.innerHTML=`
            <span class="sr-only">Alternar modo alto contraste</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a4 4 0 004-4V5z" />
            </svg>
        `,e.addEventListener("click",()=>{const t=document.body.classList.toggle("high-contrast-mode");this.announce(`Modo alto contraste ${t?"ativado":"desativado"}`),localStorage.setItem("highContrastMode",t)}),document.body.appendChild(e),localStorage.getItem("highContrastMode")==="true"&&document.body.classList.add("high-contrast-mode")}applyContrastMode(e){document.body.classList.toggle("system-high-contrast",e),e&&this.announce("Modo alto contraste do sistema detectado")}setupReducedMotion(){const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.applyMotionPreference(e.matches),e.addEventListener("change",t=>{this.applyMotionPreference(t.matches)})}applyMotionPreference(e){document.body.classList.toggle("reduce-motion",e),e&&(window.DOMUtils&&(DOMUtils.animateCounter,DOMUtils.animateCounter=(t,o,n={})=>{const s=typeof t=="string"?document.getElementById(t):t;s&&(s.textContent=o.toLocaleString(n.locale||"pt-BR"),n.onComplete?.())}),this.announce("Anima√ß√µes reduzidas ativadas"))}improveSemantics(){if(!(document.querySelector("main")||document.querySelector("#main-content"))){const s=document.querySelector(".mx-auto.max-w-7xl")||document.body;s&&!s.querySelector("main")&&(s.setAttribute("role","main"),s.id="main-content")}const t=document.querySelector("nav");t&&!t.id&&(t.id="navigation",t.setAttribute("aria-label","Navega√ß√£o principal"));const o=document.getElementById("lista-paises-publicos");o&&(o.setAttribute("role","grid"),o.setAttribute("aria-label","Lista de pa√≠ses dispon√≠veis"),o.id="countries-list",o.querySelectorAll(".country-card-button").forEach((r,c)=>{r.setAttribute("role","gridcell"),r.setAttribute("aria-rowindex",Math.floor(c/4)+1),r.setAttribute("aria-colindex",c%4+1);const l=r.querySelector(".text-sm.font-semibold")?.textContent;l&&r.setAttribute("aria-label",`Selecionar pa√≠s ${l}`)})),document.querySelectorAll("input, select, textarea").forEach(s=>{if(!s.getAttribute("aria-label")&&!s.id){const r=s.parentElement.querySelector("label");if(r){const c=`input-${Math.random().toString(36).substr(2,9)}`;s.id=c,r.setAttribute("for",c)}else{const c=s.getAttribute("placeholder");c&&s.setAttribute("aria-label",c)}}s.hasAttribute("required")&&s.setAttribute("aria-required","true")})}runAccessibilityCheck(){const e=[];document.querySelectorAll("img:not([alt])").forEach(s=>{e.push(`Imagem sem texto alternativo: ${s.src}`)}),document.querySelectorAll("*").forEach(s=>{const r=getComputedStyle(s),c=r.color,l=r.backgroundColor;c&&l&&c!=="rgba(0, 0, 0, 0)"&&l!=="rgba(0, 0, 0, 0)"&&h.debug("Elemento com cores definidas:",{color:c,background:l})}),document.querySelectorAll("button:not([aria-label]):not([title])").forEach(s=>{s.textContent.trim()||e.push(`Bot√£o sem label: ${s.outerHTML.substring(0,50)}...`)});const o=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6"));let n=0;return o.forEach(s=>{const r=parseInt(s.tagName.charAt(1));r>n+1&&e.push(`Heading level skip: ${s.tagName} after h${n}`),n=r}),e.length>0?h.warn("Issues de acessibilidade encontrados:",e):h.info("Nenhum issue cr√≠tico de acessibilidade encontrado"),e}}const A=new ye,be={announce:(a,e)=>A.announce(a,e),focus:a=>{typeof a=="string"&&(a=document.getElementById(a)||document.querySelector(a)),a?.focus()},check:()=>A.runAccessibilityCheck(),improveSemantics:()=>A.improveSemantics()};document.addEventListener("DOMContentLoaded",()=>{A.improveSemantics(),h.info("Sistema de acessibilidade totalmente carregado")});class ve{constructor(){this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),this.isTablet=/iPad|Android.*Tablet/i.test(navigator.userAgent),this.hasTouch="ontouchstart"in window,this.viewportWidth=window.innerWidth,this.searchResults=[],this.currentSearchTerm="",this.searchIndex=null,(this.isMobile||this.hasTouch)&&this.init()}init(){h.info("üîß Inicializando otimiza√ß√µes mobile"),this.setupMobileViewport(),this.addMobileClasses(),this.createSearchBar(),this.setupTouchGestures(),this.createMobileMenu(),this.setupMobilePanels(),this.createQuickActions(),this.optimizeForMobile(),h.info("‚úÖ Otimiza√ß√µes mobile ativadas")}setupMobileViewport(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",e.content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes",document.head.appendChild(e));const t=document.createElement("style");t.textContent=`
            .no-zoom { touch-action: manipulation; }
            button, .country-card-button { touch-action: manipulation; }
        `,document.head.appendChild(t)}addMobileClasses(){document.body.classList.add(this.isMobile?"is-mobile":"is-desktop",this.isTablet?"is-tablet":"is-phone",this.hasTouch?"has-touch":"no-touch")}setupTouchGestures(){let e=0,t=0,o=!1;document.addEventListener("touchstart",n=>{window.scrollY===0&&(e=n.touches[0].clientY,o=!1)},{passive:!0}),document.addEventListener("touchmove",n=>{window.scrollY===0&&e>0&&(t=n.touches[0].clientY,t-e>60&&!o&&(o=!0,this.showPullToRefresh(),navigator.vibrate&&navigator.vibrate(30)))},{passive:!0}),document.addEventListener("touchend",()=>{o&&this.triggerRefresh(),this.hidePullToRefresh(),e=0,o=!1},{passive:!0}),this.setupSwipeGestures(),this.setupLongPress()}setupSwipeGestures(){let e=0,t=0,o=null;document.addEventListener("touchstart",n=>{const s=n.target.closest(".country-card-button");s&&(e=n.touches[0].clientX,t=n.touches[0].clientY,o=s)},{passive:!0}),document.addEventListener("touchmove",n=>{if(!o)return;const s=e-n.touches[0].clientX,r=t-n.touches[0].clientY;Math.abs(s)>Math.abs(r)&&Math.abs(s)>50&&(n.preventDefault(),this.showCardSwipeActions(o,s>0?"left":"right"))}),document.addEventListener("touchend",()=>{o&&(this.hideCardSwipeActions(o),o=null)},{passive:!0})}setupLongPress(){let e;document.addEventListener("touchstart",t=>{const o=t.target.closest(".country-card-button");o&&(e=setTimeout(()=>{this.showCardContextMenu(o,t.touches[0].clientX,t.touches[0].clientY),navigator.vibrate&&navigator.vibrate(50)},500))},{passive:!0}),document.addEventListener("touchend",()=>clearTimeout(e),{passive:!0}),document.addEventListener("touchmove",()=>clearTimeout(e),{passive:!0})}showPullToRefresh(){let e=document.getElementById("pull-refresh-indicator");e||(e=document.createElement("div"),e.id="pull-refresh-indicator",e.className="fixed top-16 left-1/2 transform -translate-x-1/2 z-50 bg-brand-500 text-slate-950 px-4 py-2 rounded-full shadow-lg flex items-center gap-2 transition-all",e.innerHTML='<div class="animate-spin h-4 w-4 border-2 border-slate-950/30 border-t-slate-950 rounded-full"></div><span class="text-sm font-medium">Puxe para atualizar</span>',document.body.appendChild(e)),e.style.transform="translate(-50%, 0)"}hidePullToRefresh(){const e=document.getElementById("pull-refresh-indicator");e&&(e.style.transform="translate(-50%, -100%)",setTimeout(()=>e.remove(),300))}triggerRefresh(){window.loadSiteData&&window.loadSiteData();const e=document.getElementById("pull-refresh-indicator");e&&(e.innerHTML='<svg class="h-4 w-4 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><span class="text-sm font-medium">Atualizado!</span>',e.className=e.className.replace("bg-brand-500","bg-emerald-500")),be.announce("Lista de pa√≠ses atualizada"),h.info("üì± Pull-to-refresh executado")}showCardSwipeActions(e,t){if(!e.querySelector(".swipe-indicator")){const o=document.createElement("div");o.className="swipe-indicator absolute inset-y-0 right-2 flex items-center text-brand-400 opacity-50",o.innerHTML=t==="left"?"üëÅÔ∏è Ver detalhes":"‚≠ê Favoritar",e.style.position="relative",e.appendChild(o)}}hideCardSwipeActions(e){const t=e.querySelector(".swipe-indicator");t&&t.remove()}showCardContextMenu(e,t,o){const n=e.querySelector(".text-sm.font-semibold")?.textContent,s=e.dataset.countryId,r=document.createElement("div");r.className="fixed z-50 bg-bg-soft border border-bg-ring/70 rounded-xl shadow-xl p-2 min-w-48",r.style.left=`${Math.min(t,window.innerWidth-200)}px`,r.style.top=`${Math.min(o,window.innerHeight-150)}px`,r.innerHTML=`
            <div class="text-sm font-medium text-slate-200 px-3 py-2 border-b border-bg-ring/50">${ne.sanitizeInput(n||"Pa√≠s")}</div>
            <button class="context-menu-item" data-action="view">...</button>
            ...
        `,r.querySelectorAll(".context-menu-item").forEach(l=>l.addEventListener("click",()=>{this.handleContextAction(l.dataset.action,s,n),r.remove()}));const c=l=>{r.contains(l.target)||(r.remove(),document.removeEventListener("touchstart",c))};document.addEventListener("touchstart",c),document.body.appendChild(r)}handleContextAction(e,t,o){}createMobileMenu(){}showMobileMenu(){}addMobileMenuStyles(){}setupMobilePanels(){}convertToSlideUp(e,t){}showSlideUpPanel(e,t){}setupSwipeToClose(e,t){}createQuickActions(){}openQuickActions(e){}closeQuickActions(e){}optimizeForMobile(){}addShowMoreButton(e,t){}debounceScrollEvents(){}toggleFavorite(e,t){}shareCountry(e,t){}addToCompare(e,t){}showFavorites(){}updateFavoriteIndicators(){}createSearchBar(){}setupSearchFunctionality(){}performSearch(e){}createSearchIndex(e){}fuzzySearch(e,t){}fuzzyMatch(e,t){}getRegion(e){}}document.addEventListener("DOMContentLoaded",()=>{const a=new ve;window.__MOBILE_OPTIMIZATIONS__=a});const $=document.getElementById("auth-button"),C=document.getElementById("main-login-btn"),Ee=document.getElementById("hero-blurb"),L=document.getElementById("hero-facebook-btn");function W(){return Ee||(document.querySelector("h1.text-4xl")?document.querySelector("h1.text-4xl").parentElement:null)}const b=document.getElementById("turn-post-button"),F=document.getElementById("filtro-visibilidade"),J=document.getElementById("refresh-paises"),Z=document.getElementById("search-country-input"),Y=document.getElementById("turno-editor");document.getElementById("last-sync");const S=document.getElementById("lista-paises-publicos"),d=document.getElementById("country-panel-modal"),Ce=document.getElementById("close-country-panel"),v=document.getElementById("auth-modal"),w=document.getElementById("login-tab"),x=document.getElementById("register-tab"),I=document.getElementById("login-form"),k=document.getElementById("register-form"),we=document.getElementById("google-login-btn"),xe=document.getElementById("close-auth-modal"),M=document.getElementById("auth-error-message"),B=document.getElementById("auth-success-message"),y=document.getElementById("forgot-password-btn");let i={allCountries:[],gameConfig:{},isDataLoaded:!1,playerCountry:null,currentTurn:0};window.appState=i;let T="login";function ee(a="login"){T=a,V(),v.classList.remove("hidden"),document.body.classList.add("auth-modal-open"),g(),d&&!d.classList.contains("hidden")&&d.classList.add("hidden")}function p(){v.classList.add("hidden"),document.body.classList.remove("auth-modal-open"),g(),Le()}function V(){const a=T==="login";a?(w.classList.add("bg-brand-500","text-slate-950"),w.classList.remove("text-slate-300","hover:text-slate-100"),x.classList.remove("bg-brand-500","text-slate-950"),x.classList.add("text-slate-300","hover:text-slate-100")):(x.classList.add("bg-brand-500","text-slate-950"),x.classList.remove("text-slate-300","hover:text-slate-100"),w.classList.remove("bg-brand-500","text-slate-950"),w.classList.add("text-slate-300","hover:text-slate-100")),a?(I.classList.remove("hidden"),k.classList.add("hidden"),document.getElementById("auth-modal-title").textContent="Entrar no Portal",document.getElementById("auth-modal-subtitle").textContent="Acesse sua conta"):(I.classList.add("hidden"),k.classList.remove("hidden"),document.getElementById("auth-modal-title").textContent="Criar Conta",document.getElementById("auth-modal-subtitle").textContent="Registre-se para come√ßar")}function g(){M.classList.add("hidden"),B.classList.add("hidden")}function u(a){M.textContent=a,M.classList.remove("hidden"),B.classList.add("hidden")}function _(a){B.textContent=a,B.classList.remove("hidden"),M.classList.add("hidden")}function Le(){I.reset(),k.reset()}async function Ae(a){if(a.preventDefault(),!y)return;g();const e=document.getElementById("login-email"),t=e.value.trim();if(!t){u("Informe seu email para recuperar a senha."),e.focus();return}const o=y.textContent;y.disabled=!0,y.textContent="Enviando...";try{const n=await de(t);n.success?_(n.message||"Verifique seu email para redefinir a senha."):n.message?u(n.message):u("N√£o foi poss√≠vel enviar o email de recupera√ß√£o.")}catch(n){console.error("Erro inesperado no reset de senha:",n),u("Erro inesperado ao solicitar recupera√ß√£o de senha.")}finally{y.disabled=!1,y.textContent=o}}async function Se(){try{const a=await me(!0);if(a&&a.success&&a.user){p(),g();const e=a.user.displayName||a.user.email;m("success",`Bem-vindo, ${e}!`)}}catch(a){console.error("Erro ao processar redirect do Google:",a),u("N√£o foi poss√≠vel concluir o login com Google.")}}async function N(){console.log("Carregando dados do site...");try{if(document.querySelectorAll(".loading-shimmer").forEach(a=>a.style.display="inline"),i.allCountries=await le(),i.gameConfig=await ce(),i.currentTurn=i.gameConfig?.turnoAtual||0,pe.init(i.currentTurn),console.log("Pa√≠ses carregados:",i.allCountries.length),console.log("Config do jogo:",i.gameConfig),i.allCountries.length>0){z(i.allCountries),E();const a=document.getElementById("turno-atual");a&&i.gameConfig&&i.gameConfig.turnoAtual&&(a.textContent=`#${i.gameConfig.turnoAtual}`),document.querySelectorAll(".loading-shimmer").forEach(e=>e.style.display="none"),i.isDataLoaded=!0,Be(),f.currentUser&&(console.log("Revalidando painel do jogador ap√≥s carregar pa√≠ses"),await te(f.currentUser))}else console.warn("Nenhum pa√≠s encontrado no Firestore"),m("warning","Nenhum pa√≠s encontrado. Verifique a configura√ß√£o do Firestore.")}catch(a){console.error("Erro ao carregar dados:",a),m("error","Erro ao carregar dados do servidor.")}ke(),f.currentUser&&b&&i.gameConfig&&i.gameConfig.turnoAtual&&(b.textContent=`Ver turno #${i.gameConfig.turnoAtual} (Facebook)`)}function E(){const a=F.value,e=Z.value.toLowerCase();let t=[];a==="todos"?t=i.allCountries:a==="publicos"?t=i.allCountries.filter(o=>o.Visibilidade&&o.Visibilidade.toLowerCase()==="p√∫blico"):a==="privados"?t=i.allCountries.filter(o=>o.Visibilidade&&o.Visibilidade.toLowerCase()==="privado"):a==="com-jogadores"?t=i.allCountries.filter(o=>o.Player):a==="sem-jogadores"&&(t=i.allCountries.filter(o=>!o.Player)),e&&(t=t.filter(o=>o.Pais&&o.Pais.toLowerCase().includes(e))),console.log(`Renderizando ${t.length} pa√≠ses (filtro: ${a}, busca: ${e})`),he(t),Ie()}d.addEventListener("click",a=>{a.target===d&&d.classList.add("hidden")});S&&S.addEventListener("click",async a=>{const e=a.target.closest(".country-card-button");if(!e)return;a.preventDefault();const t=e.dataset.countryId,o=i.allCountries.find(n=>n.id===t);o&&await K(o)});document.addEventListener("keydown",a=>{a.key==="Escape"&&(v.classList.contains("hidden")||p(),d.classList.contains("hidden")||d.classList.add("hidden"))});F.addEventListener("change",E);Z.addEventListener("input",E);J.addEventListener("click",N);function Ie(){const a=document.querySelectorAll(".country-card-button");a.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const o=e.dataset.countryId,n=i.allCountries.find(s=>s.id===o);n&&(console.log("Pa√≠s clicado:",n.Pais),m("info",`Voc√™ clicou em ${n.Pais}`))})}),console.log(`Event listeners adicionados para ${a.length} pa√≠ses`)}function ke(){const a=new Date,e=document.getElementById("last-sync");e&&(e.textContent=a.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}))}async function te(a){if(console.log("Mudan√ßa de estado de autentica√ß√£o:",a?"Logado":"Deslogado"),a){p(),g(),$.querySelector(".btn-text").textContent="Sair";const e=W();e&&e.classList.add("hidden"),b&&b.classList.remove("hidden"),C&&C.classList.add("hidden"),L&&L.classList.add("hidden"),console.log("Usu√°rio logado:",a.displayName||a.email);try{const t=await X(a.uid);console.log("Permiss√µes do usu√°rio:",t),j(t.isNarrator,t.isAdmin);const o=await ue(a.uid);if(console.log("Pa√≠s do jogador:",o),o){const n=i.allCountries.find(s=>s.id===o);n&&(localStorage.setItem("loggedCountry",n.id),console.log("Pa√≠s salvo no localStorage (main):",n.id),i.playerCountry=n,console.log("DEBUG: appState.playerCountry definido como:",n),i.currentTurn=i.gameConfig.turnoAtual||0,R(n,i.gameConfig.turnoAtual))}else{const n=i.allCountries.filter(s=>!s.Player);if(n.length>0){const s=fe(n);Me(s,a.uid)}else m("warning","N√£o h√° pa√≠ses dispon√≠veis para sele√ß√£o no momento.")}}catch(t){console.error("Erro ao processar login do usu√°rio:",t),m("error","Erro ao carregar dados do usu√°rio.")}}else{$.querySelector(".btn-text").textContent="Entrar",j(!1,!1),R(null),oe();const e=W();e&&e.classList.remove("hidden"),b&&b.classList.add("hidden"),C&&C.classList.remove("hidden"),L&&L.classList.remove("hidden")}}function Me(a,e){let t=null;const o=a.querySelectorAll(".pais-option"),n=a.querySelector("#confirmar-selecao"),s=a.querySelector("#cancelar-selecao"),r=a.querySelector("#busca-pais"),c=a.querySelector("#paises-visiveis");o.forEach(l=>{l.addEventListener("click",()=>{o.forEach(q=>q.classList.remove("border-brand-500","bg-brand-500/10")),l.classList.add("border-brand-500","bg-brand-500/10"),t={id:l.dataset.paisId,name:l.dataset.paisNome},n.disabled=!1})}),r&&c&&r.addEventListener("input",l=>{const q=l.target.value.toLowerCase();let O=0;o.forEach(U=>{const G=U.dataset.paisNome.toLowerCase().includes(q);U.style.display=G?"block":"none",G&&O++}),c.textContent=O}),n&&n.addEventListener("click",async()=>{if(t){n.textContent="Vinculando...",n.disabled=!0;try{await ge(e,t.id),a.remove(),m("success",`Voc√™ agora governa ${t.name}!`),N()}catch(l){m("error","Erro ao vincular pa√≠s. Tente novamente."),console.error("Erro ao vincular pa√≠s:",l)}finally{n.textContent="Confirmar Sele√ß√£o",n.disabled=!1}}}),s&&s.addEventListener("click",()=>{a.remove()})}$.addEventListener("click",()=>{console.log("Bot√£o auth clicado"),f.currentUser?(console.log("Fazendo logout"),f.signOut()):(console.log("Abrindo modal de login"),ee("login"))});C.addEventListener("click",()=>{console.log("Bot√£o main login clicado"),ee("login")});w.addEventListener("click",()=>{T="login",V(),g()});x.addEventListener("click",()=>{T="register",V(),g()});xe.addEventListener("click",p);Ce.addEventListener("click",()=>{d.classList.add("hidden")});y&&y.addEventListener("click",Ae);we.addEventListener("click",async()=>{console.log("Tentando login com Google"),g();try{const a=await ae();if(console.log("Resultado do login Google:",a),a.redirect){_("Abrindo login do Google em nova janela...");return}if(a.success){p();const e=a.user.displayName||a.user.email;m("success",`Bem-vindo, ${e}!`)}else console.error("Erro no login Google:",a.error),u(a.error?a.error.message:"Erro no login com Google.")}catch(a){console.error("Erro inesperado no login Google:",a),u("Erro inesperado no login com Google.")}});I.addEventListener("submit",async a=>{a.preventDefault(),console.log("Submetendo form de login"),g();const e=document.getElementById("login-email").value,t=document.getElementById("login-password").value;console.log("Tentando login com email:",e);try{const o=await se(e,t);console.log("Resultado do login:",o),o.success?(p(),m("success","Login realizado com sucesso!")):(console.error("Erro no login:",o.error),u(o.error?o.error.message:"Erro no login."))}catch(o){console.error("Erro inesperado no login:",o),u("Erro inesperado no login.")}});k.addEventListener("submit",async a=>{a.preventDefault(),console.log("Submetendo form de registro"),g();const e=document.getElementById("register-name").value,t=document.getElementById("register-email").value,o=document.getElementById("register-password").value,n=document.getElementById("register-confirm-password").value;if(o!==n){u("As senhas n√£o coincidem.");return}if(o.length<6){u("A senha deve ter pelo menos 6 caracteres.");return}console.log("Tentando registro com email:",t);try{const s=await ie(t,o,e);console.log("Resultado do registro:",s),s.success?(_("Conta criada com sucesso! Redirecionando..."),setTimeout(()=>{p(),m("success",`Bem-vindo ao WAR, ${e}!`)},1500)):(console.error("Erro no registro:",s.error),u(s.error?s.error.message:"Erro no registro."))}catch(s){console.error("Erro inesperado no registro:",s),u("Erro inesperado no registro.")}});v.addEventListener("click",a=>{a.target===v&&p()});d.addEventListener("click",a=>{a.target===d&&d.classList.add("hidden")});S&&S.addEventListener("click",async a=>{const e=a.target.closest(".country-card-button");if(!e)return;a.preventDefault();const t=e.dataset.countryId,o=i.allCountries.find(n=>n.id===t);o&&await K(o)});document.addEventListener("keydown",a=>{a.key==="Escape"&&(v.classList.contains("hidden")||p(),d.classList.contains("hidden")||d.classList.add("hidden"))});F.addEventListener("change",E);J.addEventListener("click",N);Y&&Y.addEventListener("change",async a=>{const e=a.target.value;if(f.currentUser&&(await X(f.currentUser.uid)).isNarrator)if(await re(e)){m("success",`Turno atualizado para #${e}`),i.gameConfig.turnoAtual=e;const n=i.allCountries.find(s=>s.Player===f.currentUser.uid);n&&localStorage.setItem("loggedCountry",n.id),R(n,e)}else m("error","Erro ao salvar turno.")});f.onAuthStateChanged(te);let P=new Map;function Be(){console.log("Configurando sincroniza√ß√£o em tempo real...");const a=H.collection("paises").onSnapshot(t=>{console.log("Mudan√ßas detectadas na cole√ß√£o de pa√≠ses"),t.docChanges().forEach(o=>{const n={id:o.doc.id,...o.doc.data()},s=i.allCountries.findIndex(r=>r.id===o.doc.id);o.type==="added"&&s===-1?(i.allCountries.push(n),console.log(`Pa√≠s adicionado: ${n.Pais}`)):o.type==="modified"&&s!==-1?(i.allCountries[s]=n,console.log(`Pa√≠s atualizado: ${n.Pais}`)):o.type==="removed"&&s!==-1&&(i.allCountries.splice(s,1),console.log(`Pa√≠s removido: ${n.Pais}`))}),i.isDataLoaded&&(z(i.allCountries),E(),console.log("Interface atualizada automaticamente"))},t=>{console.error("Erro no listener de pa√≠ses:",t)});P.set("countries",a),window.addEventListener("realtime:update",t=>{console.log("Evento realtime:update recebido:",t.detail);const{countryId:o,section:n,field:s,newValue:r}=t.detail,c=i.allCountries.findIndex(l=>l.id===o);if(c!==-1){const l=i.allCountries[c];l[n]||(l[n]={}),l[n][s]=r,n==="geral"&&(l[s]=r),console.log(`Campo ${s} do pa√≠s ${l.Pais} atualizado via broadcast:`,r),z(i.allCountries),E()}});const e=H.collection("configuracoes").doc("jogo").onSnapshot(t=>{if(t.exists){const o=t.data();if(i.gameConfig.turnoAtual!==o.turnoAtual){console.log(`Turno atualizado: ${i.gameConfig.turnoAtual} ‚Üí ${o.turnoAtual}`),i.gameConfig=o;const n=document.getElementById("turno-atual");n&&(n.textContent=`#${o.turnoAtual}`),b&&(b.textContent=`Ver turno #${o.turnoAtual} (Facebook)`)}}},t=>{console.error("Erro no listener de configura√ß√£o:",t)});P.set("config",e),console.log("Sincroniza√ß√£o em tempo real ativada ‚úÖ")}function oe(){console.log("Removendo listeners de tempo real..."),P.forEach(a=>a()),P.clear()}window.addEventListener("beforeunload",()=>{oe()});document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("btn-main-agency");a&&a.addEventListener("click",()=>{i.playerCountry&&D(()=>import("./renderer-HdU8-N65.js").then(e=>e.e),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(e=>{const t=document.createElement("div");t.id="agency-modal",t.className="fixed inset-0 z-[70] flex items-center justify-center bg-black/70 backdrop-blur-sm",t.innerHTML=`
            <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-6xl max-h-[90vh] overflow-y-auto m-4 p-6">
              <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                  <span class="text-4xl">üïµÔ∏è</span>
                  <div>
                    <h3 class="text-2xl font-bold text-slate-100">Ag√™ncia de Intelig√™ncia</h3>
                    <p class="text-sm text-slate-400">${i.playerCountry.Pais}</p>
                  </div>
                </div>
                <button id="close-agency-modal" class="text-slate-400 hover:text-slate-200 text-2xl transition">√ó</button>
              </div>
              <div id="agency-dashboard-content">
                <div class="text-center py-12">
                  <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500 mx-auto mb-4"></div>
                  <p class="text-slate-400">Carregando...</p>
                </div>
              </div>
            </div>
          `,document.body.appendChild(t);const o=document.getElementById("close-agency-modal");o&&o.addEventListener("click",()=>t.remove()),t.addEventListener("click",n=>{n.target===t&&t.remove()}),D(()=>import("./renderer-HdU8-N65.js").then(n=>n.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(n=>{const s=document.getElementById("agency-dashboard-content");s&&n.renderAgencyDashboard(i.playerCountry,s)})})})});let Q=null;async function Pe(){try{if(!document.getElementById("world-map-player")){console.log("Container do mapa n√£o encontrado");return}const{WorldMap:e}=await D(async()=>{const{WorldMap:o}=await import("./worldMap-hNvdQcxt.js").then(n=>n.w);return{WorldMap:o}},__vite__mapDeps([9,5,6,1]));Q=new e("world-map-player"),await Q.initialize(!1);const t=document.getElementById("map-info-text-player");t&&(t.textContent="Mapa carregado com sucesso!"),console.log("Mapa mundial (players) inicializado")}catch(a){console.error("Erro ao inicializar mapa mundial:",a);const e=document.getElementById("map-info-text-player");e&&(e.textContent="Erro ao carregar mapa: "+a.message)}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM carregado, iniciando aplica√ß√£o"),Se(),N(),setTimeout(()=>{Pe()},500)});
