const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-ep1w8F7T.js","assets/preload-helper-f85Crcwt.js","assets/utils-DLoRv3re.js"])))=>i.map(i=>d[i]);
import{_ as P}from"./preload-helper-f85Crcwt.js";import{t as T}from"./training_levels-0GuzqOdX.js";import{s as g,a as j}from"./utils-DLoRv3re.js";const q={irregulares:{id:"irregulares",name:"Irregulares",nameEn:"Irregulars",category:"infantry",subcategory:"light",composition:{manpower:1e3,equipment:{small_arms:1e3,light_mg:50}},costs:{production:3e5,maintenance:15e3},stats:{softAttack:15,hardAttack:1,defense:20,breakthrough:8,armor:0,piercing:1,hp:8,organization:50,recovery:.3,reconnaissance:3,suppression:8,weight:.1,combatWidth:2},requirements:{minTechLevel:0,requiredTech:[],incompatibleWith:[]},icon:"assets/division-icons/unit_militia_icon.png",color:"#78716c"},infantaria_linha:{id:"infantaria_linha",name:"Infantaria de Linha",nameEn:"Line Infantry",category:"infantry",subcategory:"standard",composition:{manpower:800,equipment:{small_arms:800,light_mg:80,mortars:12}},costs:{production:6e5,maintenance:3e4},stats:{softAttack:20,hardAttack:2,defense:25,breakthrough:12,armor:0,piercing:1,hp:10,organization:60,recovery:.4,reconnaissance:2,suppression:10,weight:.15,combatWidth:2},requirements:{minTechLevel:1},icon:"assets/division-icons/unit_infantry_icon.png",color:"#4a7c59"},infantaria_leve:{id:"infantaria_leve",name:"Infantaria Leve",nameEn:"Light Infantry",category:"infantry",subcategory:"light",composition:{manpower:800,equipment:{small_arms:800,light_mg:60,mortars:8}},costs:{production:6e5,maintenance:3e4},stats:{softAttack:18,hardAttack:1,defense:22,breakthrough:10,armor:0,piercing:1,hp:9,organization:65,recovery:.45,reconnaissance:4,suppression:8,weight:.12,combatWidth:2},requirements:{minTechLevel:1},icon:"assets/division-icons/unit_marine_commando_icon.png",color:"#6b8e23"},tropa_choque:{id:"tropa_choque",name:"Tropa de Choque",nameEn:"Shock Troops",category:"infantry",subcategory:"elite",composition:{manpower:800,equipment:{small_arms:800,light_mg:100,mortars:16,explosives:400}},costs:{production:8e5,maintenance:4e4},stats:{softAttack:28,hardAttack:4,defense:20,breakthrough:20,armor:0,piercing:2,hp:11,organization:55,recovery:.35,reconnaissance:2,suppression:15,weight:.18,combatWidth:2},requirements:{minTechLevel:2},icon:"assets/division-icons/unit_heavy_infantry_icon.png",color:"#dc2626"},montanhistas:{id:"montanhistas",name:"Montanhistas",nameEn:"Mountain Infantry",category:"infantry",subcategory:"special",composition:{manpower:800,equipment:{small_arms:800,light_mg:70,mortars:10,climbing_gear:800}},costs:{production:8e5,maintenance:4e4},stats:{softAttack:19,hardAttack:2,defense:28,breakthrough:10,armor:0,piercing:1,hp:10,organization:70,recovery:.4,reconnaissance:3,suppression:9,weight:.14,combatWidth:2},requirements:{minTechLevel:2},icon:"assets/division-icons/unit_mountain_icon.png",color:"#8b7355"},paraquedistas:{id:"paraquedistas",name:"Paraquedistas",nameEn:"Paratroopers",category:"infantry",subcategory:"special",composition:{manpower:800,equipment:{small_arms:800,light_mg:80,mortars:12,parachutes:800}},costs:{production:8e5,maintenance:4e4},stats:{softAttack:22,hardAttack:3,defense:23,breakthrough:14,armor:0,piercing:2,hp:10,organization:65,recovery:.42,reconnaissance:4,suppression:11,weight:.13,combatWidth:2},requirements:{minTechLevel:2},icon:"assets/division-icons/unit_paratroop_icon.png",color:"#1e40af"},fuzileiros_navais:{id:"fuzileiros_navais",name:"Fuzileiros Navais",nameEn:"Marines",category:"infantry",subcategory:"special",composition:{manpower:800,equipment:{small_arms:800,light_mg:85,mortars:14,amphibious_gear:800}},costs:{production:8e5,maintenance:4e4},stats:{softAttack:24,hardAttack:3,defense:26,breakthrough:15,armor:0,piercing:2,hp:11,organization:68,recovery:.43,reconnaissance:3,suppression:12,weight:.16,combatWidth:2},requirements:{minTechLevel:2},icon:"assets/division-icons/unit_marine_icon.png",color:"#1e3a8a"},infantaria_motorizada:{id:"infantaria_motorizada",name:"Infantaria Motorizada",nameEn:"Motorized Infantry",category:"motorized",subcategory:"standard",composition:{manpower:800,equipment:{trucks:40,small_arms:800,light_mg:80,mortars:16}},costs:{production:1e6,maintenance:5e4},stats:{softAttack:25,hardAttack:2,defense:30,breakthrough:15,armor:0,piercing:1,hp:10,organization:60,recovery:.4,reconnaissance:2,suppression:12,weight:.8,combatWidth:2},requirements:{minTechLevel:2},icon:"assets/division-icons/unit_motorized_icon.png",color:"#92400e"},carro_armado_irregulares:{id:"carro_armado_irregulares",name:"Carro Armado (Irregulares)",nameEn:"Gun Truck (Irregulars)",category:"motorized",subcategory:"light",composition:{manpower:800,equipment:{utility_vehicles:120,small_arms:800,light_mg:120,heavy_mg:40}},costs:{production:8e5,maintenance:4e4},stats:{softAttack:28,hardAttack:3,defense:22,breakthrough:16,armor:2,piercing:3,hp:9,organization:55,recovery:.38,reconnaissance:4,suppression:14,weight:.6,combatWidth:2},requirements:{minTechLevel:1},icon:"assets/division-icons/unit_mot_militia_icon.png",color:"#78350f"},carro_armado:{id:"carro_armado",name:"Carro Armado",nameEn:"Gun Truck",category:"motorized",subcategory:"standard",composition:{manpower:800,equipment:{utility_vehicles:160,small_arms:800,light_mg:160,heavy_mg:60,autocannons:20}},costs:{production:1e6,maintenance:5e4},stats:{softAttack:32,hardAttack:5,defense:25,breakthrough:18,armor:3,piercing:4,hp:10,organization:58,recovery:.4,reconnaissance:5,suppression:16,weight:.7,combatWidth:2},requirements:{minTechLevel:2},icon:"assets/division-icons/unit_armored_car_icon.png",color:"#a16207"},mecanizada_leve_apc:{id:"mecanizada_leve_apc",name:"Infantaria Mecanizada Leve (APC)",nameEn:"Light Mechanized (APC)",category:"mechanized",subcategory:"apc",composition:{manpower:800,equipment:{apc:100,small_arms:800,light_mg:100}},costs:{production:2e6,maintenance:1e5},stats:{softAttack:30,hardAttack:4,defense:35,breakthrough:20,armor:10,piercing:5,hp:12,organization:65,recovery:.42,reconnaissance:3,suppression:14,weight:1.2,combatWidth:2},requirements:{minTechLevel:3},icon:"assets/division-icons/unit_apc_company_icon.png",color:"#15803d"},mecanizada_ifv:{id:"mecanizada_ifv",name:"Infantaria Mecanizada (IFV)",nameEn:"Mechanized Infantry (IFV)",category:"mechanized",subcategory:"ifv",composition:{manpower:800,equipment:{ifv:100,small_arms:800,autocannons:100,atgm:50}},costs:{production:3e6,maintenance:15e4},stats:{softAttack:38,hardAttack:12,defense:40,breakthrough:25,armor:15,piercing:20,hp:14,organization:68,recovery:.45,reconnaissance:4,suppression:16,weight:1.5,combatWidth:2},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_mechanized_icon.png",color:"#166534"},tanque_leve:{id:"tanque_leve",name:"Tanque Leve",nameEn:"Light Tank",category:"armor",subcategory:"light",composition:{manpower:300,equipment:{light_tanks:60}},costs:{production:4e6,maintenance:2e5},stats:{softAttack:25,hardAttack:20,defense:30,breakthrough:35,armor:30,piercing:40,hp:12,organization:50,recovery:.35,reconnaissance:8,suppression:10,weight:2.5,combatWidth:2},requirements:{minTechLevel:3},icon:"assets/division-icons/unit_light_tank_icon.png",color:"#713f12"},tanque_medio:{id:"tanque_medio",name:"Tanque Médio",nameEn:"Medium Tank",category:"armor",subcategory:"medium",composition:{manpower:400,equipment:{medium_tanks:80}},costs:{production:16e5,maintenance:8e4},stats:{softAttack:30,hardAttack:35,defense:40,breakthrough:45,armor:60,piercing:70,hp:15,organization:55,recovery:.38,reconnaissance:6,suppression:12,weight:3.5,combatWidth:2},requirements:{minTechLevel:3},icon:"assets/division-icons/unit_medium_tank_icon.png",color:"#854d0e"},tanque_mbt:{id:"tanque_mbt",name:"Tanque (MBT)",nameEn:"Main Battle Tank",category:"armor",subcategory:"mbt",composition:{manpower:300,equipment:{mbt:60}},costs:{production:6e6,maintenance:3e5},stats:{softAttack:35,hardAttack:50,defense:50,breakthrough:60,armor:90,piercing:100,hp:18,organization:58,recovery:.4,reconnaissance:7,suppression:15,weight:4.5,combatWidth:2},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_mbt_company_icon.png",color:"#a16207"},tanque_anfibio:{id:"tanque_anfibio",name:"Tanque Anfíbio",nameEn:"Amphibious Tank",category:"armor",subcategory:"amphibious",composition:{manpower:400,equipment:{amphibious_tanks:60}},costs:{production:4e6,maintenance:2e5},stats:{softAttack:28,hardAttack:25,defense:35,breakthrough:38,armor:40,piercing:50,hp:14,organization:52,recovery:.37,reconnaissance:7,suppression:11,weight:3,combatWidth:2},requirements:{minTechLevel:3},icon:"assets/division-icons/unit_amphibious_tank_icon.png",color:"#0c4a6e"},bateria_antiaerea:{id:"bateria_antiaerea",name:"Bateria Antiaérea",nameEn:"Anti-Aircraft Battery",category:"artillery",subcategory:"aa",composition:{manpower:400,equipment:{aa_guns:24,trucks:24}},costs:{production:1e6,maintenance:5e4},stats:{softAttack:5,hardAttack:2,defense:15,breakthrough:5,armor:0,piercing:10,hp:8,organization:45,recovery:.3,reconnaissance:1,suppression:5,weight:.6,combatWidth:1},requirements:{minTechLevel:2},icon:"assets/division-icons/unit_anti_air_icon.png",color:"#713f12"},bateria_artilharia:{id:"bateria_artilharia",name:"Bateria de Artilharia",nameEn:"Artillery Battery",category:"artillery",subcategory:"howitzer",composition:{manpower:400,equipment:{artillery:24,trucks:24}},costs:{production:1e6,maintenance:5e4},stats:{softAttack:40,hardAttack:8,defense:12,breakthrough:6,armor:0,piercing:5,hp:8,organization:40,recovery:.3,reconnaissance:1,suppression:8,weight:.8,combatWidth:1},requirements:{minTechLevel:2},icon:"assets/division-icons/unit_art_icon.png",color:"#92400e"},lancador_foguete:{id:"lancador_foguete",name:"Lançador de Foguete",nameEn:"Rocket Launcher",category:"artillery",subcategory:"rocket",composition:{manpower:400,equipment:{rocket_launchers:24,trucks:24}},costs:{production:2e6,maintenance:1e5},stats:{softAttack:50,hardAttack:10,defense:10,breakthrough:8,armor:0,piercing:6,hp:7,organization:38,recovery:.28,reconnaissance:1,suppression:10,weight:.9,combatWidth:1},requirements:{minTechLevel:3},icon:"assets/division-icons/unit_rocket_art_icon.png",color:"#b45309"},grupo_atcms:{id:"grupo_atcms",name:"Grupo de Armas (ATCMS)",nameEn:"ATGM Group",category:"artillery",subcategory:"atgm",composition:{manpower:400,equipment:{atcms:36,trucks:18}},costs:{production:2e6,maintenance:1e5},stats:{softAttack:15,hardAttack:35,defense:18,breakthrough:10,armor:0,piercing:60,hp:8,organization:42,recovery:.32,reconnaissance:2,suppression:6,weight:.7,combatWidth:1},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_at_icon.png",color:"#dc2626"},grupo_manpad:{id:"grupo_manpad",name:"Grupo MANPAD",nameEn:"MANPAD Group",category:"artillery",subcategory:"manpad",composition:{manpower:400,equipment:{manpads:36,trucks:12}},costs:{production:22e5,maintenance:11e4},stats:{softAttack:8,hardAttack:3,defense:16,breakthrough:6,armor:0,piercing:12,hp:7,organization:43,recovery:.31,reconnaissance:2,suppression:5,weight:.5,combatWidth:1},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_mot_anti_air_icon.png",color:"#ef4444"},mlrs:{id:"mlrs",name:"MLRS",nameEn:"Multiple Rocket Launch System",category:"artillery",subcategory:"mlrs",composition:{manpower:400,equipment:{mlrs:32}},costs:{production:1e7,maintenance:5e5},stats:{softAttack:80,hardAttack:15,defense:8,breakthrough:10,armor:5,piercing:10,hp:10,organization:35,recovery:.25,reconnaissance:1,suppression:15,weight:2,combatWidth:2},requirements:{minTechLevel:5},icon:"assets/division-icons/unit_mlrs_icon.png",color:"#991b1b"},spg:{id:"spg",name:"Artilharia Autopropulsada (SPG)",nameEn:"Self-Propelled Gun",category:"artillery",subcategory:"spg",composition:{manpower:400,equipment:{spg:32}},costs:{production:6e6,maintenance:3e5},stats:{softAttack:55,hardAttack:12,defense:20,breakthrough:15,armor:20,piercing:15,hp:12,organization:45,recovery:.35,reconnaissance:2,suppression:12,weight:2.5,combatWidth:2},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_spa_company_icon.png",color:"#a16207"},spaa:{id:"spaa",name:"Artilharia AA Autopropulsada (SPAA)",nameEn:"Self-Propelled Anti-Aircraft",category:"artillery",subcategory:"spaa",composition:{manpower:400,equipment:{spaa:32}},costs:{production:6e6,maintenance:3e5},stats:{softAttack:10,hardAttack:4,defense:25,breakthrough:10,armor:15,piercing:20,hp:11,organization:48,recovery:.36,reconnaissance:2,suppression:8,weight:2.2,combatWidth:2},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_spaa_company_icon.png",color:"#ca8a04"},tropas_aerotransportadas:{id:"tropas_aerotransportadas",name:"Tropas Aerotransportadas",nameEn:"Air Assault",category:"special",subcategory:"airborne",composition:{manpower:800,equipment:{utility_helicopters:40,small_arms:800,light_mg:80,mortars:16}},costs:{production:6e6,maintenance:3e5},stats:{softAttack:26,hardAttack:4,defense:24,breakthrough:18,armor:0,piercing:2,hp:10,organization:70,recovery:.45,reconnaissance:6,suppression:12,weight:.2,combatWidth:2},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_category_helicopter_icon_small.png",color:"#0369a1"},helicoptero_ataque:{id:"helicoptero_ataque",name:"Helicóptero de Ataque",nameEn:"Attack Helicopter",category:"special",subcategory:"attack_heli",composition:{manpower:200,equipment:{attack_helicopters:30}},costs:{production:4e6,maintenance:2e5},stats:{softAttack:35,hardAttack:40,defense:10,breakthrough:25,armor:5,piercing:45,hp:8,organization:40,recovery:.3,reconnaissance:10,suppression:15,weight:.5,combatWidth:1},requirements:{minTechLevel:5},icon:"assets/division-icons/unit_attack_helicopter_icon_small.png",color:"#be123c"},anfibio_mecanizado:{id:"anfibio_mecanizado",name:"Anfíbio Mecanizado",nameEn:"Amphibious Mechanized",category:"amphibious",subcategory:"amtrac",composition:{manpower:800,equipment:{amtrac:60,small_arms:800,light_mg:80}},costs:{production:3e6,maintenance:15e4},stats:{softAttack:28,hardAttack:6,defense:32,breakthrough:18,armor:8,piercing:8,hp:12,organization:62,recovery:.4,reconnaissance:4,suppression:13,weight:1.8,combatWidth:2},requirements:{minTechLevel:3},icon:"assets/division-icons/unit_amphibious_mechanized_icon.png",color:"#0891b2"}},E={suporte_helicoptero_ataque:{id:"suporte_helicoptero_ataque",name:"Suporte: Helicóptero de Ataque",nameEn:"Support: Attack Helicopter",category:"air_support",composition:{manpower:80,equipment:{attack_helicopters:12}},costs:{production:1e6,maintenance:5e4},divisionBonuses:{softAttack:15,hardAttack:20,piercing:15,reconnaissance:3},requirements:{minTechLevel:5},icon:"assets/division-icons/unit_attack_helicopter_icon_small.png",color:"#dc2626"},suporte_logistica_aerea:{id:"suporte_logistica_aerea",name:"Suporte: Logística Aérea",nameEn:"Support: Air Logistics",category:"air_support",composition:{manpower:1200,equipment:{utility_helicopters:60}},costs:{production:2e6,maintenance:1e5},divisionBonuses:{organization:5,recovery:.05,suppression:3},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_category_helicopter_icon_small.png",color:"#0891b2"},suporte_recon_aereo:{id:"suporte_recon_aereo",name:"Suporte: Reconhecimento Aéreo",nameEn:"Support: Air Reconnaissance",category:"air_support",composition:{manpower:80,equipment:{utility_helicopters:12}},costs:{production:1e6,maintenance:5e4},divisionBonuses:{reconnaissance:8,combatWidth:0},requirements:{minTechLevel:4},icon:"assets/division-icons/support_unit_helicopter_recon.png",color:"#0369a1"},suporte_evacuacao_medica:{id:"suporte_evacuacao_medica",name:"Suporte: Evacuação Médica Aérea",nameEn:"Support: Medical Evacuation",category:"air_support",composition:{manpower:200,equipment:{utility_helicopters:24}},costs:{production:3e6,maintenance:15e4},divisionBonuses:{recovery:.1,organization:3,hp:2},requirements:{minTechLevel:4},icon:"assets/division-icons/support_unit_field_hospital_icon.png",color:"#dc2626"},suporte_ifv_aerotrans:{id:"suporte_ifv_aerotrans",name:"Suporte: IFV Aerotransportado",nameEn:"Support: Airborne IFV",category:"airborne_support",composition:{manpower:300,equipment:{ifv:20}},costs:{production:1e6,maintenance:5e4},divisionBonuses:{softAttack:10,hardAttack:8,armor:5,piercing:8},requirements:{minTechLevel:4},icon:"assets/division-icons/support_unit_air_mechanized_icon.png",color:"#16a34a"},suporte_tanque_leve_aerotrans:{id:"suporte_tanque_leve_aerotrans",name:"Suporte: Tanque Leve Aerotransportado",nameEn:"Support: Airborne Light Tank",category:"airborne_support",composition:{manpower:100,equipment:{light_tanks:20}},costs:{production:14e5,maintenance:7e4},divisionBonuses:{hardAttack:12,armor:10,piercing:15,breakthrough:8},requirements:{minTechLevel:4},icon:"assets/division-icons/support_unit_airborne_armored_recon_icon.png",color:"#ca8a04"},suporte_antiaerea:{id:"suporte_antiaerea",name:"Suporte: Antiaérea",nameEn:"Support: Anti-Aircraft",category:"fire_support",composition:{manpower:200,equipment:{aa_guns:12,trucks:12}},costs:{production:6e5,maintenance:3e4},divisionBonuses:{piercing:5,defense:3},requirements:{minTechLevel:2},icon:"assets/division-icons/support_unit_anti_air_icon.png",color:"#92400e"},suporte_artilharia:{id:"suporte_artilharia",name:"Suporte: Artilharia",nameEn:"Support: Artillery",category:"fire_support",composition:{manpower:200,equipment:{artillery:12,trucks:12}},costs:{production:5e5,maintenance:25e3},divisionBonuses:{softAttack:20,hardAttack:5,defense:5,combatWidth:1},requirements:{minTechLevel:2},icon:"assets/division-icons/support_unit_art_icon.png",color:"#b45309"},suporte_atcms:{id:"suporte_atcms",name:"Suporte: ATCMS",nameEn:"Support: ATGM",category:"fire_support",composition:{manpower:20,equipment:{atcms:12}},costs:{production:1e6,maintenance:5e4},divisionBonuses:{hardAttack:15,piercing:25,defense:4},requirements:{minTechLevel:4},icon:"assets/division-icons/support_unit_at_icon.png",color:"#dc2626"},suporte_manpad:{id:"suporte_manpad",name:"Suporte: MANPAD",nameEn:"Support: MANPAD",category:"fire_support",composition:{manpower:20,equipment:{manpads:12}},costs:{production:1e6,maintenance:5e4},divisionBonuses:{piercing:6,defense:4},requirements:{minTechLevel:4},icon:"assets/division-icons/support_unit_at_icon.png",color:"#ef4444"},suporte_lancador_foguete:{id:"suporte_lancador_foguete",name:"Suporte: Lançadores de Foguete",nameEn:"Support: Rocket Launchers",category:"fire_support",composition:{manpower:200,equipment:{rocket_launchers:12,trucks:12}},costs:{production:1e6,maintenance:5e4},divisionBonuses:{softAttack:25,hardAttack:8,suppression:5,combatWidth:1},requirements:{minTechLevel:3},icon:"assets/division-icons/support_unit_rocket_art_icon.png",color:"#ea580c"},suporte_spg:{id:"suporte_spg",name:"Suporte: Artilharia Autopropulsada",nameEn:"Support: SPG",category:"fire_support",composition:{manpower:200,equipment:{spg:8}},costs:{production:1e6,maintenance:5e4},divisionBonuses:{softAttack:18,hardAttack:6,armor:5,defense:4},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_spa_company_icon.png",color:"#a16207"},suporte_spaa:{id:"suporte_spaa",name:"Suporte: Artilharia AA Autopropulsada",nameEn:"Support: SPAA",category:"fire_support",composition:{manpower:200,equipment:{spaa:8}},costs:{production:1e6,maintenance:5e4},divisionBonuses:{piercing:8,armor:4,defense:5},requirements:{minTechLevel:4},icon:"assets/division-icons/unit_spaa_company_icon.png",color:"#eab308"},suporte_recon_mecanizado:{id:"suporte_recon_mecanizado",name:"Suporte: Reconhecimento Mecanizado",nameEn:"Support: Mechanized Recon",category:"reconnaissance",composition:{manpower:200,equipment:{apc:20}},costs:{production:2e6,maintenance:1e5},divisionBonuses:{reconnaissance:10,armor:3,piercing:3},requirements:{minTechLevel:3},icon:"assets/division-icons/support_unit_armored_recon_icon.png",color:"#15803d"},suporte_recon_tanque_leve:{id:"suporte_recon_tanque_leve",name:"Suporte: Reconhecimento Tanque Leve",nameEn:"Support: Light Tank Recon",category:"reconnaissance",composition:{manpower:100,equipment:{light_tanks:20}},costs:{production:12e5,maintenance:6e4},divisionBonuses:{reconnaissance:12,armor:8,piercing:10,hardAttack:5},requirements:{minTechLevel:3},icon:"assets/division-icons/support_unit_armored_car_recon_icon.png",color:"#ca8a04"},suporte_recon_motorizado:{id:"suporte_recon_motorizado",name:"Suporte: Reconhecimento Motorizado",nameEn:"Support: Motorized Recon",category:"reconnaissance",composition:{manpower:200,equipment:{trucks:20}},costs:{production:4e5,maintenance:2e4},divisionBonuses:{reconnaissance:6},requirements:{minTechLevel:2},icon:"assets/division-icons/support_unit_motorized_recon_icon.png",color:"#92400e"},suporte_recon_desmontado:{id:"suporte_recon_desmontado",name:"Suporte: Reconhecimento Desmontado",nameEn:"Support: Dismounted Recon",category:"reconnaissance",composition:{manpower:200,equipment:{binoculars:200,radios:50}},costs:{production:2e5,maintenance:1e4},divisionBonuses:{reconnaissance:4},requirements:{minTechLevel:1},icon:"assets/division-icons/support_unit_rangers_icon.png",color:"#65a30d"},suporte_engenheiros:{id:"suporte_engenheiros",name:"Suporte: Engenheiros",nameEn:"Support: Engineers",category:"logistics",composition:{manpower:1400,equipment:{trucks:100,engineering_equipment:500}},costs:{production:2e6,maintenance:1e5},divisionBonuses:{defense:8,recovery:.05,organization:4},requirements:{minTechLevel:2},icon:"assets/division-icons/unit_engineer_icon.png",color:"#f59e0b"},suporte_hospital_campo:{id:"suporte_hospital_campo",name:"Suporte: Hospital de Campo",nameEn:"Support: Field Hospital",category:"logistics",composition:{manpower:600,equipment:{trucks:100,medical_equipment:300}},costs:{production:16e5,maintenance:8e4},divisionBonuses:{recovery:.12,hp:3,organization:5},requirements:{minTechLevel:2},icon:"assets/division-icons/support_unit_field_hospital_icon.png",color:"#dc2626"},suporte_logistica_admin:{id:"suporte_logistica_admin",name:"Suporte: Logística e Administração",nameEn:"Support: Logistics & Admin",category:"logistics",composition:{manpower:800,equipment:{trucks:200,radios:100,computers:50}},costs:{production:2e6,maintenance:1e5},divisionBonuses:{organization:8,recovery:.06,suppression:2},requirements:{minTechLevel:2},icon:"assets/division-icons/support_unit_logistics_company_icon.png",color:"#3b82f6"},suporte_manutencao_reparo:{id:"suporte_manutencao_reparo",name:"Suporte: Manutenção e Reparo",nameEn:"Support: Maintenance & Repair",category:"logistics",composition:{manpower:600,equipment:{trucks:200,repair_equipment:400,spare_parts:1e3}},costs:{production:4e6,maintenance:2e5},divisionBonuses:{recovery:.15,organization:6},requirements:{minTechLevel:3},icon:"assets/division-icons/support_unit_maintenance_company_icon.png",color:"#ea580c"},suporte_policia_militar:{id:"suporte_policia_militar",name:"Suporte: Polícia Militar",nameEn:"Support: Military Police",category:"logistics",composition:{manpower:1e3,equipment:{utility_vehicles:200,dogs:100,small_arms:1e3}},costs:{production:2e6,maintenance:1e5},divisionBonuses:{suppression:15,organization:7,defense:3},requirements:{minTechLevel:2},icon:"assets/division-icons/support_unit_military_police_icon.png",color:"#1e40af"},suporte_comunicacao_sinal:{id:"suporte_comunicacao_sinal",name:"Suporte: Comunicação e Sinal",nameEn:"Support: Signal",category:"logistics",composition:{manpower:200,equipment:{trucks:80,radios:200,communication_equipment:100}},costs:{production:2e6,maintenance:1e5},divisionBonuses:{reconnaissance:5,organization:5,recovery:.04},requirements:{minTechLevel:2},icon:"assets/division-icons/support_unit_signal_company_icon.png",color:"#059669"}},M={infantaria_basica:{id:"infantaria_basica",name:"Divisão de Infantaria Básica",description:"Divisão de infantaria padrão para combate geral",trainingLevel:"regular",combatUnits:[{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"}],supportUnits:[{unitType:"suporte_artilharia"},{unitType:"suporte_engenheiros"},{unitType:"suporte_recon_desmontado"}],category:"infantry",icon:"assets/division-icons/unit_infantry_icon.png"},infantaria_elite:{id:"infantaria_elite",name:"Divisão de Infantaria de Elite",description:"Infantaria de alto nível para operações críticas",trainingLevel:"elite",combatUnits:[{unitType:"tropa_choque"},{unitType:"tropa_choque"},{unitType:"tropa_choque"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"},{unitType:"infantaria_linha"}],supportUnits:[{unitType:"suporte_artilharia"},{unitType:"suporte_engenheiros"},{unitType:"suporte_hospital_campo"},{unitType:"suporte_recon_desmontado"}],category:"infantry",icon:"assets/division-icons/unit_heavy_infantry_icon.png"},infantaria_motorizada:{id:"infantaria_motorizada",name:"Divisão Motorizada",description:"Infantaria com alta mobilidade em estradas",trainingLevel:"regular",combatUnits:[{unitType:"infantaria_motorizada"},{unitType:"infantaria_motorizada"},{unitType:"infantaria_motorizada"},{unitType:"infantaria_motorizada"},{unitType:"infantaria_motorizada"},{unitType:"infantaria_motorizada"},{unitType:"infantaria_motorizada"},{unitType:"infantaria_motorizada"},{unitType:"carro_armado"},{unitType:"carro_armado"}],supportUnits:[{unitType:"suporte_artilharia"},{unitType:"suporte_recon_motorizado"},{unitType:"suporte_engenheiros"},{unitType:"suporte_antiaerea"}],category:"motorized",icon:"assets/division-icons/unit_motorized_icon.png"},divisao_mecanizada:{id:"divisao_mecanizada",name:"Divisão Mecanizada (IFV)",description:"Divisão mecanizada com IFVs para combate moderno",trainingLevel:"regular",combatUnits:[{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"tanque_mbt"},{unitType:"tanque_mbt"}],supportUnits:[{unitType:"suporte_spg"},{unitType:"suporte_recon_mecanizado"},{unitType:"suporte_engenheiros"},{unitType:"suporte_spaa"},{unitType:"suporte_manutencao_reparo"}],category:"mechanized",icon:"assets/division-icons/unit_mechanized_icon.png"},divisao_blindada:{id:"divisao_blindada",name:"Divisão Blindada",description:"Divisão de tanques pesados para breakthrough",trainingLevel:"regular",combatUnits:[{unitType:"tanque_mbt"},{unitType:"tanque_mbt"},{unitType:"tanque_mbt"},{unitType:"tanque_mbt"},{unitType:"tanque_mbt"},{unitType:"tanque_mbt"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"}],supportUnits:[{unitType:"suporte_spg"},{unitType:"suporte_recon_tanque_leve"},{unitType:"suporte_spaa"},{unitType:"suporte_manutencao_reparo"},{unitType:"suporte_engenheiros"}],category:"armor",icon:"assets/division-icons/unit_mbt_company_icon.png"},tanques_leves:{id:"tanques_leves",name:"Divisão de Tanques Leves",description:"Blindados leves para reconhecimento e flanqueamento",trainingLevel:"regular",combatUnits:[{unitType:"tanque_leve"},{unitType:"tanque_leve"},{unitType:"tanque_leve"},{unitType:"tanque_leve"},{unitType:"tanque_leve"},{unitType:"tanque_leve"},{unitType:"mecanizada_leve_apc"},{unitType:"mecanizada_leve_apc"},{unitType:"mecanizada_leve_apc"},{unitType:"mecanizada_leve_apc"}],supportUnits:[{unitType:"suporte_artilharia"},{unitType:"suporte_recon_tanque_leve"},{unitType:"suporte_antiaerea"},{unitType:"suporte_engenheiros"}],category:"armor",icon:"assets/division-icons/unit_light_tank_icon.png"},paraquedistas:{id:"paraquedistas",name:"Divisão Paraquedista",description:"Forças aerotransportadas para operações especiais",trainingLevel:"elite",combatUnits:[{unitType:"paraquedistas"},{unitType:"paraquedistas"},{unitType:"paraquedistas"},{unitType:"paraquedistas"},{unitType:"paraquedistas"},{unitType:"paraquedistas"},{unitType:"paraquedistas"},{unitType:"paraquedistas"},{unitType:"infantaria_leve"},{unitType:"infantaria_leve"}],supportUnits:[{unitType:"suporte_tanque_leve_aerotrans"},{unitType:"suporte_ifv_aerotrans"},{unitType:"suporte_artilharia"},{unitType:"suporte_engenheiros"}],category:"special",icon:"assets/division-icons/unit_paratroop_icon.png"},fuzileiros_navais:{id:"fuzileiros_navais",name:"Divisão de Fuzileiros Navais",description:"Infantaria naval para assaltos anfíbios",trainingLevel:"elite",combatUnits:[{unitType:"fuzileiros_navais"},{unitType:"fuzileiros_navais"},{unitType:"fuzileiros_navais"},{unitType:"fuzileiros_navais"},{unitType:"fuzileiros_navais"},{unitType:"fuzileiros_navais"},{unitType:"anfibio_mecanizado"},{unitType:"anfibio_mecanizado"},{unitType:"tanque_anfibio"},{unitType:"tanque_anfibio"}],supportUnits:[{unitType:"suporte_artilharia"},{unitType:"suporte_engenheiros"},{unitType:"suporte_hospital_campo"},{unitType:"suporte_antiaerea"}],category:"special",icon:"assets/division-icons/unit_marine_icon.png"},montanhistas:{id:"montanhistas",name:"Divisão de Montanha",description:"Especializada em combate em terreno montanhoso",trainingLevel:"elite",combatUnits:[{unitType:"montanhistas"},{unitType:"montanhistas"},{unitType:"montanhistas"},{unitType:"montanhistas"},{unitType:"montanhistas"},{unitType:"montanhistas"},{unitType:"montanhistas"},{unitType:"montanhistas"},{unitType:"infantaria_leve"},{unitType:"infantaria_leve"}],supportUnits:[{unitType:"suporte_artilharia"},{unitType:"suporte_engenheiros"},{unitType:"suporte_recon_desmontado"},{unitType:"suporte_hospital_campo"}],category:"special",icon:"assets/division-icons/unit_mountain_icon.png"},artilharia_pesada:{id:"artilharia_pesada",name:"Divisão de Artilharia Pesada",description:"Suporte de fogo massivo de longo alcance",trainingLevel:"regular",combatUnits:[{unitType:"spg"},{unitType:"spg"},{unitType:"spg"},{unitType:"spg"},{unitType:"mlrs"},{unitType:"mlrs"},{unitType:"bateria_artilharia"},{unitType:"bateria_artilharia"},{unitType:"bateria_artilharia"},{unitType:"bateria_artilharia"}],supportUnits:[{unitType:"suporte_recon_motorizado"},{unitType:"suporte_spaa"},{unitType:"suporte_engenheiros"},{unitType:"suporte_manutencao_reparo"}],category:"artillery",icon:"assets/division-icons/unit_spa_company_icon.png"},defesa_antiaerea:{id:"defesa_antiaerea",name:"Divisão Antiaérea",description:"Especializada em defesa aérea",trainingLevel:"regular",combatUnits:[{unitType:"spaa"},{unitType:"spaa"},{unitType:"spaa"},{unitType:"bateria_antiaerea"},{unitType:"bateria_antiaerea"},{unitType:"bateria_antiaerea"},{unitType:"grupo_manpad"},{unitType:"grupo_manpad"},{unitType:"infantaria_motorizada"},{unitType:"infantaria_motorizada"}],supportUnits:[{unitType:"suporte_spaa"},{unitType:"suporte_antiaerea"},{unitType:"suporte_recon_motorizado"},{unitType:"suporte_comunicacao_sinal"}],category:"artillery",icon:"assets/division-icons/unit_spaa_company_icon.png"},forca_tarefa_combinada:{id:"forca_tarefa_combinada",name:"Força-Tarefa Combinada",description:"Divisão balanceada com múltiplos tipos de unidades",trainingLevel:"regular",combatUnits:[{unitType:"tanque_mbt"},{unitType:"tanque_mbt"},{unitType:"tanque_mbt"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"mecanizada_ifv"},{unitType:"spg"},{unitType:"spaa"},{unitType:"helicoptero_ataque"},{unitType:"helicoptero_ataque"}],supportUnits:[{unitType:"suporte_recon_mecanizado"},{unitType:"suporte_engenheiros"},{unitType:"suporte_hospital_campo"},{unitType:"suporte_manutencao_reparo"},{unitType:"suporte_comunicacao_sinal"}],category:"combined",icon:"assets/division-icons/unit_mbt_company_icon.png"}};class U{static calculateDivisionStats(e,t,n,a){const c=(a[e.trainingLevel]||a.regular).modifiers;let r={manpower:{combat:0,support:0,total:0},equipment:{},costs:{production:0,maintenance:0},combatStats:{softAttack:0,hardAttack:0,defense:0,breakthrough:0,armor:0,piercing:0,hp:0,organization:0,recovery:0,reconnaissance:0,suppression:0,weight:0,combatWidth:0}};return e.combatUnits&&Array.isArray(e.combatUnits)&&e.combatUnits.forEach(p=>{const d=t[p.unitType];if(!d){console.warn(`Unidade de combate não encontrada: ${p.unitType}`);return}r.manpower.combat+=d.composition.manpower,this.mergeEquipment(r.equipment,d.composition.equipment),r.costs.production+=d.costs.production*c.costs.production,r.costs.maintenance+=d.costs.maintenance*c.costs.maintenance,Object.keys(r.combatStats).forEach(m=>{const l=d.stats[m]||0,u=c.stats[m]||1;r.combatStats[m]+=l*u})}),e.supportUnits&&Array.isArray(e.supportUnits)&&e.supportUnits.forEach(p=>{const d=n[p.unitType];if(!d){console.warn(`Unidade de suporte não encontrada: ${p.unitType}`);return}r.manpower.support+=d.composition.manpower,this.mergeEquipment(r.equipment,d.composition.equipment),r.costs.production+=d.costs.production,r.costs.maintenance+=d.costs.maintenance,d.divisionBonuses&&Object.keys(d.divisionBonuses).forEach(m=>{const l=d.divisionBonuses[m],w=["softAttack","hardAttack","defense","breakthrough","reconnaissance"].includes(m)&&c.stats[m]||1;r.combatStats[m]+=l*w})}),r.manpower.total=r.manpower.combat+r.manpower.support,r=this.roundStats(r),r}static mergeEquipment(e,t){t&&Object.keys(t).forEach(n=>{e[n]=(e[n]||0)+t[n]})}static roundStats(e){return e.manpower.combat=Math.round(e.manpower.combat),e.manpower.support=Math.round(e.manpower.support),e.manpower.total=Math.round(e.manpower.total),Object.keys(e.equipment).forEach(t=>{e.equipment[t]=Math.round(e.equipment[t])}),e.costs.production=Math.round(e.costs.production*100)/100,e.costs.maintenance=Math.round(e.costs.maintenance*100)/100,Object.keys(e.combatStats).forEach(t=>{e.combatStats[t]=Math.round(e.combatStats[t]*10)/10}),e}static categorizeEquipment(e){return{vehicles:{trucks:e.trucks||0,utility_vehicles:e.utility_vehicles||0,apc:e.apc||0,ifv:e.ifv||0,amtrac:e.amtrac||0},tanks:{light_tanks:e.light_tanks||0,medium_tanks:e.medium_tanks||0,mbt:e.mbt||0,amphibious_tanks:e.amphibious_tanks||0},artillery:{artillery:e.artillery||0,aa_guns:e.aa_guns||0,rocket_launchers:e.rocket_launchers||0,spg:e.spg||0,spaa:e.spaa||0,mlrs:e.mlrs||0},missiles:{atcms:e.atcms||0,manpads:e.manpads||0},aircraft:{attack_helicopters:e.attack_helicopters||0,utility_helicopters:e.utility_helicopters||0},infantry:{small_arms:e.small_arms||0,light_mg:e.light_mg||0,heavy_mg:e.heavy_mg||0,mortars:e.mortars||0,autocannons:e.autocannons||0,atgm:e.atgm||0}}}static calculateEffectiveness(e){const t=e.combatStats,n=(t.softAttack+t.hardAttack+t.breakthrough)/3,a=(t.defense+t.armor+t.hp)/3,o=(t.reconnaissance+t.suppression+t.organization)/3,c=n*.4+a*.4+o*.2;return Math.min(100,Math.round(c))}static calculateCostPerManpower(e){return e.manpower.total===0?0:Math.round(e.costs.production/e.manpower.total)}static getWidthClassification(e){const t=e.combatStats.combatWidth;return t<=10?"Muito Estreita":t<=20?"Estreita":t<=30?"Média":t<=40?"Larga":"Muito Larga"}static analyzeDivision(e){const t=e.combatStats,n=[],a=[];return t.softAttack>200?n.push("Alto ataque contra infantaria"):t.softAttack<50&&a.push("Baixo ataque contra infantaria"),t.hardAttack>200?n.push("Alto ataque contra blindados"):t.hardAttack<20&&a.push("Baixo ataque contra blindados"),t.defense>200?n.push("Alta defesa"):t.defense<50&&a.push("Baixa defesa"),t.armor>50?n.push("Boa proteção blindada"):t.armor<10&&a.push("Pouca proteção blindada"),t.reconnaissance>15?n.push("Excelente reconhecimento"):t.reconnaissance<5&&a.push("Reconhecimento limitado"),t.organization>60?n.push("Alta organização"):t.organization<40&&a.push("Baixa organização"),t.combatWidth>40?a.push("Largura de combate muito alta"):t.combatWidth<10&&a.push("Largura de combate muito baixa"),{strengths:n,weaknesses:a,overallRating:this.calculateEffectiveness(e)}}}class k{static validate(e,t,n,a){const o=[],c=[];if(this.validateMetadata(e,o),this.validateCombatUnits(e,t,o,c),this.validateSupportUnits(e,n,o,c),o.length===0){const r=U.calculateDivisionStats(e,t,n,a);this.validateStats(r,o,c)}return{valid:o.length===0,errors:o,warnings:c}}static validateMetadata(e,t){!e.name||typeof e.name!="string"?t.push("Nome da divisão é obrigatório"):e.name.trim()===""?t.push("Nome da divisão não pode ser vazio"):e.name.length>50&&t.push("Nome da divisão muito longo (máximo 50 caracteres)"),["conscript","regular","elite"].includes(e.trainingLevel)||t.push("Nível de treinamento inválido")}static validateCombatUnits(e,t,n,a){if(!e.combatUnits||!Array.isArray(e.combatUnits)){n.push("Lista de unidades de combate inválida");return}const o=e.combatUnits;o.length===0&&n.push("A divisão deve ter pelo menos uma unidade de combate"),o.length>25&&n.push("Máximo de 25 unidades de combate permitidas"),o.forEach((d,m)=>{if(!d.unitType||!d.id){n.push(`Unidade de combate #${m+1} com estrutura inválida`);return}t[d.unitType]||n.push(`Tipo de unidade de combate não encontrado: ${d.unitType}`)}),o.length<5&&a.push("Divisão muito pequena (menos de 5 batalhões). Considere adicionar mais unidades.");const c=o.map(d=>d.unitType);new Set(c).size/c.length<.3&&o.length>5&&a.push("Pouca variedade de tipos de unidade. Considere diversificar a composição.")}static validateSupportUnits(e,t,n,a){if(!e.supportUnits||!Array.isArray(e.supportUnits)){n.push("Lista de unidades de suporte inválida");return}const o=e.supportUnits;o.length>5&&n.push("Máximo de 5 unidades de suporte permitidas"),o.forEach((p,d)=>{if(!p.unitType||!p.id){n.push(`Unidade de suporte #${d+1} com estrutura inválida`);return}t[p.unitType]||n.push(`Tipo de unidade de suporte não encontrado: ${p.unitType}`)});const c=o.map(p=>p.unitType),r=new Set(c);if(c.length>r.size){const p=c.filter((d,m)=>c.indexOf(d)!==m);a.push(`Unidades de suporte duplicadas (${[...new Set(p)].join(", ")}). Duplicatas não fornecem benefícios adicionais.`)}o.length===0&&e.combatUnits&&e.combatUnits.length>5&&a.push("Divisão sem unidades de suporte. Considere adicionar suporte para melhorar desempenho.")}static validateStats(e,t,n){const a=e.combatStats;a.combatWidth>40&&n.push(`Largura de combate muito alta (${a.combatWidth}). Divisões largas são menos eficientes em terrenos difíceis. Recomendado: ≤40`),a.combatWidth<10&&n.push(`Largura de combate muito baixa (${a.combatWidth}). Divisões estreitas podem não aproveitar todo o front. Recomendado: ≥10`),a.organization<20&&n.push("Organização muito baixa (<20). A divisão pode quebrar rapidamente em combate."),a.organization<10&&t.push("Organização crítica (<10). Divisão inviável para combate."),a.hp<5&&t.push("HP muito baixo (<5). Divisão não sobreviveria a combate."),a.hp<10&&n.push("HP baixo (<10). Considere adicionar mais unidades ou melhorar treinamento."),a.softAttack<10&&a.hardAttack<10&&n.push("Capacidade ofensiva muito baixa. Divisão terá dificuldade em causar dano ao inimigo."),a.weight>5&&n.push(`Divisão muito pesada (${a.weight.toFixed(1)} ton). Mobilidade reduzida e maior consumo de combustível.`);const o=U.calculateCostPerManpower(e);o>1e4&&n.push(`Custo por soldado muito alto ($${(o/1e3).toFixed(1)}k). Considere otimizar composição.`),e.manpower.total<500&&n.push("Divisão muito pequena (<500 MP). Pode não ser efetiva em combate."),e.manpower.total>25e3&&n.push("Divisão muito grande (>25k MP). Difícil de manter e suprir.")}static validateResources(e,t,n,a,o){if(!n)return;const c=n.Orcamento||0;t.costs.production>c&&a.push(`Custo de produção ($${(t.costs.production/1e6).toFixed(1)}M) excede orçamento disponível ($${(c/1e6).toFixed(1)}M)`),t.costs.production>c*.8&&o.push(`Custo de produção muito alto (${(t.costs.production/c*100).toFixed(0)}% do orçamento)`);const r=n.ManpowerDisponivel||0;t.manpower.total>r&&a.push(`Manpower necessário (${t.manpower.total}) excede disponível (${r})`);const p=n.CapacidadeProducaoVeiculos||0;this.estimateEquipmentValue(t.equipment)>p&&o.push("Equipamentos requeridos excedem capacidade de produção militar. Produção pode levar múltiplos turnos.")}static estimateEquipmentValue(e){const t={mbt:1e5,medium_tanks:2e4,light_tanks:67e3,ifv:3e4,apc:2e4,spg:187500,spaa:187500,mlrs:312500,artillery:41667,aa_guns:41667,attack_helicopters:133333,utility_helicopters:33333};let n=0;return Object.keys(e).forEach(a=>{t[a]&&(n+=e[a]*t[a])}),n}static validateCompatibility(e,t,n,a){const o=e.combatUnits||[],c=e.supportUnits||[],r=o.some(l=>{const u=t[l.unitType];return u&&u.category==="special"&&u.subcategory==="airborne"}),p=c.some(l=>{const u=n[l.unitType];return u&&u.category==="air_support"});r&&!p&&a.push("Divisão tem unidades aerotransportadas mas não tem suporte aéreo. Considere adicionar suporte de helicópteros.");const d=o.filter(l=>{const u=t[l.unitType];return u&&u.category==="armor"}).length,m=c.some(l=>l.unitType==="suporte_manutencao_reparo");d>3&&!m&&a.push("Muitas unidades blindadas sem suporte de manutenção. Considere adicionar Suporte: Manutenção e Reparo.")}static generateReport(e){let t=[];return e.errors.length>0&&(t.push("❌ ERROS:"),e.errors.forEach(n=>{t.push(`  • ${n}`)})),e.warnings.length>0&&(t.length>0&&t.push(""),t.push("⚠️ AVISOS:"),e.warnings.forEach(n=>{t.push(`  • ${n}`)})),e.valid&&e.warnings.length===0&&t.push("✅ Divisão válida e otimizada!"),t.join(`
`)}}let s={id:null,name:"Nova Divisão",countryId:null,trainingLevel:"regular",combatUnits:[],supportUnits:[],calculatedStats:null,createdAt:null,updatedAt:null},B=null,_=null,v=null,L=[];function z(){return window.db}async function ve(i){try{console.log("🎖️ Inicializando Division Designer..."),B=i;const{checkUserPermissions:e}=await P(async()=>{const{checkUserPermissions:a}=await import("./firebase-ep1w8F7T.js");return{checkUserPermissions:a}},__vite__mapDeps([0,1,2]));v=await e(B.uid),console.log("🔑 Permissões do usuário:",v),(v.isNarrator||v.isAdmin)&&await Q(),await J();const n=new URLSearchParams(window.location.search).get("id");n&&await X(n),await Y(),x(),ue(),console.log("✅ Division Designer inicializado com sucesso")}catch(e){console.error("❌ Erro ao inicializar Division Designer:",e),g("error","Erro ao carregar Division Designer: "+e.message)}}async function Q(){try{const{getAllCountries:i}=await P(async()=>{const{getAllCountries:t}=await import("./firebase-ep1w8F7T.js");return{getAllCountries:t}},__vite__mapDeps([0,1,2]));L=(await i()).map(t=>({id:t.id,name:t.Pais,flag:t.Flag})).sort((t,n)=>t.name.localeCompare(n.name)),console.log(`✅ ${L.length} países carregados para seleção`)}catch(i){throw console.error("Erro ao carregar países:",i),i}}async function J(){try{const{checkPlayerCountry:i,getCountryData:e}=await P(async()=>{const{checkPlayerCountry:n,getCountryData:a}=await import("./firebase-ep1w8F7T.js");return{checkPlayerCountry:n,getCountryData:a}},__vite__mapDeps([0,1,2])),t=await i(B.uid);if(!t){if(v?.isNarrator||v?.isAdmin){console.log("⚠️ Narrador/Admin sem país vinculado - poderá selecionar país manualmente");return}throw new Error("Usuário não está vinculado a um país")}_=await e(t),_.id=t,s.countryId=t,console.log(`✅ País carregado: ${_.Pais}`)}catch(i){throw console.error("Erro ao carregar país:",i),i}}async function X(i){try{if(!_||!_.id)throw new Error("País do usuário não carregado. Não é possível carregar a divisão.");const t=await z().collection("inventory").doc(_.id).get();if(!t.exists)throw new Error("Inventário do país não encontrado.");const a=(t.data().divisions||[]).find(o=>o.id===i);if(!a)throw new Error("Divisão não encontrada no inventário.");s={...s,...a,id:i},console.log(`✅ Divisão carregada: ${s.name}`)}catch(e){console.error("Erro ao carregar divisão:",e),g("error","Erro ao carregar divisão: "+e.message)}}async function Y(){(v?.isNarrator||v?.isAdmin)&&Z(),I(),S(),$(),re(),await K()}function Z(){const i=document.getElementById("country-selector-container"),e=document.getElementById("country-selector");!i||!e||(i.classList.remove("hidden"),e.innerHTML=`
    <option value="">Selecione um país...</option>
    ${L.map(t=>`
      <option value="${t.id}" ${s.countryId===t.id?"selected":""}>
        ${t.flag||"🏳️"} ${t.name}
      </option>
    `).join("")}
  `,e.addEventListener("change",t=>{const n=t.target.value;n&&(s.countryId=n,console.log(`🌍 País selecionado: ${n}`))}),console.log("✅ Seletor de país renderizado"))}function I(){const i=document.getElementById("training-selector"),e=[{id:"conscript",...T.conscript},{id:"regular",...T.regular},{id:"elite",...T.elite}];i.innerHTML=e.map(t=>{const n=(t.modifiers.costs.production-1)*100;return`
      <button
        class="training-badge flex-1 px-4 py-3 rounded-lg border-2 transition-all ${s.trainingLevel===t.id?"border-brand-500 bg-brand-500/20 text-brand-400":"border-bg-ring bg-bg hover:border-slate-600"}"
        data-training="${t.id}"
        onclick="window.selectTrainingLevel('${t.id}')"
        title="${ee(t)}"
      >
        <div class="text-2xl mb-1">${t.icon}</div>
        <div class="text-xs font-bold mb-1">${t.name}</div>
        <div class="text-xs text-slate-400">${t.modifiers.recruitmentTurns} turno${t.modifiers.recruitmentTurns>1?"s":""}</div>
        <div class="text-xs font-semibold ${n<0?"text-green-400":n>0?"text-red-400":"text-slate-400"}">
          ${n>=0?"+":""}${n.toFixed(0)}% $
        </div>
      </button>
    `}).join("")}function ee(i){const e=(i.modifiers.costs.production-1)*100,t=(i.modifiers.stats.softAttack-1)*100,n=i.modifiers.recruitmentTurns;let a=`${i.name}
${i.description}

`;if(a+=`💰 Custo: ${e>=0?"+":""}${e.toFixed(0)}%
`,a+=`⚔️ Stats: ${t>=0?"+":""}${t.toFixed(0)}%
`,a+=`⏱️ Recrutamento: ${n} turno${n>1?"s":""}`,n>1){const o=(i.modifiers.recruitmentProgress*100).toFixed(1);a+=` (${o}% por turno)`}return a}window.selectTrainingLevel=function(i){s.trainingLevel=i,I(),x()};function S(){const i=document.getElementById("support-grid"),e=5;i.innerHTML="";for(let t=0;t<e;t++){const n=s.supportUnits[t],a=W(t,"support",n);i.appendChild(a)}N()}function $(){const i=document.getElementById("combat-grid"),e=25;i.innerHTML="";for(let t=0;t<e;t++){const n=s.combatUnits[t],a=W(t,"combat",n);i.appendChild(a)}N()}function W(i,e,t){const n=document.createElement("div");if(t){const a=e==="combat"?q[t.unitType]:E[t.unitType];n.className="unit-slot filled rounded-lg p-2 cursor-pointer flex flex-col items-center justify-center relative group";const c=a.icon.endsWith(".png")?`<img src="${a.icon}" alt="${a.name}" class="w-12 h-12 object-contain mb-1" />`:`<div class="text-3xl mb-1">${a.icon}</div>`;n.innerHTML=`
      ${c}
      <div class="text-[10px] font-medium text-center line-clamp-2 text-slate-300">${a.name.split(" ")[0]}</div>
      <div class="absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity">
        <button
          onclick="window.removeUnit(${i}, '${e}')"
          class="w-5 h-5 rounded-full bg-red-600 hover:bg-red-700 flex items-center justify-center text-white text-xs"
        >×</button>
      </div>
    `,n.addEventListener("mouseenter",r=>me(r,a,e)),n.addEventListener("mouseleave",A),n.addEventListener("click",r=>{r.target.closest("button")||A()})}else n.className="unit-slot empty rounded-lg flex items-center justify-center cursor-pointer hover:border-brand-500",n.innerHTML=`
      <div class="text-2xl text-slate-600 group-hover:text-brand-500 transition-colors">+</div>
    `,n.onclick=()=>te(i,e);return n}window.removeUnit=function(i,e){e==="combat"?(s.combatUnits.splice(i,1),$()):(s.supportUnits.splice(i,1),S()),x()};function te(i,e){const t=e==="combat"?q:E,n=e==="combat"?"Unidade de Combate":"Unidade de Suporte",a=e==="combat"?25:5;if((e==="combat"?s.combatUnits.length:s.supportUnits.length)>=a){g("warning",`Máximo de ${a} unidades ${e==="combat"?"de combate":"de suporte"} atingido`);return}const c=`
    <div class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center p-4" onclick="window.closeModal(event)">
      <div class="bg-bg-soft border border-bg-ring rounded-2xl max-w-4xl w-full max-h-[80vh] flex flex-col" onclick="event.stopPropagation()">
        <!-- Header -->
        <div class="border-b border-bg-ring p-6">
          <div class="flex items-center justify-between">
            <h2 class="text-2xl font-bold text-brand-500">Selecionar ${n}</h2>
            <button onclick="window.closeModal()" class="text-slate-400 hover:text-slate-200 text-2xl leading-none">×</button>
          </div>
        </div>

        <!-- Filters -->
        <div class="border-b border-bg-ring p-4">
          <div id="category-filters" class="flex gap-2 flex-wrap">
            ${ne(t)}
          </div>
        </div>

        <!-- Units List -->
        <div class="flex-1 overflow-y-auto p-6">
          <div id="units-list" class="grid grid-cols-1 md:grid-cols-2 gap-3">
            ${H(t,i,e)}
          </div>
        </div>
      </div>
    </div>
  `,r=document.getElementById("modal-container");r.innerHTML=c,ae(t,i,e);const p=r.querySelector(".modal-backdrop > div > div");p&&p.addEventListener("scroll",()=>{A(!0)});const d=r.querySelector(".modal-backdrop");d&&d.addEventListener("mousemove",m=>{const l=d.querySelector(".modal-backdrop > div");l&&!l.contains(m.target)&&A(!0)})}function ie(i){return{air_support:"Suporte Aéreo",airborne_support:"Aerotransportado",fire_support:"Suporte de Fogo",reconnaissance:"Reconhecimento",logistics:"Logística",infantry:"Infantaria",motorized:"Motorizada",mechanized:"Mecanizada",armor:"Blindados",artillery:"Artilharia",special:"Forças Especiais",amphibious:"Anfíbios"}[i]||i.charAt(0).toUpperCase()+i.slice(1)}function ne(i,e){const t=new Set;return Object.values(i).forEach(a=>t.add(a.category)),["Todas",...Array.from(t)].map(a=>`
    <button
      class="category-filter px-4 py-2 rounded-lg border transition-colors ${a==="Todas"?"border-brand-500 bg-brand-500/20 text-brand-400":"border-bg-ring bg-bg hover:border-slate-600"}"
      data-category="${a}"
    >
      ${a==="Todas"?"Todas":ie(a)}
    </button>
  `).join("")}function ae(i,e,t){const n=document.querySelectorAll(".category-filter");n.forEach(a=>{a.addEventListener("click",()=>{const o=a.dataset.category;n.forEach(r=>{r.classList.remove("border-brand-500","bg-brand-500/20","text-brand-400"),r.classList.add("border-bg-ring","bg-bg")}),a.classList.add("border-brand-500","bg-brand-500/20","text-brand-400"),a.classList.remove("border-bg-ring","bg-bg");const c=o==="Todas"?i:Object.fromEntries(Object.entries(i).filter(([r,p])=>p.category===o));document.getElementById("units-list").innerHTML=H(c,e,t)})})}function H(i,e,t){return Object.entries(i).map(([n,a])=>{const c=a.icon.endsWith(".png")?`<img src="${a.icon}" alt="${a.name}" class="w-16 h-16 object-contain" />`:`<div class="text-4xl">${a.icon}</div>`;return`
      <div
        class="unit-card bg-bg border border-bg-ring rounded-lg p-4 hover:shadow-lg transition-all"
        onclick="window.selectUnit('${n}', ${e}, '${t}')"
      >
        <div class="flex items-start gap-3">
          ${c}
          <div class="flex-1 min-w-0">
            <h3 class="font-bold text-slate-100 mb-1">${a.name}</h3>
            <div class="text-xs text-slate-400 space-y-1">
              <div>${a.composition.manpower} MP</div>
              <div class="text-green-400">$${(a.costs.production/1e6).toFixed(1)}M</div>
            </div>
          </div>
          <div class="text-right text-xs text-slate-500">
            <div>${a.category}</div>
          </div>
        </div>
      </div>
    `}).join("")}window.selectUnit=function(i,e,t){const n={id:D(),unitType:i,position:e};t==="combat"?(s.combatUnits.push(n),$()):(s.supportUnits.push(n),S()),closeModal(),x()};window.closeModal=function(i){(!i||i.target.classList.contains("modal-backdrop"))&&(A(!0),document.getElementById("modal-container").innerHTML="")};function N(){document.getElementById("combat-count").textContent=`${s.combatUnits.length}/25`,document.getElementById("support-count").textContent=`${s.supportUnits.length}/5`}function x(){const i=U.calculateDivisionStats(s,q,E,T);s.calculatedStats=i,document.querySelectorAll(".stat-value").forEach(d=>{d.classList.add("stat-updating"),setTimeout(()=>d.classList.remove("stat-updating"),400)});const t=i.combatStats.softAttack+i.combatStats.hardAttack;document.getElementById("stat-firepower").textContent=t.toFixed(0),document.getElementById("stat-defense").textContent=i.combatStats.defense.toFixed(0),document.getElementById("stat-organization").textContent=i.combatStats.organization.toFixed(0),document.getElementById("stat-hp").textContent=i.combatStats.hp.toFixed(0),document.getElementById("stat-width").textContent=i.combatStats.combatWidth.toFixed(0),document.getElementById("stat-manpower").textContent=i.manpower.total.toLocaleString();const n=document.getElementById("division-quantity"),a=n?Math.max(1,Math.min(50,parseInt(n.value)||1)):1,o=i.costs.production*a,c=i.costs.maintenance*a;let r="$"+(o/1e6).toFixed(2)+"M",p="$"+(c/1e3).toFixed(0)+"k";a>1&&(r+=` (${a}x)`,p+=` (${a}x)`),document.getElementById("cost-production").textContent=r,document.getElementById("cost-maintenance").textContent=p,oe(i.equipment)}function oe(i){const e=document.getElementById("equipment-list");if(Object.keys(i).length===0){e.innerHTML='<p class="text-slate-500 text-center py-4">Nenhuma unidade adicionada</p>';return}const t=Object.entries(i).filter(([n,a])=>a>0).sort((n,a)=>a[1]-n[1]).map(([n,a])=>`
      <div class="flex justify-between items-center py-1">
        <span class="text-slate-400">${F(n)}:</span>
        <span class="font-bold text-slate-200">${a}</span>
      </div>
    `).join("");e.innerHTML=t}function F(i){return{trucks:"Caminhões",utility_vehicles:"Utilitários",apc:"APC",ifv:"IFV",light_tanks:"Tanques Leves",medium_tanks:"Tanques Médios",mbt:"MBT",artillery:"Artilharia",aa_guns:"AA",spg:"SPG",spaa:"SPAA",mlrs:"MLRS",atcms:"ATCMS",manpads:"MANPADS",attack_helicopters:"Helicópteros Ataque",utility_helicopters:"Helicópteros Utilitários",small_arms:"Armas Pequenas",amtrac:"AMTRAC"}[i]||i}function se(i){const e=document.getElementById("quantity-info");if(!e)return;const t=Math.max(1,Math.min(50,i));t===1?(e.textContent="1 divisão será criada",e.className="text-xs text-slate-400 mt-1"):(e.textContent=`${t} divisões serão criadas`,e.className="text-xs text-brand-400 mt-1 font-semibold"),s.calculatedStats&&x()}function re(){const i=document.getElementById("division-name");i.value=s.name,i.addEventListener("input",o=>{s.name=o.target.value});const e=document.getElementById("division-quantity");e&&e.addEventListener("input",o=>{const c=parseInt(o.target.value)||1;se(c)}),document.getElementById("btn-reset").addEventListener("click",O),document.getElementById("btn-validate").addEventListener("click",V),document.getElementById("btn-save").addEventListener("click",G);const t=document.getElementById("btn-save-template");t&&t.addEventListener("click",de);const n=document.getElementById("btn-duplicate");n&&n.addEventListener("click",duplicateDivision);const a=document.getElementById("templates-dropdown");a&&a.addEventListener("change",o=>{window.loadTemplate(o.target.value)}),ce()}function ce(){document.addEventListener("keydown",i=>{(i.ctrlKey||i.metaKey)&&i.key==="s"&&(i.preventDefault(),G(),g("info","💾 Salvando divisão...")),(i.ctrlKey||i.metaKey)&&i.key==="r"&&(i.preventDefault(),O()),(i.ctrlKey||i.metaKey)&&i.key==="v"&&(i.preventDefault(),V()),(i.ctrlKey||i.metaKey)&&i.key==="d"&&(i.preventDefault(),duplicateDivision()),i.key==="Escape"&&window.closeModal(),i.key==="?"&&!i.target.matches("input, textarea")&&(i.preventDefault(),showKeyboardShortcutsHelp())})}window.showKeyboardShortcutsHelp=function(){const i=`
    <div class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center p-4" onclick="window.closeModal(event)">
      <div class="bg-bg-soft border border-bg-ring rounded-2xl max-w-md w-full p-6" onclick="event.stopPropagation()">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-bold text-brand-500">⌨️ Atalhos de Teclado</h2>
          <button onclick="window.closeModal()" class="text-slate-400 hover:text-slate-200 text-2xl">×</button>
        </div>

        <div class="space-y-3 text-sm">
          <div class="flex justify-between items-center py-2 border-b border-bg-ring">
            <span class="text-slate-300">Salvar Divisão</span>
            <kbd class="px-2 py-1 bg-bg rounded font-mono text-brand-400">Ctrl + S</kbd>
          </div>
          <div class="flex justify-between items-center py-2 border-b border-bg-ring">
            <span class="text-slate-300">Validar Divisão</span>
            <kbd class="px-2 py-1 bg-bg rounded font-mono text-brand-400">Ctrl + V</kbd>
          </div>
          <div class="flex justify-between items-center py-2 border-b border-bg-ring">
            <span class="text-slate-300">Resetar Divisão</span>
            <kbd class="px-2 py-1 bg-bg rounded font-mono text-brand-400">Ctrl + R</kbd>
          </div>
          <div class="flex justify-between items-center py-2 border-b border-bg-ring">
            <span class="text-slate-300">Duplicar Divisão</span>
            <kbd class="px-2 py-1 bg-bg rounded font-mono text-brand-400">Ctrl + D</kbd>
          </div>
          <div class="flex justify-between items-center py-2 border-b border-bg-ring">
            <span class="text-slate-300">Fechar Modal</span>
            <kbd class="px-2 py-1 bg-bg rounded font-mono text-brand-400">Esc</kbd>
          </div>
          <div class="flex justify-between items-center py-2">
            <span class="text-slate-300">Mostrar Atalhos</span>
            <kbd class="px-2 py-1 bg-bg rounded font-mono text-brand-400">?</kbd>
          </div>
        </div>

        <div class="mt-6 text-center">
          <button onclick="window.closeModal()" class="px-6 py-2 bg-brand-500 hover:bg-brand-600 rounded-lg font-medium transition-colors">
            Entendido
          </button>
        </div>
      </div>
    </div>
  `;document.getElementById("modal-container").innerHTML=i};async function O(){await j("Resetar Divisão","Tem certeza que deseja limpar toda a divisão?")&&(s.combatUnits=[],s.supportUnits=[],s.name="Nova Divisão",s.trainingLevel="regular",document.getElementById("division-name").value="Nova Divisão",I(),$(),S(),x(),g("success","Divisão resetada"))}function V(){const i=k.validate(s,q,E,T),e=k.generateReport(i),t=document.getElementById("division-name");t.classList.remove("border-red-500","border-yellow-500","border-green-500"),i.valid?i.warnings.length>0?(t.classList.add("border-yellow-500"),g("warning",`Divisão válida com avisos:

`+e)):(t.classList.add("border-green-500"),g("success",`Divisão válida!

`+e)):(t.classList.add("border-red-500"),g("error",`Divisão inválida:

`+e),pe()),setTimeout(()=>{t.classList.remove("border-red-500","border-yellow-500","border-green-500")},3e3)}function pe(i){if(s.calculatedStats){const e=s.calculatedStats.combatStats;if(e.combatWidth>40){const t=document.getElementById("stat-width");t.classList.add("text-red-400","font-bold"),setTimeout(()=>t.classList.remove("text-red-400","font-bold"),3e3)}if(e.organization<20){const t=document.getElementById("stat-organization");t.classList.add("text-red-400","font-bold"),setTimeout(()=>t.classList.remove("text-red-400","font-bold"),3e3)}}}async function G(){const i=document.getElementById("btn-save"),e=i.textContent;try{const t=k.validate(s,q,E,T);if(!t.valid){const f=k.generateReport(t);g("error",`Não é possível salvar divisão inválida:

`+f);return}if(t.warnings.length>0){const f=k.generateReport(t);if(!await j("Avisos de Validação",f+`

Deseja continuar mesmo assim?`,"Sim, salvar","Cancelar"))return}if(i.disabled=!0,i.innerHTML=`
      <svg class="animate-spin h-4 w-4 inline-block mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Salvando...
    `,!window.db)throw new Error("Firestore não está inicializado. Recarregue a página.");let n;if(v?.isNarrator||v?.isAdmin){if(n=s.countryId,!n)throw new Error("Selecione um país para salvar a divisão.")}else{if(!_||!_.id)throw new Error("País do usuário não está carregado. Recarregue a página.");n=_.id}const a=!s.id;a&&(s.id=`div_${Date.now()}_${Math.random().toString(36).substr(2,9)}`);const o=T[s.trainingLevel],c=o.modifiers.recruitmentTurns,r=o.modifiers.recruitmentProgress,p={id:s.id,name:s.name,countryId:s.countryId,trainingLevel:s.trainingLevel,combatUnits:s.combatUnits,supportUnits:s.supportUnits,calculatedStats:s.calculatedStats,updatedAt:new Date().toISOString(),recruitmentStatus:s.recruitmentStatus||"recruiting",recruitment:s.recruitment||{totalTurns:c,currentTurn:0,progressPerTurn:r,progress:0,startedAt:new Date().toISOString(),trainingLevel:s.trainingLevel}};a?p.createdAt=new Date().toISOString():p.createdAt=s.createdAt,console.log("📦 Salvando divisão no inventário (compat):",n);const d=z().collection("inventory").doc(n);console.log("📖 Tentando obter inventoryDoc com .get()...");const m=await d.get();console.log("✅ inventoryDoc obtido, exists:",m.exists);const l=document.getElementById("division-quantity"),u=l?Math.max(1,Math.min(50,parseInt(l.value)||1)):1;if(m.exists){console.log("🔄 Atualizando inventário existente");let h=m.data().divisions||[];if(a)if(u>1){console.log(`➕ Adicionando ${u} novas divisões`);for(let y=0;y<u;y++){const C={...p,id:`${p.id}_${y+1}`,name:`${p.name} #${y+1}`};h.push(C)}}else console.log("➕ Adicionando 1 nova divisão"),h.push(p);else{console.log("🔄 Atualizando divisão existente");const y=h.findIndex(C=>C.id===s.id);y!==-1?h[y]=p:h.push(p)}console.log("💾 Tentando atualizar com .update()..."),await d.update({divisions:h}),console.log("✅ Inventário atualizado com sucesso")}else{console.log("➕ Criando novo inventário com .set()");const f=[];if(a&&u>1){for(let h=0;h<u;h++){const y={...p,id:`${p.id}_${h+1}`,name:u>1?`${p.name} #${h+1}`:p.name};f.push(y)}console.log(`✅ Criando ${u} divisões`)}else f.push(p);await d.set({country_id:n,divisions:f}),console.log("✅ Inventário criado com sucesso")}i.innerHTML=`
      <svg class="h-4 w-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
      Salvo!
    `;let w;if(a&&u>1){if(w=`✅ ${u} divisões criadas com sucesso!`,v?.isNarrator||v?.isAdmin){const f=L.find(h=>h.id===n)?.name||n;w=`✅ ${u} divisões criadas para ${f}!`}}else w="✅ Divisão salva com sucesso!",(v?.isNarrator||v?.isAdmin)&&(w=`✅ Divisão salva para ${L.find(h=>h.id===n)?.name||n}!`);g("success",w),setTimeout(()=>{i.disabled=!1,i.textContent=e},2e3)}catch(t){console.error("Erro ao salvar divisão:",t),g("error","Erro ao salvar: "+t.message),i.disabled=!1,i.textContent=e}}async function de(){try{if(!k.validate(s,q,E,T).valid){g("error","Não é possível salvar template de divisão inválida");return}const e=prompt("Nome do template:",s.name+" (Template)");if(!e)return;const t=z().collection("division_templates"),n={name:e,countryId:_.id,isPublic:!1,trainingLevel:s.trainingLevel,combatUnits:s.combatUnits.map(o=>({unitType:o.unitType})),supportUnits:s.supportUnits.map(o=>({unitType:o.unitType})),createdAt:new Date().toISOString()},a=await t.add(n);g("success","✅ Template salvo com sucesso!"),await K()}catch(i){console.error("Erro ao salvar template:",i),g("error","Erro ao salvar template: "+i.message)}}async function K(){try{const i=Object.values(M);if(_&&_.id)try{(await z().collection("division_templates").where("countryId","==",_.id).orderBy("createdAt","desc").get()).forEach(a=>{i.push({id:a.id,...a.data(),isCustom:!0})})}catch(e){console.warn("Erro ao carregar templates customizados:",e)}return R(i),i}catch(i){console.error("Erro ao carregar templates:",i);const e=Object.values(M);return R(e),e}}function R(i){const e=document.getElementById("templates-dropdown");if(!e){console.warn("Elemento templates-dropdown não encontrado");return}if(!i||i.length===0){e.innerHTML='<option value="">Nenhum template disponível</option>';return}const t=i.filter(o=>!o.isCustom),n=i.filter(o=>o.isCustom);let a='<option value="">Selecione um template...</option>';t.length>0&&(a+='<optgroup label="📋 Templates Básicos">',a+=t.map(o=>`<option value="${o.id}">${o.name}</option>`).join(""),a+="</optgroup>"),n.length>0&&(a+='<optgroup label="⭐ Meus Templates">',a+=n.map(o=>`<option value="${o.id}">${o.name}</option>`).join(""),a+="</optgroup>"),e.innerHTML=a}window.loadTemplate=async function(i){if(i)try{let e=null;if(M[i])e=M[i],console.log("Carregando template básico:",e.name);else{const n=await z().collection("division_templates").doc(i).get();if(!n.exists){g("error","Template não encontrado");return}e=n.data(),console.log("Carregando template customizado:",e.name)}s.name=e.name.replace(" (Template)",""),s.trainingLevel=e.trainingLevel,s.combatUnits=e.combatUnits.map((t,n)=>({id:D(),unitType:t.unitType,position:n})),s.supportUnits=e.supportUnits.map((t,n)=>({id:D(),unitType:t.unitType,position:n})),document.getElementById("division-name").value=s.name,I(),$(),S(),x(),g("success",`✅ Template "${e.name}" carregado!`)}catch(e){console.error("Erro ao carregar template:",e),g("error","Erro ao carregar template: "+e.message)}};window.duplicateDivision=async function(i){try{const e=window.db.collection("inventory").doc(_.id),t=await e.get();if(!t.exists)throw new Error("Inventário do país não encontrado.");const n=t.data().divisions||[],a=n.find(r=>r.id===i);if(!a){g("error","Divisão não encontrada para duplicar.");return}const o={...a,id:`div_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:a.name+" (Cópia)",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},c=[...n,o];await e.update({divisions:c}),g("success","✅ Divisão duplicada!"),await loadDivisions()}catch(e){console.error("Erro ao duplicar divisão:",e),g("error","Erro ao duplicar: "+e.message)}};function D(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function ue(){const i=document.getElementById("initial-loading");i&&(i.style.opacity="0",setTimeout(()=>i.style.display="none",500))}let b=null;function me(i,e,t){b&&(clearTimeout(b),b=null),A(!0);const n=document.createElement("div");n.id="unit-tooltip",n.className="fixed z-[100] bg-bg-soft border-2 border-brand-500 rounded-lg p-4 shadow-2xl max-w-sm pointer-events-none";let c=`
    <div class="space-y-3">
      <div class="flex items-center gap-3 border-b border-bg-ring pb-2">
        ${e.icon.endsWith(".png")?`<img src="${e.icon}" alt="${e.name}" class="w-16 h-16 object-contain" />`:`<div class="text-4xl">${e.icon}</div>`}
        <div>
          <h3 class="font-bold text-brand-400 text-lg">${e.name}</h3>
          <p class="text-xs text-slate-400">${e.category}</p>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-2 text-xs">
        <div class="bg-bg rounded p-2">
          <p class="text-slate-500">Manpower</p>
          <p class="font-bold text-slate-100">${e.composition.manpower.toLocaleString()}</p>
        </div>
        <div class="bg-bg rounded p-2">
          <p class="text-slate-500">Produção</p>
          <p class="font-bold text-green-400">$${(e.costs.production/1e6).toFixed(1)}M</p>
        </div>
      </div>
  `;t==="combat"&&e.stats?c+=`
      <div class="border-t border-bg-ring pt-2">
        <p class="text-xs font-bold text-slate-300 mb-2">Combat Stats:</p>
        <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-xs">
          ${e.stats.softAttack?`<div><span class="text-slate-500">Soft Attack:</span> <span class="text-slate-200">${e.stats.softAttack}</span></div>`:""}
          ${e.stats.hardAttack?`<div><span class="text-slate-500">Hard Attack:</span> <span class="text-slate-200">${e.stats.hardAttack}</span></div>`:""}
          ${e.stats.defense?`<div><span class="text-slate-500">Defense:</span> <span class="text-slate-200">${e.stats.defense}</span></div>`:""}
          ${e.stats.breakthrough?`<div><span class="text-slate-500">Breakthrough:</span> <span class="text-slate-200">${e.stats.breakthrough}</span></div>`:""}
          ${e.stats.organization?`<div><span class="text-slate-500">Organization:</span> <span class="text-slate-200">${e.stats.organization}</span></div>`:""}
          ${e.stats.combatWidth?`<div><span class="text-slate-500">Width:</span> <span class="text-slate-200">${e.stats.combatWidth}</span></div>`:""}
        </div>
      </div>
    `:t==="support"&&e.divisionBonuses&&(c+=`
      <div class="border-t border-bg-ring pt-2">
        <p class="text-xs font-bold text-brand-400 mb-2">Division Bonuses:</p>
        <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-xs">
          ${Object.entries(e.divisionBonuses).map(([l,u])=>`
            <div><span class="text-slate-500">${l}:</span> <span class="text-green-400">+${u}</span></div>
          `).join("")}
        </div>
      </div>
    `),e.composition.equipment&&Object.keys(e.composition.equipment).length>0&&(c+=`
      <div class="border-t border-bg-ring pt-2">
        <p class="text-xs font-bold text-slate-300 mb-2">Equipment:</p>
        <div class="space-y-1 text-xs">
          ${Object.entries(e.composition.equipment).map(([l,u])=>`
            <div class="flex justify-between">
              <span class="text-slate-400">${F(l)}</span>
              <span class="text-slate-200">${u}</span>
            </div>
          `).join("")}
        </div>
      </div>
    `),c+="</div>",n.innerHTML=c,document.body.appendChild(n);const r=i.currentTarget.getBoundingClientRect(),p=n.getBoundingClientRect();let d=r.right+10,m=r.top;d+p.width>window.innerWidth&&(d=r.left-p.width-10),m+p.height>window.innerHeight&&(m=window.innerHeight-p.height-10),n.style.left=d+"px",n.style.top=m+"px",n.style.opacity="0",b=setTimeout(()=>{n.parentElement&&(n.style.transition="opacity 0.2s",n.style.opacity="1")},100)}function A(i=!1){b&&(clearTimeout(b),b=null);const e=document.getElementById("unit-tooltip");e&&(i?e.remove():(e.style.opacity="0",b=setTimeout(()=>{e.parentElement&&e.remove()},200)))}export{ve as initDivisionCreator};
