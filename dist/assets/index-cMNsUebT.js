import"./preload-helper-f85Crcwt.js";/* empty css             */import{L as f,V as ie,a as p,s as W,b as u,c as Q,r as X,d as _,u as ae,g as re,e as le,f as ce,h as G,v as de}from"./firebase-COmVF2I9.js";import{r as K,f as D,a as ue,u as z,b as H,c as me}from"./renderer-DLfkB2Rz.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js";import"./resourceConsumptionCalculator-m-978Loo.js";import"./resourceProductionCalculator-DqTGEJNK.js";import"./consumerGoodsCalculator-Cxcetyr8.js";class ge{constructor(){this.focusableElements=[],this.currentFocusIndex=-1,this.skipLinks=[],this.announcements=new Set,this.init()}init(){this.createSkipLinks(),this.setupKeyboardNavigation(),this.setupFocusManagement(),this.setupLiveRegions(),this.setupAnnouncements(),this.setupColorContrastMode(),this.setupReducedMotion(),f.info("Sistema de acessibilidade inicializado")}createSkipLinks(){const e=document.createElement("div");e.className="skip-links sr-only-focusable",e.innerHTML=`
            <a href="#main-content" class="skip-link">Pular para conteúdo principal</a>
            <a href="#navigation" class="skip-link">Pular para navegação</a>
            <a href="#countries-list" class="skip-link">Pular para lista de países</a>
            <a href="#player-panel" class="skip-link">Pular para painel do jogador</a>
        `,document.body.insertBefore(e,document.body.firstChild),this.addSkipLinksStyles()}addSkipLinksStyles(){const e=document.createElement("style");e.textContent=`
            .skip-links {
                position: absolute;
                top: -40px;
                left: 6px;
                z-index: 1000;
            }
            
            .skip-link {
                position: absolute;
                top: -40px;
                left: 6px;
                background: #ffb400;
                color: #0b1020;
                padding: 8px;
                text-decoration: none;
                border-radius: 4px;
                font-weight: bold;
                font-size: 14px;
                transition: top 0.3s ease;
            }
            
            .skip-link:focus {
                top: 6px;
            }
            
            .sr-only {
                position: absolute !important;
                width: 1px !important;
                height: 1px !important;
                padding: 0 !important;
                margin: -1px !important;
                overflow: hidden !important;
                clip: rect(0, 0, 0, 0) !important;
                white-space: nowrap !important;
                border: 0 !important;
            }
            
            .sr-only-focusable:focus,
            .sr-only-focusable:active {
                position: static !important;
                width: auto !important;
                height: auto !important;
                padding: inherit !important;
                margin: inherit !important;
                overflow: visible !important;
                clip: auto !important;
                white-space: inherit !important;
            }
            
            /* Focus indicators melhorados */
            *:focus {
                outline: 2px solid #ffb400;
                outline-offset: 2px;
                border-radius: 4px;
            }
            
            button:focus,
            .country-card-button:focus {
                outline: 2px solid #ffb400;
                outline-offset: 2px;
                box-shadow: 0 0 0 4px rgba(255, 180, 0, 0.2);
            }
            
            /* High contrast mode */
            @media (prefers-contrast: high) {
                .kpi-card,
                .country-card-button,
                .player-panel {
                    border: 2px solid #ffffff;
                    background: #000000;
                    color: #ffffff;
                }
                
                .text-slate-400 {
                    color: #ffffff !important;
                }
                
                .bg-slate-900\\/60 {
                    background: #000000 !important;
                }
            }
            
            /* Reduced motion */
            @media (prefers-reduced-motion: reduce) {
                *,
                *::before,
                *::after {
                    animation-duration: 0.01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: 0.01ms !important;
                    scroll-behavior: auto !important;
                }
            }
        `,document.head.appendChild(e)}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{switch(e.key){case"Tab":this.handleTabNavigation(e);break;case"Escape":this.handleEscape(e);break;case"Enter":case" ":this.handleActivation(e);break;case"ArrowDown":case"ArrowUp":case"ArrowLeft":case"ArrowRight":this.handleArrowNavigation(e);break;case"Home":case"End":this.handleHomeEnd(e);break}})}handleTabNavigation(e){if(this.updateFocusableElements(),this.focusableElements.length===0)return;const o=this.focusableElements.indexOf(document.activeElement);if(e.shiftKey){const t=o<=0?this.focusableElements.length-1:o-1;this.focusableElements[t]?.focus()}else{const t=o>=this.focusableElements.length-1?0:o+1;this.focusableElements[t]?.focus()}}handleEscape(e){document.querySelectorAll('[role="dialog"]:not(.hidden)').forEach(s=>{s.classList.add("hidden");const i=s.getAttribute("data-trigger-element");i&&document.getElementById(i)?.focus()}),document.querySelectorAll('[aria-selected="true"]').forEach(s=>s.setAttribute("aria-selected","false"))}handleActivation(e){const o=e.target;o.getAttribute("role")==="button"&&o.tagName!=="BUTTON"&&(e.preventDefault(),o.click())}handleArrowNavigation(e){const o=e.target,t=o.closest('[role="grid"], [role="listbox"], [role="tablist"]');if(!t)return;e.preventDefault();const s=Array.from(t.querySelectorAll('[role="gridcell"], [role="option"], [role="tab"]')),i=s.indexOf(o);let a;switch(e.key){case"ArrowDown":a=Math.min(i+1,s.length-1);break;case"ArrowUp":a=Math.max(i-1,0);break;case"ArrowRight":a=Math.min(i+1,s.length-1);break;case"ArrowLeft":a=Math.max(i-1,0);break}a!==void 0&&s[a]&&(s[a].focus(),s.forEach((c,l)=>{c.setAttribute("aria-selected",l===a?"true":"false")}))}handleHomeEnd(e){const t=e.target.closest('[role="grid"], [role="listbox"]');if(!t)return;e.preventDefault();const s=Array.from(t.querySelectorAll('[role="gridcell"], [role="option"]'));e.key==="Home"&&s[0]?s[0].focus():e.key==="End"&&s[s.length-1]&&s[s.length-1].focus()}setupFocusManagement(){document.addEventListener("focusin",e=>{this.announceFocusContext(e.target)})}updateFocusableElements(){const e=`
            button:not([disabled]):not(.hidden),
            [href]:not([disabled]):not(.hidden),
            input:not([disabled]):not(.hidden),
            select:not([disabled]):not(.hidden),
            textarea:not([disabled]):not(.hidden),
            [tabindex]:not([tabindex="-1"]):not([disabled]):not(.hidden),
            [role="button"]:not([disabled]):not(.hidden),
            [role="link"]:not([disabled]):not(.hidden)
        `;this.focusableElements=Array.from(document.querySelectorAll(e)).filter(o=>{const t=getComputedStyle(o);return t.display!=="none"&&t.visibility!=="hidden"})}announceFocusContext(e){let o="";const t=e.closest(".country-card-button");if(t){const a=t.querySelector(".text-sm.font-semibold")?.textContent,c=t.querySelector('[class*="font-bold"]')?.textContent;o=`País: ${a}, Índice de poder: ${c}`}e.closest(".player-panel")&&(o="Painel do jogador");const i=e.closest('[role="dialog"]');i&&(o=`Modal: ${i.querySelector("h1, h2, h3")?.textContent||"Diálogo aberto"}`),o&&this.announce(o)}setupLiveRegions(){[{id:"live-polite",level:"polite"},{id:"live-assertive",level:"assertive"},{id:"live-status",level:"polite"}].forEach(o=>{if(!document.getElementById(o.id)){const t=document.createElement("div");t.id=o.id,t.className="sr-only",t.setAttribute("aria-live",o.level),t.setAttribute("aria-atomic","true"),document.body.appendChild(t)}})}setupAnnouncements(){const e=window.showNotification;e&&(window.showNotification=(o,t,s)=>(this.announce(`${o}: ${t}`,o==="error"?"assertive":"polite"),e(o,t,s)))}announce(e,o="polite"){const t=o==="assertive"?"live-assertive":"live-polite",s=document.getElementById(t);!s||this.announcements.has(e)||(this.announcements.add(e),s.textContent="",setTimeout(()=>{s.textContent=e,setTimeout(()=>{s.textContent="",this.announcements.delete(e)},5e3)},100),f.debug(`Anúncio (${o}): ${e}`))}setupColorContrastMode(){const e=window.matchMedia("(prefers-contrast: high)");this.applyContrastMode(e.matches),e.addEventListener("change",o=>{this.applyContrastMode(o.matches)}),this.createContrastToggle()}createContrastToggle(){const e=document.createElement("button");e.id="contrast-toggle",e.className="fixed top-4 left-4 z-50 px-3 py-2 bg-slate-900 text-white border border-slate-600 rounded-lg sr-only-focusable",e.innerHTML=`
            <span class="sr-only">Alternar modo alto contraste</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a4 4 0 004-4V5z" />
            </svg>
        `,e.addEventListener("click",()=>{const o=document.body.classList.toggle("high-contrast-mode");this.announce(`Modo alto contraste ${o?"ativado":"desativado"}`),localStorage.setItem("highContrastMode",o)}),document.body.appendChild(e),localStorage.getItem("highContrastMode")==="true"&&document.body.classList.add("high-contrast-mode")}applyContrastMode(e){document.body.classList.toggle("system-high-contrast",e),e&&this.announce("Modo alto contraste do sistema detectado")}setupReducedMotion(){const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.applyMotionPreference(e.matches),e.addEventListener("change",o=>{this.applyMotionPreference(o.matches)})}applyMotionPreference(e){document.body.classList.toggle("reduce-motion",e),e&&(window.DOMUtils&&(DOMUtils.animateCounter,DOMUtils.animateCounter=(o,t,s={})=>{const i=typeof o=="string"?document.getElementById(o):o;i&&(i.textContent=t.toLocaleString(s.locale||"pt-BR"),s.onComplete?.())}),this.announce("Animações reduzidas ativadas"))}improveSemantics(){if(!(document.querySelector("main")||document.querySelector("#main-content"))){const i=document.querySelector(".mx-auto.max-w-7xl")||document.body;i&&!i.querySelector("main")&&(i.setAttribute("role","main"),i.id="main-content")}const o=document.querySelector("nav");o&&!o.id&&(o.id="navigation",o.setAttribute("aria-label","Navegação principal"));const t=document.getElementById("lista-paises-publicos");t&&(t.setAttribute("role","grid"),t.setAttribute("aria-label","Lista de países disponíveis"),t.id="countries-list",t.querySelectorAll(".country-card-button").forEach((a,c)=>{a.setAttribute("role","gridcell"),a.setAttribute("aria-rowindex",Math.floor(c/4)+1),a.setAttribute("aria-colindex",c%4+1);const l=a.querySelector(".text-sm.font-semibold")?.textContent;l&&a.setAttribute("aria-label",`Selecionar país ${l}`)})),document.querySelectorAll("input, select, textarea").forEach(i=>{if(!i.getAttribute("aria-label")&&!i.id){const a=i.parentElement.querySelector("label");if(a){const c=`input-${Math.random().toString(36).substr(2,9)}`;i.id=c,a.setAttribute("for",c)}else{const c=i.getAttribute("placeholder");c&&i.setAttribute("aria-label",c)}}i.hasAttribute("required")&&i.setAttribute("aria-required","true")})}runAccessibilityCheck(){const e=[];document.querySelectorAll("img:not([alt])").forEach(i=>{e.push(`Imagem sem texto alternativo: ${i.src}`)}),document.querySelectorAll("*").forEach(i=>{const a=getComputedStyle(i),c=a.color,l=a.backgroundColor;c&&l&&c!=="rgba(0, 0, 0, 0)"&&l!=="rgba(0, 0, 0, 0)"&&f.debug("Elemento com cores definidas:",{color:c,background:l})}),document.querySelectorAll("button:not([aria-label]):not([title])").forEach(i=>{i.textContent.trim()||e.push(`Botão sem label: ${i.outerHTML.substring(0,50)}...`)});const t=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6"));let s=0;return t.forEach(i=>{const a=parseInt(i.tagName.charAt(1));a>s+1&&e.push(`Heading level skip: ${i.tagName} after h${s}`),s=a}),e.length>0?f.warn("Issues de acessibilidade encontrados:",e):f.info("Nenhum issue crítico de acessibilidade encontrado"),e}}const I=new ge,he={announce:(n,e)=>I.announce(n,e),focus:n=>{typeof n=="string"&&(n=document.getElementById(n)||document.querySelector(n)),n?.focus()},check:()=>I.runAccessibilityCheck(),improveSemantics:()=>I.improveSemantics()};document.addEventListener("DOMContentLoaded",()=>{I.improveSemantics(),f.info("Sistema de acessibilidade totalmente carregado")});class fe{constructor(){this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),this.isTablet=/iPad|Android.*Tablet/i.test(navigator.userAgent),this.hasTouch="ontouchstart"in window,this.viewportWidth=window.innerWidth,this.searchResults=[],this.currentSearchTerm="",this.searchIndex=null,(this.isMobile||this.hasTouch)&&this.init()}init(){f.info("🔧 Inicializando otimizações mobile"),this.setupMobileViewport(),this.addMobileClasses(),this.createSearchBar(),this.setupTouchGestures(),this.createMobileMenu(),this.setupMobilePanels(),this.createQuickActions(),this.optimizeForMobile(),f.info("✅ Otimizações mobile ativadas")}setupMobileViewport(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",e.content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes",document.head.appendChild(e));const o=document.createElement("style");o.textContent=`
            .no-zoom { touch-action: manipulation; }
            button, .country-card-button { touch-action: manipulation; }
        `,document.head.appendChild(o)}addMobileClasses(){document.body.classList.add(this.isMobile?"is-mobile":"is-desktop",this.isTablet?"is-tablet":"is-phone",this.hasTouch?"has-touch":"no-touch")}setupTouchGestures(){let e=0,o=0,t=!1;document.addEventListener("touchstart",s=>{window.scrollY===0&&(e=s.touches[0].clientY,t=!1)},{passive:!0}),document.addEventListener("touchmove",s=>{window.scrollY===0&&e>0&&(o=s.touches[0].clientY,o-e>60&&!t&&(t=!0,this.showPullToRefresh(),navigator.vibrate&&navigator.vibrate(30)))},{passive:!0}),document.addEventListener("touchend",()=>{t&&this.triggerRefresh(),this.hidePullToRefresh(),e=0,t=!1},{passive:!0}),this.setupSwipeGestures(),this.setupLongPress()}setupSwipeGestures(){let e=0,o=0,t=null;document.addEventListener("touchstart",s=>{const i=s.target.closest(".country-card-button");i&&(e=s.touches[0].clientX,o=s.touches[0].clientY,t=i)},{passive:!0}),document.addEventListener("touchmove",s=>{if(!t)return;const i=e-s.touches[0].clientX,a=o-s.touches[0].clientY;Math.abs(i)>Math.abs(a)&&Math.abs(i)>50&&(s.preventDefault(),this.showCardSwipeActions(t,i>0?"left":"right"))}),document.addEventListener("touchend",()=>{t&&(this.hideCardSwipeActions(t),t=null)},{passive:!0})}setupLongPress(){let e;document.addEventListener("touchstart",o=>{const t=o.target.closest(".country-card-button");t&&(e=setTimeout(()=>{this.showCardContextMenu(t,o.touches[0].clientX,o.touches[0].clientY),navigator.vibrate&&navigator.vibrate(50)},500))},{passive:!0}),document.addEventListener("touchend",()=>clearTimeout(e),{passive:!0}),document.addEventListener("touchmove",()=>clearTimeout(e),{passive:!0})}showPullToRefresh(){let e=document.getElementById("pull-refresh-indicator");e||(e=document.createElement("div"),e.id="pull-refresh-indicator",e.className="fixed top-16 left-1/2 transform -translate-x-1/2 z-50 bg-brand-500 text-slate-950 px-4 py-2 rounded-full shadow-lg flex items-center gap-2 transition-all",e.innerHTML='<div class="animate-spin h-4 w-4 border-2 border-slate-950/30 border-t-slate-950 rounded-full"></div><span class="text-sm font-medium">Puxe para atualizar</span>',document.body.appendChild(e)),e.style.transform="translate(-50%, 0)"}hidePullToRefresh(){const e=document.getElementById("pull-refresh-indicator");e&&(e.style.transform="translate(-50%, -100%)",setTimeout(()=>e.remove(),300))}triggerRefresh(){window.loadSiteData&&window.loadSiteData();const e=document.getElementById("pull-refresh-indicator");e&&(e.innerHTML='<svg class="h-4 w-4 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><span class="text-sm font-medium">Atualizado!</span>',e.className=e.className.replace("bg-brand-500","bg-emerald-500")),he.announce("Lista de países atualizada"),f.info("📱 Pull-to-refresh executado")}showCardSwipeActions(e,o){if(!e.querySelector(".swipe-indicator")){const t=document.createElement("div");t.className="swipe-indicator absolute inset-y-0 right-2 flex items-center text-brand-400 opacity-50",t.innerHTML=o==="left"?"👁️ Ver detalhes":"⭐ Favoritar",e.style.position="relative",e.appendChild(t)}}hideCardSwipeActions(e){const o=e.querySelector(".swipe-indicator");o&&o.remove()}showCardContextMenu(e,o,t){const s=e.querySelector(".text-sm.font-semibold")?.textContent,i=e.dataset.countryId,a=document.createElement("div");a.className="fixed z-50 bg-bg-soft border border-bg-ring/70 rounded-xl shadow-xl p-2 min-w-48",a.style.left=`${Math.min(o,window.innerWidth-200)}px`,a.style.top=`${Math.min(t,window.innerHeight-150)}px`,a.innerHTML=`
            <div class="text-sm font-medium text-slate-200 px-3 py-2 border-b border-bg-ring/50">${ie.sanitizeInput(s||"País")}</div>
            <button class="context-menu-item" data-action="view">...</button>
            ...
        `,a.querySelectorAll(".context-menu-item").forEach(l=>l.addEventListener("click",()=>{this.handleContextAction(l.dataset.action,i,s),a.remove()}));const c=l=>{a.contains(l.target)||(a.remove(),document.removeEventListener("touchstart",c))};document.addEventListener("touchstart",c),document.body.appendChild(a)}handleContextAction(e,o,t){}createMobileMenu(){}showMobileMenu(){}addMobileMenuStyles(){}setupMobilePanels(){}convertToSlideUp(e,o){}showSlideUpPanel(e,o){}setupSwipeToClose(e,o){}createQuickActions(){}openQuickActions(e){}closeQuickActions(e){}optimizeForMobile(){}addShowMoreButton(e,o){}debounceScrollEvents(){}toggleFavorite(e,o){}shareCountry(e,o){}addToCompare(e,o){}showFavorites(){}updateFavoriteIndicators(){}createSearchBar(){}setupSearchFunctionality(){}performSearch(e){}createSearchIndex(e){}fuzzySearch(e,o){}fuzzyMatch(e,o){}getRegion(e){}}document.addEventListener("DOMContentLoaded",()=>{const n=new fe;window.__MOBILE_OPTIMIZATIONS__=n});const M=document.getElementById("auth-button"),v=document.getElementById("main-login-btn"),pe=document.getElementById("hero-blurb"),k=document.getElementById("hero-facebook-btn");function Y(){return pe||(document.querySelector("h1.text-4xl")?document.querySelector("h1.text-4xl").parentElement:null)}const b=document.getElementById("turn-post-button"),F=document.getElementById("filtro-visibilidade"),J=document.getElementById("refresh-paises"),Z=document.getElementById("search-country-input"),j=document.getElementById("turno-editor");document.getElementById("last-sync");const B=document.getElementById("lista-paises-publicos"),m=document.getElementById("country-panel-modal"),ee=document.getElementById("close-country-panel"),y=document.getElementById("auth-modal"),E=document.getElementById("login-tab"),w=document.getElementById("register-tab"),x=document.getElementById("login-form"),A=document.getElementById("register-form"),te=document.getElementById("google-login-btn"),oe=document.getElementById("close-auth-modal"),P=document.getElementById("auth-error-message"),T=document.getElementById("auth-success-message");let r={allCountries:[],gameConfig:{},isDataLoaded:!1},L="login";function q(n="login"){L=n,S(),y.classList.remove("hidden"),h()}function g(){y.classList.add("hidden"),h(),be()}function S(){const n=L==="login";n?(E.classList.add("bg-brand-500","text-slate-950"),E.classList.remove("text-slate-300","hover:text-slate-100"),w.classList.remove("bg-brand-500","text-slate-950"),w.classList.add("text-slate-300","hover:text-slate-100")):(w.classList.add("bg-brand-500","text-slate-950"),w.classList.remove("text-slate-300","hover:text-slate-100"),E.classList.remove("bg-brand-500","text-slate-950"),E.classList.add("text-slate-300","hover:text-slate-100")),n?(x.classList.remove("hidden"),A.classList.add("hidden"),document.getElementById("auth-modal-title").textContent="Entrar no Portal",document.getElementById("auth-modal-subtitle").textContent="Acesse sua conta"):(x.classList.add("hidden"),A.classList.remove("hidden"),document.getElementById("auth-modal-title").textContent="Criar Conta",document.getElementById("auth-modal-subtitle").textContent="Registre-se para começar")}function h(){P.classList.add("hidden"),T.classList.add("hidden")}function d(n){P.textContent=n,P.classList.remove("hidden"),T.classList.add("hidden")}function ne(n){T.textContent=n,T.classList.remove("hidden"),P.classList.add("hidden")}function be(){x.reset(),A.reset()}async function R(){console.log("Carregando dados do site...");try{if(document.querySelectorAll(".loading-shimmer").forEach(n=>n.style.display="inline"),r.allCountries=await re(),r.gameConfig=await le(),console.log("Países carregados:",r.allCountries.length),console.log("Config do jogo:",r.gameConfig),r.allCountries.length>0){z(r.allCountries),C();const n=document.getElementById("turno-atual");n&&r.gameConfig&&r.gameConfig.turnoAtual&&(n.textContent=`#${r.gameConfig.turnoAtual}`),document.querySelectorAll(".loading-shimmer").forEach(e=>e.style.display="none"),r.isDataLoaded=!0,Ce()}else console.warn("Nenhum país encontrado no Firestore"),u("warning","Nenhum país encontrado. Verifique a configuração do Firestore.")}catch(n){console.error("Erro ao carregar dados:",n),u("error","Erro ao carregar dados do servidor.")}ve(),p.currentUser&&b&&r.gameConfig&&r.gameConfig.turnoAtual&&(b.textContent=`Ver turno #${r.gameConfig.turnoAtual} (Facebook)`)}function C(){const n=F.value,e=Z.value.toLowerCase();let o=[];n==="todos"?o=r.allCountries:n==="publicos"?o=r.allCountries.filter(t=>t.Visibilidade&&t.Visibilidade.toLowerCase()==="público"):n==="privados"?o=r.allCountries.filter(t=>t.Visibilidade&&t.Visibilidade.toLowerCase()==="privado"):n==="com-jogadores"?o=r.allCountries.filter(t=>t.Player):n==="sem-jogadores"&&(o=r.allCountries.filter(t=>!t.Player)),e&&(o=o.filter(t=>t.Pais&&t.Pais.toLowerCase().includes(e))),console.log(`Renderizando ${o.length} países (filtro: ${n}, busca: ${e})`),ue(o),ye()}M.addEventListener("click",()=>{console.log("Botão auth clicado"),p.currentUser?(console.log("Fazendo logout"),p.signOut()):(console.log("Abrindo modal de login"),q("login"))});v.addEventListener("click",()=>{console.log("Botão main login clicado"),q("login")});E.addEventListener("click",()=>{L="login",S(),h()});w.addEventListener("click",()=>{L="register",S(),h()});oe.addEventListener("click",g);ee.addEventListener("click",()=>{m.classList.add("hidden")});te.addEventListener("click",async()=>{console.log("Tentando login com Google"),h();try{const n=await W();console.log("Resultado do login Google:",n),n.success?(g(),u("success",`Bem-vindo, ${n.user.displayName}!`)):(console.error("Erro no login Google:",n.error),d(n.error?n.error.message:"Erro no login com Google."))}catch(n){console.error("Erro inesperado no login Google:",n),d("Erro inesperado no login com Google.")}});x.addEventListener("submit",async n=>{n.preventDefault(),console.log("Submetendo form de login"),h();const e=document.getElementById("login-email").value,o=document.getElementById("login-password").value;console.log("Tentando login com email:",e);try{const t=await Q(e,o);console.log("Resultado do login:",t),t.success?(g(),u("success","Login realizado com sucesso!")):(console.error("Erro no login:",t.error),d(t.error?t.error.message:"Erro no login."))}catch(t){console.error("Erro inesperado no login:",t),d("Erro inesperado no login.")}});A.addEventListener("submit",async n=>{n.preventDefault(),console.log("Submetendo form de registro"),h();const e=document.getElementById("register-name").value,o=document.getElementById("register-email").value,t=document.getElementById("register-password").value,s=document.getElementById("register-confirm-password").value;if(t!==s){d("As senhas não coincidem.");return}if(t.length<6){d("A senha deve ter pelo menos 6 caracteres.");return}console.log("Tentando registro com email:",o);try{const i=await X(o,t,e);console.log("Resultado do registro:",i),i.success?(ne("Conta criada com sucesso! Redirecionando..."),setTimeout(()=>{g(),u("success",`Bem-vindo ao WAR, ${e}!`)},1500)):(console.error("Erro no registro:",i.error),d(i.error?i.error.message:"Erro no registro."))}catch(i){console.error("Erro inesperado no registro:",i),d("Erro inesperado no registro.")}});y.addEventListener("click",n=>{n.target===y&&g()});m.addEventListener("click",n=>{n.target===m&&m.classList.add("hidden")});B&&B.addEventListener("click",n=>{const e=n.target.closest(".country-card-button");if(!e)return;n.preventDefault();const o=e.dataset.countryId,t=r.allCountries.find(s=>s.id===o);t&&K(t)});document.addEventListener("keydown",n=>{n.key==="Escape"&&(y.classList.contains("hidden")||g(),m.classList.contains("hidden")||m.classList.add("hidden"))});F.addEventListener("change",C);Z.addEventListener("input",C);J.addEventListener("click",R);function ye(){const n=document.querySelectorAll(".country-card-button");n.forEach(e=>{e.addEventListener("click",o=>{o.preventDefault();const t=e.dataset.countryId,s=r.allCountries.find(i=>i.id===t);s&&(console.log("País clicado:",s.Pais),u("info",`Você clicou em ${s.Pais}`))})}),console.log(`Event listeners adicionados para ${n.length} países`)}function ve(){const n=new Date,e=document.getElementById("last-sync");e&&(e.textContent=n.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}))}async function Ee(n){if(console.log("Mudança de estado de autenticação:",n?"Logado":"Deslogado"),n){M.querySelector(".btn-text").textContent="Sair";const e=Y();e&&e.classList.add("hidden"),b&&b.classList.remove("hidden"),v&&v.classList.add("hidden"),k&&k.classList.add("hidden"),console.log("Usuário logado:",n.displayName||n.email);try{const o=await _(n.uid);console.log("Permissões do usuário:",o),H(o.isNarrator,o.isAdmin);const t=await ce(n.uid);if(console.log("País do jogador:",t),t){const s=r.allCountries.find(i=>i.id===t);s&&(localStorage.setItem("loggedCountry",s.id),console.log("País salvo no localStorage (main):",s.id),D(s,r.gameConfig.turnoAtual))}else{const s=r.allCountries.filter(i=>!i.Player);if(s.length>0){const i=me(s);we(i,n.uid)}else u("warning","Não há países disponíveis para seleção no momento.")}}catch(o){console.error("Erro ao processar login do usuário:",o),u("error","Erro ao carregar dados do usuário.")}}else{M.querySelector(".btn-text").textContent="Entrar",H(!1,!1),D(null),se();const e=Y();e&&e.classList.remove("hidden"),b&&b.classList.add("hidden"),v&&v.classList.remove("hidden"),k&&k.classList.remove("hidden")}}function we(n,e){let o=null;const t=n.querySelectorAll(".pais-option"),s=n.querySelector("#confirmar-selecao"),i=n.querySelector("#cancelar-selecao"),a=n.querySelector("#busca-pais"),c=n.querySelector("#paises-visiveis");t.forEach(l=>{l.addEventListener("click",()=>{t.forEach($=>$.classList.remove("border-brand-500","bg-brand-500/10")),l.classList.add("border-brand-500","bg-brand-500/10"),o={id:l.dataset.paisId,name:l.dataset.paisNome},s.disabled=!1})}),a&&c&&a.addEventListener("input",l=>{const $=l.target.value.toLowerCase();let U=0;t.forEach(V=>{const O=V.dataset.paisNome.toLowerCase().includes($);V.style.display=O?"block":"none",O&&U++}),c.textContent=U}),s&&s.addEventListener("click",async()=>{if(o){s.textContent="Vinculando...",s.disabled=!0;try{await de(e,o.id),n.remove(),u("success",`Você agora governa ${o.name}!`),R()}catch(l){u("error","Erro ao vincular país. Tente novamente."),console.error("Erro ao vincular país:",l)}finally{s.textContent="Confirmar Seleção",s.disabled=!1}}}),i&&i.addEventListener("click",()=>{n.remove()})}M.addEventListener("click",()=>{console.log("Botão auth clicado"),p.currentUser?(console.log("Fazendo logout"),p.signOut()):(console.log("Abrindo modal de login"),q("login"))});v.addEventListener("click",()=>{console.log("Botão main login clicado"),q("login")});E.addEventListener("click",()=>{L="login",S(),h()});w.addEventListener("click",()=>{L="register",S(),h()});oe.addEventListener("click",g);ee.addEventListener("click",()=>{m.classList.add("hidden")});te.addEventListener("click",async()=>{console.log("Tentando login com Google"),h();try{const n=await W();console.log("Resultado do login Google:",n),n.success?(g(),u("success",`Bem-vindo, ${n.user.displayName}!`)):(console.error("Erro no login Google:",n.error),d(n.error?n.error.message:"Erro no login com Google."))}catch(n){console.error("Erro inesperado no login Google:",n),d("Erro inesperado no login com Google.")}});x.addEventListener("submit",async n=>{n.preventDefault(),console.log("Submetendo form de login"),h();const e=document.getElementById("login-email").value,o=document.getElementById("login-password").value;console.log("Tentando login com email:",e);try{const t=await Q(e,o);console.log("Resultado do login:",t),t.success?(g(),u("success","Login realizado com sucesso!")):(console.error("Erro no login:",t.error),d(t.error?t.error.message:"Erro no login."))}catch(t){console.error("Erro inesperado no login:",t),d("Erro inesperado no login.")}});A.addEventListener("submit",async n=>{n.preventDefault(),console.log("Submetendo form de registro"),h();const e=document.getElementById("register-name").value,o=document.getElementById("register-email").value,t=document.getElementById("register-password").value,s=document.getElementById("register-confirm-password").value;if(t!==s){d("As senhas não coincidem.");return}if(t.length<6){d("A senha deve ter pelo menos 6 caracteres.");return}console.log("Tentando registro com email:",o);try{const i=await X(o,t,e);console.log("Resultado do registro:",i),i.success?(ne("Conta criada com sucesso! Redirecionando..."),setTimeout(()=>{g(),u("success",`Bem-vindo ao WAR, ${e}!`)},1500)):(console.error("Erro no registro:",i.error),d(i.error?i.error.message:"Erro no registro."))}catch(i){console.error("Erro inesperado no registro:",i),d("Erro inesperado no registro.")}});y.addEventListener("click",n=>{n.target===y&&g()});m.addEventListener("click",n=>{n.target===m&&m.classList.add("hidden")});B&&B.addEventListener("click",n=>{const e=n.target.closest(".country-card-button");if(!e)return;n.preventDefault();const o=e.dataset.countryId,t=r.allCountries.find(s=>s.id===o);t&&K(t)});document.addEventListener("keydown",n=>{n.key==="Escape"&&(y.classList.contains("hidden")||g(),m.classList.contains("hidden")||m.classList.add("hidden"))});F.addEventListener("change",C);J.addEventListener("click",R);j&&j.addEventListener("change",async n=>{const e=n.target.value;if(p.currentUser&&(await _(p.currentUser.uid)).isNarrator)if(await ae(e)){u("success",`Turno atualizado para #${e}`),r.gameConfig.turnoAtual=e;const s=r.allCountries.find(i=>i.Player===p.currentUser.uid);s&&localStorage.setItem("loggedCountry",s.id),D(s,e)}else u("error","Erro ao salvar turno.")});p.onAuthStateChanged(Ee);let N=new Map;function Ce(){console.log("Configurando sincronização em tempo real...");const n=G.collection("paises").onSnapshot(o=>{console.log("Mudanças detectadas na coleção de países"),o.docChanges().forEach(t=>{const s={id:t.doc.id,...t.doc.data()},i=r.allCountries.findIndex(a=>a.id===t.doc.id);t.type==="added"&&i===-1?(r.allCountries.push(s),console.log(`País adicionado: ${s.Pais}`)):t.type==="modified"&&i!==-1?(r.allCountries[i]=s,console.log(`País atualizado: ${s.Pais}`)):t.type==="removed"&&i!==-1&&(r.allCountries.splice(i,1),console.log(`País removido: ${s.Pais}`))}),r.isDataLoaded&&(z(r.allCountries),C(),console.log("Interface atualizada automaticamente"))},o=>{console.error("Erro no listener de países:",o)});N.set("countries",n),window.addEventListener("realtime:update",o=>{console.log("Evento realtime:update recebido:",o.detail);const{countryId:t,section:s,field:i,newValue:a}=o.detail,c=r.allCountries.findIndex(l=>l.id===t);if(c!==-1){const l=r.allCountries[c];l[s]||(l[s]={}),l[s][i]=a,s==="geral"&&(l[i]=a),console.log(`Campo ${i} do país ${l.Pais} atualizado via broadcast:`,a),z(r.allCountries),C()}});const e=G.collection("configuracoes").doc("jogo").onSnapshot(o=>{if(o.exists){const t=o.data();if(r.gameConfig.turnoAtual!==t.turnoAtual){console.log(`Turno atualizado: ${r.gameConfig.turnoAtual} → ${t.turnoAtual}`),r.gameConfig=t;const s=document.getElementById("turno-atual");s&&(s.textContent=`#${t.turnoAtual}`),b&&(b.textContent=`Ver turno #${t.turnoAtual} (Facebook)`)}}},o=>{console.error("Erro no listener de configuração:",o)});N.set("config",e),console.log("Sincronização em tempo real ativada ✅")}function se(){console.log("Removendo listeners de tempo real..."),N.forEach(n=>n()),N.clear()}window.addEventListener("beforeunload",()=>{se()});document.addEventListener("DOMContentLoaded",()=>{console.log("DOM carregado, iniciando aplicação"),R()});
